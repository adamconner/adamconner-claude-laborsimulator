<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Labor Market Impact Simulator</title>
    <link rel="stylesheet" href="public/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Overlay (for mobile) -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileMenu()"></div>

        <!-- Mobile Floating Action Button -->
        <button class="mobile-fab" onclick="openMobileMenu()" aria-label="Configure scenario" title="Configure Scenario">
            ‚öôÔ∏è
        </button>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-close" id="sidebarClose" onclick="closeMobileMenu()" aria-label="Close menu">&times;</button>
            <div class="sidebar-header">
                <h2>AI Labor Market Simulator</h2>
                <p style="font-size: 0.875rem; color: var(--gray-400); margin-top: 8px;">
                    Model AI's impact on employment
                </p>
            </div>

            <!-- Reset All Button -->
            <div class="sidebar-section" style="padding-top: 0;">
                <button class="btn btn-outline btn-block" onclick="resetEverything()" style="border-color: var(--danger); color: var(--danger);">
                    Reset Everything
                </button>
            </div>

            <!-- Scenario Configuration -->
            <div class="sidebar-section">
                <h3>Scenario Configuration</h3>

                <div class="form-group">
                    <label>Scenario Name</label>
                    <input type="text" id="scenarioName" value="My Scenario" placeholder="Enter scenario name">
                </div>

                <div class="form-group">
                    <label>Target Year</label>
                    <select id="targetYear">
                        <option value="2026">2026 (2 years)</option>
                        <option value="2027">2027 (3 years)</option>
                        <option value="2028">2028 (4 years)</option>
                        <option value="2029" selected>2029 (5 years)</option>
                        <option value="2034">2034 (10 years)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Target Unemployment Rate: <span id="urValue">10.0</span>%</label>
                    <input type="range" id="targetUR" min="2" max="40" step="0.5" value="10">
                </div>

                <div class="form-group">
                    <label>AI Adoption Rate: <span id="aiValue">70</span>%</label>
                    <input type="range" id="aiAdoption" min="20" max="100" step="5" value="70">
                </div>

                <div class="form-group">
                    <label>Automation Pace</label>
                    <select id="automationPace">
                        <option value="slow">Slow</option>
                        <option value="moderate" selected>Moderate</option>
                        <option value="fast">Fast</option>
                        <option value="accelerating">Accelerating</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Adoption Curve</label>
                    <select id="adoptionCurve">
                        <option value="linear">Linear</option>
                        <option value="s_curve" selected>S-Curve (Logistic)</option>
                        <option value="exponential">Exponential</option>
                    </select>
                </div>
            </div>

            <!-- Preset Scenarios -->
            <div class="sidebar-section">
                <h3>Preset Scenarios</h3>
                <button class="preset-btn" onclick="loadPreset('moderate')">
                    <div class="title">Moderate Disruption</div>
                    <div class="desc">8% unemployment, gradual AI adoption</div>
                </button>
                <button class="preset-btn" onclick="loadPreset('rapid')">
                    <div class="title">Rapid Automation</div>
                    <div class="desc">12% unemployment, accelerated AI</div>
                </button>
                <button class="preset-btn" onclick="loadPreset('managed')">
                    <div class="title">Managed Transition</div>
                    <div class="desc">6% unemployment with interventions</div>
                </button>
            </div>

            <!-- Interventions -->
            <div class="sidebar-section">
                <h3>Policy Interventions</h3>
                <div id="interventionsList"></div>
                <button class="btn btn-outline btn-block btn-sm" onclick="showInterventionModal()">
                    + Add Intervention
                </button>
            </div>

            <!-- Target Unemployment Optimizer -->
            <div class="sidebar-section" id="targetOptimizerSection">
                <h3>Target Unemployment</h3>

                <!-- Target Toggle -->
                <div class="form-group" style="margin-bottom: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="enableTargetOptimizer" onchange="toggleTargetOptimizer()" style="width: 18px; height: 18px;">
                        <span>Set Target Rate</span>
                    </label>
                </div>

                <!-- Target Rate Controls (hidden by default) -->
                <div id="targetOptimizerControls" style="display: none; margin-bottom: 12px;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Target Unemployment: <span id="targetURValue">5.0</span>%</label>
                        <input type="range" id="targetUnemploymentRate" min="2" max="15" step="0.5" value="5"
                               oninput="document.getElementById('targetURValue').textContent = this.value">
                    </div>
                </div>

                <!-- Baseline Display -->
                <div style="background: var(--gray-700); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                    <div style="font-size: 0.7rem; color: var(--gray-400); text-transform: uppercase; margin-bottom: 4px;">
                        Projected with AI (no interventions)
                    </div>
                    <div id="baselineUnemploymentDisplay" style="font-size: 1.5rem; font-weight: 700; color: var(--warning);">
                        --
                    </div>
                    <div style="font-size: 0.7rem; color: var(--gray-500);">
                        Run simulation to calculate
                    </div>
                </div>

                <!-- Optimizer Button and Results (shown when target enabled) -->
                <div id="optimizerActions" style="display: none;">
                    <button class="btn btn-secondary btn-block" onclick="optimizeInterventions()" id="optimizeBtn">
                        <span style="margin-right: 6px;">&#9881;</span> Find Intervention Mix
                    </button>

                    <!-- Optimization Results -->
                    <div id="optimizationResults" style="margin-top: 12px; display: none;">
                        <div style="font-size: 0.75rem; color: var(--gray-400); text-transform: uppercase; margin-bottom: 8px;">
                            Recommended Mix
                        </div>
                        <div id="optimizationContent">
                            <!-- Results inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Run Simulation -->
            <div class="sidebar-section">
                <button class="btn btn-primary btn-block btn-lg" onclick="runSimulation()">
                    Run Simulation
                </button>
                <button class="btn btn-block btn-lg ai-sim-btn" onclick="runAdvancedAISimulation()" style="margin-top: 8px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border: none;">
                    <span style="margin-right: 6px;">‚ú®</span> Advanced AI Simulation
                </button>
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                    <button class="btn btn-outline btn-block" onclick="resetToDefaults()">
                        Reset
                    </button>
                    <button class="btn btn-outline btn-block" onclick="copyScenarioURL()" title="Copy shareable URL">
                        Share URL
                    </button>
                </div>
            </div>

            <!-- AI Model Status -->
            <div class="sidebar-section" id="ai-model-status-section">
                <h3>AI Model</h3>
                <div id="aiModelStatus">
                    <p style="font-size: 0.75rem; color: var(--gray-400);">No AI simulations yet</p>
                </div>
                <button class="btn btn-sm btn-outline btn-block" onclick="showTrainingModal()" style="margin-top: 8px;">
                    Train Model
                </button>
            </div>

            <!-- Saved Simulations -->
            <div class="sidebar-section">
                <h3>Saved Simulations</h3>
                <div id="savedSimulationsList">
                    <p style="font-size: 0.875rem; color: var(--gray-400);">No saved simulations</p>
                </div>
            </div>

            <!-- Author Credit & Contact -->
            <div class="sidebar-section" style="margin-top: auto; border-top: 1px solid var(--gray-700); padding-top: 16px;">
                <div style="text-align: center;">
                    <p style="font-size: 0.875rem; color: var(--gray-400); margin-bottom: 12px;">
                        A project by <a href="https://adamconner.com" target="_blank" style="color: var(--primary); text-decoration: none; font-weight: 500;">Adam Conner</a>
                    </p>
                    <a href="mailto:contact@adamconner.com" class="btn btn-outline btn-block btn-sm" style="border-color: var(--gray-600); color: var(--gray-300);">
                        Contact Me
                    </a>
                </div>
            </div>

        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="openMobileMenu()" aria-label="Open menu">
                    <span class="menu-icon">‚ò∞</span>
                    <span class="menu-label">Configure</span>
                </button>
                <h1>AI Labor Market Impact Analysis</h1>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="saveSimulation()">Save Simulation</button>
                    <button class="btn btn-primary" onclick="shareSimulation()" id="shareBtn" style="display: none;">Share Publicly</button>
                    <button class="btn btn-outline" onclick="exportResults()">Export Results</button>
                    <button class="btn btn-outline" onclick="showHistoryModal()" id="historyBtn" title="View simulation history">
                        <span>üìú</span> History
                    </button>
                    <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle" title="Toggle dark mode">
                        <span id="themeIcon">üåô</span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetToDefaults()">Reset to Defaults</button>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('snapshot')">Current Snapshot</button>
                <button class="nav-tab" onclick="showSection('realmetrics')">Real Economic Metrics</button>
                <button class="nav-tab" onclick="showSection('indicators')">AI Indicators</button>
                <button class="nav-tab" onclick="showSection('simulation')">Simulation Results</button>
                <button class="nav-tab" onclick="showSection('comparison')">Compare Scenarios</button>
                <button class="nav-tab" onclick="showSection('occupations')">Occupations</button>
                <button class="nav-tab" onclick="showSection('sectors')">Sector Analysis</button>
                <button class="nav-tab" onclick="showSection('sensitivity')">Sensitivity</button>
                <button class="nav-tab" onclick="showSection('interventions')">Intervention Impact</button>
                <button class="nav-tab" onclick="showSection('abm')" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); border: 1px solid rgba(99, 102, 241, 0.3);">Agent-Based Model</button>
                <button class="nav-tab" onclick="showSection('settings')">Settings</button>
            </nav>

            <!-- Current Snapshot Section -->
            <section id="snapshot-section" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="label">Unemployment Rate</div>
                        <div class="value" id="stat-ur">4.1%</div>
                        <div class="change positive">‚Üì 0.2% from last month</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Total Employment</div>
                        <div class="value" id="stat-emp">161.2M</div>
                        <div class="change positive">‚Üë +145K jobs</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Labor Force Participation</div>
                        <div class="value" id="stat-lfpr">62.6%</div>
                        <div class="change">Unchanged</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Job Openings</div>
                        <div class="value" id="stat-jo">7.4M</div>
                        <div class="change negative">‚Üì -1.8M YoY</div>
                    </div>
                </div>

                <div class="card-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Historical Unemployment Trend</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="historicalChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Labor Market Health</h3>
                        </div>
                        <div class="indicator-list">
                            <div class="indicator-item">
                                <div>
                                    <div class="indicator-name">Average Hourly Earnings</div>
                                    <div class="indicator-source">BLS, Oct 2024</div>
                                </div>
                                <div class="indicator-value">$35.46</div>
                            </div>
                            <div class="indicator-item">
                                <div>
                                    <div class="indicator-name">Real Wage Growth</div>
                                    <div class="indicator-source">BLS, Oct 2024</div>
                                </div>
                                <div class="indicator-value">+1.4%</div>
                            </div>
                            <div class="indicator-item">
                                <div>
                                    <div class="indicator-name">Productivity Growth</div>
                                    <div class="indicator-source">BLS, Q3 2024</div>
                                </div>
                                <div class="indicator-value">+2.2%</div>
                            </div>
                            <div class="indicator-item">
                                <div>
                                    <div class="indicator-name">Quits Rate</div>
                                    <div class="indicator-source">JOLTS, Sep 2024</div>
                                </div>
                                <div class="indicator-value">2.1%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Employment by Sector</h3>
                    </div>
                    <div class="chart-container large">
                        <canvas id="sectorEmploymentChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Real Metrics Section -->
            <section id="realmetrics-section" class="section">
                <!-- Real Economic Indicators -->
                <div class="card" style="margin-bottom: 24px; border-left: 4px solid var(--secondary);">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                        <div>
                            <h3>Real Economic Metrics</h3>
                            <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 4px;">
                                Actual government data from BLS, FRED, Census, and other official sources
                            </p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <span class="tag tag-low">Verified Sources</span>
                            <button class="btn btn-sm btn-outline" onclick="resetAllRealMetrics()">Reset All</button>
                        </div>
                    </div>

                    <div id="realMetricsList" style="margin-top: 16px;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Data Sources Reference -->
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Data Sources & Methodology</h3>
                        <button class="btn btn-sm btn-outline" onclick="toggleRealMetricsSourcesDetails()">Show Details</button>
                    </div>
                    <div id="realMetricsSourcesDetails" style="display: none; margin-top: 16px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Type</th>
                                    <th>Data Provided</th>
                                    <th>Update Frequency</th>
                                    <th>Link</th>
                                </tr>
                            </thead>
                            <tbody id="realMetricsSourcesTable">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- AI Indicators Section -->
            <section id="indicators-section" class="section">
                <!-- Real Indicators (Current Data) -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Real AI Indicators (Current Data)</h3>
                        <span class="tag tag-low">Verified Sources</span>
                    </div>
                    <div class="stats-grid" style="margin-top: 16px;">
                        <div class="stat-card">
                            <div class="label">Companies Using AI</div>
                            <div class="value">35%</div>
                            <div class="change positive">‚Üë McKinsey Survey</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">AI Investment (2024)</div>
                            <div class="value">$189B</div>
                            <div class="change positive">Stanford AI Index</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">GenAI Weekly Users</div>
                            <div class="value">23%</div>
                            <div class="change positive">Census RPS Survey</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">AI Job Postings</div>
                            <div class="value">2.3%</div>
                            <div class="change">Indeed/LinkedIn</div>
                        </div>
                    </div>
                </div>

                <!-- Hypothetical Indicators -->
                <div class="card" style="margin-bottom: 24px; border-left: 4px solid var(--warning);">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                        <div>
                            <h3>Hypothetical AI Impact Indicators</h3>
                            <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 4px;">
                                Research-based metrics that would measure AI's labor market impact if tracked systematically
                            </p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-sm btn-outline" onclick="resetAllHypotheticalIndicators()">Reset All</button>
                            <button class="btn btn-sm btn-primary" onclick="showCustomIndicatorModal()">+ Add Custom</button>
                        </div>
                    </div>

                    <div id="hypotheticalIndicatorsList" style="margin-top: 16px;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Data Sources Reference -->
                <div class="card">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Research Sources & Methodology</h3>
                        <button class="btn btn-sm btn-outline" onclick="toggleSourcesDetails()">Show Details</button>
                    </div>
                    <div id="sourcesDetails" style="display: none; margin-top: 16px;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Source</th>
                                    <th>Organization</th>
                                    <th>Indicators Derived</th>
                                    <th>Link</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Anthropic Economic Index</strong></td>
                                    <td>Anthropic</td>
                                    <td>Task Automation Rate, Human-AI Collaboration</td>
                                    <td><a href="https://www.anthropic.com/economic-index" target="_blank" style="color: var(--primary);">View</a></td>
                                </tr>
                                <tr>
                                    <td><strong>Iceberg Index</strong></td>
                                    <td>MIT / Oak Ridge</td>
                                    <td>Skills Transformation Score</td>
                                    <td><a href="https://iceberg.mit.edu" target="_blank" style="color: var(--primary);">View</a></td>
                                </tr>
                                <tr>
                                    <td><strong>AIOE Index</strong></td>
                                    <td>Felten, Raj, Seamans</td>
                                    <td>AI Occupational Exposure</td>
                                    <td><a href="https://www.aeaweb.org/articles?id=10.1257/pandp.20181019" target="_blank" style="color: var(--primary);">View</a></td>
                                </tr>
                                <tr>
                                    <td><strong>Budget Lab Analysis</strong></td>
                                    <td>Yale</td>
                                    <td>Job Displacement Velocity</td>
                                    <td><a href="https://budgetlab.yale.edu" target="_blank" style="color: var(--primary);">View</a></td>
                                </tr>
                                <tr>
                                    <td><strong>IMF Working Papers</strong></td>
                                    <td>IMF</td>
                                    <td>Regional Vulnerability, Labor Share</td>
                                    <td><a href="https://www.imf.org/en/Publications/WP" target="_blank" style="color: var(--primary);">View</a></td>
                                </tr>
                                <tr>
                                    <td><strong>GenAI & Jobs Report</strong></td>
                                    <td>ILO</td>
                                    <td>Human-AI Collaboration Index</td>
                                    <td><a href="https://www.ilo.org" target="_blank" style="color: var(--primary);">View</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Simulation Results Section -->
            <section id="simulation-section" class="section">
                <div id="simulation-results">
                    <div class="card" style="text-align: center; padding: 60px;">
                        <h3 style="margin-bottom: 16px;">No Simulation Run Yet</h3>
                        <p style="color: var(--gray-500); margin-bottom: 24px;">
                            Configure your scenario parameters and click "Run Simulation" to see projected impacts.
                        </p>
                        <button class="btn btn-primary" onclick="runSimulation()">Run Simulation</button>
                    </div>
                </div>
            </section>

            <!-- Scenario Comparison Section -->
            <section id="comparison-section" class="section">
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3>Scenario Comparison</h3>
                            <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                                Compare up to 3 scenarios side-by-side to analyze different outcomes
                            </p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <span id="comparisonCount" class="tag tag-medium">0/3 scenarios</span>
                            <button class="btn btn-sm btn-outline" onclick="clearAllComparisons()" id="clearComparisonBtn" style="display: none;">
                                Clear All
                            </button>
                        </div>
                    </div>
                </div>
                <div id="comparison-content">
                    <div class="card" style="text-align: center; padding: 60px;">
                        <h3 style="margin-bottom: 16px;">No Scenarios to Compare</h3>
                        <p style="color: var(--gray-500); margin-bottom: 24px;">
                            Run simulations and click "Add to Comparison" to compare scenarios side-by-side.
                        </p>
                        <button class="btn btn-primary" onclick="showSection('simulation'); document.querySelectorAll('.nav-tab')[3].click();">
                            Run a Simulation
                        </button>
                    </div>
                </div>
            </section>

            <!-- Occupations Drill-Down Section -->
            <section id="occupations-section" class="section">
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3>Occupation-Level AI Impact Analysis</h3>
                            <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                                Explore how AI may impact specific occupations based on O*NET task analysis
                            </p>
                        </div>
                    </div>
                </div>
                <div id="occupation-content">
                    <!-- Populated by JavaScript -->
                </div>
            </section>

            <!-- Sector Analysis Section -->
            <section id="sectors-section" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3>Sector Automation Exposure</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Sector</th>
                                <th>Employment</th>
                                <th>Automation Exposure</th>
                                <th>Risk Level</th>
                                <th>Jobs at Risk</th>
                            </tr>
                        </thead>
                        <tbody id="sectorTableBody">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <div class="card-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Employment by Risk Level</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="riskLevelChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>Jobs at Risk Summary</h3>
                        </div>
                        <div class="indicator-list" id="riskSummary">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sensitivity Analysis Section -->
            <section id="sensitivity-section" class="section">
                <div id="sensitivity-content">
                    <!-- Populated by JavaScript -->
                </div>
            </section>

            <!-- Intervention Impact Section -->
            <section id="interventions-section" class="section">
                <div class="card">
                    <div class="card-header">
                        <h3>Available Policy Interventions</h3>
                    </div>
                    <div class="card-grid" id="interventionTypes">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <div id="intervention-results" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3>Intervention Impact Analysis</h3>
                        </div>
                        <div class="chart-container large">
                            <canvas id="interventionChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Agent-Based Model Section -->
            <section id="abm-section" class="section">
                <div class="card" style="margin-bottom: 24px; border-left: 4px solid #8b5cf6;">
                    <div class="card-header">
                        <h3 style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 1.5rem;">üß¨</span>
                            Agent-Based Labor Market Simulation
                        </h3>
                        <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 8px;">
                            Simulate millions of individual workers and firms making autonomous decisions.
                            Track how economic conditions shift political support for policy interventions.
                        </p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                        <!-- ABM Configuration -->
                        <div style="background: var(--gray-50); border-radius: 8px; padding: 20px;">
                            <h4 style="margin-bottom: 16px; color: var(--gray-700);">Simulation Scale</h4>

                            <div class="form-group">
                                <label>Number of Workers: <span id="abmWorkersValue">1,000</span></label>
                                <input type="range" id="abmWorkers" min="1000" max="100000" step="1000" value="1000"
                                       oninput="document.getElementById('abmWorkersValue').textContent = parseInt(this.value).toLocaleString()">
                                <small style="color: var(--gray-500);">More workers = more accurate but slower</small>
                            </div>

                            <div class="form-group">
                                <label>Number of Firms: <span id="abmFirmsValue">50</span></label>
                                <input type="range" id="abmFirms" min="50" max="5000" step="50" value="50"
                                       oninput="document.getElementById('abmFirmsValue').textContent = parseInt(this.value).toLocaleString()">
                            </div>

                            <div class="form-group">
                                <label>Simulation Duration</label>
                                <select id="abmDuration">
                                    <option value="12">1 Year (12 months)</option>
                                    <option value="24">2 Years (24 months)</option>
                                    <option value="36">3 Years (36 months)</option>
                                    <option value="60" selected>5 Years (60 months)</option>
                                    <option value="120">10 Years (120 months)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Number of Regions</label>
                                <select id="abmRegions">
                                    <option value="1">1 Region (National)</option>
                                    <option value="5">5 Regions</option>
                                    <option value="10" selected>10 Regions</option>
                                    <option value="50">50 Regions (States)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Initial Conditions -->
                        <div style="background: var(--gray-50); border-radius: 8px; padding: 20px;">
                            <h4 style="margin-bottom: 16px; color: var(--gray-700);">Initial Conditions</h4>

                            <div class="form-group">
                                <label>Initial Unemployment: <span id="abmInitialURValue">5</span>%</label>
                                <input type="range" id="abmInitialUR" min="2" max="15" step="0.5" value="5"
                                       oninput="document.getElementById('abmInitialURValue').textContent = this.value">
                            </div>

                            <div class="form-group">
                                <label>Initial AI Adoption: <span id="abmInitialAIValue">10</span>%</label>
                                <input type="range" id="abmInitialAI" min="0" max="50" step="5" value="10"
                                       oninput="document.getElementById('abmInitialAIValue').textContent = this.value">
                            </div>

                            <div class="form-group">
                                <label>Adoption Curve</label>
                                <select id="abmAdoptionCurve">
                                    <option value="linear">Linear</option>
                                    <option value="s_curve" selected>S-Curve (Logistic)</option>
                                    <option value="exponential">Exponential</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Automation Pace</label>
                                <select id="abmAutomationPace">
                                    <option value="slow">Slow</option>
                                    <option value="moderate" selected>Moderate</option>
                                    <option value="fast">Fast</option>
                                    <option value="accelerating">Accelerating</option>
                                </select>
                            </div>
                        </div>

                        <!-- Interventions -->
                        <div style="background: var(--gray-50); border-radius: 8px; padding: 20px;">
                            <h4 style="margin-bottom: 16px; color: var(--gray-700);">Policy Interventions</h4>

                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="abmUBI" style="width: 18px; height: 18px;">
                                    <span>Universal Basic Income ($1000/mo)</span>
                                </label>

                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="abmRetraining" style="width: 18px; height: 18px;">
                                    <span>Government Retraining Programs</span>
                                </label>

                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="abmWageSubsidy" style="width: 18px; height: 18px;">
                                    <span>Wage Subsidies ($500/worker)</span>
                                </label>
                            </div>

                            <div style="margin-top: 16px; padding: 12px; background: rgba(139, 92, 246, 0.1); border-radius: 6px;">
                                <small style="color: var(--gray-600);">
                                    <strong>Tip:</strong> Watch how intervention choices affect political feasibility over time!
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Run Button -->
                    <div style="margin-top: 24px; display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 12px 32px; font-size: 1rem;" onclick="runABMSimulation()">
                            üöÄ Run Agent-Based Simulation
                        </button>
                        <button class="btn btn-outline" onclick="runQuickABMTest()" style="padding: 12px 24px;">
                            ‚ö° Quick Test (1K agents, 12 months)
                        </button>
                    </div>
                </div>

                <!-- ABM Progress -->
                <div id="abmProgress" class="card" style="display: none; margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>Simulation Progress</h3>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                            <div class="loading-spinner" style="width: 30px; height: 30px; border: 3px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <span id="abmProgressText">Initializing agents...</span>
                        </div>
                        <div style="background: var(--gray-200); border-radius: 4px; height: 8px; overflow: hidden;">
                            <div id="abmProgressBar" style="background: linear-gradient(90deg, #6366f1, #8b5cf6); height: 100%; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.875rem; color: var(--gray-500);">
                            <span>Month <span id="abmCurrentMonth">0</span> of <span id="abmTotalMonths">60</span></span>
                            <span id="abmProgressPercent">0%</span>
                        </div>
                    </div>
                </div>

                <!-- ABM Results -->
                <div id="abmResults" style="display: none;">
                    <!-- Summary Cards -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div class="card" style="text-align: center; padding: 20px;">
                            <div style="font-size: 0.875rem; color: var(--gray-500);">Final Unemployment</div>
                            <div id="abmFinalUR" style="font-size: 2rem; font-weight: 700; color: var(--danger);">--%</div>
                            <div id="abmURChange" style="font-size: 0.875rem; color: var(--gray-500);">+0.0% from start</div>
                        </div>
                        <div class="card" style="text-align: center; padding: 20px;">
                            <div style="font-size: 0.875rem; color: var(--gray-500);">Peak Unemployment</div>
                            <div id="abmPeakUR" style="font-size: 2rem; font-weight: 700; color: var(--warning);">--%</div>
                            <div id="abmPeakMonth" style="font-size: 0.875rem; color: var(--gray-500);">Month --</div>
                        </div>
                        <div class="card" style="text-align: center; padding: 20px;">
                            <div style="font-size: 0.875rem; color: var(--gray-500);">AI Adoption</div>
                            <div id="abmFinalAI" style="font-size: 2rem; font-weight: 700; color: var(--primary);">--%</div>
                            <div id="abmAIChange" style="font-size: 0.875rem; color: var(--gray-500);">+0.0% from start</div>
                        </div>
                        <div class="card" style="text-align: center; padding: 20px;">
                            <div style="font-size: 0.875rem; color: var(--gray-500);">Net Job Change</div>
                            <div id="abmNetJobs" style="font-size: 2rem; font-weight: 700; color: var(--secondary);">--</div>
                            <div style="font-size: 0.875rem; color: var(--gray-500);">Hires - Layoffs</div>
                        </div>
                    </div>

                    <!-- Results Interpretation Section -->
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3>üß† Results Interpretation</h3>
                                <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                                    AI-powered analysis of simulation outcomes
                                </p>
                            </div>
                            <button class="btn btn-outline" onclick="toggleInterpretationDetails()" style="font-size: 0.75rem; padding: 6px 12px;">
                                Show Details
                            </button>
                        </div>
                        <div id="abmInterpretationContent" style="padding: 20px;">
                            <p style="color: var(--gray-500);">Run simulation to generate interpretation...</p>
                        </div>
                        <div id="abmInterpretationDetails" style="display: none; padding: 0 20px 20px 20px;">
                            <!-- Detailed interpretation will be inserted here -->
                        </div>
                    </div>

                    <!-- Policy Support Section -->
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h3>üìä Political Feasibility of Interventions</h3>
                            <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                                How economic conditions shifted worker support for policy interventions
                            </p>
                        </div>
                        <div id="abmPolicySupportContent" style="padding: 20px;">
                            <!-- Policy support gauges will be inserted here -->
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="card-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3>Unemployment Over Time</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="abmUnemploymentChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>Policy Support Trends</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="abmPolicySupportChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- AI Adoption Chart -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h3>Firm AI Adoption Status</h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="abmAIAdoptionChart"></canvas>
                        </div>
                    </div>

                    <!-- Emergent Patterns -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h3>üîç Emergent Patterns Detected</h3>
                            <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                                Tipping points and feedback loops discovered during simulation
                            </p>
                        </div>
                        <div id="abmPatternsContent" style="padding: 20px;">
                            <p style="color: var(--gray-500);">Run simulation to detect emergent patterns...</p>
                        </div>
                    </div>

                    <!-- Demographic Breakdown -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h3>üìà Policy Support by Demographics</h3>
                        </div>
                        <div id="abmDemographicsContent" style="padding: 20px;">
                            <!-- Demographics breakdown will be inserted here -->
                        </div>
                    </div>

                    <!-- Regional Heat Map -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header">
                            <h3>üó∫Ô∏è Regional Impact Analysis</h3>
                            <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                                Geographic distribution of labor market impacts across US states
                            </p>
                        </div>
                        <div id="regionalHeatmapSummary" style="padding: 20px 20px 0 20px;">
                            <!-- Summary stats will be inserted here -->
                        </div>
                        <div id="regionalHeatmapContent" style="padding: 20px;">
                            <p style="color: var(--gray-500);">Run simulation to view regional impacts...</p>
                        </div>
                    </div>

                    <!-- ABM Sensitivity Analysis -->
                    <div class="card" style="margin-top: 24px;">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3>üìê Parameter Sensitivity Analysis</h3>
                                <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                                    Explore how changes in model parameters affect outcomes
                                </p>
                            </div>
                            <button id="runSensitivityBtn" class="btn btn-outline" onclick="runABMSensitivityAnalysis()" style="font-size: 0.875rem;">
                                Run Analysis
                            </button>
                        </div>
                        <div id="abmSensitivityProgress" style="display: none; padding: 20px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="spinner" style="width: 20px; height: 20px;"></div>
                                <span id="sensitivityProgressText">Running sensitivity analysis...</span>
                            </div>
                            <div style="margin-top: 12px; background: var(--gray-200); border-radius: 6px; height: 8px; overflow: hidden;">
                                <div id="sensitivityProgressBar" style="background: var(--primary); height: 100%; width: 0%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        <div id="abmSensitivityContent" style="padding: 20px;">
                            <p style="color: var(--gray-500);">Click "Run Analysis" to perform parameter sensitivity analysis on the current simulation configuration.</p>
                        </div>
                    </div>

                    <!-- Export Button -->
                    <div style="margin-top: 24px; text-align: center;">
                        <button class="btn btn-outline" onclick="exportABMResults()" style="padding: 12px 24px;">
                            üì• Export ABM Results
                        </button>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="section">
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>AI Analysis</h3>
                        <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                            AI-powered analysis is available for all simulation results
                        </p>
                    </div>

                    <div style="margin-top: 20px;">
                        <!-- AI Analysis Status -->
                        <div style="background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 8px; padding: 20px; margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                                <div>
                                    <h4 style="color: var(--gray-800); margin-bottom: 4px;">Google Gemini AI</h4>
                                    <p style="font-size: 0.75rem; color: var(--gray-500);">
                                        Generates summaries and insights from your simulation results
                                    </p>
                                </div>
                                <span class="tag tag-medium" style="background: var(--secondary); color: white;">Active</span>
                            </div>

                            <div style="background: var(--gray-100); border-radius: 6px; padding: 12px; margin-bottom: 16px;">
                                <p style="font-size: 0.8rem; color: var(--gray-600); margin: 0;">
                                    AI analysis is powered by Google's Gemini model and is available to all users.
                                    Use the "Advanced AI Simulation" button or view AI insights in your simulation results.
                                </p>
                            </div>

                            <!-- API Call Counter -->
                            <div style="border-top: 1px solid var(--gray-300); padding-top: 16px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <div>
                                        <h5 style="color: var(--gray-700); font-size: 0.875rem; margin-bottom: 2px;">Usage Statistics</h5>
                                        <p style="font-size: 0.7rem; color: var(--gray-500);">Track your AI analysis usage</p>
                                    </div>
                                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.75rem; color: var(--gray-600);">
                                        <input type="checkbox" id="geminiCounterEnabled" onchange="toggleGeminiCounter()" checked style="width: 16px; height: 16px;">
                                        Track Usage
                                    </label>
                                </div>
                                <div id="geminiApiCallStats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 12px;">
                                    <div style="background: var(--gray-100); padding: 10px; border-radius: 6px; text-align: center;">
                                        <div id="geminiCallsTotal" style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">0</div>
                                        <div style="font-size: 0.65rem; color: var(--gray-500); text-transform: uppercase;">Total</div>
                                    </div>
                                    <div style="background: var(--gray-100); padding: 10px; border-radius: 6px; text-align: center;">
                                        <div id="geminiCallsToday" style="font-size: 1.25rem; font-weight: 700; color: var(--secondary);">0</div>
                                        <div style="font-size: 0.65rem; color: var(--gray-500); text-transform: uppercase;">Today</div>
                                    </div>
                                    <div style="background: var(--gray-100); padding: 10px; border-radius: 6px; text-align: center;">
                                        <div id="geminiCallsWeek" style="font-size: 1.25rem; font-weight: 700; color: var(--accent);">0</div>
                                        <div style="font-size: 0.65rem; color: var(--gray-500); text-transform: uppercase;">This Week</div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span id="geminiLastCall" style="font-size: 0.7rem; color: var(--gray-500);">No calls recorded</span>
                                    <button class="btn btn-sm btn-outline" onclick="resetGeminiCounter()" style="font-size: 0.7rem; padding: 4px 8px;">Reset Counter</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Auto-Updated Data Status -->
                <div class="card" style="margin-bottom: 24px; border-left: 4px solid var(--secondary);">
                    <div class="card-header">
                        <h3>Economic Data Status</h3>
                        <p style="font-size: 0.875rem; color: var(--gray-500); margin-top: 4px;">
                            Data is automatically updated daily from BLS and FRED
                        </p>
                    </div>
                    <div style="margin-top: 20px;">
                        <div id="autoDataStatus" style="background: var(--gray-50); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <!-- Populated by JavaScript -->
                            <p style="color: var(--gray-600); font-size: 0.875rem;">
                                <strong>Loading data status...</strong>
                            </p>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 16px;">
                            Economic data from BLS and FRED is automatically fetched daily via GitHub Actions
                            and made available to all users. No API key required.
                        </p>
                    </div>
                </div>

                <!-- Data Storage Info -->
                <div class="card">
                    <div class="card-header">
                        <h3>Data Privacy & Storage</h3>
                    </div>
                    <div style="margin-top: 16px; color: var(--gray-600); font-size: 0.875rem; line-height: 1.6;">
                        <p style="margin-bottom: 12px;">
                            <strong>Economic Data:</strong> Live economic data from BLS and FRED is automatically fetched daily
                            via GitHub Actions and cached for all users. No API keys required.
                        </p>
                        <p style="margin-bottom: 12px;">
                            <strong>API Keys:</strong> Your Gemini API key (if configured) is stored locally in your browser's localStorage.
                            It is only sent to Google's API servers for AI analysis.
                        </p>
                        <p style="margin-bottom: 12px;">
                            <strong>Simulations:</strong> Your saved simulations and settings are stored locally in your browser.
                        </p>
                        <p>
                            <strong>Clearing Data:</strong> Use your browser's "Clear site data" feature to remove all stored data,
                            or use the "Clear" button above to remove your API key.
                        </p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Intervention Modal -->
    <div id="interventionModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 8px; padding: 24px; max-width: 500px; width: 90%;">
            <h3 style="margin-bottom: 16px;">Add Policy Intervention</h3>
            <div class="form-group">
                <label style="color: var(--gray-700);">Intervention Type</label>
                <select id="interventionType" onchange="updateInterventionParams()" style="color: var(--gray-900);">
                    <option value="ubi">Universal Basic Income</option>
                    <option value="job_retraining">Job Retraining Programs</option>
                    <option value="wage_subsidy">Wage Subsidies</option>
                    <option value="reduced_workweek">Reduced Work Week</option>
                    <option value="robot_tax">Automation Tax</option>
                    <option value="education_subsidy">Education Subsidy</option>
                    <option value="job_guarantee">Federal Job Guarantee</option>
                    <option value="transition_assistance">Transition Assistance</option>
                </select>
            </div>
            <div id="interventionParams"></div>
            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button class="btn btn-primary" onclick="addIntervention()">Add Intervention</button>
                <button class="btn btn-secondary" onclick="hideInterventionModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Saved Simulations Modal -->
    <div id="savedSimulationsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: var(--gray-100); border-radius: 8px; padding: 24px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Saved Simulations</h3>
                <button class="btn btn-secondary btn-sm" onclick="hideSavedSimulationsModal()">Close</button>
            </div>
            <div id="savedSimulationsContent">
                <!-- Populated by JavaScript -->
            </div>
            <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--gray-300); display: flex; justify-content: space-between;">
                <button class="btn btn-danger btn-sm" onclick="clearAllSavedSimulations()">Delete All Saved Simulations</button>
                <button class="btn btn-secondary" onclick="hideSavedSimulationsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Custom Indicator Modal -->
    <div id="customIndicatorModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 8px; padding: 24px; max-width: 600px; width: 90%; max-height: 85vh; overflow-y: auto;">
            <h3 style="margin-bottom: 16px; color: var(--gray-800);">Add Custom Indicator</h3>
            <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 16px;">
                Create your own hypothetical indicator to track in the simulation.
            </p>

            <div class="form-group">
                <label style="color: var(--gray-700);">Indicator Name *</label>
                <input type="text" id="customIndName" placeholder="e.g., AI Freelancer Displacement Rate"
                       style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>

            <div class="form-group">
                <label style="color: var(--gray-700);">Short Name (4 chars)</label>
                <input type="text" id="customIndShortName" placeholder="e.g., AFDR" maxlength="6"
                       style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>

            <div class="form-group">
                <label style="color: var(--gray-700);">Description</label>
                <textarea id="customIndDescription" placeholder="What does this indicator measure?"
                          style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px; min-height: 60px;"></textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="form-group">
                    <label style="color: var(--gray-700);">Initial Value *</label>
                    <input type="number" id="customIndValue" placeholder="0" step="0.1"
                           style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                </div>

                <div class="form-group">
                    <label style="color: var(--gray-700);">Unit</label>
                    <select id="customIndUnit" style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                        <option value="percent">Percent (%)</option>
                        <option value="index_0_100">Index (0-100)</option>
                        <option value="millions">Millions</option>
                        <option value="thousands">Thousands</option>
                        <option value="ratio">Ratio</option>
                        <option value="currency">Currency ($)</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="form-group">
                    <label style="color: var(--gray-700);">Min Value</label>
                    <input type="number" id="customIndMin" placeholder="0" step="0.1"
                           style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                </div>

                <div class="form-group">
                    <label style="color: var(--gray-700);">Max Value</label>
                    <input type="number" id="customIndMax" placeholder="100" step="0.1"
                           style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                </div>
            </div>

            <div class="form-group">
                <label style="color: var(--gray-700);">Category</label>
                <select id="customIndCategory" style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                    <option value="custom">Custom</option>
                    <option value="automation">Task Automation</option>
                    <option value="displacement">Job Displacement</option>
                    <option value="creation">Job Creation</option>
                    <option value="wages">Wage Impacts</option>
                    <option value="skills">Skills & Training</option>
                    <option value="geographic">Geographic Impact</option>
                </select>
            </div>

            <div class="form-group">
                <label style="color: var(--gray-700);">Linked Real Metrics (affects how this changes)</label>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 0.875rem; color: var(--gray-600);">
                        <input type="checkbox" id="link_unemployment" value="unemployment_rate"> Unemployment Rate
                    </label>
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 0.875rem; color: var(--gray-600);">
                        <input type="checkbox" id="link_ai_adoption" value="ai_adoption"> AI Adoption
                    </label>
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 0.875rem; color: var(--gray-600);">
                        <input type="checkbox" id="link_productivity" value="productivity_growth"> Productivity
                    </label>
                    <label style="display: flex; align-items: center; gap: 4px; font-size: 0.875rem; color: var(--gray-600);">
                        <input type="checkbox" id="link_wages" value="wage_growth"> Wage Growth
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label style="color: var(--gray-700);">Icon</label>
                <select id="customIndIcon" style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
                    <option value="üìä">üìä Chart</option>
                    <option value="üìà">üìà Growth</option>
                    <option value="üìâ">üìâ Decline</option>
                    <option value="üéØ">üéØ Target</option>
                    <option value="üíº">üíº Jobs</option>
                    <option value="üí∞">üí∞ Money</option>
                    <option value="ü§ñ">ü§ñ Robot</option>
                    <option value="‚ö°">‚ö° Speed</option>
                    <option value="üå±">üå± Growth</option>
                    <option value="‚ö†Ô∏è">‚ö†Ô∏è Warning</option>
                    <option value="üìå">üìå Pin</option>
                </select>
            </div>

            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button class="btn btn-primary" onclick="saveCustomIndicator()">Add Indicator</button>
                <button class="btn btn-secondary" onclick="hideCustomIndicatorModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- AI Settings Modal -->
    <div id="aiSettingsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 8px; padding: 24px; max-width: 500px; width: 90%;">
            <h3 style="margin-bottom: 16px; color: var(--gray-800);">Configure AI Analysis</h3>
            <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 16px;">
                Add your Gemini API key to enable AI-powered analysis of simulation results.
                The key is stored locally in your browser and never sent to any server except Google's API.
            </p>
            <div class="form-group">
                <label style="color: var(--gray-700);">Gemini API Key</label>
                <input type="password" id="geminiApiKey" placeholder="Enter your Gemini API key"
                       style="color: var(--gray-900); width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px;">
            </div>
            <p style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 16px;">
                Get a free API key from <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: var(--primary);">Google AI Studio</a>
            </p>
            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button class="btn btn-primary" onclick="saveAIApiKey()">Save API Key</button>
                <button class="btn btn-secondary" onclick="hideAISettingsModal()">Cancel</button>
                <button class="btn btn-danger" onclick="clearAIApiKey()" style="margin-left: auto;">Clear Key</button>
            </div>
        </div>
    </div>

    <!-- Simulation History Modal -->
    <div id="historyModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: var(--bg-card, white); border-radius: 8px; padding: 24px; max-width: 700px; width: 95%; max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="color: var(--text-primary, var(--gray-800));">Simulation History</h3>
                <button onclick="hideHistoryModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary, var(--gray-500));">&times;</button>
            </div>
            <p style="font-size: 0.875rem; color: var(--text-muted, var(--gray-500)); margin-bottom: 16px;">
                Your recent simulation runs are saved locally. Click on any to reload it.
            </p>
            <div id="historyList">
                <!-- History items will be inserted here -->
            </div>
            <div style="display: flex; gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-color, var(--gray-200));">
                <button class="btn btn-secondary" onclick="hideHistoryModal()">Close</button>
                <button class="btn btn-danger" onclick="clearAllHistory()" style="margin-left: auto;">Clear All History</button>
            </div>
        </div>
    </div>

    <!-- Password Modal for Advanced AI Simulation -->
    <div id="passwordModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <h3 style="margin-bottom: 16px;">Advanced AI Simulation</h3>
            <p style="color: var(--gray-500); margin-bottom: 16px; font-size: 0.875rem;">
                Enter the password to access AI-enhanced simulation features.
            </p>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="aiSimPassword" placeholder="Enter password" style="width: 100%;">
            </div>
            <div id="passwordError" style="color: var(--danger); font-size: 0.875rem; margin-bottom: 12px; display: none;">
                Incorrect password. Please try again.
            </div>
            <div style="display: flex; gap: 12px; margin-top: 16px;">
                <button class="btn btn-primary" onclick="submitAIPassword()">Continue</button>
                <button class="btn btn-secondary" onclick="hidePasswordModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- AI Training Modal -->
    <div id="trainingModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <h3 style="margin-bottom: 16px;">AI Model Training</h3>
            <div id="trainingStatus">
                <div class="training-stats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px;">
                    <div class="stat-box" style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Stored Simulations</div>
                        <div id="trainSimCount" style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">0</div>
                    </div>
                    <div class="stat-box" style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Model Version</div>
                        <div id="trainModelVersion" style="font-size: 1.5rem; font-weight: bold; color: var(--secondary);">-</div>
                    </div>
                    <div class="stat-box" style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Confidence</div>
                        <div id="trainConfidence" style="font-size: 1.5rem; font-weight: bold; color: var(--warning);">-</div>
                    </div>
                </div>
                <div id="trainingMessage" style="padding: 12px; background: var(--gray-100); border-radius: 6px; margin-bottom: 16px; font-size: 0.875rem;">
                    Run at least 3 AI-enhanced simulations to enable model training.
                </div>
            </div>
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button id="trainModelBtn" class="btn btn-primary" onclick="trainModel()" disabled>
                    Train Model
                </button>
                <button class="btn btn-outline" onclick="exportTrainingData()">
                    Export Data
                </button>
                <button class="btn btn-secondary" onclick="hideTrainingModal()" style="margin-left: auto;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- AI Simulation Results Modal -->
    <div id="aiResultsModal" class="modal-overlay" style="display: none;">
        <div class="modal-content ai-results-modal" style="max-width: 900px; max-height: 90vh; overflow-y: auto; position: relative;">
            <!-- Sticky Header -->
            <div class="ai-modal-header">
                <h3>AI-Enhanced Analysis</h3>
                <button class="btn btn-sm btn-secondary" onclick="hideAIResultsModal()">Close</button>
            </div>
            <div id="aiResultsContent">
                <!-- AI analysis will be inserted here -->
            </div>
            <!-- Sticky Footer Close Button -->
            <div class="ai-modal-footer">
                <button class="btn btn-primary" onclick="hideAIResultsModal()">Close Report</button>
            </div>
        </div>
    </div>

    <!-- Main Entry Point (Vite bundles all modules) -->
    <script type="module" src="src/main.js"></script>
</body>
</html>
