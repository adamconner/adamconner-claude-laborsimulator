{"version":3,"file":"app-K7V0Ylxr.js","sources":["../../src/app.js"],"sourcesContent":["/**\n * AI Labor Market Impact Simulator - Main Application\n */\n\n// HTML escape helper for XSS prevention\nconst escapeHtml = (str) => {\n    if (str === null || str === undefined) return '';\n    const div = document.createElement('div');\n    div.textContent = String(str);\n    return div.innerHTML;\n};\n\n// Global instances\nlet dataService;\nlet indicators;\nlet simulationEngine;\nlet interventionSystem;\nlet vizManager;\nlet currentResults = null;\nlet currentAIAnalysis = null;  // Store current AI analysis for re-viewing\nlet isAISimulationResult = false;  // Track if current results are from AI simulation\n\n// Default configuration values\nconst DEFAULT_CONFIG = {\n    scenarioName: 'My Scenario',\n    targetYear: '2029',\n    targetUR: 10,\n    aiAdoption: 70,\n    automationPace: 'moderate',\n    adoptionCurve: 's_curve'\n};\n\n// Storage key for saved simulations\nconst STORAGE_KEY = 'ai_labor_simulator_saved_simulations';\n\n// Storage keys for API keys (legacy - kept for cleanup)\nconst API_KEYS_STORAGE = {};\n\n/**\n * Initialize the application\n */\nasync function initApp() {\n    try {\n        // Initialize services\n        dataService = new EconomicDataService();\n        indicators = new EconomicIndicators();\n        interventionSystem = new InterventionSystem();\n        vizManager = new VisualizationManager();\n        vizManager.initDefaults();\n\n        // Load baseline data\n        await dataService.loadBaselineData();\n\n        // Initialize simulation engine\n        simulationEngine = new SimulationEngine(dataService, indicators);\n        await simulationEngine.initialize();\n\n        // Setup UI\n        setupEventListeners();\n        populateCurrentSnapshot();\n        populateSectorTable();\n        populateInterventionTypes();\n        createHistoricalChart();\n        createSectorChart();\n        updateSavedSimulationsList();\n        updateAISettingsStatus();\n        renderHypotheticalIndicators();\n        renderOccupationList();\n        renderSensitivityOverview();\n        await initializeRealMetrics();\n        initializeSettings();\n\n        // Check for shared simulation in URL\n        await checkForSharedSimulation();\n\n        console.log('AI Labor Market Simulator initialized');\n    } catch (error) {\n        console.error('Initialization error:', error);\n        alert('Failed to initialize simulator. Please refresh the page.');\n    }\n}\n\n/**\n * Setup event listeners\n */\nfunction setupEventListeners() {\n    // Range slider value displays\n    document.getElementById('targetUR').addEventListener('input', function() {\n        document.getElementById('urValue').textContent = this.value;\n    });\n\n    document.getElementById('aiAdoption').addEventListener('input', function() {\n        document.getElementById('aiValue').textContent = this.value;\n    });\n}\n\n/**\n * Show section by ID\n */\nfunction showSection(sectionId) {\n    // Hide all sections\n    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n\n    // Show selected section\n    document.getElementById(`${sectionId}-section`).classList.add('active');\n\n    // Update nav tabs\n    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));\n    event.target.classList.add('active');\n}\n\n/**\n * Populate current snapshot stats\n */\nasync function populateCurrentSnapshot() {\n    const snapshot = await dataService.getCurrentSnapshot();\n\n    document.getElementById('stat-ur').textContent =\n        snapshot.labor_market.unemployment_rate.toFixed(1) + '%';\n    document.getElementById('stat-emp').textContent =\n        (snapshot.labor_market.total_employment / 1e6).toFixed(1) + 'M';\n    document.getElementById('stat-lfpr').textContent =\n        snapshot.labor_market.labor_force_participation.toFixed(1) + '%';\n    document.getElementById('stat-jo').textContent =\n        (snapshot.labor_market.job_openings / 1e6).toFixed(1) + 'M';\n}\n\n/**\n * Populate sector analysis table\n */\nasync function populateSectorTable() {\n    const sectors = await dataService.getSectorData();\n    const tbody = document.getElementById('sectorTableBody');\n\n    const sectorExposure = indicators.calculateSectorExposure(sectors);\n    const riskSummary = indicators.calculateJobsAtRisk(sectors);\n\n    let html = '';\n    for (const [key, data] of Object.entries(sectorExposure)) {\n        const riskClass = data.risk_level === 'high' ? 'tag-high' :\n            data.risk_level.includes('medium') ? 'tag-medium' : 'tag-low';\n\n        html += `\n            <tr>\n                <td><strong>${data.name}</strong></td>\n                <td>${(data.employment / 1e6).toFixed(1)}M</td>\n                <td>\n                    <div class=\"progress-bar\" style=\"width: 100px; display: inline-block; vertical-align: middle;\">\n                        <div class=\"fill\" style=\"width: ${data.exposure * 100}%; background: ${\n            data.risk_level === 'high' ? 'var(--danger)' :\n                data.risk_level.includes('medium') ? 'var(--warning)' : 'var(--secondary)'\n        }\"></div>\n                    </div>\n                    <span style=\"margin-left: 8px;\">${(data.exposure * 100).toFixed(0)}%</span>\n                </td>\n                <td><span class=\"tag ${riskClass}\">${data.risk_level.replace('-', ' ')}</span></td>\n                <td>${(data.at_risk_jobs / 1e6).toFixed(1)}M</td>\n            </tr>\n        `;\n    }\n\n    tbody.innerHTML = html;\n\n    // Update risk summary\n    const summaryDiv = document.getElementById('riskSummary');\n    summaryDiv.innerHTML = `\n        <div class=\"indicator-item\">\n            <div>\n                <div class=\"indicator-name\">Total Employment</div>\n            </div>\n            <div class=\"indicator-value\">${(riskSummary.total_employment / 1e6).toFixed(1)}M</div>\n        </div>\n        <div class=\"indicator-item\">\n            <div>\n                <div class=\"indicator-name\">Total Jobs at Risk</div>\n            </div>\n            <div class=\"indicator-value\" style=\"color: var(--danger);\">${(riskSummary.total_at_risk / 1e6).toFixed(1)}M</div>\n        </div>\n        <div class=\"indicator-item\">\n            <div>\n                <div class=\"indicator-name\">Percentage at Risk</div>\n            </div>\n            <div class=\"indicator-value\">${riskSummary.percentage_at_risk}%</div>\n        </div>\n        <div class=\"indicator-item\">\n            <div>\n                <div class=\"indicator-name\">High Risk Employment</div>\n            </div>\n            <div class=\"indicator-value\">${(riskSummary.by_risk_level.high / 1e6).toFixed(1)}M</div>\n        </div>\n    `;\n\n    // Create risk level chart\n    createRiskLevelChart(riskSummary);\n}\n\n/**\n * Populate intervention types\n */\nfunction populateInterventionTypes() {\n    const types = interventionSystem.getAvailableTypes();\n    const container = document.getElementById('interventionTypes');\n\n    let html = '';\n    for (const type of types) {\n        html += `\n            <div class=\"card\" style=\"cursor: pointer;\" onclick=\"quickAddIntervention('${type.type}')\">\n                <h4 style=\"margin-bottom: 8px;\">${type.name}</h4>\n                <p style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px;\">\n                    ${type.description}\n                </p>\n                <span class=\"tag tag-medium\">${type.category.replace('_', ' ')}</span>\n            </div>\n        `;\n    }\n\n    container.innerHTML = html;\n}\n\n/**\n * Create historical chart\n */\nasync function createHistoricalChart() {\n    const historical = await dataService.getHistoricalTrends();\n\n    const ctx = document.getElementById('historicalChart');\n    new Chart(ctx, {\n        type: 'line',\n        data: {\n            labels: historical.unemployment_rate.map(d => d.year),\n            datasets: [{\n                label: 'Unemployment Rate (%)',\n                data: historical.unemployment_rate.map(d => d.value),\n                borderColor: '#3b82f6',\n                backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                fill: true,\n                tension: 0.4\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n                legend: { display: false }\n            },\n            scales: {\n                y: {\n                    beginAtZero: true,\n                    max: 12\n                }\n            }\n        }\n    });\n}\n\n/**\n * Create sector employment chart\n */\nasync function createSectorChart() {\n    const sectors = await dataService.getSectorData();\n    vizManager.createSectorEmploymentChart('sectorEmploymentChart', sectors);\n}\n\n/**\n * Create risk level chart\n */\nfunction createRiskLevelChart(riskSummary) {\n    const ctx = document.getElementById('riskLevelChart');\n    new Chart(ctx, {\n        type: 'doughnut',\n        data: {\n            labels: ['High Risk', 'Medium-High', 'Medium', 'Low Risk'],\n            datasets: [{\n                data: [\n                    riskSummary.by_risk_level.high / 1e6,\n                    riskSummary.by_risk_level['medium-high'] / 1e6,\n                    riskSummary.by_risk_level.medium / 1e6,\n                    riskSummary.by_risk_level.low / 1e6\n                ],\n                backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981']\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n                legend: {\n                    position: 'bottom'\n                }\n            }\n        }\n    });\n}\n\n/**\n * Load preset scenario\n */\nfunction loadPreset(preset) {\n    const presets = {\n        moderate: {\n            targetUR: 8,\n            aiAdoption: 55,\n            automationPace: 'moderate',\n            adoptionCurve: 's_curve',\n            targetYear: 2029\n        },\n        rapid: {\n            targetUR: 12,\n            aiAdoption: 80,\n            automationPace: 'fast',\n            adoptionCurve: 'exponential',\n            targetYear: 2027\n        },\n        managed: {\n            targetUR: 6,\n            aiAdoption: 60,\n            automationPace: 'moderate',\n            adoptionCurve: 's_curve',\n            targetYear: 2029,\n            interventions: ['job_retraining', 'transition_assistance']\n        }\n    };\n\n    const config = presets[preset];\n    if (!config) return;\n\n    document.getElementById('targetUR').value = config.targetUR;\n    document.getElementById('urValue').textContent = config.targetUR;\n    document.getElementById('aiAdoption').value = config.aiAdoption;\n    document.getElementById('aiValue').textContent = config.aiAdoption;\n    document.getElementById('automationPace').value = config.automationPace;\n    document.getElementById('adoptionCurve').value = config.adoptionCurve;\n    document.getElementById('targetYear').value = config.targetYear;\n    document.getElementById('scenarioName').value =\n        preset.charAt(0).toUpperCase() + preset.slice(1) + ' Disruption Scenario';\n\n    // Clear existing interventions\n    interventionSystem.interventions = [];\n\n    // Add preset interventions\n    if (config.interventions) {\n        for (const type of config.interventions) {\n            interventionSystem.addIntervention(type);\n        }\n    }\n\n    updateInterventionsList();\n}\n\n/**\n * Get current scenario configuration from form inputs\n */\nfunction getCurrentScenario() {\n    const currentYear = new Date().getFullYear();\n    return {\n        name: document.getElementById('scenarioName')?.value || 'My Scenario',\n        timeframe: {\n            start_year: currentYear,\n            end_year: parseInt(document.getElementById('targetYear')?.value || '2029')\n        },\n        targets: {\n            unemployment_rate: parseFloat(document.getElementById('targetUR')?.value || '10'),\n            ai_adoption_rate: parseInt(document.getElementById('aiAdoption')?.value || '70'),\n            automation_pace: document.getElementById('automationPace')?.value || 'moderate'\n        },\n        ai_parameters: {\n            adoption_curve: document.getElementById('adoptionCurve')?.value || 's_curve'\n        },\n        interventions: typeof interventionSystem !== 'undefined'\n            ? interventionSystem.interventions.filter(i => i.active)\n            : []\n    };\n}\n\n/**\n * Run simulation\n */\nasync function runSimulation() {\n    // Reset AI simulation flag - regular simulations show the Generate AI Analysis button\n    isAISimulationResult = false;\n\n    const config = {\n        name: document.getElementById('scenarioName').value,\n        end_year: parseInt(document.getElementById('targetYear').value),\n        target_unemployment: parseFloat(document.getElementById('targetUR').value),\n        ai_adoption_rate: parseInt(document.getElementById('aiAdoption').value),\n        automation_pace: document.getElementById('automationPace').value,\n        adoption_curve: document.getElementById('adoptionCurve').value\n    };\n\n    // Show loading state\n    const resultsDiv = document.getElementById('simulation-results');\n    resultsDiv.textContent = '';\n    const loadingCard = DOMUtils.createCard({\n        content: DOMUtils.createLoadingSpinner('Running simulation...'),\n        style: { textAlign: 'center', padding: '60px' }\n    });\n    resultsDiv.appendChild(loadingCard);\n\n    // Switch to simulation tab (index 3)\n    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n    document.getElementById('simulation-section').classList.add('active');\n    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));\n    document.querySelectorAll('.nav-tab')[3].classList.add('active');\n\n    try {\n        // Create and run scenario\n        const scenario = simulationEngine.createScenario(config);\n\n        // Add active interventions\n        scenario.interventions = interventionSystem.interventions.filter(i => i.active);\n\n        const results = await simulationEngine.runSimulation();\n        currentResults = results;\n\n        // Display results\n        displaySimulationResults(results);\n\n        // Save to history\n        if (typeof simulationHistory !== 'undefined') {\n            simulationHistory.save(results);\n        }\n\n        // Show share button\n        showShareButton();\n\n        // Calculate and display baseline unemployment (without interventions)\n        calculateAndDisplayBaseline(config);\n\n    } catch (error) {\n        console.error('Simulation error:', error);\n        resultsDiv.textContent = '';\n        resultsDiv.appendChild(DOMUtils.createErrorMessage(error.message));\n    }\n}\n\n// ============================================\n// TARGET UNEMPLOYMENT OPTIMIZER\n// ============================================\n\nlet baselineUnemploymentRate = null;\n\n/**\n * Toggle target unemployment optimizer controls\n */\nfunction toggleTargetOptimizer() {\n    const enabled = document.getElementById('enableTargetOptimizer').checked;\n    const controls = document.getElementById('targetOptimizerControls');\n    const actions = document.getElementById('optimizerActions');\n\n    controls.style.display = enabled ? 'block' : 'none';\n    actions.style.display = enabled ? 'block' : 'none';\n\n    if (enabled && baselineUnemploymentRate !== null) {\n        // Set initial target to something achievable (baseline - 2%)\n        const initialTarget = Math.max(2, baselineUnemploymentRate - 2);\n        document.getElementById('targetUnemploymentRate').value = initialTarget;\n        document.getElementById('targetURValue').textContent = initialTarget.toFixed(1);\n    }\n}\n\n/**\n * Calculate baseline unemployment rate (AI impact without interventions)\n */\nasync function calculateAndDisplayBaseline(config) {\n    try {\n        // Store current interventions\n        const savedInterventions = [...interventionSystem.interventions];\n\n        // Temporarily clear interventions\n        interventionSystem.interventions = [];\n\n        // Create scenario without interventions\n        const baselineScenario = simulationEngine.createScenario({\n            ...config,\n            interventions: []\n        });\n\n        // Run baseline simulation\n        const baselineResults = await simulationEngine.runSimulation();\n        baselineUnemploymentRate = baselineResults.summary.final_unemployment_rate;\n\n        // Restore interventions\n        interventionSystem.interventions = savedInterventions;\n\n        // Update display\n        const display = document.getElementById('baselineUnemploymentDisplay');\n        if (display) {\n            display.innerHTML = `${baselineUnemploymentRate.toFixed(1)}%`;\n            display.style.color = baselineUnemploymentRate > 8 ? 'var(--danger)' :\n                                  baselineUnemploymentRate > 6 ? 'var(--warning)' : 'var(--secondary)';\n\n            // Update helper text\n            display.nextElementSibling.textContent = `By ${config.end_year}`;\n        }\n\n        // Re-run original simulation with interventions to restore state\n        simulationEngine.createScenario(config);\n        simulationEngine.scenario.interventions = savedInterventions.filter(i => i.active);\n\n    } catch (error) {\n        console.error('Error calculating baseline:', error);\n    }\n}\n\n/**\n * Optimize interventions to reach target unemployment rate\n */\nasync function optimizeInterventions() {\n    if (baselineUnemploymentRate === null) {\n        showNotification('Run a simulation first to calculate baseline unemployment.', 'warning');\n        return;\n    }\n\n    const targetRate = parseFloat(document.getElementById('targetUnemploymentRate').value);\n    const btn = document.getElementById('optimizeBtn');\n    const resultsDiv = document.getElementById('optimizationResults');\n    const contentDiv = document.getElementById('optimizationContent');\n\n    // Validate target\n    if (targetRate >= baselineUnemploymentRate) {\n        showNotification('Target must be lower than baseline unemployment rate.', 'warning');\n        return;\n    }\n\n    btn.disabled = true;\n    btn.innerHTML = '<span class=\"spinner\" style=\"width: 14px; height: 14px; margin-right: 6px;\"></span> Analyzing...';\n\n    try {\n        const reductionNeeded = baselineUnemploymentRate - targetRate;\n        const optimization = await findOptimalInterventionMix(reductionNeeded, targetRate);\n\n        // Display results\n        resultsDiv.style.display = 'block';\n        contentDiv.innerHTML = generateOptimizationResultsHTML(optimization, targetRate);\n\n    } catch (error) {\n        console.error('Optimization error:', error);\n        showNotification('Optimization failed: ' + error.message, 'error');\n    } finally {\n        btn.disabled = false;\n        btn.innerHTML = '<span style=\"margin-right: 6px;\">&#9881;</span> Find Intervention Mix';\n    }\n}\n\n/**\n * Find optimal intervention mix to achieve target reduction\n */\nasync function findOptimalInterventionMix(reductionNeeded, targetRate) {\n    // Intervention effectiveness estimates (unemployment reduction per $1B spent annually)\n    const interventionEffectiveness = {\n        job_retraining: {\n            name: 'Job Retraining Programs',\n            ur_reduction_per_billion: 0.15,\n            min_budget: 10,\n            max_budget: 100,\n            default_params: { annual_budget: 50, success_rate: 70 },\n            cost_per_point: 6.67, // $B per 1% UR reduction\n            implementation_time: 'Medium-term (1-2 years)'\n        },\n        ubi: {\n            name: 'Universal Basic Income',\n            ur_reduction_per_billion: 0.08,\n            min_budget: 500,\n            max_budget: 3000,\n            default_params: { monthly_amount: 1000, eligibility_threshold: 50000 },\n            cost_per_point: 12.5,\n            implementation_time: 'Immediate'\n        },\n        public_works: {\n            name: 'Public Works Programs',\n            ur_reduction_per_billion: 0.25,\n            min_budget: 20,\n            max_budget: 200,\n            default_params: { annual_budget: 75, job_creation_rate: 15000 },\n            cost_per_point: 4.0,\n            implementation_time: 'Short-term (6-12 months)'\n        },\n        tax_incentives: {\n            name: 'Tax Incentives for Hiring',\n            ur_reduction_per_billion: 0.12,\n            min_budget: 10,\n            max_budget: 100,\n            default_params: { credit_per_employee: 5000, eligibility: 'all' },\n            cost_per_point: 8.33,\n            implementation_time: 'Short-term (3-6 months)'\n        },\n        education_investment: {\n            name: 'Education Investment',\n            ur_reduction_per_billion: 0.10,\n            min_budget: 20,\n            max_budget: 150,\n            default_params: { annual_budget: 50, focus_area: 'stem' },\n            cost_per_point: 10.0,\n            implementation_time: 'Long-term (3-5 years)'\n        },\n        transition_assistance: {\n            name: 'Transition Assistance',\n            ur_reduction_per_billion: 0.18,\n            min_budget: 5,\n            max_budget: 50,\n            default_params: { stipend_months: 12, monthly_amount: 2000 },\n            cost_per_point: 5.56,\n            implementation_time: 'Immediate'\n        },\n        reduced_work_week: {\n            name: 'Reduced Work Week',\n            ur_reduction_per_billion: 0.20,\n            min_budget: 30,\n            max_budget: 200,\n            default_params: { hours_per_week: 32, wage_adjustment: 0 },\n            cost_per_point: 5.0,\n            implementation_time: 'Medium-term (1-2 years)'\n        },\n        early_retirement: {\n            name: 'Early Retirement Incentives',\n            ur_reduction_per_billion: 0.14,\n            min_budget: 20,\n            max_budget: 100,\n            default_params: { eligible_age: 60, benefit_percentage: 80 },\n            cost_per_point: 7.14,\n            implementation_time: 'Short-term (6-12 months)'\n        },\n        entrepreneurship: {\n            name: 'Entrepreneurship Support',\n            ur_reduction_per_billion: 0.22,\n            min_budget: 5,\n            max_budget: 50,\n            default_params: { grant_amount: 25000, loan_rate: 2 },\n            cost_per_point: 4.55,\n            implementation_time: 'Medium-term (1-2 years)'\n        }\n    };\n\n    // Sort by cost-effectiveness (lowest cost per point first)\n    const sortedInterventions = Object.entries(interventionEffectiveness)\n        .sort((a, b) => a[1].cost_per_point - b[1].cost_per_point);\n\n    // Greedy algorithm: pick most cost-effective interventions until target is reached\n    const recommendedMix = [];\n    let remainingReduction = reductionNeeded;\n    let totalAnnualCost = 0;\n    let totalMultiYearCost = 0;\n    const simulationYears = parseInt(document.getElementById('targetYear').value) - new Date().getFullYear();\n\n    for (const [type, data] of sortedInterventions) {\n        if (remainingReduction <= 0) break;\n\n        // Calculate how much budget needed to achieve remaining reduction\n        const budgetNeeded = (remainingReduction / data.ur_reduction_per_billion);\n        const actualBudget = Math.min(Math.max(budgetNeeded, data.min_budget), data.max_budget);\n        const actualReduction = actualBudget * data.ur_reduction_per_billion;\n\n        if (actualReduction > 0.05) { // Only include if meaningful impact\n            recommendedMix.push({\n                type,\n                name: data.name,\n                budget: actualBudget,\n                ur_reduction: actualReduction,\n                cost_per_point: data.cost_per_point,\n                implementation_time: data.implementation_time,\n                params: { ...data.default_params, annual_budget: actualBudget }\n            });\n\n            remainingReduction -= actualReduction;\n            totalAnnualCost += actualBudget;\n        }\n    }\n\n    totalMultiYearCost = totalAnnualCost * simulationYears;\n\n    // Calculate achievable rate\n    const achievableReduction = reductionNeeded - Math.max(0, remainingReduction);\n    const achievableRate = baselineUnemploymentRate - achievableReduction;\n\n    return {\n        targetRate,\n        baselineRate: baselineUnemploymentRate,\n        achievableRate,\n        reductionNeeded,\n        achievableReduction,\n        gap: Math.max(0, remainingReduction),\n        recommendations: recommendedMix,\n        totalAnnualCost,\n        totalMultiYearCost,\n        simulationYears,\n        feasible: remainingReduction <= 0.1 // Within 0.1% is feasible\n    };\n}\n\n/**\n * Generate HTML for optimization results\n */\nfunction generateOptimizationResultsHTML(optimization, targetRate) {\n    const formatCost = (n) => {\n        if (n >= 1000) return '$' + (n / 1000).toFixed(1) + 'T';\n        return '$' + n.toFixed(0) + 'B';\n    };\n\n    const feasibilityClass = optimization.feasible ? 'var(--secondary)' : 'var(--warning)';\n    const feasibilityText = optimization.feasible ? 'Achievable' : 'Partially Achievable';\n\n    let html = `\n        <div style=\"background: var(--gray-800); border-radius: 6px; padding: 10px; margin-bottom: 10px;\">\n            <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                <span style=\"font-size: 0.75rem; color: var(--gray-400);\">Target</span>\n                <span style=\"font-weight: 600; color: var(--primary);\">${targetRate.toFixed(1)}%</span>\n            </div>\n            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-top: 4px;\">\n                <span style=\"font-size: 0.75rem; color: var(--gray-400);\">Achievable</span>\n                <span style=\"font-weight: 600; color: ${feasibilityClass};\">${optimization.achievableRate.toFixed(1)}%</span>\n            </div>\n            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-top: 4px;\">\n                <span style=\"font-size: 0.75rem; color: var(--gray-400);\">Status</span>\n                <span style=\"font-size: 0.75rem; color: ${feasibilityClass};\">${feasibilityText}</span>\n            </div>\n        </div>\n\n        <div style=\"font-size: 0.7rem; color: var(--gray-400); margin-bottom: 6px;\">RECOMMENDED INTERVENTIONS</div>\n    `;\n\n    for (const rec of optimization.recommendations) {\n        html += `\n            <div style=\"background: var(--gray-800); border-radius: 6px; padding: 8px; margin-bottom: 6px; font-size: 0.8rem;\">\n                <div style=\"font-weight: 500; color: var(--text-primary); margin-bottom: 2px;\">${rec.name}</div>\n                <div style=\"display: flex; justify-content: space-between; color: var(--gray-400);\">\n                    <span>${formatCost(rec.budget)}/yr</span>\n                    <span style=\"color: var(--secondary);\">-${rec.ur_reduction.toFixed(2)}%</span>\n                </div>\n            </div>\n        `;\n    }\n\n    html += `\n        <div style=\"background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2)); border-radius: 6px; padding: 10px; margin-top: 10px;\">\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 4px;\">\n                <span style=\"font-size: 0.75rem; color: var(--gray-300);\">Annual Cost</span>\n                <span style=\"font-weight: 600; color: var(--primary);\">${formatCost(optimization.totalAnnualCost)}</span>\n            </div>\n            <div style=\"display: flex; justify-content: space-between;\">\n                <span style=\"font-size: 0.75rem; color: var(--gray-300);\">${optimization.simulationYears}-Year Total</span>\n                <span style=\"font-weight: 600; color: var(--warning);\">${formatCost(optimization.totalMultiYearCost)}</span>\n            </div>\n        </div>\n\n        <button class=\"btn btn-primary btn-block btn-sm\" onclick=\"applyOptimizedInterventions()\" style=\"margin-top: 10px;\">\n            Apply These Interventions\n        </button>\n    `;\n\n    // Store optimization for applying\n    window.lastOptimization = optimization;\n\n    return html;\n}\n\n/**\n * Apply the optimized interventions\n */\nfunction applyOptimizedInterventions() {\n    if (!window.lastOptimization) {\n        showNotification('No optimization results to apply.', 'warning');\n        return;\n    }\n\n    // Clear existing interventions\n    interventionSystem.interventions = [];\n\n    // Add recommended interventions\n    for (const rec of window.lastOptimization.recommendations) {\n        interventionSystem.addIntervention(rec.type, rec.params);\n    }\n\n    // Update UI\n    updateInterventionsList();\n\n    showNotification(`Applied ${window.lastOptimization.recommendations.length} interventions. Run simulation to see results.`, 'success');\n\n    // Uncheck the optimizer toggle and hide controls\n    document.getElementById('enableTargetOptimizer').checked = false;\n    document.getElementById('targetOptimizerControls').style.display = 'none';\n    document.getElementById('optimizerActions').style.display = 'none';\n}\n\n/**\n * Generate HTML for intervention impact display\n */\nfunction generateInterventionImpactHTML(interventionSummary, interventions) {\n    if (!interventionSummary || interventions.length === 0) {\n        return '<p style=\"color: var(--gray-500);\">No intervention data available.</p>';\n    }\n\n    const formatNumber = (n) => {\n        if (n === undefined || n === null || isNaN(n)) return '0';\n        if (Math.abs(n) >= 1e12) return (n / 1e12).toFixed(1) + 'T';\n        if (Math.abs(n) >= 1e9) return (n / 1e9).toFixed(1) + 'B';\n        if (Math.abs(n) >= 1e6) return (n / 1e6).toFixed(1) + 'M';\n        if (Math.abs(n) >= 1e3) return (n / 1e3).toFixed(1) + 'K';\n        return n.toFixed(0);\n    };\n\n    const safePercent = (n) => {\n        if (n === undefined || n === null || isNaN(n)) return '0.00';\n        return (n * 100).toFixed(2);\n    };\n\n    const totalJobs = interventionSummary.total_job_effect || 0;\n    const totalEconomic = interventionSummary.total_economic_impact || 0;\n    const totalFiscal = interventionSummary.total_fiscal_cost || 0;\n    const avgWageEffect = interventionSummary.monthly_averages?.wage_effect || 0;\n\n    // Generate details breakdown\n    const detailsHTML = (interventionSummary.details || []).map(d => {\n        const jobEffect = d.job_effect || 0;\n        const wageEffect = d.wage_effect || 0;\n        const economicImpact = d.economic_impact || 0;\n        const fiscalCost = d.fiscal_cost || 0;\n        return `\n        <tr>\n            <td><strong>${d.intervention || 'Unknown'}</strong></td>\n            <td style=\"text-align: right; color: ${jobEffect >= 0 ? 'var(--secondary)' : 'var(--danger)'};\">\n                ${jobEffect >= 0 ? '+' : ''}${formatNumber(jobEffect * 12)}/yr\n            </td>\n            <td style=\"text-align: right; color: ${wageEffect >= 0 ? 'var(--secondary)' : 'var(--danger)'};\">\n                ${wageEffect >= 0 ? '+' : ''}${safePercent(wageEffect)}%\n            </td>\n            <td style=\"text-align: right; color: ${economicImpact >= 0 ? 'var(--secondary)' : 'var(--danger)'};\">\n                $${formatNumber(economicImpact * 12)}\n            </td>\n            <td style=\"text-align: right; color: ${fiscalCost <= 0 ? 'var(--secondary)' : 'var(--warning)'};\">\n                ${fiscalCost < 0 ? '+' : '-'}$${formatNumber(Math.abs(fiscalCost * 12))}\n            </td>\n        </tr>\n    `}).join('');\n\n    return `\n        <div style=\"margin-bottom: 24px;\">\n            <!-- Summary Cards -->\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; margin-bottom: 24px;\">\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;\">Jobs Impact</div>\n                    <div style=\"font-size: 1.25rem; font-weight: 700; color: ${totalJobs >= 0 ? 'var(--secondary)' : 'var(--danger)'};\">\n                        ${totalJobs >= 0 ? '+' : ''}${formatNumber(totalJobs)}\n                    </div>\n                    <div style=\"font-size: 0.7rem; color: var(--gray-400);\">cumulative</div>\n                </div>\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;\">Wage Effect</div>\n                    <div style=\"font-size: 1.25rem; font-weight: 700; color: ${avgWageEffect >= 0 ? 'var(--secondary)' : 'var(--danger)'};\">\n                        ${avgWageEffect >= 0 ? '+' : ''}${safePercent(avgWageEffect)}%\n                    </div>\n                    <div style=\"font-size: 0.7rem; color: var(--gray-400);\">monthly avg</div>\n                </div>\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;\">Economic Impact</div>\n                    <div style=\"font-size: 1.25rem; font-weight: 700; color: var(--primary);\">\n                        $${formatNumber(totalEconomic)}\n                    </div>\n                    <div style=\"font-size: 0.7rem; color: var(--gray-400);\">cumulative GDP</div>\n                </div>\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;\">Fiscal Impact</div>\n                    <div style=\"font-size: 1.25rem; font-weight: 700; color: ${totalFiscal <= 0 ? 'var(--secondary)' : 'var(--warning)'};\">\n                        ${totalFiscal < 0 ? '+' : '-'}$${formatNumber(Math.abs(totalFiscal))}\n                    </div>\n                    <div style=\"font-size: 0.7rem; color: var(--gray-400);\">${totalFiscal < 0 ? 'revenue' : 'cost'}</div>\n                </div>\n            </div>\n\n            <!-- Intervention Breakdown -->\n            ${interventionSummary.details && interventionSummary.details.length > 0 ? `\n            <h4 style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px; text-transform: uppercase;\">\n                Intervention Breakdown\n            </h4>\n            <div style=\"overflow-x: auto;\">\n                <table style=\"width: 100%; font-size: 0.875rem; border-collapse: collapse;\">\n                    <thead>\n                        <tr style=\"border-bottom: 2px solid var(--gray-200);\">\n                            <th style=\"text-align: left; padding: 8px 12px;\">Intervention</th>\n                            <th style=\"text-align: right; padding: 8px 12px;\">Jobs/Year</th>\n                            <th style=\"text-align: right; padding: 8px 12px;\">Wage Effect</th>\n                            <th style=\"text-align: right; padding: 8px 12px;\">Economic/Year</th>\n                            <th style=\"text-align: right; padding: 8px 12px;\">Fiscal/Year</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${detailsHTML}\n                    </tbody>\n                </table>\n            </div>\n            ` : ''}\n        </div>\n    `;\n}\n\n/**\n * Generate HTML for demographics analysis display\n */\nfunction generateDemographicsHTML(demographics) {\n    if (!demographics) {\n        return '<p style=\"color: var(--gray-500);\">No demographics data available.</p>';\n    }\n\n    const formatNumber = (n) => {\n        if (n === undefined || n === null || isNaN(n)) return '0';\n        if (Math.abs(n) >= 1e6) return (n / 1e6).toFixed(1) + 'M';\n        if (Math.abs(n) >= 1e3) return (n / 1e3).toFixed(1) + 'K';\n        return Math.round(n).toString();\n    };\n\n    const safePercent = (n) => {\n        if (n === undefined || n === null || isNaN(n)) return '0';\n        return typeof n === 'number' ? n.toFixed(1) : n;\n    };\n\n    // Build age group cards - using estimated_displacement and displacement_rate from analyzer\n    const ageGroupsHTML = demographics.by_age ? Object.entries(demographics.by_age).map(([group, data]) => {\n        const displacement = data.estimated_displacement || 0;\n        const rate = data.displacement_rate || 0;\n        const impactLevel = data.impact_level || 'Low';\n        return `\n        <div style=\"background: var(--gray-50); padding: 12px; border-radius: 8px; min-width: 140px;\">\n            <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;\">Age ${group}</div>\n            <div style=\"font-size: 1.1rem; font-weight: 600; color: ${displacement > 0 ? 'var(--danger)' : 'var(--secondary)'};\">\n                -${formatNumber(displacement)} jobs\n            </div>\n            <div style=\"font-size: 0.7rem; color: var(--gray-400);\">Risk: ${safePercent(rate)}%</div>\n        </div>\n    `}).join('') : '';\n\n    // Build education cards\n    const educationHTML = demographics.by_education ? Object.entries(demographics.by_education).map(([level, data]) => {\n        const displacement = data.estimated_displacement || 0;\n        const rate = data.displacement_rate || 0;\n        return `\n        <div style=\"background: var(--gray-50); padding: 12px; border-radius: 8px; min-width: 140px;\">\n            <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;\">${level}</div>\n            <div style=\"font-size: 1.1rem; font-weight: 600; color: ${displacement > 0 ? 'var(--danger)' : 'var(--secondary)'};\">\n                -${formatNumber(displacement)} jobs\n            </div>\n            <div style=\"font-size: 0.7rem; color: var(--gray-400);\">Risk: ${safePercent(rate)}%</div>\n        </div>\n    `}).join('') : '';\n\n    // Build most vulnerable list - using displacement_rate from analyzer\n    const vulnerableHTML = demographics.most_vulnerable ? demographics.most_vulnerable.slice(0, 5).map((v, i) => `\n        <div style=\"display: flex; justify-content: space-between; padding: 8px; ${i < demographics.most_vulnerable.length - 1 ? 'border-bottom: 1px solid var(--gray-100);' : ''}\">\n            <span style=\"font-weight: 500;\">${v.group || 'Unknown'}</span>\n            <span style=\"color: var(--danger);\">${safePercent(v.displacement_rate)}% at risk</span>\n        </div>\n    `).join('') : '';\n\n    // Build recommendations - these are objects with target, priority, actions\n    const recommendationsHTML = demographics.recommendations ? demographics.recommendations.slice(0, 4).map(rec => {\n        if (typeof rec === 'string') {\n            return `<li style=\"margin-bottom: 8px; color: var(--text-secondary);\">${rec}</li>`;\n        }\n        // Handle object format from analyzer\n        const target = rec.target || 'General';\n        const actions = rec.actions || [];\n        return `\n            <li style=\"margin-bottom: 12px;\">\n                <strong style=\"color: var(--text-primary);\">${target}</strong>\n                <span style=\"font-size: 0.75rem; color: ${rec.priority === 'Critical' ? 'var(--danger)' : rec.priority === 'High' ? 'var(--warning)' : 'var(--gray-500)'}; margin-left: 8px;\">(${rec.priority || 'Medium'} Priority)</span>\n                <ul style=\"margin: 4px 0 0 0; padding-left: 16px; font-size: 0.85rem; color: var(--text-secondary);\">\n                    ${actions.slice(0, 2).map(a => `<li>${a}</li>`).join('')}\n                </ul>\n            </li>\n        `;\n    }).join('') : '';\n\n    return `\n        <div style=\"margin-bottom: 20px;\">\n            <h4 style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px; text-transform: uppercase;\">\n                Impact by Age Group\n            </h4>\n            <div style=\"display: flex; gap: 12px; flex-wrap: wrap; overflow-x: auto; padding-bottom: 8px;\">\n                ${ageGroupsHTML}\n            </div>\n        </div>\n\n        <div style=\"margin-bottom: 20px;\">\n            <h4 style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px; text-transform: uppercase;\">\n                Impact by Education Level\n            </h4>\n            <div style=\"display: flex; gap: 12px; flex-wrap: wrap; overflow-x: auto; padding-bottom: 8px;\">\n                ${educationHTML}\n            </div>\n        </div>\n\n        ${demographics.most_vulnerable && demographics.most_vulnerable.length > 0 ? `\n        <div style=\"margin-bottom: 20px;\">\n            <h4 style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px; text-transform: uppercase;\">\n                Most Vulnerable Groups\n            </h4>\n            <div style=\"background: rgba(239, 68, 68, 0.05); border-radius: 8px; overflow: hidden;\">\n                ${vulnerableHTML}\n            </div>\n        </div>\n        ` : ''}\n\n        ${demographics.recommendations && demographics.recommendations.length > 0 ? `\n        <div>\n            <h4 style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px; text-transform: uppercase;\">\n                Policy Recommendations\n            </h4>\n            <ul style=\"margin: 0; padding-left: 20px; font-size: 0.875rem;\">\n                ${recommendationsHTML}\n            </ul>\n        </div>\n        ` : ''}\n    `;\n}\n\n/**\n * Generate HTML for skills gap analysis display\n */\nfunction generateSkillsGapHTML(skillsGap) {\n    if (!skillsGap) {\n        return '<p style=\"color: var(--gray-500);\">No skills gap data available.</p>';\n    }\n\n    const formatSalary = (n) => {\n        if (n === undefined || n === null || isNaN(n)) return '$0K';\n        return '$' + (n / 1000).toFixed(0) + 'K';\n    };\n\n    const safeRate = (n) => {\n        if (n === undefined || n === null || isNaN(n)) return '0';\n        return n;\n    };\n\n    // Declining skills\n    const decliningHTML = skillsGap.declining_skills ? skillsGap.declining_skills.slice(0, 6).map(skill => `\n        <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(239, 68, 68, 0.05); border-radius: 6px; margin-bottom: 8px;\">\n            <div>\n                <span style=\"font-weight: 500;\">${skill.name || 'Unknown Skill'}</span>\n                <span style=\"font-size: 0.75rem; color: var(--gray-400); margin-left: 8px;\">${skill.sector || ''}</span>\n            </div>\n            <span style=\"color: var(--danger); font-weight: 600;\">-${safeRate(skill.decline_rate)}%</span>\n        </div>\n    `).join('') : '';\n\n    // Growing skills\n    const growingHTML = skillsGap.growing_skills ? skillsGap.growing_skills.slice(0, 6).map(skill => `\n        <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(16, 185, 129, 0.05); border-radius: 6px; margin-bottom: 8px;\">\n            <div>\n                <span style=\"font-weight: 500;\">${skill.name || 'Unknown Skill'}</span>\n                <span style=\"font-size: 0.75rem; color: var(--gray-400); margin-left: 8px;\">${formatSalary(skill.avg_salary)}</span>\n            </div>\n            <span style=\"color: var(--secondary); font-weight: 600;\">+${safeRate(skill.growth_rate)}%</span>\n        </div>\n    `).join('') : '';\n\n    // Training recommendations - handle object format from analyzer\n    const trainingHTML = skillsGap.training_recommendations ? skillsGap.training_recommendations.slice(0, 4).map(rec => {\n        const skillName = rec.skill || rec.program || 'Training Program';\n        const priority = rec.priority || 'Medium';\n        const careerOutcomes = rec.career_outcomes || rec.career_paths || [];\n        // Get first program if programs is an array\n        const firstProgram = Array.isArray(rec.programs) && rec.programs.length > 0 ? rec.programs[0] : null;\n        const duration = firstProgram?.duration || rec.duration;\n        const cost = firstProgram?.cost || rec.cost || rec.estimated_cost;\n        const provider = firstProgram?.provider || rec.provider;\n\n        return `\n        <div style=\"border: 1px solid var(--gray-200); border-radius: 8px; padding: 12px; margin-bottom: 10px;\">\n            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;\">\n                <span style=\"font-weight: 600;\">${skillName}</span>\n                <span style=\"font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: ${priority === 'Critical' ? 'var(--danger)' : priority === 'High' ? 'var(--warning)' : 'var(--gray-200)'}; color: ${priority === 'Critical' || priority === 'High' ? 'white' : 'var(--gray-600)'};\">${priority}</span>\n            </div>\n            <div style=\"display: flex; gap: 16px; font-size: 0.8rem; color: var(--gray-500);\">\n                ${duration ? `<span>&#128197; ${duration} months</span>` : ''}\n                ${cost ? `<span>&#128176; ${cost}</span>` : ''}\n                ${provider ? `<span>&#127979; ${provider}</span>` : ''}\n            </div>\n            ${careerOutcomes.length > 0 ? `\n            <div style=\"margin-top: 8px; font-size: 0.75rem; color: var(--gray-400);\">\n                Leads to: ${careerOutcomes.slice(0, 3).join(', ')}\n            </div>\n            ` : ''}\n        </div>\n    `}).join('') : '';\n\n    // Transition paths - handle array format from analyzer (objects with from_skill, to_skill)\n    let transitionsHTML = '';\n    if (skillsGap.transition_paths) {\n        if (Array.isArray(skillsGap.transition_paths)) {\n            // Array of objects format\n            transitionsHTML = skillsGap.transition_paths.slice(0, 4).map(path => `\n                <div style=\"margin-bottom: 10px;\">\n                    <span style=\"color: var(--danger);\">${path.from_skill || 'Unknown'}</span>\n                    <span style=\"margin: 0 8px;\">&#8594;</span>\n                    <span style=\"color: var(--secondary);\">${path.to_skill || 'Unknown'}</span>\n                    ${path.training_duration ? `<span style=\"font-size: 0.75rem; color: var(--gray-400); margin-left: 8px;\">(${path.training_duration})</span>` : ''}\n                </div>\n            `).join('');\n        } else {\n            // Object/dictionary format (fallback)\n            transitionsHTML = Object.entries(skillsGap.transition_paths).slice(0, 4).map(([from, paths]) => `\n                <div style=\"margin-bottom: 10px;\">\n                    <span style=\"color: var(--danger);\">${from}</span>\n                    <span style=\"margin: 0 8px;\">&#8594;</span>\n                    <span style=\"color: var(--secondary);\">${Array.isArray(paths) ? paths.slice(0, 2).join(', ') : (typeof paths === 'string' ? paths : 'Various')}</span>\n                </div>\n            `).join('');\n        }\n    }\n\n    return `\n        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 20px;\">\n            <div>\n                <h4 style=\"font-size: 0.875rem; color: var(--danger); margin-bottom: 12px; text-transform: uppercase;\">\n                    &#128308; Declining Skills\n                </h4>\n                ${decliningHTML || '<p style=\"color: var(--gray-400); font-size: 0.875rem;\">No declining skills data</p>'}\n            </div>\n            <div>\n                <h4 style=\"font-size: 0.875rem; color: var(--secondary); margin-bottom: 12px; text-transform: uppercase;\">\n                    &#128994; In-Demand Skills\n                </h4>\n                ${growingHTML || '<p style=\"color: var(--gray-400); font-size: 0.875rem;\">No growing skills data</p>'}\n            </div>\n        </div>\n\n        ${transitionsHTML ? `\n        <div style=\"margin-bottom: 20px;\">\n            <h4 style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px; text-transform: uppercase;\">\n                Recommended Skill Transitions\n            </h4>\n            <div style=\"background: var(--gray-50); border-radius: 8px; padding: 12px; font-size: 0.875rem;\">\n                ${transitionsHTML}\n            </div>\n        </div>\n        ` : ''}\n\n        ${trainingHTML ? `\n        <div>\n            <h4 style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px; text-transform: uppercase;\">\n                Training Programs\n            </h4>\n            ${trainingHTML}\n        </div>\n        ` : ''}\n    `;\n}\n\n/**\n * Download PDF report of simulation results\n */\nasync function downloadPDFReport() {\n    if (!currentResults) {\n        showNotification('No simulation results to export. Run a simulation first.', 'warning');\n        return;\n    }\n\n    const btn = document.getElementById('downloadPDFBtn');\n    const originalText = btn.innerHTML;\n    btn.innerHTML = '<span class=\"spinner\" style=\"width: 16px; height: 16px; margin-right: 8px;\"></span> Generating PDF...';\n    btn.disabled = true;\n\n    try {\n        // Add demographics and skills gap data to results for PDF\n        const enrichedResults = { ...currentResults };\n\n        if (typeof demographicsAnalyzer !== 'undefined') {\n            enrichedResults.summary.demographics = demographicsAnalyzer.analyzeImpacts(currentResults);\n        }\n\n        if (typeof skillsGapAnalyzer !== 'undefined') {\n            enrichedResults.summary.skills_gap = skillsGapAnalyzer.analyzeSkillsGap(currentResults);\n        }\n\n        if (typeof pdfReportGenerator !== 'undefined') {\n            const filename = await pdfReportGenerator.generateReport(enrichedResults);\n            showNotification(`PDF report downloaded: ${filename}`, 'success');\n        } else {\n            throw new Error('PDF generator not available');\n        }\n    } catch (error) {\n        console.error('PDF generation error:', error);\n        showNotification('Failed to generate PDF report: ' + error.message, 'error');\n    } finally {\n        btn.innerHTML = originalText;\n        btn.disabled = false;\n    }\n}\n\n/**\n * Display simulation results\n */\nfunction displaySimulationResults(results) {\n    const resultsDiv = document.getElementById('simulation-results');\n    const summary = results.summary;\n\n    // Check if AI summary is available (proxy or user API key)\n    const aiAvailable = typeof aiSummaryService !== 'undefined' && aiSummaryService.isAvailable();\n\n    // Comparison button state\n    const comparisonAvailable = typeof scenarioComparison !== 'undefined';\n    const canAddToComparison = comparisonAvailable && scenarioComparison.canAddMore();\n    const comparisonCount = comparisonAvailable ? scenarioComparison.getCount() : 0;\n\n    const comparisonButton = comparisonAvailable ? `\n        <button id=\"addToComparisonBtn\" class=\"btn btn-success\" onclick=\"addToComparison()\" ${!canAddToComparison ? 'disabled' : ''}>\n            ${canAddToComparison ? `Add to Comparison (${comparisonCount}/3)` : 'Comparison Full (3/3)'}\n        </button>\n    ` : '';\n\n    // Check if we have an AI-enhanced analysis available\n    const hasEnhancedAnalysis = currentAIAnalysis !== null;\n\n    // Generate inline AI analysis HTML if this is an AI simulation with analysis\n    const inlineAIAnalysisHTML = (isAISimulationResult && currentAIAnalysis) ? generateInlineAIAnalysisHTML(currentAIAnalysis.analysis, currentAIAnalysis.enhancedParams) : '';\n\n    const aiSummarySection = isAISimulationResult ? `\n        <div class=\"card\" id=\"aiSummaryCard\" style=\"margin-bottom: 24px; border-left: 4px solid var(--primary);\">\n            <div class=\"card-header\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n                <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                    <span style=\"font-size: 1.25rem;\">&#129302;</span> AI-Enhanced Analysis\n                </h3>\n                <div style=\"display: flex; gap: 8px;\">\n                    ${comparisonButton}\n                </div>\n            </div>\n            <div id=\"aiSummaryContent\" style=\"line-height: 1.7;\">\n                ${inlineAIAnalysisHTML}\n            </div>\n        </div>\n    ` : `\n        <div class=\"card\" id=\"aiSummaryCard\" style=\"margin-bottom: 24px; border-left: 4px solid var(--primary);\">\n            <div class=\"card-header\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n                <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                    <span style=\"font-size: 1.25rem;\">&#129302;</span> AI Analysis\n                </h3>\n                <div style=\"display: flex; gap: 8px;\">\n                    ${comparisonButton}\n                </div>\n            </div>\n            <div id=\"aiSummaryContent\" style=\"line-height: 1.7;\">\n                ${hasEnhancedAnalysis ? `\n                    <div style=\"display: flex; align-items: center; gap: 16px; padding: 16px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1)); border-radius: 8px; margin-bottom: 16px;\">\n                        <div style=\"flex: 1;\">\n                            <p style=\"margin: 0 0 4px 0; font-weight: 600; color: var(--text-primary);\">\n                                 AI-Enhanced Analysis Available\n                            </p>\n                            <p style=\"margin: 0; font-size: 0.875rem; color: var(--text-secondary);\">\n                                View the comprehensive AI analysis with policy recommendations and insights.\n                            </p>\n                        </div>\n                        <button class=\"btn\" style=\"background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; white-space: nowrap;\" onclick=\"showAIAnalysis()\">\n                            View AI Report\n                        </button>\n                    </div>\n                ` : ''}\n                ${aiAvailable ? `\n                    <p style=\"color: var(--gray-500); margin-bottom: 16px;\">\n                        Get AI-powered analysis of your simulation results, including key insights,\n                        policy implications, and risk assessments.\n                    </p>\n                    <button class=\"btn btn-primary\" onclick=\"generateAISummary(currentResults)\" id=\"generateAIBtn\">\n                        Generate AI Analysis\n                    </button>\n                ` : `\n                    <p style=\"color: var(--gray-500);\">\n                        Configure your Gemini API key to get AI-powered analysis of your simulation results.\n                    </p>\n                    <button class=\"btn btn-primary btn-sm\" onclick=\"showAISettingsModal()\" style=\"margin-top: 12px;\">\n                        Configure API Key\n                    </button>\n                `}\n            </div>\n        </div>\n    `;\n\n    resultsDiv.innerHTML = `\n        <div class=\"fade-in\">\n            ${aiSummarySection}\n            ${vizManager.createSummaryHTML(summary)}\n\n            <div class=\"card-grid\">\n                <div class=\"card\">\n                    <div class=\"card-header\">\n                        <h3>Unemployment Projection</h3>\n                    </div>\n                    <div class=\"chart-container\">\n                        <canvas id=\"projectedURChart\"></canvas>\n                    </div>\n                </div>\n                <div class=\"card\">\n                    <div class=\"card-header\">\n                        <h3>AI Adoption Curve</h3>\n                    </div>\n                    <div class=\"chart-container\">\n                        <canvas id=\"adoptionCurveChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <h3>AI Job Impact Over Time</h3>\n                </div>\n                <div class=\"chart-container large\">\n                    <canvas id=\"jobImpactChart\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"card-grid\">\n                <div class=\"card\">\n                    <div class=\"card-header\">\n                        <h3>Wage Trends</h3>\n                    </div>\n                    <div class=\"chart-container\">\n                        <canvas id=\"wageTrendChart\"></canvas>\n                    </div>\n                </div>\n                <div class=\"card\">\n                    <div class=\"card-header\">\n                        <h3>Productivity</h3>\n                    </div>\n                    <div class=\"chart-container\">\n                        <canvas id=\"productivityChart\"></canvas>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <h3>Sector Employment Changes</h3>\n                </div>\n                <div class=\"chart-container large\">\n                    <canvas id=\"sectorChangeChart\"></canvas>\n                </div>\n            </div>\n\n            <div class=\"card\">\n                <div class=\"card-header\">\n                    <h3>Simulation Inputs & Assumptions</h3>\n                </div>\n                <table class=\"data-table\">\n                    <tbody>\n                        <tr>\n                            <td><strong>Scenario Name</strong></td>\n                            <td>${escapeHtml(results.scenario.name)}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Timeframe</strong></td>\n                            <td>${results.scenario.timeframe.start_year} - ${results.scenario.timeframe.end_year}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Target Unemployment</strong></td>\n                            <td>${results.scenario.targets.unemployment_rate}%</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Target AI Adoption</strong></td>\n                            <td>${results.scenario.targets.ai_adoption_rate}%</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Automation Pace</strong></td>\n                            <td>${results.scenario.targets.automation_pace}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Adoption Curve</strong></td>\n                            <td>${results.scenario.ai_parameters.adoption_curve.replace('_', '-')}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>New Job Multiplier</strong></td>\n                            <td>${results.scenario.ai_parameters.new_job_multiplier}</td>\n                        </tr>\n                        <tr>\n                            <td><strong>Active Interventions</strong></td>\n                            <td>${results.scenario.interventions.length > 0 ?\n        results.scenario.interventions.map(i => i.name).join(', ') : 'None'}</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n\n            <!-- Timeline Player Section -->\n            <div class=\"card\" id=\"timelineCard\" style=\"border-left: 4px solid var(--secondary);\">\n                <div class=\"card-header\">\n                    <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                        <span style=\"font-size: 1.25rem;\">&#9199;</span> Timeline Player\n                    </h3>\n                    <span style=\"font-size: 0.875rem; color: var(--gray-500);\">Animate through simulation years</span>\n                </div>\n                <div id=\"timeline-player-container\" style=\"padding: 20px;\">\n                    <div style=\"text-align: center; color: var(--gray-500);\">\n                        <div class=\"spinner\" style=\"margin: 0 auto 12px; width: 24px; height: 24px;\"></div>\n                        <p>Loading timeline player...</p>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Monte Carlo Analysis Section -->\n            <div class=\"card\" id=\"monteCarloCard\" style=\"border-left: 4px solid var(--info);\">\n                <div class=\"card-header\">\n                    <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                        <span style=\"font-size: 1.25rem;\">&#127922;</span> Monte Carlo Analysis\n                    </h3>\n                    <button class=\"btn btn-primary btn-sm\" onclick=\"runMonteCarloAnalysis()\" id=\"runMonteCarloBtn\">\n                        Run 1000 Iterations\n                    </button>\n                </div>\n                <div id=\"monteCarloContent\">\n                    <p style=\"color: var(--gray-500); margin-bottom: 12px;\">\n                        Monte Carlo simulation runs your scenario 1000+ times with randomized parameters\n                        to show probability distributions instead of single point estimates.\n                    </p>\n                    <p style=\"font-size: 0.875rem; color: var(--gray-400);\">\n                        Click \"Run 1000 Iterations\" to see the range of possible outcomes and their likelihoods.\n                    </p>\n                </div>\n            </div>\n\n            <!-- Intervention Impact Section -->\n            ${results.scenario.interventions && results.scenario.interventions.length > 0 && results.summary.interventions ? `\n            <div class=\"card\" id=\"interventionImpactCard\" style=\"border-left: 4px solid var(--secondary);\">\n                <div class=\"card-header\">\n                    <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                        <span style=\"font-size: 1.25rem;\">&#128200;</span> Intervention Impact\n                    </h3>\n                    <span style=\"font-size: 0.875rem; color: var(--gray-500);\">Effects on simulation outcomes</span>\n                </div>\n                <div id=\"interventionImpactContent\">\n                    ${generateInterventionImpactHTML(results.summary.interventions, results.scenario.interventions)}\n                </div>\n            </div>\n            ` : ''}\n\n            <!-- Intervention Cost Calculator Section -->\n            ${results.scenario.interventions && results.scenario.interventions.length > 0 ? `\n            <div class=\"card\" id=\"costCalculatorCard\" style=\"border-left: 4px solid var(--warning);\">\n                <div class=\"card-header\">\n                    <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                        <span style=\"font-size: 1.25rem;\">&#128176;</span> Intervention Cost Analysis\n                    </h3>\n                </div>\n                <div id=\"costCalculatorContent\">\n                    ${typeof interventionCostCalculator !== 'undefined'\n                        ? interventionCostCalculator.generateSummaryHTML(\n                            interventionCostCalculator.calculateAllCosts(results.scenario.interventions, results)\n                          )\n                        : '<p style=\"color: var(--gray-500);\">Cost calculator not available.</p>'\n                    }\n                </div>\n            </div>\n            ` : ''}\n\n            <!-- Demographics Analysis Section -->\n            <div class=\"card\" id=\"demographicsCard\" style=\"border-left: 4px solid #ec4899;\">\n                <div class=\"card-header\">\n                    <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                        <span style=\"font-size: 1.25rem;\">&#128101;</span> Demographic Impact Analysis\n                    </h3>\n                    <span style=\"font-size: 0.875rem; color: var(--gray-500);\">Impact by age, education, and gender</span>\n                </div>\n                <div id=\"demographicsContent\">\n                    ${typeof demographicsAnalyzer !== 'undefined'\n                        ? generateDemographicsHTML(demographicsAnalyzer.analyzeImpacts(results))\n                        : '<p style=\"color: var(--gray-500);\">Demographics analyzer not available.</p>'\n                    }\n                </div>\n            </div>\n\n            <!-- Skills Gap Analysis Section -->\n            <div class=\"card\" id=\"skillsGapCard\" style=\"border-left: 4px solid #14b8a6;\">\n                <div class=\"card-header\">\n                    <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                        <span style=\"font-size: 1.25rem;\">&#128218;</span> Skills Gap Analysis\n                    </h3>\n                    <span style=\"font-size: 0.875rem; color: var(--gray-500);\">Declining and growing skills with training paths</span>\n                </div>\n                <div id=\"skillsGapContent\">\n                    ${typeof skillsGapAnalyzer !== 'undefined'\n                        ? generateSkillsGapHTML(skillsGapAnalyzer.analyzeSkillsGap(results))\n                        : '<p style=\"color: var(--gray-500);\">Skills gap analyzer not available.</p>'\n                    }\n                </div>\n            </div>\n\n            <!-- Export Actions Section -->\n            <div class=\"card\" id=\"exportActionsCard\" style=\"border-left: 4px solid var(--gray-400);\">\n                <div class=\"card-header\">\n                    <h3 style=\"display: flex; align-items: center; gap: 8px;\">\n                        <span style=\"font-size: 1.25rem;\">&#128190;</span> Export & Download\n                    </h3>\n                </div>\n                <div style=\"display: flex; gap: 12px; flex-wrap: wrap;\">\n                    <button class=\"btn btn-primary\" onclick=\"downloadPDFReport()\" id=\"downloadPDFBtn\">\n                        <span style=\"margin-right: 6px;\">&#128196;</span> Download PDF Report\n                    </button>\n                    <button class=\"btn btn-outline\" onclick=\"exportResults()\">\n                        <span style=\"margin-right: 6px;\">&#128202;</span> Export JSON Data\n                    </button>\n                    <button class=\"btn btn-outline\" onclick=\"copyScenarioURL()\">\n                        <span style=\"margin-right: 6px;\">&#128279;</span> Copy Share URL\n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n\n    // Create charts\n    setTimeout(() => {\n        vizManager.createUnemploymentChart('projectedURChart', results.results);\n        vizManager.createAdoptionChart('adoptionCurveChart', results.results);\n        vizManager.createJobImpactChart('jobImpactChart', results.results);\n        vizManager.createWageChart('wageTrendChart', results.results);\n        vizManager.createProductivityChart('productivityChart', results.results);\n        vizManager.createSectorImpactChart('sectorChangeChart',\n            results.results[0].sectors,\n            results.results[results.results.length - 1].sectors\n        );\n    }, 100);\n\n    // Initialize timeline player\n    if (typeof initializeTimeline !== 'undefined') {\n        setTimeout(() => {\n            initializeTimeline(results);\n        }, 150);\n    }\n}\n\n/**\n * Show intervention modal\n */\nfunction showInterventionModal() {\n    document.getElementById('interventionModal').style.display = 'flex';\n    updateInterventionParams();\n}\n\n/**\n * Hide intervention modal\n */\nfunction hideInterventionModal() {\n    document.getElementById('interventionModal').style.display = 'none';\n}\n\n/**\n * Update intervention parameters form\n */\nfunction updateInterventionParams() {\n    const type = document.getElementById('interventionType').value;\n    const types = interventionSystem.interventionTypes;\n    const params = types[type].parameters;\n\n    let html = '';\n    for (const [key, config] of Object.entries(params)) {\n        if (config.type === 'number') {\n            html += `\n                <div class=\"form-group\">\n                    <label style=\"color: var(--gray-700);\">${key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n                        ${config.unit ? `(${config.unit})` : ''}</label>\n                    <input type=\"number\" id=\"param_${key}\" value=\"${config.default}\"\n                        min=\"${config.min || 0}\" max=\"${config.max || 100}\"\n                        style=\"color: var(--gray-900);\">\n                </div>\n            `;\n        } else if (config.type === 'select') {\n            html += `\n                <div class=\"form-group\">\n                    <label style=\"color: var(--gray-700);\">${key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}</label>\n                    <select id=\"param_${key}\" style=\"color: var(--gray-900);\">\n                        ${config.options.map(o => `<option value=\"${o}\" ${o === config.default ? 'selected' : ''}>${o.replace(/_/g, ' ')}</option>`).join('')}\n                    </select>\n                </div>\n            `;\n        }\n    }\n\n    document.getElementById('interventionParams').innerHTML = html;\n}\n\n/**\n * Add intervention from modal\n */\nfunction addIntervention() {\n    const type = document.getElementById('interventionType').value;\n    const types = interventionSystem.interventionTypes;\n    const paramDefs = types[type].parameters;\n\n    const params = {};\n    for (const key of Object.keys(paramDefs)) {\n        const el = document.getElementById(`param_${key}`);\n        if (el) {\n            params[key] = paramDefs[key].type === 'number' ?\n                parseFloat(el.value) : el.value;\n        }\n    }\n\n    interventionSystem.addIntervention(type, params);\n    updateInterventionsList();\n    hideInterventionModal();\n}\n\n/**\n * Quick add intervention with defaults\n */\nfunction quickAddIntervention(type) {\n    interventionSystem.addIntervention(type);\n    updateInterventionsList();\n}\n\n/**\n * Update interventions list in sidebar\n */\nfunction updateInterventionsList() {\n    const container = document.getElementById('interventionsList');\n    const interventions = interventionSystem.interventions;\n\n    if (interventions.length === 0) {\n        container.innerHTML = '<p class=\"no-interventions-message\">No interventions added</p>';\n        return;\n    }\n\n    let html = '';\n    for (const intervention of interventions) {\n        html += `\n            <div class=\"intervention-card\">\n                <div class=\"header\">\n                    <span class=\"name\">${intervention.name}</span>\n                    <div class=\"toggle ${intervention.active ? 'active' : ''}\"\n                         onclick=\"toggleIntervention('${intervention.id}')\"></div>\n                </div>\n                <div class=\"intervention-card-footer\">\n                    <span class=\"category\">${intervention.category.replace('_', ' ')}</span>\n                    <button class=\"btn btn-sm remove-btn\" onclick=\"removeIntervention('${intervention.id}')\">Remove</button>\n                </div>\n            </div>\n        `;\n    }\n\n    container.innerHTML = html;\n}\n\n/**\n * Toggle intervention active state\n */\nfunction toggleIntervention(id) {\n    const intervention = interventionSystem.interventions.find(i => i.id == id);\n    if (intervention) {\n        intervention.active = !intervention.active;\n        updateInterventionsList();\n    }\n}\n\n/**\n * Remove intervention\n */\nfunction removeIntervention(id) {\n    interventionSystem.removeIntervention(parseFloat(id));\n    updateInterventionsList();\n}\n\n/**\n * Export results - show options modal\n */\nfunction exportResults() {\n    if (!currentResults) {\n        alert('No simulation results to export. Please run a simulation first.');\n        return;\n    }\n\n    const choice = confirm('Export as PDF report?\\n\\nClick OK for PDF report\\nClick Cancel for JSON data export');\n\n    if (choice) {\n        exportAsPDF();\n    } else {\n        exportAsJSON();\n    }\n}\n\n/**\n * Export results as PDF report\n */\nfunction exportAsPDF() {\n    if (!currentResults) {\n        alert('No simulation results to export. Please run a simulation first.');\n        return;\n    }\n\n    if (typeof pdfExporter !== 'undefined') {\n        pdfExporter.generateReport(currentResults);\n    } else {\n        alert('PDF export not available.');\n    }\n}\n\n/**\n * Export results as JSON\n */\nfunction exportAsJSON() {\n    if (!currentResults) {\n        alert('No simulation results to export. Please run a simulation first.');\n        return;\n    }\n\n    const data = simulationEngine.exportResults('json');\n    const blob = new Blob([data], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `simulation-results-${Date.now()}.json`;\n    a.click();\n\n    URL.revokeObjectURL(url);\n}\n\n/**\n * Reset simulation to defaults\n */\nfunction resetSimulation() {\n    resetToDefaults();\n}\n\n/**\n * Reset all settings to default values\n */\nfunction resetToDefaults() {\n    currentResults = null;\n    interventionSystem.interventions = [];\n\n    // Reset form values to defaults\n    document.getElementById('scenarioName').value = DEFAULT_CONFIG.scenarioName;\n    document.getElementById('targetYear').value = DEFAULT_CONFIG.targetYear;\n    document.getElementById('targetUR').value = DEFAULT_CONFIG.targetUR;\n    document.getElementById('urValue').textContent = DEFAULT_CONFIG.targetUR.toFixed(1);\n    document.getElementById('aiAdoption').value = DEFAULT_CONFIG.aiAdoption;\n    document.getElementById('aiValue').textContent = DEFAULT_CONFIG.aiAdoption;\n    document.getElementById('automationPace').value = DEFAULT_CONFIG.automationPace;\n    document.getElementById('adoptionCurve').value = DEFAULT_CONFIG.adoptionCurve;\n\n    updateInterventionsList();\n\n    // Reset results display\n    document.getElementById('simulation-results').innerHTML = `\n        <div class=\"card\" style=\"text-align: center; padding: 60px;\">\n            <h3 style=\"margin-bottom: 16px;\">No Simulation Run Yet</h3>\n            <p style=\"color: var(--gray-500); margin-bottom: 24px;\">\n                Configure your scenario parameters and click \"Run Simulation\" to see projected impacts.\n            </p>\n            <button class=\"btn btn-primary\" onclick=\"runSimulation()\">Run Simulation</button>\n        </div>\n    `;\n\n    // Show snapshot section\n    showSection('snapshot');\n    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));\n    document.querySelectorAll('.nav-tab')[0].classList.add('active');\n}\n\n/**\n * Get all saved simulations from localStorage\n */\nfunction getSavedSimulations() {\n    try {\n        const saved = localStorage.getItem(STORAGE_KEY);\n        return saved ? JSON.parse(saved) : [];\n    } catch (error) {\n        console.error('Error loading saved simulations:', error);\n        return [];\n    }\n}\n\n/**\n * Save current simulation\n */\nfunction saveSimulation() {\n    if (!currentResults) {\n        alert('No simulation results to save. Please run a simulation first.');\n        return;\n    }\n\n    const name = prompt('Enter a name for this simulation:', currentResults.scenario.name);\n    if (!name) return;\n\n    const simulations = getSavedSimulations();\n\n    const simulationToSave = {\n        id: Date.now(),\n        name: name,\n        savedAt: new Date().toISOString(),\n        config: {\n            scenarioName: currentResults.scenario.name,\n            targetYear: currentResults.scenario.timeframe.end_year,\n            targetUR: currentResults.scenario.targets.unemployment_rate,\n            aiAdoption: currentResults.scenario.targets.ai_adoption_rate,\n            automationPace: currentResults.scenario.targets.automation_pace,\n            adoptionCurve: currentResults.scenario.ai_parameters.adoption_curve\n        },\n        interventions: interventionSystem.interventions.map(i => ({\n            type: i.type,\n            parameters: i.parameters,\n            active: i.active\n        })),\n        results: currentResults,\n        summary: currentResults.summary\n    };\n\n    simulations.push(simulationToSave);\n\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(simulations));\n        updateSavedSimulationsList();\n        alert(`Simulation \"${name}\" saved successfully!`);\n    } catch (error) {\n        console.error('Error saving simulation:', error);\n        alert('Failed to save simulation. Storage may be full.');\n    }\n}\n\n/**\n * Load a saved simulation\n */\nfunction loadSavedSimulation(id) {\n    const simulations = getSavedSimulations();\n    const simulation = simulations.find(s => s.id === id);\n\n    if (!simulation) {\n        alert('Simulation not found.');\n        return;\n    }\n\n    // Load config into form\n    document.getElementById('scenarioName').value = simulation.config.scenarioName;\n    document.getElementById('targetYear').value = simulation.config.targetYear;\n    document.getElementById('targetUR').value = simulation.config.targetUR;\n    document.getElementById('urValue').textContent = simulation.config.targetUR;\n    document.getElementById('aiAdoption').value = simulation.config.aiAdoption;\n    document.getElementById('aiValue').textContent = simulation.config.aiAdoption;\n    document.getElementById('automationPace').value = simulation.config.automationPace;\n    document.getElementById('adoptionCurve').value = simulation.config.adoptionCurve;\n\n    // Load interventions\n    interventionSystem.interventions = [];\n    for (const intervention of simulation.interventions) {\n        interventionSystem.addIntervention(intervention.type, intervention.parameters, {\n            active: intervention.active\n        });\n    }\n    updateInterventionsList();\n\n    // Load results\n    currentResults = simulation.results;\n    displaySimulationResults(currentResults);\n\n    // Switch to simulation tab (index 3)\n    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n    document.getElementById('simulation-section').classList.add('active');\n    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));\n    document.querySelectorAll('.nav-tab')[3].classList.add('active');\n\n    // Close modal if open\n    hideSavedSimulationsModal();\n}\n\n/**\n * Delete a saved simulation\n */\nfunction deleteSavedSimulation(id, event) {\n    if (event) event.stopPropagation();\n\n    if (!confirm('Are you sure you want to delete this simulation?')) {\n        return;\n    }\n\n    const simulations = getSavedSimulations();\n    const filtered = simulations.filter(s => s.id !== id);\n\n    try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(filtered));\n        updateSavedSimulationsList();\n    } catch (error) {\n        console.error('Error deleting simulation:', error);\n        alert('Failed to delete simulation.');\n    }\n}\n\n/**\n * Update the saved simulations list in sidebar\n */\nfunction updateSavedSimulationsList() {\n    const container = document.getElementById('savedSimulationsList');\n    if (!container) return;\n\n    const simulations = getSavedSimulations();\n\n    if (simulations.length === 0) {\n        container.innerHTML = '<p style=\"font-size: 0.875rem; color: var(--gray-400);\">No saved simulations</p>';\n        return;\n    }\n\n    let html = '';\n    // Show most recent 3 simulations\n    const recentSimulations = simulations.slice(-3).reverse();\n\n    for (const sim of recentSimulations) {\n        const date = new Date(sim.savedAt).toLocaleDateString();\n        html += `\n            <div class=\"saved-sim-card\" onclick=\"loadSavedSimulation(${sim.id})\" style=\"\n                background: var(--gray-700);\n                border-radius: 6px;\n                padding: 10px;\n                margin-bottom: 8px;\n                cursor: pointer;\n                transition: background 0.2s;\n            \" onmouseover=\"this.style.background='var(--gray-600)'\" onmouseout=\"this.style.background='var(--gray-700)'\">\n                <div style=\"display: flex; justify-content: space-between; align-items: start;\">\n                    <div>\n                        <div style=\"font-weight: 500; font-size: 0.875rem;\">${escapeHtml(sim.name)}</div>\n                        <div style=\"font-size: 0.75rem; color: var(--gray-400);\">${date}</div>\n                        <div style=\"font-size: 0.75rem; color: var(--gray-400);\">\n                            UR: ${sim.summary.labor_market_changes.unemployment_rate.final}%\n                        </div>\n                    </div>\n                    <button class=\"btn btn-sm\" style=\"padding: 2px 6px; background: var(--gray-600); font-size: 0.7rem;\"\n                            onclick=\"deleteSavedSimulation(${sim.id}, event)\">X</button>\n                </div>\n            </div>\n        `;\n    }\n\n    if (simulations.length > 3) {\n        html += `\n            <button class=\"btn btn-outline btn-block btn-sm\" onclick=\"showSavedSimulationsModal()\" style=\"margin-top: 8px;\">\n                View All (${simulations.length})\n            </button>\n        `;\n    }\n\n    container.innerHTML = html;\n}\n\n/**\n * Show saved simulations modal\n */\nfunction showSavedSimulationsModal() {\n    const simulations = getSavedSimulations();\n    const modal = document.getElementById('savedSimulationsModal');\n\n    let html = '';\n    if (simulations.length === 0) {\n        html = '<p style=\"text-align: center; color: var(--gray-500);\">No saved simulations</p>';\n    } else {\n        for (const sim of simulations.slice().reverse()) {\n            const date = new Date(sim.savedAt).toLocaleDateString();\n            const time = new Date(sim.savedAt).toLocaleTimeString();\n            html += `\n                <div class=\"card\" style=\"margin-bottom: 12px; cursor: pointer;\" onclick=\"loadSavedSimulation(${sim.id})\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: start;\">\n                        <div>\n                            <h4 style=\"margin-bottom: 4px;\">${escapeHtml(sim.name)}</h4>\n                            <p style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 8px;\">\n                                Saved: ${date} at ${time}\n                            </p>\n                            <div style=\"display: flex; gap: 16px; font-size: 0.875rem;\">\n                                <span><strong>Target Year:</strong> ${sim.config.targetYear}</span>\n                                <span><strong>Final UR:</strong> ${sim.summary.labor_market_changes.unemployment_rate.final}%</span>\n                                <span><strong>AI Adoption:</strong> ${sim.summary.ai_impact.ai_adoption.final}%</span>\n                            </div>\n                            ${sim.interventions.length > 0 ? `\n                                <div style=\"margin-top: 8px; font-size: 0.75rem; color: var(--gray-400);\">\n                                    Interventions: ${sim.interventions.filter(i => i.active).map(i => i.type.replace(/_/g, ' ')).join(', ')}\n                                </div>\n                            ` : ''}\n                        </div>\n                        <button class=\"btn btn-danger btn-sm\" onclick=\"deleteSavedSimulation(${sim.id}, event)\">Delete</button>\n                    </div>\n                </div>\n            `;\n        }\n    }\n\n    document.getElementById('savedSimulationsContent').innerHTML = html;\n    modal.style.display = 'flex';\n}\n\n/**\n * Hide saved simulations modal\n */\nfunction hideSavedSimulationsModal() {\n    document.getElementById('savedSimulationsModal').style.display = 'none';\n}\n\n/**\n * Clear all saved simulations\n */\nfunction clearAllSavedSimulations() {\n    if (!confirm('Are you sure you want to delete ALL saved simulations? This cannot be undone.')) {\n        return;\n    }\n\n    try {\n        localStorage.removeItem(STORAGE_KEY);\n        updateSavedSimulationsList();\n        hideSavedSimulationsModal();\n        alert('All saved simulations have been deleted.');\n    } catch (error) {\n        console.error('Error clearing simulations:', error);\n        alert('Failed to clear simulations.');\n    }\n}\n\n// ==========================================\n// Hypothetical Indicators Functions\n// ==========================================\n\n/**\n * Render hypothetical indicators list\n */\nfunction renderHypotheticalIndicators() {\n    const container = document.getElementById('hypotheticalIndicatorsList');\n    if (!container || typeof hypotheticalIndicators === 'undefined') return;\n\n    const allIndicators = hypotheticalIndicators.getAllIndicators();\n    const categoryNames = hypotheticalIndicators.getCategoryDisplayNames();\n\n    // Group by category\n    const grouped = {};\n    Object.values(allIndicators).forEach(ind => {\n        const cat = ind.category || 'other';\n        if (!grouped[cat]) grouped[cat] = [];\n        grouped[cat].push(ind);\n    });\n\n    let html = '';\n\n    Object.entries(grouped).forEach(([category, indicators]) => {\n        html += `\n            <div style=\"margin-bottom: 20px;\">\n                <h4 style=\"font-size: 0.875rem; color: var(--gray-600); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;\">\n                    ${categoryNames[category] || category}\n                </h4>\n                <div style=\"display: grid; gap: 12px;\">\n        `;\n\n        indicators.forEach(ind => {\n            const isAdjusted = ind.manuallyAdjusted;\n            const isCustom = ind.isCustom;\n            const trendIcon = ind.trend === 'increasing' ? '' : ind.trend === 'decreasing' ? '' : '';\n            const trendClass = ind.trend === 'increasing' ? 'positive' : ind.trend === 'decreasing' ? 'negative' : '';\n\n            html += `\n                <div class=\"hypothetical-indicator-card\" style=\"\n                    background: var(--gray-50);\n                    border: 1px solid ${isAdjusted ? 'var(--warning)' : 'var(--gray-200)'};\n                    border-radius: 8px;\n                    padding: 16px;\n                    ${isAdjusted ? 'border-left: 3px solid var(--warning);' : ''}\n                \">\n                    <div style=\"display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;\">\n                        <div style=\"display: flex; align-items: center; gap: 8px;\">\n                            <span style=\"font-size: 1.25rem;\">${ind.icon}</span>\n                            <div>\n                                <div style=\"font-weight: 600; color: var(--gray-800);\">\n                                    ${ind.name}\n                                    ${isCustom ? '<span class=\"tag tag-medium\" style=\"margin-left: 8px; font-size: 0.65rem;\">Custom</span>' : ''}\n                                    ${isAdjusted ? '<span class=\"tag tag-high\" style=\"margin-left: 8px; font-size: 0.65rem;\">Adjusted</span>' : ''}\n                                </div>\n                                <div style=\"font-size: 0.75rem; color: var(--gray-500);\">${ind.shortName}  ${ind.source}</div>\n                            </div>\n                        </div>\n                        <div style=\"text-align: right;\">\n                            <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--gray-800);\">\n                                ${formatIndicatorValue(ind.value, ind.unit)}\n                            </div>\n                            <div class=\"change ${trendClass}\" style=\"font-size: 0.75rem;\">\n                                ${trendIcon} ${ind.trend}\n                            </div>\n                        </div>\n                    </div>\n\n                    <p style=\"font-size: 0.8rem; color: var(--gray-600); margin-bottom: 12px;\">\n                        ${ind.description}\n                    </p>\n\n                    <div style=\"margin-bottom: 8px;\">\n                        <label style=\"font-size: 0.75rem; color: var(--gray-500); display: flex; justify-content: space-between;\">\n                            <span>Adjust Value</span>\n                            <span>${ind.range.min} - ${ind.range.max}</span>\n                        </label>\n                        <div style=\"display: flex; align-items: center; gap: 8px;\">\n                            <input type=\"range\"\n                                   id=\"slider_${ind.id}\"\n                                   min=\"${ind.range.min}\"\n                                   max=\"${ind.range.max}\"\n                                   step=\"${(ind.range.max - ind.range.min) / 100}\"\n                                   value=\"${ind.value}\"\n                                   onchange=\"updateIndicatorValue('${ind.id}', this.value)\"\n                                   style=\"flex: 1;\">\n                            <input type=\"number\"\n                                   id=\"input_${ind.id}\"\n                                   value=\"${ind.value.toFixed(1)}\"\n                                   min=\"${ind.range.min}\"\n                                   max=\"${ind.range.max}\"\n                                   step=\"0.1\"\n                                   onchange=\"updateIndicatorValue('${ind.id}', this.value)\"\n                                   style=\"width: 70px; padding: 4px 8px; border: 1px solid var(--gray-300); border-radius: 4px; color: var(--gray-800);\">\n                        </div>\n                    </div>\n\n                    <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                        <div style=\"font-size: 0.7rem; color: var(--gray-400);\">\n                            Linked: ${ind.linkedMetrics.length > 0 ? ind.linkedMetrics.join(', ') : 'None'}\n                        </div>\n                        <div style=\"display: flex; gap: 8px;\">\n                            ${isAdjusted ? `\n                                <button class=\"btn btn-sm btn-outline\" onclick=\"resetIndicator('${ind.id}')\" style=\"font-size: 0.7rem; padding: 2px 8px;\">\n                                    Reset\n                                </button>\n                            ` : ''}\n                            ${isCustom ? `\n                                <button class=\"btn btn-sm btn-danger\" onclick=\"deleteCustomIndicator('${ind.id}')\" style=\"font-size: 0.7rem; padding: 2px 8px;\">\n                                    Delete\n                                </button>\n                            ` : ''}\n                            <button class=\"btn btn-sm btn-outline\" onclick=\"showIndicatorDetails('${ind.id}')\" style=\"font-size: 0.7rem; padding: 2px 8px;\">\n                                Details\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n        });\n\n        html += `\n                </div>\n            </div>\n        `;\n    });\n\n    container.innerHTML = html;\n}\n\n/**\n * Format indicator value with appropriate unit\n */\nfunction formatIndicatorValue(value, unit) {\n    switch (unit) {\n        case 'percent':\n        case 'percent_workers':\n        case 'percent_jobs_exposed':\n        case 'percent_augmented':\n        case 'percent_premium':\n        case 'percent_monthly':\n        case 'percent_new_roles':\n        case 'percent_annual_change':\n            return `${value.toFixed(1)}%`;\n        case 'index_0_100':\n            return value.toFixed(0);\n        case 'millions':\n            return `${value.toFixed(1)}M`;\n        case 'thousands':\n            return `${value.toFixed(0)}K`;\n        case 'currency':\n            return `$${value.toFixed(0)}`;\n        case 'ratio':\n            return value.toFixed(2);\n        default:\n            return value.toFixed(1);\n    }\n}\n\n/**\n * Update indicator value from slider/input\n */\nfunction updateIndicatorValue(id, value) {\n    if (typeof hypotheticalIndicators === 'undefined') return;\n\n    const numValue = parseFloat(value);\n    hypotheticalIndicators.setIndicatorValue(id, numValue);\n\n    // Update both slider and input\n    const slider = document.getElementById(`slider_${id}`);\n    const input = document.getElementById(`input_${id}`);\n    if (slider) slider.value = numValue;\n    if (input) input.value = numValue.toFixed(1);\n\n    // Re-render to show adjusted state\n    renderHypotheticalIndicators();\n}\n\n/**\n * Reset a single indicator\n */\nfunction resetIndicator(id) {\n    if (typeof hypotheticalIndicators === 'undefined') return;\n    hypotheticalIndicators.resetIndicator(id);\n    renderHypotheticalIndicators();\n}\n\n/**\n * Reset all hypothetical indicators\n */\nfunction resetAllHypotheticalIndicators() {\n    if (!confirm('Reset all hypothetical indicators to their default values?')) return;\n    if (typeof hypotheticalIndicators === 'undefined') return;\n    hypotheticalIndicators.resetAllIndicators();\n    renderHypotheticalIndicators();\n}\n\n/**\n * Show indicator details modal\n */\nfunction showIndicatorDetails(id) {\n    if (typeof hypotheticalIndicators === 'undefined') return;\n\n    const ind = hypotheticalIndicators.getIndicator(id);\n    if (!ind) return;\n\n    const linkedInfo = Object.entries(ind.linkageFormula)\n        .map(([metric, coef]) => `${metric}: ${coef > 0 ? '+' : ''}${coef}`)\n        .join(', ') || 'None';\n\n    alert(`${ind.icon} ${ind.name} (${ind.shortName})\n\nDescription:\n${ind.description}\n\nMethodology:\n${ind.methodology}\n\nSource: ${ind.source}\n${ind.sourceUrl ? `URL: ${ind.sourceUrl}` : ''}\n\nCurrent Value: ${formatIndicatorValue(ind.value, ind.unit)}\nBase Value: ${formatIndicatorValue(ind.baseValue, ind.unit)}\nRange: ${ind.range.min} - ${ind.range.max}\n\nLinkage Coefficients:\n${linkedInfo}\n\nConfidence: ${ind.confidence}\nTrend: ${ind.trend}`);\n}\n\n/**\n * Toggle sources details visibility\n */\nfunction toggleSourcesDetails() {\n    const details = document.getElementById('sourcesDetails');\n    if (details) {\n        details.style.display = details.style.display === 'none' ? 'block' : 'none';\n    }\n}\n\n/**\n * Show custom indicator modal\n */\nfunction showCustomIndicatorModal() {\n    document.getElementById('customIndicatorModal').style.display = 'flex';\n\n    // Reset form\n    document.getElementById('customIndName').value = '';\n    document.getElementById('customIndShortName').value = '';\n    document.getElementById('customIndDescription').value = '';\n    document.getElementById('customIndValue').value = '';\n    document.getElementById('customIndMin').value = '0';\n    document.getElementById('customIndMax').value = '100';\n    document.getElementById('customIndCategory').value = 'custom';\n    document.getElementById('customIndIcon').value = '';\n\n    // Reset checkboxes\n    document.getElementById('link_unemployment').checked = false;\n    document.getElementById('link_ai_adoption').checked = false;\n    document.getElementById('link_productivity').checked = false;\n    document.getElementById('link_wages').checked = false;\n}\n\n/**\n * Hide custom indicator modal\n */\nfunction hideCustomIndicatorModal() {\n    document.getElementById('customIndicatorModal').style.display = 'none';\n}\n\n/**\n * Save custom indicator\n */\nfunction saveCustomIndicator() {\n    if (typeof hypotheticalIndicators === 'undefined') return;\n\n    const name = document.getElementById('customIndName').value.trim();\n    const value = parseFloat(document.getElementById('customIndValue').value);\n\n    if (!name) {\n        alert('Please enter an indicator name.');\n        return;\n    }\n\n    if (isNaN(value)) {\n        alert('Please enter a valid initial value.');\n        return;\n    }\n\n    const linkedMetrics = [];\n    const linkageFormula = {};\n\n    if (document.getElementById('link_unemployment').checked) {\n        linkedMetrics.push('unemployment_rate');\n        linkageFormula.unemployment_rate = 0.2;\n    }\n    if (document.getElementById('link_ai_adoption').checked) {\n        linkedMetrics.push('ai_adoption');\n        linkageFormula.ai_adoption = 0.3;\n    }\n    if (document.getElementById('link_productivity').checked) {\n        linkedMetrics.push('productivity_growth');\n        linkageFormula.productivity_growth = 0.2;\n    }\n    if (document.getElementById('link_wages').checked) {\n        linkedMetrics.push('wage_growth');\n        linkageFormula.wage_growth = 0.15;\n    }\n\n    const config = {\n        name,\n        shortName: document.getElementById('customIndShortName').value.trim() || name.substring(0, 4).toUpperCase(),\n        description: document.getElementById('customIndDescription').value.trim(),\n        value,\n        unit: document.getElementById('customIndUnit').value,\n        range: {\n            min: parseFloat(document.getElementById('customIndMin').value) || 0,\n            max: parseFloat(document.getElementById('customIndMax').value) || 100\n        },\n        category: document.getElementById('customIndCategory').value,\n        icon: document.getElementById('customIndIcon').value,\n        linkedMetrics,\n        linkageFormula\n    };\n\n    hypotheticalIndicators.addCustomIndicator(config);\n    hideCustomIndicatorModal();\n    renderHypotheticalIndicators();\n\n    alert(`Custom indicator \"${name}\" created successfully!`);\n}\n\n/**\n * Delete custom indicator\n */\nfunction deleteCustomIndicator(id) {\n    if (!confirm('Are you sure you want to delete this custom indicator?')) return;\n    if (typeof hypotheticalIndicators === 'undefined') return;\n\n    hypotheticalIndicators.removeCustomIndicator(id);\n    renderHypotheticalIndicators();\n}\n\n// ==========================================\n// AI Summary Functions\n// ==========================================\n\n/**\n * Update AI settings status in sidebar\n */\nfunction updateAISettingsStatus() {\n    const statusDiv = document.getElementById('aiSettingsStatus');\n    if (!statusDiv) return;\n\n    if (typeof aiSummaryService !== 'undefined' && aiSummaryService.isAvailable()) {\n        statusDiv.innerHTML = `\n            <p style=\"font-size: 0.875rem; color: var(--secondary);\">\n                &#10003; AI analysis available\n            </p>\n        `;\n    } else {\n        statusDiv.innerHTML = `\n            <p style=\"font-size: 0.875rem; color: var(--gray-400);\">AI analysis unavailable</p>\n        `;\n    }\n}\n\n\n/**\n * Generate AI summary for simulation results\n */\nasync function generateAISummary(results) {\n    const contentDiv = document.getElementById('aiSummaryContent');\n    if (!contentDiv) return;\n\n    // Show loading state\n    contentDiv.innerHTML = `\n        <div style=\"display: flex; align-items: center; gap: 12px; color: var(--gray-500);\">\n            <div class=\"spinner\" style=\"width: 20px; height: 20px; border-width: 2px;\"></div>\n            <span>Generating AI analysis...</span>\n        </div>\n    `;\n\n    try {\n        const summary = await aiSummaryService.generateSummary(results);\n\n        // Format the summary with proper paragraphs\n        const formattedSummary = summary\n            .split('\\n\\n')\n            .map(para => `<p style=\"margin-bottom: 16px;\">${para.replace(/\\n/g, '<br>')}</p>`)\n            .join('');\n\n        contentDiv.innerHTML = `\n            <div class=\"ai-summary-text\">\n                ${formattedSummary}\n            </div>\n            <div style=\"margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center;\">\n                <span style=\"font-size: 0.75rem; color: var(--gray-400);\">\n                    Generated by Google Gemini AI\n                </span>\n                <button class=\"btn btn-sm btn-outline\" onclick=\"regenerateAISummary()\">\n                    Regenerate\n                </button>\n            </div>\n        `;\n    } catch (error) {\n        console.error('AI Summary error:', error);\n        contentDiv.innerHTML = `\n            <div style=\"color: var(--danger);\">\n                <p style=\"margin-bottom: 8px;\"><strong>Error generating AI analysis:</strong></p>\n                <p style=\"margin-bottom: 12px;\">${error.message}</p>\n                <button class=\"btn btn-sm btn-outline\" onclick=\"regenerateAISummary()\">Try Again</button>\n            </div>\n        `;\n    }\n}\n\n/**\n * Regenerate AI summary\n */\nfunction regenerateAISummary() {\n    if (currentResults) {\n        generateAISummary(currentResults);\n    }\n}\n\n// ==========================================\n// Scenario Comparison Functions\n// ==========================================\n\n/**\n * Render the comparison view\n */\nfunction renderComparisonView() {\n    const contentDiv = document.getElementById('comparison-content');\n    const countSpan = document.getElementById('comparisonCount');\n    const clearBtn = document.getElementById('clearComparisonBtn');\n\n    if (!contentDiv || typeof scenarioComparison === 'undefined') return;\n\n    const count = scenarioComparison.getCount();\n\n    // Update count badge\n    if (countSpan) {\n        countSpan.textContent = `${count}/3 scenarios`;\n    }\n\n    // Show/hide clear button\n    if (clearBtn) {\n        clearBtn.style.display = count > 0 ? 'inline-block' : 'none';\n    }\n\n    // Render comparison HTML\n    contentDiv.innerHTML = scenarioComparison.generateComparisonHTML();\n\n    // Render charts if we have 2+ scenarios\n    if (count >= 2) {\n        setTimeout(() => {\n            scenarioComparison.renderCharts();\n        }, 100);\n    }\n}\n\n/**\n * Add current simulation to comparison\n */\nfunction addToComparison() {\n    if (!currentResults) {\n        alert('No simulation results to add. Please run a simulation first.');\n        return;\n    }\n\n    if (typeof scenarioComparison === 'undefined') {\n        alert('Comparison feature not available.');\n        return;\n    }\n\n    const config = {\n        targetYear: currentResults.scenario.timeframe.end_year,\n        targetUR: currentResults.scenario.targets.unemployment_rate,\n        aiAdoption: currentResults.scenario.targets.ai_adoption_rate,\n        automationPace: currentResults.scenario.targets.automation_pace,\n        interventions: currentResults.scenario.interventions\n    };\n\n    const name = currentResults.scenario.name || `Scenario ${scenarioComparison.getCount() + 1}`;\n\n    const result = scenarioComparison.addScenario(name, config, currentResults);\n\n    if (result.success) {\n        // Update the comparison badge in the add button\n        updateComparisonButton();\n\n        alert(`\"${name}\" added to comparison! Go to \"Compare Scenarios\" tab to view.`);\n    } else {\n        alert(result.message);\n    }\n}\n\n/**\n * Update the comparison button badge\n */\nfunction updateComparisonButton() {\n    const btn = document.getElementById('addToComparisonBtn');\n    if (btn && typeof scenarioComparison !== 'undefined') {\n        const count = scenarioComparison.getCount();\n        const canAdd = scenarioComparison.canAddMore();\n\n        if (!canAdd) {\n            btn.disabled = true;\n            btn.innerHTML = 'Comparison Full (3/3)';\n        } else {\n            btn.disabled = false;\n            btn.innerHTML = `Add to Comparison (${count}/3)`;\n        }\n    }\n}\n\n/**\n * Clear all comparisons\n */\nfunction clearAllComparisons() {\n    if (!confirm('Are you sure you want to clear all scenarios from comparison?')) {\n        return;\n    }\n\n    if (typeof scenarioComparison !== 'undefined') {\n        scenarioComparison.clearAll();\n        renderComparisonView();\n        updateComparisonButton();\n    }\n}\n\n/**\n * Remove a scenario from comparison (called from comparison view)\n */\nfunction removeFromComparison(id) {\n    if (typeof scenarioComparison !== 'undefined') {\n        scenarioComparison.removeScenario(id);\n        renderComparisonView();\n        updateComparisonButton();\n    }\n}\n\n// ==========================================\n// Occupation Drill-Down Functions\n// ==========================================\n\n/**\n * Render occupation list\n */\nfunction renderOccupationList() {\n    const contentDiv = document.getElementById('occupation-content');\n    if (!contentDiv || typeof occupationDrilldown === 'undefined') return;\n\n    contentDiv.innerHTML = occupationDrilldown.generateOccupationListHTML();\n}\n\n/**\n * Show occupation details\n */\nfunction showOccupationDetails(occupationId) {\n    const contentDiv = document.getElementById('occupation-content');\n    if (!contentDiv || typeof occupationDrilldown === 'undefined') return;\n\n    // Get current scenario parameters\n    const aiAdoptionRate = parseInt(document.getElementById('aiAdoption').value) || 70;\n    const targetYear = parseInt(document.getElementById('targetYear').value) || 2029;\n\n    contentDiv.innerHTML = occupationDrilldown.generateDetailedViewHTML(occupationId, aiAdoptionRate, targetYear);\n}\n\n/**\n * Hide occupation details and return to list\n */\nfunction hideOccupationDetails() {\n    renderOccupationList();\n}\n\n// ==========================================\n// Sensitivity Analysis Functions\n// ==========================================\n\n/**\n * Render sensitivity analysis overview\n */\nfunction renderSensitivityOverview() {\n    const contentDiv = document.getElementById('sensitivity-content');\n    if (!contentDiv || typeof sensitivityAnalysis === 'undefined') return;\n\n    contentDiv.innerHTML = sensitivityAnalysis.generateOverviewHTML();\n}\n\n/**\n * Run sensitivity analysis for a specific parameter\n */\nasync function runParameterSensitivity(parameterId) {\n    const resultsDiv = document.getElementById('sensitivity-results');\n    if (!resultsDiv || typeof sensitivityAnalysis === 'undefined') return;\n\n    // Show loading state\n    resultsDiv.innerHTML = `\n        <div class=\"card\" style=\"text-align: center; padding: 40px;\">\n            <div class=\"loading\">\n                <div class=\"spinner\"></div>\n                <span>Running sensitivity analysis...</span>\n            </div>\n            <p style=\"color: var(--gray-500); margin-top: 16px; font-size: 0.875rem;\">\n                This may take a moment as multiple simulations are run.\n            </p>\n        </div>\n    `;\n\n    try {\n        // Get current configuration\n        const baseConfig = {\n            name: 'Sensitivity Analysis',\n            end_year: parseInt(document.getElementById('targetYear').value),\n            target_unemployment: parseFloat(document.getElementById('targetUR').value),\n            ai_adoption_rate: parseInt(document.getElementById('aiAdoption').value),\n            automation_pace: document.getElementById('automationPace').value,\n            adoption_curve: document.getElementById('adoptionCurve').value\n        };\n\n        // Run analysis\n        const analysisResults = await sensitivityAnalysis.runAnalysis(\n            parameterId,\n            simulationEngine,\n            baseConfig\n        );\n\n        // Display results\n        resultsDiv.innerHTML = sensitivityAnalysis.generateAnalysisHTML(analysisResults);\n\n    } catch (error) {\n        console.error('Sensitivity analysis error:', error);\n        resultsDiv.innerHTML = `\n            <div class=\"card\" style=\"text-align: center; padding: 40px; color: var(--danger);\">\n                <h3>Analysis Error</h3>\n                <p>${error.message}</p>\n                <button class=\"btn btn-outline\" onclick=\"renderSensitivityOverview()\" style=\"margin-top: 16px;\">\n                    Try Again\n                </button>\n            </div>\n        `;\n    }\n}\n\n// ==========================================\n// Real Metrics Functions\n// ==========================================\n\n/**\n * Initialize real metrics system\n */\nasync function initializeRealMetrics() {\n    if (typeof realMetricsSystem !== 'undefined' && dataService) {\n        await realMetricsSystem.initialize(dataService);\n        renderRealMetrics();\n        renderRealMetricsSources();\n    }\n}\n\n/**\n * Render real metrics list\n */\nfunction renderRealMetrics() {\n    const container = document.getElementById('realMetricsList');\n    if (!container || typeof realMetricsSystem === 'undefined') return;\n\n    const metricsByCategory = realMetricsSystem.getMetricsByCategory();\n    if (!metricsByCategory) {\n        container.innerHTML = '<p style=\"color: var(--gray-500);\">Loading metrics...</p>';\n        return;\n    }\n\n    let html = '';\n\n    Object.entries(metricsByCategory).forEach(([categoryId, category]) => {\n        html += `\n            <div style=\"margin-bottom: 24px;\">\n                <h4 style=\"font-size: 0.875rem; color: var(--gray-600); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px;\">\n                    <span>${category.icon}</span> ${category.category}\n                </h4>\n                <div style=\"display: grid; gap: 12px;\">\n        `;\n\n        Object.values(category.metrics).forEach(metric => {\n            const isAdjusted = metric.manuallyAdjusted;\n            const trendIcon = metric.trend === 'increasing' ? '' : metric.trend === 'decreasing' ? '' : '';\n            const trendClass = metric.trend === 'increasing' ? 'positive' : metric.trend === 'decreasing' ? 'negative' : '';\n\n            html += `\n                <div class=\"real-metric-card\" style=\"\n                    background: var(--gray-50);\n                    border: 1px solid ${isAdjusted ? 'var(--warning)' : 'var(--gray-200)'};\n                    border-radius: 8px;\n                    padding: 16px;\n                    ${isAdjusted ? 'border-left: 3px solid var(--warning);' : ''}\n                \">\n                    <div style=\"display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;\">\n                        <div style=\"display: flex; align-items: center; gap: 8px;\">\n                            <div>\n                                <div style=\"font-weight: 600; color: var(--gray-800);\">\n                                    ${metric.name}\n                                    ${isAdjusted ? '<span class=\"tag tag-high\" style=\"margin-left: 8px; font-size: 0.65rem;\">Adjusted</span>' : ''}\n                                </div>\n                                <div style=\"font-size: 0.75rem; color: var(--gray-500);\">\n                                    ${metric.shortName}  ${metric.source}  ${metric.date || 'Current'}\n                                </div>\n                            </div>\n                        </div>\n                        <div style=\"text-align: right;\">\n                            <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--gray-800);\">\n                                ${formatRealMetricValue(metric.value, metric.unit)}\n                            </div>\n                            <div class=\"change ${trendClass}\" style=\"font-size: 0.75rem;\">\n                                ${trendIcon} ${metric.trend}\n                            </div>\n                        </div>\n                    </div>\n\n                    <p style=\"font-size: 0.8rem; color: var(--gray-600); margin-bottom: 12px;\">\n                        ${metric.description}\n                    </p>\n\n                    <div style=\"margin-bottom: 8px;\">\n                        <label style=\"font-size: 0.75rem; color: var(--gray-500); display: flex; justify-content: space-between;\">\n                            <span>Adjust Value</span>\n                            <span>${formatRealMetricValue(metric.range.min, metric.unit)} - ${formatRealMetricValue(metric.range.max, metric.unit)}</span>\n                        </label>\n                        <div style=\"display: flex; align-items: center; gap: 8px;\">\n                            <input type=\"range\"\n                                   id=\"realmetric_slider_${metric.id}\"\n                                   min=\"${metric.range.min}\"\n                                   max=\"${metric.range.max}\"\n                                   step=\"${(metric.range.max - metric.range.min) / 100}\"\n                                   value=\"${metric.value}\"\n                                   onchange=\"updateRealMetricValue('${metric.id}', this.value)\"\n                                   style=\"flex: 1;\">\n                            <input type=\"number\"\n                                   id=\"realmetric_input_${metric.id}\"\n                                   value=\"${formatRealMetricInput(metric.value, metric.unit)}\"\n                                   min=\"${metric.range.min}\"\n                                   max=\"${metric.range.max}\"\n                                   step=\"${getMetricStep(metric.unit)}\"\n                                   onchange=\"updateRealMetricValue('${metric.id}', this.value)\"\n                                   style=\"width: 100px; padding: 4px 8px; border: 1px solid var(--gray-300); border-radius: 4px; color: var(--gray-800);\">\n                        </div>\n                    </div>\n\n                    <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                        <div style=\"font-size: 0.7rem; color: var(--gray-400);\">\n                            ${metric.seriesId ? `Series: ${metric.seriesId}` : ''}\n                        </div>\n                        <div style=\"display: flex; gap: 8px;\">\n                            ${isAdjusted ? `\n                                <button class=\"btn btn-sm btn-outline\" onclick=\"resetRealMetric('${metric.id}')\" style=\"font-size: 0.7rem; padding: 2px 8px;\">\n                                    Reset\n                                </button>\n                            ` : ''}\n                            <button class=\"btn btn-sm btn-outline\" onclick=\"showRealMetricDetails('${metric.id}')\" style=\"font-size: 0.7rem; padding: 2px 8px;\">\n                                Details\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            `;\n        });\n\n        html += `\n                </div>\n            </div>\n        `;\n    });\n\n    container.innerHTML = html;\n}\n\n/**\n * Format real metric value for display\n */\nfunction formatRealMetricValue(value, unit) {\n    switch (unit) {\n        case 'percent':\n            return `${value.toFixed(1)}%`;\n        case 'millions':\n            if (value >= 1000000) {\n                return `${(value / 1000000).toFixed(1)}M`;\n            }\n            return `${(value / 1000000).toFixed(2)}M`;\n        case 'currency':\n            return `$${value.toFixed(2)}`;\n        case 'index':\n            return value.toFixed(1);\n        default:\n            return value.toFixed(1);\n    }\n}\n\n/**\n * Format real metric value for input field\n */\nfunction formatRealMetricInput(value, unit) {\n    if (unit === 'millions' && value >= 1000000) {\n        return value.toFixed(0);\n    }\n    return value.toFixed(2);\n}\n\n/**\n * Get step value for metric input\n */\nfunction getMetricStep(unit) {\n    switch (unit) {\n        case 'millions':\n            return 100000;\n        case 'percent':\n            return 0.1;\n        case 'currency':\n            return 0.01;\n        default:\n            return 0.1;\n    }\n}\n\n/**\n * Update real metric value\n */\nfunction updateRealMetricValue(id, value) {\n    if (typeof realMetricsSystem === 'undefined') return;\n\n    const numValue = parseFloat(value);\n    realMetricsSystem.setMetricValue(id, numValue);\n\n    // Update both slider and input\n    const slider = document.getElementById(`realmetric_slider_${id}`);\n    const input = document.getElementById(`realmetric_input_${id}`);\n    const metric = realMetricsSystem.getMetric(id);\n\n    if (slider) slider.value = numValue;\n    if (input && metric) input.value = formatRealMetricInput(numValue, metric.unit);\n\n    // Re-render to show adjusted state\n    renderRealMetrics();\n}\n\n/**\n * Reset a single real metric\n */\nfunction resetRealMetric(id) {\n    if (typeof realMetricsSystem === 'undefined') return;\n    realMetricsSystem.resetMetric(id);\n    renderRealMetrics();\n}\n\n/**\n * Reset all real metrics\n */\nfunction resetAllRealMetrics() {\n    if (!confirm('Reset all real metrics to their baseline values?')) return;\n    if (typeof realMetricsSystem === 'undefined') return;\n    realMetricsSystem.resetAllMetrics();\n    renderRealMetrics();\n}\n\n/**\n * Show real metric details\n */\nfunction showRealMetricDetails(id) {\n    if (typeof realMetricsSystem === 'undefined') return;\n\n    const metric = realMetricsSystem.getMetric(id);\n    if (!metric) return;\n\n    alert(`${metric.name} (${metric.shortName})\n\nDescription:\n${metric.description}\n\nMethodology:\n${metric.methodology}\n\nSource: ${metric.source}\n${metric.sourceUrl ? `URL: ${metric.sourceUrl}` : ''}\n${metric.seriesId ? `Series ID: ${metric.seriesId}` : ''}\n\nCurrent Value: ${formatRealMetricValue(metric.value, metric.unit)}\nBase Value: ${formatRealMetricValue(metric.baseValue, metric.unit)}\nData Date: ${metric.date || 'Current'}\n\nTrend: ${metric.trend}`);\n}\n\n/**\n * Toggle real metrics sources details\n */\nfunction toggleRealMetricsSourcesDetails() {\n    const details = document.getElementById('realMetricsSourcesDetails');\n    if (details) {\n        details.style.display = details.style.display === 'none' ? 'block' : 'none';\n    }\n}\n\n/**\n * Render real metrics data sources\n */\nfunction renderRealMetricsSources() {\n    const container = document.getElementById('realMetricsSourcesTable');\n    if (!container || typeof realMetricsSystem === 'undefined') return;\n\n    const sources = realMetricsSystem.getDataSources();\n\n    let html = '';\n    sources.forEach(source => {\n        html += `\n            <tr>\n                <td><strong>${source.name}</strong></td>\n                <td>${source.type}</td>\n                <td>${source.metrics.join(', ')}</td>\n                <td>${source.updateFrequency}</td>\n                <td><a href=\"${source.url}\" target=\"_blank\" style=\"color: var(--primary);\">View</a></td>\n            </tr>\n        `;\n    });\n\n    container.innerHTML = html;\n}\n\n// ==========================================\n// Settings & API Key Functions\n// ==========================================\n\n/**\n * Initialize settings page\n */\nfunction initializeSettings() {\n    // Load saved API keys into fields\n    loadApiKeyFields();\n\n    // Update status badges\n    updateAllApiStatuses();\n\n    // Update fetch button state\n    updateFetchButtonState();\n\n    // Update auto data status\n    updateAutoDataStatus();\n\n    // Initialize Gemini API call counter\n    initializeGeminiCounter();\n}\n\n// ==========================================\n// GEMINI API CALL COUNTER\n// ==========================================\n\n/**\n * Initialize the Gemini API call counter display\n */\nfunction initializeGeminiCounter() {\n    // Set initial checkbox state\n    const checkbox = document.getElementById('geminiCounterEnabled');\n    if (checkbox && typeof aiSummaryService !== 'undefined') {\n        checkbox.checked = aiSummaryService.isCounterEnabled();\n    }\n\n    // Update the display\n    updateGeminiCounterDisplay();\n\n    // Listen for API call events\n    window.addEventListener('geminiApiCallUpdated', updateGeminiCounterDisplay);\n}\n\n/**\n * Update the Gemini counter display\n */\nfunction updateGeminiCounterDisplay() {\n    if (typeof aiSummaryService === 'undefined') return;\n\n    const stats = aiSummaryService.getApiCallStats();\n\n    // Update counter values\n    const totalEl = document.getElementById('geminiCallsTotal');\n    const todayEl = document.getElementById('geminiCallsToday');\n    const weekEl = document.getElementById('geminiCallsWeek');\n    const lastCallEl = document.getElementById('geminiLastCall');\n\n    if (totalEl) totalEl.textContent = stats.total.toLocaleString();\n    if (todayEl) todayEl.textContent = stats.today.toLocaleString();\n    if (weekEl) weekEl.textContent = stats.thisWeek.toLocaleString();\n\n    if (lastCallEl) {\n        if (stats.lastCall) {\n            const lastTime = new Date(stats.lastCall.timestamp);\n            const timeAgo = getTimeAgo(lastTime);\n            lastCallEl.textContent = `Last call: ${timeAgo} (${stats.lastCall.type})`;\n        } else {\n            lastCallEl.textContent = 'No calls recorded';\n        }\n    }\n}\n\n/**\n * Toggle the Gemini counter enabled state\n */\nfunction toggleGeminiCounter() {\n    if (typeof aiSummaryService === 'undefined') return;\n\n    const checkbox = document.getElementById('geminiCounterEnabled');\n    if (checkbox) {\n        aiSummaryService.setCounterEnabled(checkbox.checked);\n    }\n}\n\n/**\n * Reset the Gemini API call counter\n */\nfunction resetGeminiCounter() {\n    if (typeof aiSummaryService === 'undefined') return;\n\n    if (confirm('Are you sure you want to reset the API call counter? This cannot be undone.')) {\n        aiSummaryService.resetApiCallCount();\n        updateGeminiCounterDisplay();\n    }\n}\n\n/**\n * Get human-readable time ago string\n */\nfunction getTimeAgo(date) {\n    const seconds = Math.floor((new Date() - date) / 1000);\n\n    if (seconds < 60) return 'just now';\n    if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\n    if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;\n\n    return date.toLocaleDateString();\n}\n\n/**\n * Update the auto-updated data status display\n */\nfunction updateAutoDataStatus() {\n    const statusDiv = document.getElementById('autoDataStatus');\n    if (!statusDiv || !dataService) return;\n\n    const liveStatus = dataService.getLiveDataStatus();\n\n    if (liveStatus.available && liveStatus.sources.bls === 'success') {\n        const lastUpdated = new Date(liveStatus.lastUpdated);\n        const formattedDate = lastUpdated.toLocaleDateString('en-US', {\n            year: 'numeric',\n            month: 'long',\n            day: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n        });\n\n        statusDiv.innerHTML = `\n            <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 8px;\">\n                <span style=\"color: var(--secondary); font-size: 1.25rem;\">&#10003;</span>\n                <strong style=\"color: var(--secondary);\">Live Data Active</strong>\n            </div>\n            <p style=\"color: var(--gray-600); font-size: 0.875rem; margin-bottom: 8px;\">\n                Data automatically updated: <strong>${formattedDate}</strong>\n            </p>\n            <div style=\"display: flex; gap: 16px; flex-wrap: wrap; font-size: 0.8rem; color: var(--gray-600);\">\n                <span>BLS: <strong style=\"color: var(--secondary);\">${liveStatus.sources.bls}</strong></span>\n                <span>FRED: <strong style=\"color: ${liveStatus.sources.fred === 'success' ? 'var(--secondary)' : 'var(--gray-400)'};\">${liveStatus.sources.fred}</strong></span>\n            </div>\n            ${liveStatus.summary ? `\n                <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--gray-200); font-size: 0.8rem;\">\n                    <strong>Latest Values:</strong>\n                    <div style=\"display: flex; gap: 16px; flex-wrap: wrap; margin-top: 4px; color: var(--gray-600);\">\n                        ${liveStatus.summary.unemployment_rate ? `<span>Unemployment: <strong>${liveStatus.summary.unemployment_rate}%</strong></span>` : ''}\n                        ${liveStatus.summary.total_employment ? `<span>Employment: <strong>${(liveStatus.summary.total_employment / 1e6).toFixed(1)}M</strong></span>` : ''}\n                    </div>\n                </div>\n            ` : ''}\n        `;\n    } else {\n        statusDiv.innerHTML = `\n            <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 8px;\">\n                <span style=\"color: var(--warning); font-size: 1.25rem;\">&#9888;</span>\n                <strong style=\"color: var(--gray-600);\">Using Baseline Data</strong>\n            </div>\n            <p style=\"color: var(--gray-600); font-size: 0.875rem;\">\n                Currently using cached baseline data from late 2024.\n            </p>\n            <p style=\"color: var(--gray-500); font-size: 0.75rem; margin-top: 8px;\">\n                Auto-updated data will be available once the repository owner configures the GitHub Actions workflow with API keys.\n            </p>\n        `;\n    }\n}\n\n/**\n * Legacy function stubs - API keys now managed via GitHub Actions and Cloudflare proxy\n */\nfunction loadApiKeyFields() {\n    // No longer needed - API keys managed server-side\n}\n\nfunction getApiKey(service) {\n    // Legacy function - always returns null\n    return null;\n}\n\nfunction saveApiKey(service) {\n    // No longer needed\n}\n\nfunction clearApiKey(service) {\n    // No longer needed\n}\n\nfunction updateAllApiStatuses() {\n    // Update the sidebar AI settings status\n    updateAISettingsStatus();\n}\n\nfunction updateApiStatus(service, elementId) {\n    // No longer needed\n}\n\nfunction updateFetchButtonState() {\n    // No longer needed - live data fetched via GitHub Actions\n}\n\nfunction fetchLiveData() {\n    // No longer needed - live data fetched automatically via GitHub Actions\n}\n\n/**\n * Reset everything to defaults - complete reset of all simulator state\n */\nfunction resetEverything() {\n    if (!confirm('Reset everything to defaults? This will:\\n\\n Reset all simulation parameters\\n Reset all economic metrics to baseline\\n Reset all AI indicators\\n Clear all interventions\\n Clear comparison scenarios\\n\\nSaved simulations will be preserved.')) {\n        return;\n    }\n\n    // Reset simulation parameters\n    resetToDefaults();\n\n    // Reset real metrics\n    if (typeof realMetricsSystem !== 'undefined') {\n        realMetricsSystem.resetAllMetrics();\n        renderRealMetrics();\n    }\n\n    // Reset hypothetical indicators\n    if (typeof hypotheticalIndicators !== 'undefined') {\n        hypotheticalIndicators.resetAllIndicators();\n        renderHypotheticalIndicators();\n    }\n\n    // Clear interventions\n    activeInterventions = [];\n    updateInterventionsList();\n\n    // Clear comparison scenarios\n    if (typeof scenarioComparison !== 'undefined') {\n        scenarioComparison.clearAll();\n        renderComparisonView();\n    }\n\n    // Reset the current snapshot display\n    updateSnapshot();\n\n    // Show confirmation\n    alert('Everything has been reset to defaults.');\n}\n\n/**\n * Reset to baseline data\n */\nfunction resetToBaselineData() {\n    if (!confirm('Reset all metrics to baseline values? This will undo any live data updates or manual adjustments.')) {\n        return;\n    }\n\n    if (typeof realMetricsSystem !== 'undefined') {\n        realMetricsSystem.resetAllMetrics();\n        renderRealMetrics();\n    }\n\n    if (typeof hypotheticalIndicators !== 'undefined') {\n        hypotheticalIndicators.resetAllIndicators();\n        renderHypotheticalIndicators();\n    }\n\n    const resultsDiv = document.getElementById('fetchResults');\n    if (resultsDiv) {\n        resultsDiv.innerHTML = `\n            <div style=\"background: var(--secondary); color: white; padding: 12px; border-radius: 6px;\">\n                Metrics reset to baseline values.\n            </div>\n        `;\n    }\n\n    updateFetchButtonState();\n}\n\n// ============================================\n// SIMULATION SHARING FUNCTIONS\n// ============================================\n\n/**\n * Share the current simulation publicly\n */\nasync function shareSimulation() {\n    if (!currentResults) {\n        alert('Please run a simulation first before sharing.');\n        return;\n    }\n\n    const name = prompt('Enter a name for your shared simulation:', currentResults.scenario.name || 'My Simulation');\n    if (!name) return;\n\n    const description = prompt('Add a description (optional):', '');\n\n    const shareBtn = document.getElementById('shareBtn');\n    const originalText = shareBtn.textContent;\n    shareBtn.textContent = 'Sharing...';\n    shareBtn.disabled = true;\n\n    try {\n        const result = await simulationSharing.savePublic({\n            name,\n            description,\n            scenario: currentResults.scenario,\n            results: currentResults.results,\n            summary: currentResults.summary\n        });\n\n        // Copy URL to clipboard\n        await simulationSharing.copyShareUrl(result.id);\n\n        alert(`Simulation shared successfully!\\n\\nShare URL (copied to clipboard):\\n${result.url}\\n\\nThis link will expire in ${result.expiresIn}.`);\n\n    } catch (error) {\n        console.error('Share error:', error);\n        alert(`Failed to share simulation: ${error.message}`);\n    } finally {\n        shareBtn.textContent = originalText;\n        shareBtn.disabled = false;\n    }\n}\n\n/**\n * Check for and load a shared simulation from URL\n */\nasync function checkForSharedSimulation() {\n    // First check for URL parameter sharing (scenario config only)\n    if (typeof urlSharing !== 'undefined' && urlSharing.hasScenarioInURL()) {\n        try {\n            applyScenarioFromURL();\n            updateSlidersFromInputs();\n            return; // Don't also check for simulation sharing\n        } catch (e) {\n            console.warn('Failed to load URL parameters:', e);\n        }\n    }\n\n    // Then check for cloud-based simulation sharing (full results)\n    if (typeof simulationSharing === 'undefined') return;\n\n    const sharedId = simulationSharing.getSharedIdFromUrl();\n    if (!sharedId) return;\n\n    console.log('Loading shared simulation:', sharedId);\n\n    try {\n        const simulation = await simulationSharing.load(sharedId);\n\n        // Display notification\n        const notification = document.createElement('div');\n        notification.style.cssText = `\n            position: fixed;\n            top: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: var(--primary);\n            color: white;\n            padding: 16px 24px;\n            border-radius: 8px;\n            z-index: 10000;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        `;\n        notification.innerHTML = `\n            <strong>Viewing shared simulation:</strong> ${escapeHtml(simulation.name)}\n            <br><small>Shared ${new Date(simulation.createdAt).toLocaleDateString()}  ${simulation.views} views</small>\n        `;\n        document.body.appendChild(notification);\n        setTimeout(() => notification.remove(), 5000);\n\n        // Set the scenario configuration\n        if (simulation.scenario) {\n            document.getElementById('scenarioName').value = simulation.name || simulation.scenario.name;\n            document.getElementById('targetYear').value = simulation.scenario.timeframe?.end_year || '2029';\n            document.getElementById('targetUR').value = simulation.scenario.targets?.unemployment_rate || 10;\n            document.getElementById('urValue').textContent = simulation.scenario.targets?.unemployment_rate || 10;\n            document.getElementById('aiAdoption').value = simulation.scenario.targets?.ai_adoption_rate || 70;\n            document.getElementById('aiValue').textContent = simulation.scenario.targets?.ai_adoption_rate || 70;\n            document.getElementById('automationPace').value = simulation.scenario.targets?.automation_pace || 'moderate';\n            document.getElementById('adoptionCurve').value = simulation.scenario.ai_parameters?.adoption_curve || 's_curve';\n        }\n\n        // Load the results\n        currentResults = {\n            scenario: simulation.scenario,\n            results: simulation.results,\n            summary: simulation.summary\n        };\n\n        // Display the results\n        displaySimulationResults(currentResults);\n\n        // Show share button\n        document.getElementById('shareBtn').style.display = 'inline-block';\n\n        // Switch to simulation tab\n        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n        document.getElementById('simulation-section').classList.add('active');\n        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));\n        document.querySelectorAll('.nav-tab')[3].classList.add('active');\n\n        // Clear URL parameter to prevent reload issues\n        window.history.replaceState({}, document.title, window.location.pathname);\n\n    } catch (error) {\n        console.error('Failed to load shared simulation:', error);\n        alert(`Failed to load shared simulation: ${error.message}`);\n        // Clear the URL parameter\n        window.history.replaceState({}, document.title, window.location.pathname);\n    }\n}\n\n/**\n * Show share button after simulation runs\n */\nfunction showShareButton() {\n    const shareBtn = document.getElementById('shareBtn');\n    if (shareBtn && typeof simulationSharing !== 'undefined' && simulationSharing.isAvailable()) {\n        shareBtn.style.display = 'inline-block';\n    }\n}\n\n// ==========================================\n// Monte Carlo Simulation Functions\n// ==========================================\n\nlet monteCarloInstance = null;\n\n/**\n * Run Monte Carlo analysis on current simulation\n */\nasync function runMonteCarloAnalysis() {\n    if (!currentResults || !simulationEngine) {\n        alert('Please run a simulation first');\n        return;\n    }\n\n    const btn = document.getElementById('runMonteCarloBtn');\n    const content = document.getElementById('monteCarloContent');\n\n    // Disable button and show progress\n    btn.disabled = true;\n    btn.innerHTML = 'Running... 0%';\n\n    content.innerHTML = `\n        <div style=\"margin-bottom: 16px;\">\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 8px;\">\n                <span>Running 1000 iterations...</span>\n                <span id=\"mcProgress\">0%</span>\n            </div>\n            <div class=\"progress-bar\" style=\"height: 12px;\">\n                <div class=\"fill\" id=\"mcProgressBar\" style=\"width: 0%;\"></div>\n            </div>\n        </div>\n        <p style=\"color: var(--gray-500); font-size: 0.875rem;\">\n            This may take 30-60 seconds. Each iteration randomizes parameters within realistic ranges.\n        </p>\n    `;\n\n    try {\n        // Initialize Monte Carlo\n        monteCarloInstance = new MonteCarloSimulation(simulationEngine);\n        monteCarloInstance.configure({ iterations: 1000 });\n\n        // Get current scenario config\n        const config = {\n            name: currentResults.scenario.name,\n            end_year: currentResults.scenario.timeframe.end_year,\n            target_unemployment: currentResults.scenario.targets.unemployment_rate,\n            ai_adoption_rate: currentResults.scenario.targets.ai_adoption_rate,\n            automation_pace: currentResults.scenario.targets.automation_pace,\n            adoption_curve: currentResults.scenario.ai_parameters.adoption_curve,\n            new_job_multiplier: currentResults.scenario.ai_parameters.new_job_multiplier || 0.4,\n            gdp_growth: currentResults.scenario.economic_parameters?.gdp_growth || 2.5,\n            labor_elasticity: currentResults.scenario.economic_parameters?.labor_elasticity || 0.7\n        };\n\n        // Run with progress callback\n        const results = await monteCarloInstance.run(config, (progress) => {\n            const progressEl = document.getElementById('mcProgress');\n            const progressBar = document.getElementById('mcProgressBar');\n            if (progressEl) progressEl.textContent = `${Math.round(progress)}%`;\n            if (progressBar) progressBar.style.width = `${progress}%`;\n            btn.innerHTML = `Running... ${Math.round(progress)}%`;\n        });\n\n        // Display results\n        displayMonteCarloResults(results);\n        btn.innerHTML = 'Run Again';\n        btn.disabled = false;\n\n    } catch (error) {\n        console.error('Monte Carlo error:', error);\n        content.innerHTML = `\n            <div style=\"color: var(--danger);\">\n                <p><strong>Error running Monte Carlo analysis:</strong></p>\n                <p>${error.message}</p>\n            </div>\n        `;\n        btn.innerHTML = 'Run 1000 Iterations';\n        btn.disabled = false;\n    }\n}\n\n/**\n * Display Monte Carlo results\n */\nfunction displayMonteCarloResults(results) {\n    const content = document.getElementById('monteCarloContent');\n    const dist = results.distributions;\n\n    // Format numbers helper\n    const fmt = (n, decimals = 1) => {\n        if (Math.abs(n) >= 1000000) return (n / 1000000).toFixed(decimals) + 'M';\n        if (Math.abs(n) >= 1000) return (n / 1000).toFixed(decimals) + 'K';\n        return n.toFixed(decimals);\n    };\n\n    const report = monteCarloInstance.generateReport();\n\n    content.innerHTML = `\n        <div style=\"margin-bottom: 24px;\">\n            <h4 style=\"margin-bottom: 12px; color: var(--gray-700);\">Probability Distribution Summary</h4>\n            <p style=\"color: var(--gray-500); font-size: 0.875rem; margin-bottom: 16px;\">\n                Based on ${results.iterations} simulations with randomized parameters\n            </p>\n\n            <!-- Key Metrics Grid -->\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;\">\n                <!-- Unemployment -->\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase; margin-bottom: 4px;\">\n                        Final Unemployment Rate\n                    </div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--gray-900);\">\n                        ${dist.final_unemployment.median.toFixed(1)}%\n                    </div>\n                    <div style=\"font-size: 0.875rem; color: var(--gray-600);\">\n                        90% CI: ${dist.final_unemployment.p5.toFixed(1)}% - ${dist.final_unemployment.p95.toFixed(1)}%\n                    </div>\n                    <div style=\"font-size: 0.75rem; color: var(--warning); margin-top: 4px;\">\n                        ${(report.unemployment.probability_above_10 * 100).toFixed(0)}% chance above 10%\n                    </div>\n                </div>\n\n                <!-- Net Job Change -->\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase; margin-bottom: 4px;\">\n                        Net Job Change\n                    </div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: ${dist.net_job_change.median >= 0 ? 'var(--secondary)' : 'var(--danger)'};\">\n                        ${dist.net_job_change.median >= 0 ? '+' : ''}${fmt(dist.net_job_change.median)}\n                    </div>\n                    <div style=\"font-size: 0.875rem; color: var(--gray-600);\">\n                        Range: ${fmt(dist.net_job_change.p10)} to ${fmt(dist.net_job_change.p90)}\n                    </div>\n                    <div style=\"font-size: 0.75rem; color: var(--secondary); margin-top: 4px;\">\n                        ${(report.netJobChange.probability_positive * 100).toFixed(0)}% chance positive\n                    </div>\n                </div>\n\n                <!-- Jobs Displaced -->\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase; margin-bottom: 4px;\">\n                        Jobs Displaced\n                    </div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--danger);\">\n                        ${fmt(dist.cumulative_displacement.median)}\n                    </div>\n                    <div style=\"font-size: 0.875rem; color: var(--gray-600);\">\n                        90% CI: ${fmt(dist.cumulative_displacement.p5)} - ${fmt(dist.cumulative_displacement.p95)}\n                    </div>\n                </div>\n\n                <!-- New Jobs Created -->\n                <div style=\"background: var(--gray-50); padding: 16px; border-radius: 8px;\">\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase; margin-bottom: 4px;\">\n                        New Jobs Created\n                    </div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--secondary);\">\n                        ${fmt(dist.cumulative_new_jobs.median)}\n                    </div>\n                    <div style=\"font-size: 0.875rem; color: var(--gray-600);\">\n                        90% CI: ${fmt(dist.cumulative_new_jobs.p5)} - ${fmt(dist.cumulative_new_jobs.p95)}\n                    </div>\n                </div>\n            </div>\n\n            <!-- Distribution Charts -->\n            <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;\">\n                <div>\n                    <h5 style=\"margin-bottom: 8px; font-size: 0.875rem; color: var(--gray-700);\">\n                        Unemployment Distribution\n                    </h5>\n                    <div class=\"chart-container small\">\n                        <canvas id=\"mcUnemploymentHist\"></canvas>\n                    </div>\n                </div>\n                <div>\n                    <h5 style=\"margin-bottom: 8px; font-size: 0.875rem; color: var(--gray-700);\">\n                        Net Job Change Distribution\n                    </h5>\n                    <div class=\"chart-container small\">\n                        <canvas id=\"mcJobChangeHist\"></canvas>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Confidence Intervals Table -->\n            <div style=\"margin-top: 24px;\">\n                <h5 style=\"margin-bottom: 12px; font-size: 0.875rem; color: var(--gray-700);\">\n                    Confidence Intervals\n                </h5>\n                <table class=\"data-table\" style=\"font-size: 0.875rem;\">\n                    <thead>\n                        <tr>\n                            <th>Metric</th>\n                            <th>5th %ile</th>\n                            <th>25th %ile</th>\n                            <th>Median</th>\n                            <th>75th %ile</th>\n                            <th>95th %ile</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            <td>Unemployment Rate</td>\n                            <td>${dist.final_unemployment.p5.toFixed(1)}%</td>\n                            <td>${dist.final_unemployment.p25.toFixed(1)}%</td>\n                            <td><strong>${dist.final_unemployment.median.toFixed(1)}%</strong></td>\n                            <td>${dist.final_unemployment.p75.toFixed(1)}%</td>\n                            <td>${dist.final_unemployment.p95.toFixed(1)}%</td>\n                        </tr>\n                        <tr>\n                            <td>Jobs Displaced</td>\n                            <td>${fmt(dist.cumulative_displacement.p5)}</td>\n                            <td>${fmt(dist.cumulative_displacement.p25)}</td>\n                            <td><strong>${fmt(dist.cumulative_displacement.median)}</strong></td>\n                            <td>${fmt(dist.cumulative_displacement.p75)}</td>\n                            <td>${fmt(dist.cumulative_displacement.p95)}</td>\n                        </tr>\n                        <tr>\n                            <td>New Jobs Created</td>\n                            <td>${fmt(dist.cumulative_new_jobs.p5)}</td>\n                            <td>${fmt(dist.cumulative_new_jobs.p25)}</td>\n                            <td><strong>${fmt(dist.cumulative_new_jobs.median)}</strong></td>\n                            <td>${fmt(dist.cumulative_new_jobs.p75)}</td>\n                            <td>${fmt(dist.cumulative_new_jobs.p95)}</td>\n                        </tr>\n                        <tr>\n                            <td>Net Job Change</td>\n                            <td>${fmt(dist.net_job_change.p5)}</td>\n                            <td>${fmt(dist.net_job_change.p25)}</td>\n                            <td><strong>${fmt(dist.net_job_change.median)}</strong></td>\n                            <td>${fmt(dist.net_job_change.p75)}</td>\n                            <td>${fmt(dist.net_job_change.p95)}</td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    `;\n\n    // Create histogram charts\n    setTimeout(() => {\n        createMonteCarloHistogram('mcUnemploymentHist', dist.final_unemployment, 'Unemployment Rate (%)', 'var(--danger)');\n        createMonteCarloHistogram('mcJobChangeHist', dist.net_job_change, 'Net Job Change', 'var(--info)', true);\n    }, 100);\n}\n\n/**\n * Create histogram chart for Monte Carlo results\n */\nfunction createMonteCarloHistogram(canvasId, distribution, label, color, formatAsJobs = false) {\n    const ctx = document.getElementById(canvasId);\n    if (!ctx) return;\n\n    const histogram = distribution.histogram;\n    const labels = histogram.map(h => {\n        if (formatAsJobs) {\n            const val = h.binMid;\n            if (Math.abs(val) >= 1000000) return (val / 1000000).toFixed(1) + 'M';\n            if (Math.abs(val) >= 1000) return (val / 1000).toFixed(0) + 'K';\n            return val.toFixed(0);\n        }\n        return h.binMid.toFixed(1);\n    });\n\n    new Chart(ctx, {\n        type: 'bar',\n        data: {\n            labels: labels,\n            datasets: [{\n                label: 'Frequency',\n                data: histogram.map(h => h.frequency * 100),\n                backgroundColor: color,\n                borderColor: color,\n                borderWidth: 1\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n                legend: { display: false },\n                tooltip: {\n                    callbacks: {\n                        label: (ctx) => `${ctx.parsed.y.toFixed(1)}% of simulations`\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    title: { display: true, text: label }\n                },\n                y: {\n                    title: { display: true, text: 'Probability (%)' },\n                    beginAtZero: true\n                }\n            }\n        }\n    });\n}\n\n// ==========================================\n// Mobile Menu Functions\n// ==========================================\n\n/**\n * Open mobile menu\n */\nfunction openMobileMenu() {\n    const sidebar = document.getElementById('sidebar');\n    const overlay = document.getElementById('sidebarOverlay');\n\n    if (sidebar) sidebar.classList.add('open');\n    if (overlay) overlay.classList.add('active');\n\n    // Prevent body scroll when menu is open\n    document.body.style.overflow = 'hidden';\n}\n\n/**\n * Close mobile menu\n */\nfunction closeMobileMenu() {\n    const sidebar = document.getElementById('sidebar');\n    const overlay = document.getElementById('sidebarOverlay');\n\n    if (sidebar) sidebar.classList.remove('open');\n    if (overlay) overlay.classList.remove('active');\n\n    // Restore body scroll\n    document.body.style.overflow = '';\n}\n\n/**\n * Close mobile menu on escape key\n */\ndocument.addEventListener('keydown', (e) => {\n    if (e.key === 'Escape') {\n        closeMobileMenu();\n    }\n});\n\n// ==========================================\n// Simulation History Functions\n// ==========================================\n\n/**\n * Show history modal\n */\nfunction showHistoryModal() {\n    const modal = document.getElementById('historyModal');\n    modal.style.display = 'flex';\n    renderHistoryList();\n}\n\n/**\n * Hide history modal\n */\nfunction hideHistoryModal() {\n    document.getElementById('historyModal').style.display = 'none';\n}\n\n/**\n * Render history list in modal\n */\nfunction renderHistoryList() {\n    const container = document.getElementById('historyList');\n    const history = simulationHistory.getAll();\n\n    if (history.length === 0) {\n        container.innerHTML = `\n            <div style=\"text-align: center; padding: 40px; color: var(--text-muted, var(--gray-500));\">\n                <p style=\"font-size: 2rem; margin-bottom: 8px;\"></p>\n                <p>No simulation history yet.</p>\n                <p style=\"font-size: 0.875rem;\">Run a simulation to start building your history.</p>\n            </div>\n        `;\n        return;\n    }\n\n    container.innerHTML = history.map(item => `\n        <div class=\"history-item\" style=\"background: var(--gray-50, #f9fafb); border-radius: 8px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; border: 1px solid transparent;\"\n             onmouseover=\"this.style.borderColor='var(--primary)'\"\n             onmouseout=\"this.style.borderColor='transparent'\"\n             onclick=\"loadFromHistory(${item.id})\">\n            <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;\">\n                <div>\n                    <h4 style=\"font-size: 1rem; font-weight: 600; color: var(--text-primary, var(--gray-800)); margin-bottom: 4px;\">\n                        ${escapeHtml(item.name)}\n                    </h4>\n                    <span style=\"font-size: 0.75rem; color: var(--text-muted, var(--gray-500));\">\n                        ${simulationHistory.formatTimestamp(item.timestamp)}\n                    </span>\n                </div>\n                <button onclick=\"event.stopPropagation(); deleteFromHistory(${item.id})\"\n                        style=\"background: none; border: none; color: var(--danger); cursor: pointer; padding: 4px;\"\n                        title=\"Delete this simulation\">\n                    \n                </button>\n            </div>\n            <div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; font-size: 0.875rem;\">\n                <div>\n                    <div style=\"color: var(--text-muted, var(--gray-500)); font-size: 0.7rem; text-transform: uppercase;\">Timeframe</div>\n                    <div style=\"font-weight: 500; color: var(--text-secondary, var(--gray-700));\">${item.summary.timeframe}</div>\n                </div>\n                <div>\n                    <div style=\"color: var(--text-muted, var(--gray-500)); font-size: 0.7rem; text-transform: uppercase;\">Final Unemp.</div>\n                    <div style=\"font-weight: 500; color: var(--danger);\">${item.summary.finalUnemployment?.toFixed(1) || 'N/A'}%</div>\n                </div>\n                <div>\n                    <div style=\"color: var(--text-muted, var(--gray-500)); font-size: 0.7rem; text-transform: uppercase;\">Jobs Lost</div>\n                    <div style=\"font-weight: 500; color: var(--danger);\">${simulationHistory.formatNumber(item.summary.jobsDisplaced)}</div>\n                </div>\n                <div>\n                    <div style=\"color: var(--text-muted, var(--gray-500)); font-size: 0.7rem; text-transform: uppercase;\">Jobs Created</div>\n                    <div style=\"font-weight: 500; color: var(--secondary);\">${simulationHistory.formatNumber(item.summary.jobsCreated)}</div>\n                </div>\n            </div>\n            <div style=\"margin-top: 8px; font-size: 0.75rem; color: var(--text-muted, var(--gray-500));\">\n                ${item.summary.adoptionCurve.replace('_', '-')} curve  ${item.summary.aiAdoption}% AI adoption  ${item.summary.interventions} intervention${item.summary.interventions !== 1 ? 's' : ''}\n            </div>\n        </div>\n    `).join('');\n}\n\n/**\n * Load simulation from history\n */\nfunction loadFromHistory(id) {\n    const item = simulationHistory.get(id);\n    if (!item) {\n        alert('Simulation not found in history');\n        return;\n    }\n\n    // Load into current results\n    currentResults = {\n        scenario: item.scenario,\n        results: item.results,\n        summary: item.summaryData\n    };\n\n    // Update UI controls if possible\n    if (item.scenario) {\n        const endYear = document.getElementById('endYear');\n        const targetUR = document.getElementById('targetUR');\n        const aiAdoptionRate = document.getElementById('aiAdoptionRate');\n        const automationPace = document.getElementById('automationPace');\n        const adoptionCurve = document.getElementById('adoptionCurve');\n\n        if (endYear) endYear.value = item.scenario.timeframe?.end_year || 2030;\n        if (targetUR) targetUR.value = item.scenario.targets?.unemployment_rate || 10;\n        if (aiAdoptionRate) aiAdoptionRate.value = item.scenario.targets?.ai_adoption_rate || 50;\n        if (automationPace) automationPace.value = item.scenario.targets?.automation_pace || 'moderate';\n        if (adoptionCurve) adoptionCurve.value = item.scenario.ai_parameters?.adoption_curve || 's_curve';\n    }\n\n    // Display results\n    displaySimulationResults(currentResults);\n\n    // Show share button\n    showShareButton();\n\n    // Switch to simulation tab\n    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n    document.getElementById('simulation-section').classList.add('active');\n    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));\n    document.querySelectorAll('.nav-tab')[3].classList.add('active');\n\n    // Hide modal\n    hideHistoryModal();\n}\n\n/**\n * Delete simulation from history\n */\nfunction deleteFromHistory(id) {\n    if (confirm('Delete this simulation from history?')) {\n        simulationHistory.delete(id);\n        renderHistoryList();\n    }\n}\n\n/**\n * Clear all history\n */\nfunction clearAllHistory() {\n    if (confirm('Clear all simulation history? This cannot be undone.')) {\n        simulationHistory.clearAll();\n        renderHistoryList();\n    }\n}\n\n// ==========================================\n// Theme Toggle Functions\n// ==========================================\n\n/**\n * Toggle between light and dark theme\n */\nfunction toggleTheme() {\n    const currentTheme = document.documentElement.getAttribute('data-theme');\n    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n\n    document.documentElement.setAttribute('data-theme', newTheme);\n    localStorage.setItem('theme', newTheme);\n\n    updateThemeIcon(newTheme);\n    updateChartTheme(newTheme);\n}\n\n/**\n * Update theme icon\n */\nfunction updateThemeIcon(theme) {\n    const icon = document.getElementById('themeIcon');\n    if (icon) {\n        icon.textContent = theme === 'dark' ? '' : '';\n    }\n}\n\n/**\n * Update chart colors for theme\n */\nfunction updateChartTheme(theme) {\n    const isDark = theme === 'dark';\n    const textColor = isDark ? '#f1f5f9' : '#374151';\n    const gridColor = isDark ? '#334155' : '#e5e7eb';\n\n    Chart.defaults.color = textColor;\n    Chart.defaults.borderColor = gridColor;\n\n    // Update existing charts if any\n    Chart.helpers.each(Chart.instances, (chart) => {\n        if (chart.options.scales) {\n            Object.keys(chart.options.scales).forEach(scaleKey => {\n                if (chart.options.scales[scaleKey].grid) {\n                    chart.options.scales[scaleKey].grid.color = gridColor;\n                }\n                if (chart.options.scales[scaleKey].ticks) {\n                    chart.options.scales[scaleKey].ticks.color = textColor;\n                }\n            });\n        }\n        if (chart.options.plugins && chart.options.plugins.legend) {\n            chart.options.plugins.legend.labels = chart.options.plugins.legend.labels || {};\n            chart.options.plugins.legend.labels.color = textColor;\n        }\n        chart.update();\n    });\n}\n\n/**\n * Initialize theme from localStorage or system preference\n */\nfunction initTheme() {\n    const savedTheme = localStorage.getItem('theme');\n    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n    const theme = savedTheme || (prefersDark ? 'dark' : 'light');\n\n    document.documentElement.setAttribute('data-theme', theme);\n    updateThemeIcon(theme);\n    updateChartTheme(theme);\n}\n\n/**\n * Show a notification toast\n * @param {string} message - The message to show\n * @param {string} type - 'success', 'warning', 'error', or 'info'\n */\nfunction showNotification(message, type = 'info') {\n    const colors = {\n        success: 'var(--secondary)',\n        warning: 'var(--warning)',\n        error: 'var(--danger)',\n        info: 'var(--primary)'\n    };\n\n    // Determine if this notification should be persistent\n    const isPersistent = type === 'error' || type === 'warning';\n    const duration = isPersistent ? 0 : 4000; // 0 = no auto-dismiss\n\n    const notification = document.createElement('div');\n    notification.style.cssText = `\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: ${colors[type] || colors.info};\n        color: white;\n        padding: 12px 24px;\n        border-radius: 8px;\n        z-index: 10000;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        font-weight: 500;\n        animation: fadeIn 0.3s ease;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        max-width: 90vw;\n    `;\n\n    // Add message text\n    const messageSpan = document.createElement('span');\n    messageSpan.textContent = message;\n    messageSpan.style.flex = '1';\n    notification.appendChild(messageSpan);\n\n    // Add dismiss button for persistent notifications\n    if (isPersistent) {\n        const dismissBtn = document.createElement('button');\n        dismissBtn.innerHTML = '&times;';\n        dismissBtn.style.cssText = `\n            background: transparent;\n            border: none;\n            color: white;\n            font-size: 20px;\n            cursor: pointer;\n            padding: 0 4px;\n            line-height: 1;\n            opacity: 0.8;\n        `;\n        dismissBtn.onclick = () => {\n            notification.style.animation = 'fadeOut 0.3s ease forwards';\n            setTimeout(() => notification.remove(), 300);\n        };\n        dismissBtn.onmouseover = () => dismissBtn.style.opacity = '1';\n        dismissBtn.onmouseout = () => dismissBtn.style.opacity = '0.8';\n        notification.appendChild(dismissBtn);\n    }\n\n    document.body.appendChild(notification);\n\n    // Auto-dismiss for non-persistent notifications\n    if (duration > 0) {\n        setTimeout(() => {\n            notification.style.animation = 'fadeOut 0.3s ease forwards';\n            setTimeout(() => notification.remove(), 300);\n        }, duration);\n    }\n}\n\n// ============================================\n// ADVANCED AI SIMULATION FUNCTIONS\n// ============================================\n\n// Default password for AI simulation (change this or set via setAIPassword())\nconst DEFAULT_AI_PASSWORD = 'ai2025';\nconst AI_USAGE_LIMIT = 1000;\nconst AI_USAGE_STORAGE_KEY = 'ai_labor_sim_ai_usage_count';\nconst AI_LIMIT_ALERT_KEY = 'ai_labor_sim_limit_alert_sent';\n\n/**\n * Get current AI simulation usage count\n */\nfunction getAIUsageCount() {\n    const count = localStorage.getItem(AI_USAGE_STORAGE_KEY);\n    return count ? parseInt(count, 10) : 0;\n}\n\n/**\n * Increment AI simulation usage count\n */\nfunction incrementAIUsageCount() {\n    const currentCount = getAIUsageCount();\n    const newCount = currentCount + 1;\n    localStorage.setItem(AI_USAGE_STORAGE_KEY, newCount.toString());\n    return newCount;\n}\n\n/**\n * Check if usage limit has been reached\n */\nfunction isAIUsageLimitReached() {\n    return getAIUsageCount() >= AI_USAGE_LIMIT;\n}\n\n/**\n * Send alert when usage limit is reached\n */\nasync function sendUsageLimitAlert() {\n    // Check if alert already sent\n    if (localStorage.getItem(AI_LIMIT_ALERT_KEY)) {\n        return;\n    }\n\n    const usageCount = getAIUsageCount();\n    const alertData = {\n        event: 'AI_USAGE_LIMIT_REACHED',\n        count: usageCount,\n        limit: AI_USAGE_LIMIT,\n        timestamp: new Date().toISOString(),\n        url: window.location.href\n    };\n\n    console.log('AI Usage Limit Alert:', alertData);\n\n    // Try to send email notification via webhook\n    try {\n        // Option 1: If you have a webhook endpoint, send there\n        // await fetch('YOUR_WEBHOOK_URL', {\n        //     method: 'POST',\n        //     headers: { 'Content-Type': 'application/json' },\n        //     body: JSON.stringify(alertData)\n        // });\n\n        // Option 2: Use mailto link as fallback alert\n        const subject = encodeURIComponent('AI Labor Simulator - Usage Limit Reached');\n        const body = encodeURIComponent(\n            `AI Usage Limit Alert\\n\\n` +\n            `The AI Labor Market Simulator has reached ${usageCount} uses.\\n` +\n            `Limit: ${AI_USAGE_LIMIT}\\n` +\n            `Timestamp: ${alertData.timestamp}\\n\\n` +\n            `Password protection is now enabled.\\n` +\n            `Default password: ${DEFAULT_AI_PASSWORD}`\n        );\n\n        // Show notification to admin\n        showNotification(\n            `AI usage limit (${AI_USAGE_LIMIT}) reached! Password protection now enabled.`,\n            'warning'\n        );\n\n        // Mark alert as sent\n        localStorage.setItem(AI_LIMIT_ALERT_KEY, 'true');\n\n        // Log for analytics/monitoring\n        console.warn(`[ALERT] AI Simulation usage limit reached: ${usageCount}/${AI_USAGE_LIMIT}`);\n\n    } catch (error) {\n        console.error('Failed to send usage limit alert:', error);\n    }\n}\n\n/**\n * Get AI usage stats (for admin/debugging)\n */\nfunction getAIUsageStats() {\n    return {\n        currentCount: getAIUsageCount(),\n        limit: AI_USAGE_LIMIT,\n        remaining: Math.max(0, AI_USAGE_LIMIT - getAIUsageCount()),\n        limitReached: isAIUsageLimitReached(),\n        alertSent: localStorage.getItem(AI_LIMIT_ALERT_KEY) === 'true'\n    };\n}\n\n/**\n * Reset AI usage counter (admin function)\n * Call from console: resetAIUsageCount()\n */\nfunction resetAIUsageCount() {\n    localStorage.removeItem(AI_USAGE_STORAGE_KEY);\n    localStorage.removeItem(AI_LIMIT_ALERT_KEY);\n    console.log('AI usage counter reset to 0');\n    return getAIUsageStats();\n}\n\n/**\n * Set AI usage count manually (admin function)\n * Call from console: setAIUsageCount(500)\n */\nfunction setAIUsageCount(count) {\n    localStorage.setItem(AI_USAGE_STORAGE_KEY, count.toString());\n    console.log(`AI usage counter set to ${count}`);\n    return getAIUsageStats();\n}\n\n// Expose admin functions globally\nwindow.getAIUsageStats = getAIUsageStats;\nwindow.resetAIUsageCount = resetAIUsageCount;\nwindow.setAIUsageCount = setAIUsageCount;\n\n/**\n * Run Advanced AI-Enhanced Simulation\n */\nfunction runAdvancedAISimulation() {\n    // Check if usage limit has been reached\n    if (isAIUsageLimitReached()) {\n        // Send alert if not already sent\n        sendUsageLimitAlert();\n\n        // Password required after limit reached\n        if (!aiScenarioEnhancer.hasPassword()) {\n            aiScenarioEnhancer.setPassword(DEFAULT_AI_PASSWORD);\n        }\n        showPasswordModal();\n    } else {\n        // Under limit - run directly without password\n        executeAdvancedAISimulation();\n    }\n}\n\n/**\n * Show password modal\n */\nfunction showPasswordModal() {\n    document.getElementById('passwordModal').style.display = 'flex';\n    document.getElementById('aiSimPassword').value = '';\n    document.getElementById('passwordError').style.display = 'none';\n    document.getElementById('aiSimPassword').focus();\n}\n\n/**\n * Hide password modal\n */\nfunction hidePasswordModal() {\n    document.getElementById('passwordModal').style.display = 'none';\n}\n\n/**\n * Submit password and run AI simulation\n */\nasync function submitAIPassword() {\n    const password = document.getElementById('aiSimPassword').value;\n\n    if (!aiScenarioEnhancer.checkPassword(password)) {\n        document.getElementById('passwordError').style.display = 'block';\n        return;\n    }\n\n    hidePasswordModal();\n    await executeAdvancedAISimulation();\n}\n\n/**\n * Execute the Advanced AI Simulation pipeline\n */\nasync function executeAdvancedAISimulation() {\n    if (!aiScenarioEnhancer.isAvailable()) {\n        alert('AI service not available. Please check your API configuration.');\n        return;\n    }\n\n    // Show loading state\n    const resultsDiv = document.getElementById('simulation-results');\n    resultsDiv.innerHTML = `\n        <div class=\"card\" style=\"text-align: center; padding: 60px;\">\n            <div class=\"loading-spinner\" style=\"margin-bottom: 20px;\">\n                <div style=\"width: 50px; height: 50px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; margin: 0 auto; animation: spin 1s linear infinite;\"></div>\n            </div>\n            <h3 style=\"margin-bottom: 16px;\">Running AI-Enhanced Simulation</h3>\n            <p style=\"color: var(--gray-500);\" id=\"aiSimStatus\">Step 1/3: Enhancing inputs with AI...</p>\n        </div>\n    `;\n\n    // Switch to simulation tab so user can see progress\n    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));\n    document.getElementById('simulation-section').classList.add('active');\n    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));\n    document.querySelectorAll('.nav-tab')[3].classList.add('active');\n\n    // Get simple inputs\n    const simpleInputs = {\n        targetUnemployment: parseFloat(document.getElementById('targetUR').value),\n        aiAdoption: parseInt(document.getElementById('aiAdoption').value),\n        automationPace: document.getElementById('automationPace').value,\n        adoptionCurve: document.getElementById('adoptionCurve').value,\n        startYear: new Date().getFullYear(),\n        endYear: parseInt(document.getElementById('targetYear').value),\n        years: parseInt(document.getElementById('targetYear').value) - new Date().getFullYear(),\n        interventions: interventionSystem.interventions.filter(i => i.active)\n    };\n\n    try {\n        // Step 1: Enhance inputs with AI\n        updateAIStatus('Step 1/3: Enhancing inputs with AI...');\n        const enhancedParams = await aiScenarioEnhancer.enhanceInputs(simpleInputs);\n        console.log('Enhanced params:', enhancedParams);\n\n        // Step 2: Run simulation with enhanced parameters\n        updateAIStatus('Step 2/3: Running enhanced simulation...');\n\n        // Create enhanced scenario\n        const enhancedScenario = createEnhancedScenario(simpleInputs, enhancedParams);\n        simulationEngine.createScenario(enhancedScenario);\n\n        // Run simulation\n        const results = await simulationEngine.runSimulation();\n        currentResults = results;\n\n        // Step 3: Generate AI analysis\n        updateAIStatus('Step 3/3: Generating AI analysis...');\n        const analysis = await aiScenarioEnhancer.analyzeResults(simpleInputs, enhancedParams, results);\n        console.log('AI Analysis:', analysis);\n\n        // Store the enhanced simulation\n        const simId = aiScenarioEnhancer.storeSimulation({\n            inputs: simpleInputs,\n            enhancedParams,\n            results,\n            analysis\n        });\n        console.log('Stored simulation ID:', simId);\n\n        // Store analysis for later viewing BEFORE displaying results\n        currentAIAnalysis = { analysis, enhancedParams, timestamp: new Date().toISOString() };\n\n        // Mark this as an AI simulation result so analysis displays inline\n        isAISimulationResult = true;\n\n        // Display results with inline AI analysis (no popup modal)\n        displaySimulationResults(results);\n\n        // Update model status\n        updateAIModelStatus();\n\n        // Increment usage counter\n        const usageCount = incrementAIUsageCount();\n        console.log(`AI Simulation usage: ${usageCount}/${AI_USAGE_LIMIT}`);\n\n        // Check if we just hit the limit\n        if (usageCount === AI_USAGE_LIMIT) {\n            sendUsageLimitAlert();\n        }\n\n        showNotification('AI-enhanced simulation complete!', 'success');\n\n    } catch (error) {\n        console.error('AI Simulation error:', error);\n        resultsDiv.innerHTML = `\n            <div class=\"card\" style=\"text-align: center; padding: 60px;\">\n                <h3 style=\"margin-bottom: 16px; color: var(--danger);\">AI Simulation Failed</h3>\n                <p style=\"color: var(--gray-500); margin-bottom: 24px;\">${error.message}</p>\n                <button class=\"btn btn-primary\" onclick=\"runSimulation()\">Run Standard Simulation</button>\n            </div>\n        `;\n    }\n}\n\n/**\n * Update AI simulation status message\n */\nfunction updateAIStatus(message) {\n    const statusEl = document.getElementById('aiSimStatus');\n    if (statusEl) {\n        statusEl.textContent = message;\n    }\n}\n\n/**\n * Create enhanced scenario from AI parameters\n */\nfunction createEnhancedScenario(simpleInputs, enhancedParams) {\n    const scenario = {\n        name: document.getElementById('scenarioName').value + ' (AI Enhanced)',\n        end_year: simpleInputs.endYear,\n        target_unemployment: simpleInputs.targetUnemployment,\n        ai_adoption_rate: simpleInputs.aiAdoption,\n        automation_pace: simpleInputs.automationPace,\n        adoption_curve: simpleInputs.adoptionCurve,\n\n        // Enhanced parameters from AI\n        ai_enhanced: true,\n        enhanced_params: enhancedParams,\n\n        // Apply AI-derived multipliers\n        new_job_multiplier: enhancedParams.job_creation_coefficients?.base_multiplier || 0.3,\n        displacement_lag: enhancedParams.transition_dynamics?.displacement_lag_months || 6\n    };\n\n    return scenario;\n}\n\n/**\n * Generate inline AI Analysis HTML (for displaying directly in results instead of modal)\n */\nfunction generateInlineAIAnalysisHTML(analysis, enhancedParams) {\n    return `\n        <div class=\"ai-analysis-inline\">\n            <!-- Executive Summary -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Executive Summary</h4>\n                <p style=\"font-size: 1rem; line-height: 1.6;\">${analysis.executive_summary || 'Analysis in progress...'}</p>\n            </div>\n\n            <!-- Key Findings -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Key Findings</h4>\n                <div class=\"ai-findings-grid\">\n                    ${(analysis.key_findings || []).map(f => `\n                        <div class=\"ai-finding-card\" style=\"border-left-color: ${f.impact === 'high' ? 'var(--danger)' : f.impact === 'medium' ? 'var(--warning)' : 'var(--secondary)'};\">\n                            <p style=\"margin: 0; font-weight: 500;\">${f.finding}</p>\n                            <div class=\"ai-finding-meta\">\n                                <span>Confidence: <strong>${f.confidence}</strong></span>\n                                <span>Impact: <strong>${f.impact}</strong></span>\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n\n            <!-- Workforce Impacts -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Workforce Impacts</h4>\n                <div class=\"ai-workforce-grid\">\n                    <div class=\"ai-workforce-card\">\n                        <h5 style=\"color: var(--danger); font-size: 0.875rem; margin-bottom: 8px;\">High Risk Workers</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.workforce_impacts?.high_risk_workers || 'N/A'}</p>\n                    </div>\n                    <div class=\"ai-workforce-card\">\n                        <h5 style=\"color: var(--secondary); font-size: 0.875rem; margin-bottom: 8px;\">Emerging Opportunities</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.workforce_impacts?.emerging_opportunities || 'N/A'}</p>\n                    </div>\n                </div>\n                ${analysis.workforce_impacts?.skills_in_demand ? `\n                    <div style=\"margin-top: 16px;\">\n                        <h5 style=\"font-size: 0.875rem; margin-bottom: 8px;\">Skills in Demand</h5>\n                        <div class=\"ai-skills-list\">\n                            ${analysis.workforce_impacts.skills_in_demand.map(s => `<span class=\"ai-skill-tag\">${s}</span>`).join('')}\n                        </div>\n                    </div>\n                ` : ''}\n            </div>\n\n            <!-- Policy Recommendations -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Policy Recommendations</h4>\n                <div class=\"ai-policy-grid\">\n                    ${(analysis.policy_recommendations || []).map(p => `\n                        <div class=\"ai-policy-card\">\n                            <div class=\"ai-policy-priority\">\n                                <span class=\"ai-priority-badge\" style=\"background: ${p.priority === 'immediate' ? 'var(--danger)' : p.priority === 'short-term' ? 'var(--warning)' : 'var(--primary)'};\">${p.priority}</span>\n                            </div>\n                            <div class=\"ai-policy-content\">\n                                <p style=\"margin: 0;\">${p.policy}</p>\n                                <span style=\"font-size: 0.75rem; color: var(--gray-500);\">Effectiveness: ${p.effectiveness}</span>\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n\n            <!-- Scenario Variations -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Scenario Variations</h4>\n                <div class=\"ai-scenarios-grid\">\n                    <div class=\"ai-scenario-card ai-scenario-optimistic\">\n                        <h5>Optimistic</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.scenario_variations?.optimistic_case || 'N/A'}</p>\n                    </div>\n                    <div class=\"ai-scenario-card ai-scenario-likely\">\n                        <h5>Most Likely</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.scenario_variations?.most_likely || 'N/A'}</p>\n                    </div>\n                    <div class=\"ai-scenario-card ai-scenario-pessimistic\">\n                        <h5>Pessimistic</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.scenario_variations?.pessimistic_case || 'N/A'}</p>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Narrative Analysis -->\n            ${analysis.narrative_analysis ? `\n                <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                    <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Detailed Analysis</h4>\n                    <div class=\"ai-narrative-box\">\n                        ${analysis.narrative_analysis.split('\\n').map(p => `<p style=\"margin-bottom: 12px;\">${p}</p>`).join('')}\n                    </div>\n                </div>\n            ` : ''}\n\n            <!-- Model Confidence -->\n            <div class=\"analysis-section\">\n                <div class=\"ai-confidence-bar\">\n                    <span style=\"font-weight: 500;\">Model Confidence</span>\n                    <span class=\"ai-confidence-badge\" style=\"background: ${analysis.model_confidence?.overall === 'high' ? 'var(--secondary)' : analysis.model_confidence?.overall === 'medium' ? 'var(--warning)' : 'var(--danger)'};\">${analysis.model_confidence?.overall || 'Unknown'}</span>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * Display AI Analysis in modal\n */\nfunction displayAIAnalysis(analysis, enhancedParams) {\n    // Store for later viewing\n    currentAIAnalysis = { analysis, enhancedParams, timestamp: new Date().toISOString() };\n\n    const modal = document.getElementById('aiResultsModal');\n    const content = document.getElementById('aiResultsContent');\n\n    content.innerHTML = `\n        <div class=\"ai-analysis\">\n            <!-- Executive Summary -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Executive Summary</h4>\n                <p style=\"font-size: 1rem; line-height: 1.6;\">${analysis.executive_summary || 'Analysis in progress...'}</p>\n            </div>\n\n            <!-- Key Findings -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Key Findings</h4>\n                <div style=\"display: grid; gap: 12px;\">\n                    ${(analysis.key_findings || []).map(f => `\n                        <div style=\"display: flex; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px; border-left: 4px solid ${f.impact === 'high' ? 'var(--danger)' : f.impact === 'medium' ? 'var(--warning)' : 'var(--secondary)'};\">\n                            <div style=\"flex: 1;\">\n                                <p style=\"margin: 0; font-weight: 500;\">${f.finding}</p>\n                                <div style=\"display: flex; gap: 12px; margin-top: 8px; font-size: 0.75rem;\">\n                                    <span style=\"color: var(--gray-500);\">Confidence: <strong>${f.confidence}</strong></span>\n                                    <span style=\"color: var(--gray-500);\">Impact: <strong>${f.impact}</strong></span>\n                                </div>\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n\n            <!-- Workforce Impacts -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Workforce Impacts</h4>\n                <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;\">\n                    <div style=\"padding: 16px; background: var(--gray-50); border-radius: 8px;\">\n                        <h5 style=\"color: var(--danger); font-size: 0.875rem; margin-bottom: 8px;\">High Risk Workers</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.workforce_impacts?.high_risk_workers || 'N/A'}</p>\n                    </div>\n                    <div style=\"padding: 16px; background: var(--gray-50); border-radius: 8px;\">\n                        <h5 style=\"color: var(--secondary); font-size: 0.875rem; margin-bottom: 8px;\">Emerging Opportunities</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.workforce_impacts?.emerging_opportunities || 'N/A'}</p>\n                    </div>\n                </div>\n                ${analysis.workforce_impacts?.skills_in_demand ? `\n                    <div style=\"margin-top: 16px;\">\n                        <h5 style=\"font-size: 0.875rem; margin-bottom: 8px;\">Skills in Demand</h5>\n                        <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\n                            ${analysis.workforce_impacts.skills_in_demand.map(s => `<span style=\"padding: 4px 12px; background: var(--secondary); color: white; border-radius: 16px; font-size: 0.75rem;\">${s}</span>`).join('')}\n                        </div>\n                    </div>\n                ` : ''}\n            </div>\n\n            <!-- Policy Recommendations -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Policy Recommendations</h4>\n                <div style=\"display: grid; gap: 12px;\">\n                    ${(analysis.policy_recommendations || []).map(p => `\n                        <div style=\"display: flex; gap: 12px; padding: 12px; background: var(--gray-50); border-radius: 8px;\">\n                            <div style=\"width: 80px; text-align: center;\">\n                                <span style=\"display: inline-block; padding: 4px 8px; background: ${p.priority === 'immediate' ? 'var(--danger)' : p.priority === 'short-term' ? 'var(--warning)' : 'var(--primary)'}; color: white; border-radius: 4px; font-size: 0.625rem; text-transform: uppercase;\">${p.priority}</span>\n                            </div>\n                            <div style=\"flex: 1;\">\n                                <p style=\"margin: 0;\">${p.policy}</p>\n                                <span style=\"font-size: 0.75rem; color: var(--gray-500);\">Effectiveness: ${p.effectiveness}</span>\n                            </div>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n\n            <!-- Scenario Variations -->\n            <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Scenario Variations</h4>\n                <div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;\">\n                    <div style=\"padding: 16px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid var(--secondary);\">\n                        <h5 style=\"color: var(--secondary); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 8px;\">Optimistic</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.scenario_variations?.optimistic_case || 'N/A'}</p>\n                    </div>\n                    <div style=\"padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid var(--warning);\">\n                        <h5 style=\"color: var(--warning); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 8px;\">Most Likely</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.scenario_variations?.most_likely || 'N/A'}</p>\n                    </div>\n                    <div style=\"padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 4px solid var(--danger);\">\n                        <h5 style=\"color: var(--danger); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 8px;\">Pessimistic</h5>\n                        <p style=\"margin: 0; font-size: 0.875rem;\">${analysis.scenario_variations?.pessimistic_case || 'N/A'}</p>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Narrative Analysis -->\n            ${analysis.narrative_analysis ? `\n                <div class=\"analysis-section\" style=\"margin-bottom: 24px;\">\n                    <h4 style=\"color: var(--primary); margin-bottom: 12px;\">Detailed Analysis</h4>\n                    <div style=\"padding: 20px; background: var(--gray-50); border-radius: 8px; line-height: 1.8;\">\n                        ${analysis.narrative_analysis.split('\\n').map(p => `<p style=\"margin-bottom: 12px;\">${p}</p>`).join('')}\n                    </div>\n                </div>\n            ` : ''}\n\n            <!-- Model Confidence -->\n            <div class=\"analysis-section\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center; padding: 16px; background: var(--gray-100); border-radius: 8px;\">\n                    <span style=\"font-weight: 500;\">Model Confidence</span>\n                    <span style=\"padding: 6px 16px; background: ${analysis.model_confidence?.overall === 'high' ? 'var(--secondary)' : analysis.model_confidence?.overall === 'medium' ? 'var(--warning)' : 'var(--danger)'}; color: white; border-radius: 16px; font-weight: bold; text-transform: uppercase;\">${analysis.model_confidence?.overall || 'Unknown'}</span>\n                </div>\n            </div>\n        </div>\n    `;\n\n    modal.style.display = 'flex';\n}\n\n/**\n * Hide AI Results Modal\n */\nfunction hideAIResultsModal() {\n    document.getElementById('aiResultsModal').style.display = 'none';\n}\n\n/**\n * Show stored AI Analysis (re-view after closing)\n */\nfunction showAIAnalysis() {\n    if (!currentAIAnalysis) {\n        showNotification('No AI analysis available. Run an Advanced AI Simulation first.', 'warning');\n        return;\n    }\n    displayAIAnalysis(currentAIAnalysis.analysis, currentAIAnalysis.enhancedParams);\n}\n\n/**\n * Check if AI analysis is available\n */\nfunction hasAIAnalysis() {\n    return currentAIAnalysis !== null;\n}\n\n/**\n * Show Training Modal\n */\nfunction showTrainingModal() {\n    const modal = document.getElementById('trainingModal');\n    updateTrainingModalStatus();\n    modal.style.display = 'flex';\n}\n\n/**\n * Hide Training Modal\n */\nfunction hideTrainingModal() {\n    document.getElementById('trainingModal').style.display = 'none';\n}\n\n/**\n * Update Training Modal Status\n */\nfunction updateTrainingModalStatus() {\n    const status = modelTrainer.getStatus();\n\n    document.getElementById('trainSimCount').textContent = status.storedSimulations;\n    document.getElementById('trainModelVersion').textContent = status.modelVersion;\n    document.getElementById('trainConfidence').textContent = status.confidence ? (status.confidence * 100).toFixed(0) + '%' : '-';\n\n    const trainBtn = document.getElementById('trainModelBtn');\n    const messageDiv = document.getElementById('trainingMessage');\n\n    if (status.readyForTraining) {\n        trainBtn.disabled = false;\n        messageDiv.innerHTML = `<span style=\"color: var(--secondary);\">Ready to train!</span> ${status.storedSimulations} AI simulations available.`;\n    } else {\n        trainBtn.disabled = true;\n        messageDiv.innerHTML = `Run at least 3 AI-enhanced simulations to enable model training. Currently: ${status.storedSimulations}`;\n    }\n\n    if (status.hasTrainedModel) {\n        messageDiv.innerHTML += `<br><small style=\"color: var(--gray-500);\">Last trained: ${new Date(status.lastTraining).toLocaleDateString()}</small>`;\n    }\n}\n\n/**\n * Train Model\n */\nasync function trainModel() {\n    const trainBtn = document.getElementById('trainModelBtn');\n    const messageDiv = document.getElementById('trainingMessage');\n\n    trainBtn.disabled = true;\n    trainBtn.textContent = 'Training...';\n    messageDiv.innerHTML = '<span style=\"color: var(--primary);\">Training model with AI... This may take a minute.</span>';\n\n    try {\n        const result = await modelTrainer.trainModel();\n\n        if (result.success) {\n            messageDiv.innerHTML = `<span style=\"color: var(--secondary);\">Training complete!</span> Model v${result.model.model_version} with ${(result.model.confidence_score * 100).toFixed(0)}% confidence.`;\n            updateTrainingModalStatus();\n            updateAIModelStatus();\n            showNotification('Model trained successfully!', 'success');\n        } else {\n            messageDiv.innerHTML = `<span style=\"color: var(--danger);\">Training failed:</span> ${result.message}`;\n        }\n    } catch (error) {\n        messageDiv.innerHTML = `<span style=\"color: var(--danger);\">Error:</span> ${error.message}`;\n    }\n\n    trainBtn.disabled = false;\n    trainBtn.textContent = 'Train Model';\n}\n\n/**\n * Export Training Data\n */\nfunction exportTrainingData() {\n    const data = modelTrainer.exportAll();\n    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `ai-labor-sim-training-data-${new Date().toISOString().split('T')[0]}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n    showNotification('Training data exported!', 'success');\n}\n\n/**\n * Update AI Model Status in sidebar\n */\nfunction updateAIModelStatus() {\n    const statusDiv = document.getElementById('aiModelStatus');\n    if (!statusDiv) return;\n\n    const status = modelTrainer.getStatus();\n\n    statusDiv.innerHTML = `\n        <div style=\"font-size: 0.75rem;\">\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 4px;\">\n                <span style=\"color: var(--gray-400);\">Simulations:</span>\n                <span style=\"color: var(--text-primary); font-weight: 500;\">${status.storedSimulations}</span>\n            </div>\n            <div style=\"display: flex; justify-content: space-between; margin-bottom: 4px;\">\n                <span style=\"color: var(--gray-400);\">Model:</span>\n                <span style=\"color: var(--text-primary); font-weight: 500;\">${status.modelVersion}</span>\n            </div>\n            ${status.hasTrainedModel ? `\n                <div style=\"display: flex; justify-content: space-between;\">\n                    <span style=\"color: var(--gray-400);\">Confidence:</span>\n                    <span style=\"color: ${status.confidence > 0.7 ? 'var(--secondary)' : status.confidence > 0.4 ? 'var(--warning)' : 'var(--danger)'}; font-weight: 500;\">${(status.confidence * 100).toFixed(0)}%</span>\n                </div>\n            ` : ''}\n        </div>\n    `;\n}\n\n/**\n * Set AI simulation password (admin function)\n */\nfunction setAIPassword(newPassword) {\n    aiScenarioEnhancer.setPassword(newPassword);\n    console.log('AI simulation password updated');\n}\n\n// ========== ABM (Agent-Based Model) Functions ==========\n\nlet currentABMEngine = null;\nlet currentABMResults = null;\nlet abmCharts = {};\nlet abmWorkerManager = null;\n\n/**\n * Run full ABM simulation\n * Uses Web Worker for better performance when available\n */\nasync function runABMSimulation() {\n    // Get configuration from UI\n    const config = {\n        numWorkers: parseInt(document.getElementById('abmWorkers').value),\n        numFirms: parseInt(document.getElementById('abmFirms').value),\n        durationMonths: parseInt(document.getElementById('abmDuration').value),\n        numRegions: parseInt(document.getElementById('abmRegions').value),\n        onProgress: updateABMProgress\n    };\n\n    const scenario = {\n        initialUnemploymentRate: parseFloat(document.getElementById('abmInitialUR').value) / 100,\n        initialAIAdoption: parseFloat(document.getElementById('abmInitialAI').value) / 100,\n        adoptionCurve: document.getElementById('abmAdoptionCurve').value,\n        automationPace: document.getElementById('abmAutomationPace').value\n    };\n\n    // Get active interventions\n    const interventions = [];\n    if (document.getElementById('abmUBI').checked) {\n        interventions.push({ type: 'ubi', active: true, monthlyAmount: 1000 });\n    }\n    if (document.getElementById('abmRetraining').checked) {\n        interventions.push({ type: 'retraining', active: true, subsidyRate: 0.75, effectiveness: 1.5 });\n    }\n    if (document.getElementById('abmWageSubsidy').checked) {\n        interventions.push({ type: 'wage_subsidy', active: true, rate: 0.25, maxWage: 4000 });\n    }\n    scenario.interventions = interventions;\n\n    // Show progress, hide results\n    document.getElementById('abmProgress').style.display = 'block';\n    document.getElementById('abmResults').style.display = 'none';\n    document.getElementById('abmProgressBar').style.width = '0%';\n    document.getElementById('abmProgressPercent').textContent = '0%';\n    document.getElementById('abmProgressText').textContent = 'Initializing agents...';\n\n    // Check if we should use Web Worker (for large simulations)\n    const useWebWorker = config.numWorkers >= 5000 && typeof WorkerManager !== 'undefined' && WorkerManager.isSupported();\n\n    try {\n        let results;\n\n        if (useWebWorker) {\n            // Use Web Worker for parallel execution\n            results = await runABMWithWorker(config, scenario);\n        } else {\n            // Use main thread (original approach)\n            currentABMEngine = new ABMSimulationEngine(config);\n            results = await currentABMEngine.runSimulation(scenario);\n        }\n\n        currentABMResults = results;\n\n        // Display results\n        displayABMResults(results);\n        showNotification('ABM simulation complete!', 'success');\n\n    } catch (error) {\n        console.error('ABM simulation failed:', error);\n        showNotification(`ABM simulation failed: ${error.message}`, 'error');\n        document.getElementById('abmProgress').style.display = 'none';\n    }\n}\n\n/**\n * Run ABM simulation using Web Worker\n */\nasync function runABMWithWorker(config, scenario) {\n    // Terminate existing worker if any\n    if (abmWorkerManager) {\n        abmWorkerManager.terminate();\n    }\n\n    // Create new worker manager\n    abmWorkerManager = new WorkerManager();\n\n    // Set progress callback\n    abmWorkerManager.setProgressCallback((progress) => {\n        updateABMProgress({\n            month: progress.month,\n            totalMonths: progress.totalMonths,\n            progress: progress.progress,\n            currentStats: progress.currentStats\n        });\n    });\n\n    try {\n        // Initialize worker\n        document.getElementById('abmProgressText').textContent = 'Starting Web Worker...';\n        await abmWorkerManager.initialize(config, scenario);\n\n        // Run simulation\n        document.getElementById('abmProgressText').textContent = 'Running simulation in background...';\n        const results = await abmWorkerManager.runSimulation(scenario);\n\n        return results;\n\n    } catch (error) {\n        // Fallback to main thread if worker fails\n        console.warn('Web Worker failed, falling back to main thread:', error);\n        showNotification('Worker unavailable, running on main thread...', 'info');\n\n        currentABMEngine = new ABMSimulationEngine(config);\n        return await currentABMEngine.runSimulation(scenario);\n\n    } finally {\n        // Cleanup worker\n        if (abmWorkerManager) {\n            abmWorkerManager.terminate();\n            abmWorkerManager = null;\n        }\n    }\n}\n\n/**\n * Run quick ABM test (smaller scale)\n */\nasync function runQuickABMTest() {\n    // Override with small values for testing\n    document.getElementById('abmWorkers').value = 1000;\n    document.getElementById('abmWorkersValue').textContent = '1,000';\n    document.getElementById('abmFirms').value = 50;\n    document.getElementById('abmFirmsValue').textContent = '50';\n    document.getElementById('abmDuration').value = 12;\n\n    showNotification('Running quick test with 1K workers, 50 firms, 12 months...', 'info');\n    await runABMSimulation();\n}\n\n/**\n * Update ABM progress display\n */\nfunction updateABMProgress(progress) {\n    const percent = Math.round((progress.month / progress.totalMonths) * 100);\n    document.getElementById('abmProgressBar').style.width = `${percent}%`;\n    document.getElementById('abmProgressPercent').textContent = `${percent}%`;\n    document.getElementById('abmCurrentMonth').textContent = progress.month;\n    document.getElementById('abmTotalMonths').textContent = progress.totalMonths;\n\n    // Update status text\n    if (percent < 10) {\n        document.getElementById('abmProgressText').textContent = 'Initializing labor market...';\n    } else if (percent < 30) {\n        document.getElementById('abmProgressText').textContent = 'Simulating early AI adoption...';\n    } else if (percent < 60) {\n        document.getElementById('abmProgressText').textContent = 'Processing workforce transitions...';\n    } else if (percent < 90) {\n        document.getElementById('abmProgressText').textContent = 'Analyzing policy responses...';\n    } else {\n        document.getElementById('abmProgressText').textContent = 'Finalizing results...';\n    }\n}\n\n/**\n * Display ABM results\n */\nfunction displayABMResults(results) {\n    // Hide progress, show results\n    document.getElementById('abmProgress').style.display = 'none';\n    document.getElementById('abmResults').style.display = 'block';\n\n    const summary = results.summary;\n\n    // Summary cards - wrapped in try-catch for resilience\n    try {\n        const finalUR = (summary.final.unemploymentRate * 100).toFixed(1);\n        const initialUR = (summary.initial.unemploymentRate * 100).toFixed(1);\n        const urChange = (finalUR - initialUR).toFixed(1);\n        document.getElementById('abmFinalUR').textContent = `${finalUR}%`;\n        document.getElementById('abmURChange').textContent = `${urChange >= 0 ? '+' : ''}${urChange}% from start`;\n\n        document.getElementById('abmPeakUR').textContent = `${(summary.peakUnemployment * 100).toFixed(1)}%`;\n        document.getElementById('abmPeakMonth').textContent = `Month ${summary.peakUnemploymentMonth || '--'}`;\n\n        const finalAI = (summary.final.aiAdoptionRate * 100).toFixed(1);\n        const initialAI = (summary.initial.aiAdoptionRate * 100).toFixed(1);\n        const aiChange = (finalAI - initialAI).toFixed(1);\n        document.getElementById('abmFinalAI').textContent = `${finalAI}%`;\n        document.getElementById('abmAIChange').textContent = `+${aiChange}% from start`;\n\n        const netJobs = summary.totalHires - summary.totalLayoffs;\n        document.getElementById('abmNetJobs').textContent = netJobs.toLocaleString();\n        document.getElementById('abmNetJobs').style.color = netJobs >= 0 ? 'var(--secondary)' : 'var(--danger)';\n    } catch (error) {\n        console.error('Error displaying ABM summary cards:', error);\n    }\n\n    // Display results interpretation\n    try {\n        displayResultsInterpretation(results);\n    } catch (error) {\n        console.error('Error displaying results interpretation:', error);\n        const container = document.getElementById('abmInterpretationContent');\n        if (container) {\n            container.innerHTML = `<p style=\"color: var(--danger);\">Error loading interpretation: ${error.message}</p>`;\n        }\n    }\n\n    // Policy support display\n    try {\n        displayPolicySupportResults(summary.finalPolicySupport, results);\n    } catch (error) {\n        console.error('Error displaying policy support:', error);\n        const container = document.getElementById('abmPolicySupportContent');\n        if (container) {\n            container.innerHTML = `<p style=\"color: var(--danger);\">Error loading policy support: ${error.message}</p>`;\n        }\n    }\n\n    // Render charts\n    try {\n        renderABMCharts(results);\n    } catch (error) {\n        console.error('Error rendering ABM charts:', error);\n    }\n\n    // Display emergent patterns\n    try {\n        displayEmergentPatterns(summary.emergentPatterns);\n    } catch (error) {\n        console.error('Error displaying emergent patterns:', error);\n        const container = document.getElementById('abmPatternsContent');\n        if (container) {\n            container.innerHTML = `<p style=\"color: var(--danger);\">Error loading patterns: ${error.message}</p>`;\n        }\n    }\n\n    // Display demographics\n    try {\n        displayABMDemographics(results);\n    } catch (error) {\n        console.error('Error displaying demographics:', error);\n        const container = document.getElementById('abmDemographicsContent');\n        if (container) {\n            container.innerHTML = `<p style=\"color: var(--danger);\">Error loading demographics: ${error.message}</p>`;\n        }\n    }\n\n    // Display regional heat map\n    try {\n        displayRegionalHeatMap(results);\n    } catch (error) {\n        console.error('Error displaying regional heat map:', error);\n        const container = document.getElementById('regionalHeatmapContent');\n        if (container) {\n            container.innerHTML = `<p style=\"color: var(--danger);\">Error loading regional data: ${error.message}</p>`;\n        }\n    }\n}\n\n/**\n * Display regional heat map visualization\n */\nfunction displayRegionalHeatMap(results) {\n    if (typeof regionalHeatMap === 'undefined') {\n        console.warn('Regional heat map not available');\n        return;\n    }\n\n    // Initialize with simulation results\n    regionalHeatMap.initialize(results);\n\n    // Render the summary panel\n    regionalHeatMap.renderSummaryPanel('regionalHeatmapSummary');\n\n    // Render the heat map\n    regionalHeatMap.render('regionalHeatmapContent', 'unemployment');\n}\n\n/**\n * Run ABM sensitivity analysis\n */\nasync function runABMSensitivityAnalysis() {\n    if (typeof abmSensitivity === 'undefined') {\n        alert('Sensitivity analysis module not available');\n        return;\n    }\n\n    // Get current ABM configuration\n    const config = getABMConfig();\n\n    // Show progress\n    const progressDiv = document.getElementById('abmSensitivityProgress');\n    const contentDiv = document.getElementById('abmSensitivityContent');\n    const progressText = document.getElementById('sensitivityProgressText');\n    const progressBar = document.getElementById('sensitivityProgressBar');\n    const btn = document.getElementById('runSensitivityBtn');\n\n    progressDiv.style.display = 'block';\n    contentDiv.style.display = 'none';\n    btn.disabled = true;\n    btn.textContent = 'Running...';\n\n    // Select parameters to analyze\n    const paramsToAnalyze = [\n        'initialAIAdoption',\n        'aiAdoptionSpeed',\n        'laborMarketFriction',\n        'retrainingEffectiveness',\n        'wageFlexibility'\n    ];\n\n    try {\n        // Run multi-parameter analysis\n        const results = await abmSensitivity.runMultiParameterAnalysis(\n            paramsToAnalyze,\n            null, // Engine not needed for mock analysis\n            config,\n            (progress) => {\n                if (progress.phase === 'parameter') {\n                    progressText.textContent = `Analyzing ${progress.paramName}... (${progress.current}/${progress.total})`;\n                    progressBar.style.width = `${(progress.current / progress.total) * 100}%`;\n                } else {\n                    progressText.textContent = `${progress.parameter}: ${progress.current}/${progress.total} simulations`;\n                    const overallProgress = ((progress.paramIndex - 1) / progress.paramTotal) +\n                        (progress.current / progress.total) / progress.paramTotal;\n                    progressBar.style.width = `${overallProgress * 100}%`;\n                }\n            }\n        );\n\n        // Render dashboard\n        abmSensitivity.renderDashboard('abmSensitivityContent', results);\n\n    } catch (error) {\n        console.error('Sensitivity analysis error:', error);\n        contentDiv.innerHTML = `<p style=\"color: var(--danger);\">Error running sensitivity analysis: ${error.message}</p>`;\n    }\n\n    // Hide progress, show content\n    progressDiv.style.display = 'none';\n    contentDiv.style.display = 'block';\n    btn.disabled = false;\n    btn.textContent = 'Run Analysis';\n}\n\n/**\n * Get current ABM configuration from UI\n */\nfunction getABMConfig() {\n    return {\n        numWorkers: 1000,\n        numFirms: 100,\n        simulationMonths: parseInt(document.getElementById('abmMonths')?.value || 60),\n        initialAIAdoption: 0.2,\n        aiAdoptionSpeed: 1.0,\n        laborMarketFriction: 0.1,\n        retrainingEffectiveness: 0.3,\n        wageFlexibility: 0.05,\n        informationSpread: 0.1\n    };\n}\n\n/**\n * Display enhanced policy support dashboard\n */\nfunction displayPolicySupportResults(policySupport, results = null) {\n    const container = document.getElementById('abmPolicySupportContent');\n\n    const policyNames = {\n        ubi: 'Universal Basic Income',\n        retraining: 'Job Retraining Programs',\n        wageSubsidy: 'Wage Subsidies',\n        reducedWorkWeek: 'Reduced Work Week',\n        publicWorks: 'Public Works Programs',\n        eitcExpansion: 'EITC Expansion',\n        aiRegulation: 'AI Regulation',\n        tradeProtection: 'Trade Protection',\n        educationInvestment: 'Education Investment'\n    };\n\n    const policyIcons = {\n        ubi: '',\n        retraining: '',\n        wageSubsidy: '',\n        publicWorks: '',\n        aiRegulation: '',\n        educationInvestment: ''\n    };\n\n    // Calculate momentum from historical data if available\n    const getMomentum = (policy) => {\n        if (!results || !results.policySupport || results.policySupport.length < 6) {\n            return { value: 0, direction: 'stable' };\n        }\n\n        const recent = results.policySupport.slice(-6);\n        const first = recent[0]?.[policy]?.mean || 0.5;\n        const last = recent[recent.length - 1]?.[policy]?.mean || 0.5;\n        const change = (last - first) * 100;\n\n        return {\n            value: change.toFixed(1),\n            direction: change > 1 ? 'increasing' : change < -1 ? 'decreasing' : 'stable'\n        };\n    };\n\n    // Calculate feasibility label\n    const getFeasibilityLabel = (score) => {\n        if (score >= 80) return { label: 'Highly Feasible', color: 'var(--secondary)', icon: '' };\n        if (score >= 65) return { label: 'Feasible', color: 'var(--secondary)', icon: '' };\n        if (score >= 50) return { label: 'Contested', color: 'var(--warning)', icon: '~' };\n        if (score >= 35) return { label: 'Difficult', color: 'var(--warning)', icon: '!' };\n        return { label: 'Unlikely', color: 'var(--danger)', icon: '' };\n    };\n\n    // Check if policy window is open\n    const isPolicyWindowOpen = (stats) => {\n        return stats.mean > 0.6 && (stats.strongOppose || 0) < 0.25;\n    };\n\n    let html = '';\n\n    // Summary stats\n    const feasibleCount = Object.values(policySupport).filter(s => (s.feasibilityScore || s.mean * 100) >= 65).length;\n    const totalPolicies = Object.keys(policySupport).length;\n\n    html += `\n        <div style=\"display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px;\">\n            <div style=\"background: linear-gradient(135deg, var(--primary), #8b5cf6); color: white; padding: 16px; border-radius: 12px; text-align: center;\">\n                <div style=\"font-size: 2rem; font-weight: 700;\">${feasibleCount}</div>\n                <div style=\"font-size: 0.75rem; opacity: 0.9;\">Feasible Policies</div>\n            </div>\n            <div style=\"background: linear-gradient(135deg, var(--secondary), #059669); color: white; padding: 16px; border-radius: 12px; text-align: center;\">\n                <div style=\"font-size: 2rem; font-weight: 700;\">${Object.values(policySupport).filter(s => isPolicyWindowOpen(s)).length}</div>\n                <div style=\"font-size: 0.75rem; opacity: 0.9;\">Open Windows</div>\n            </div>\n            <div style=\"background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 16px; border-radius: 12px; text-align: center;\">\n                <div style=\"font-size: 2rem; font-weight: 700;\">${Object.values(policySupport).filter(s => getMomentum(Object.keys(policySupport).find(k => policySupport[k] === s)).direction === 'increasing').length}</div>\n                <div style=\"font-size: 0.75rem; opacity: 0.9;\">Rising Support</div>\n            </div>\n            <div style=\"background: linear-gradient(135deg, #64748b, #475569); color: white; padding: 16px; border-radius: 12px; text-align: center;\">\n                <div style=\"font-size: 2rem; font-weight: 700;\">${totalPolicies}</div>\n                <div style=\"font-size: 0.75rem; opacity: 0.9;\">Policies Tracked</div>\n            </div>\n        </div>\n    `;\n\n    // Policy cards\n    html += '<div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;\">';\n\n    Object.entries(policySupport).forEach(([policy, stats]) => {\n        const supportPercent = Math.round((stats.mean || 0.5) * 100);\n        const strongSupport = Math.round((stats.strongSupport || 0) * 100);\n        const strongOppose = Math.round((stats.strongOppose || 0) * 100);\n        const feasibilityScore = stats.feasibilityScore || Math.round(stats.mean * 100);\n        const feasibility = getFeasibilityLabel(feasibilityScore);\n        const momentum = getMomentum(policy);\n        const windowOpen = isPolicyWindowOpen(stats);\n\n        const mainColor = supportPercent >= 60 ? 'var(--secondary)' : supportPercent >= 40 ? 'var(--warning)' : 'var(--danger)';\n        const icon = policyIcons[policy] || '';\n\n        html += `\n            <div style=\"background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 12px; padding: 20px; position: relative;\">\n                ${windowOpen ? '<div style=\"position: absolute; top: 12px; right: 12px; background: var(--secondary); color: white; font-size: 0.65rem; padding: 4px 8px; border-radius: 12px; font-weight: 600;\">WINDOW OPEN</div>' : ''}\n\n                <div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px;\">\n                    <span style=\"font-size: 1.5rem;\">${icon}</span>\n                    <div>\n                        <div style=\"font-weight: 600; font-size: 0.95rem; color: var(--gray-800);\">${policyNames[policy] || policy}</div>\n                        <div style=\"font-size: 0.75rem; color: ${feasibility.color};\">${feasibility.icon} ${feasibility.label}</div>\n                    </div>\n                </div>\n\n                <!-- Support Gauge -->\n                <div style=\"margin-bottom: 16px;\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;\">\n                        <span style=\"font-size: 0.75rem; color: var(--gray-500);\">Public Support</span>\n                        <span style=\"font-size: 1.25rem; font-weight: 700; color: ${mainColor};\">${supportPercent}%</span>\n                    </div>\n                    <div style=\"background: var(--gray-200); border-radius: 6px; height: 10px; overflow: hidden;\">\n                        <div style=\"background: linear-gradient(90deg, var(--danger) 0%, var(--warning) 40%, var(--secondary) 60%, var(--secondary) 100%); height: 100%; width: 100%; position: relative;\">\n                            <div style=\"position: absolute; left: ${supportPercent}%; top: -2px; transform: translateX(-50%); width: 14px; height: 14px; background: white; border: 3px solid ${mainColor}; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2);\"></div>\n                        </div>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; font-size: 0.65rem; color: var(--gray-400); margin-top: 4px;\">\n                        <span>Oppose</span>\n                        <span>Neutral</span>\n                        <span>Support</span>\n                    </div>\n                </div>\n\n                <!-- Support Distribution -->\n                <div style=\"display: flex; gap: 12px; margin-bottom: 12px;\">\n                    <div style=\"flex: 1; text-align: center; padding: 8px; background: rgba(16, 185, 129, 0.1); border-radius: 6px;\">\n                        <div style=\"font-size: 1.1rem; font-weight: 700; color: var(--secondary);\">${strongSupport}%</div>\n                        <div style=\"font-size: 0.65rem; color: var(--gray-500);\">Strong Support</div>\n                    </div>\n                    <div style=\"flex: 1; text-align: center; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 6px;\">\n                        <div style=\"font-size: 1.1rem; font-weight: 700; color: var(--danger);\">${strongOppose}%</div>\n                        <div style=\"font-size: 0.65rem; color: var(--gray-500);\">Strong Oppose</div>\n                    </div>\n                </div>\n\n                <!-- Momentum Indicator -->\n                <div style=\"display: flex; justify-content: space-between; align-items: center; padding-top: 12px; border-top: 1px solid var(--gray-200);\">\n                    <span style=\"font-size: 0.75rem; color: var(--gray-500);\">Momentum</span>\n                    <span style=\"font-size: 0.85rem; font-weight: 600; color: ${momentum.direction === 'increasing' ? 'var(--secondary)' : momentum.direction === 'decreasing' ? 'var(--danger)' : 'var(--gray-500)'};\">\n                        ${momentum.direction === 'increasing' ? '' : momentum.direction === 'decreasing' ? '' : ''}\n                        ${momentum.value > 0 ? '+' : ''}${momentum.value}%\n                        <span style=\"font-weight: 400; color: var(--gray-400);\">/ 6mo</span>\n                    </span>\n                </div>\n            </div>\n        `;\n    });\n\n    html += '</div>';\n\n    // Policy Window Analysis Section\n    const openWindows = Object.entries(policySupport).filter(([_, stats]) => isPolicyWindowOpen(stats));\n\n    if (openWindows.length > 0) {\n        html += `\n            <div style=\"margin-top: 24px; padding: 20px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05)); border: 1px solid var(--secondary); border-radius: 12px;\">\n                <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 12px;\">\n                    <span style=\"font-size: 1.25rem;\"></span>\n                    <h4 style=\"margin: 0; color: var(--secondary);\">Policy Windows Open</h4>\n                </div>\n                <p style=\"font-size: 0.875rem; color: var(--gray-600); margin-bottom: 16px;\">\n                    The following policies have sufficient public support and manageable opposition for implementation:\n                </p>\n                <div style=\"display: flex; flex-wrap: wrap; gap: 8px;\">\n                    ${openWindows.map(([policy, stats]) => `\n                        <span style=\"background: var(--secondary); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.875rem; font-weight: 500;\">\n                            ${policyIcons[policy] || ''} ${policyNames[policy] || policy}\n                            <span style=\"opacity: 0.8;\">(${Math.round(stats.mean * 100)}%)</span>\n                        </span>\n                    `).join('')}\n                </div>\n            </div>\n        `;\n    }\n\n    container.innerHTML = html;\n}\n\n/**\n * Display results interpretation from ResultsInterpreter API\n */\nfunction displayResultsInterpretation(results) {\n    const container = document.getElementById('abmInterpretationContent');\n    const detailsContainer = document.getElementById('abmInterpretationDetails');\n\n    // Check if ResultsInterpreter is available\n    if (typeof resultsInterpreter === 'undefined') {\n        container.innerHTML = '<p style=\"color: var(--gray-500);\">Results interpreter not available</p>';\n        return;\n    }\n\n    // Transform ABM results to the format expected by the interpreter\n    const interpretableResults = transformABMResultsForInterpreter(results);\n    const interpretation = resultsInterpreter.interpret(interpretableResults);\n\n    if (interpretation.error) {\n        container.innerHTML = `<p style=\"color: var(--danger);\">${interpretation.error}</p>`;\n        return;\n    }\n\n    // Main interpretation content\n    let html = '';\n\n    // Overview banner\n    const overview = interpretation.overview;\n    const outlookColors = {\n        positive: { bg: 'rgba(16, 185, 129, 0.1)', border: 'var(--secondary)', icon: '' },\n        neutral: { bg: 'rgba(100, 116, 139, 0.1)', border: 'var(--gray-400)', icon: '' },\n        negative: { bg: 'rgba(245, 158, 11, 0.1)', border: 'var(--warning)', icon: '' },\n        critical: { bg: 'rgba(239, 68, 68, 0.1)', border: 'var(--danger)', icon: '' }\n    };\n    const colors = outlookColors[overview.outlook] || outlookColors.neutral;\n\n    html += `\n        <div style=\"background: ${colors.bg}; border-left: 4px solid ${colors.border}; padding: 16px 20px; border-radius: 8px; margin-bottom: 20px;\">\n            <div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 8px;\">\n                <span style=\"font-size: 1.5rem;\">${colors.icon}</span>\n                <div>\n                    <div style=\"font-weight: 700; font-size: 1.1rem; color: var(--gray-800);\">${overview.headline}</div>\n                    <div style=\"font-size: 0.875rem; color: var(--gray-600);\">${overview.subheadline}</div>\n                </div>\n            </div>\n        </div>\n    `;\n\n    // Quick insights\n    const quickInsights = interpretation.keyFindings.slice(0, 4);\n    html += '<div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;\">';\n    quickInsights.forEach(finding => {\n        const statusColors = {\n            positive: 'var(--secondary)',\n            critical: 'var(--danger)',\n            high: 'var(--danger)',\n            warning: 'var(--warning)',\n            neutral: 'var(--gray-500)',\n            moderate: 'var(--warning)',\n            low: 'var(--secondary)'\n        };\n        const color = statusColors[finding.severity] || statusColors[finding.impact] || 'var(--gray-600)';\n\n        html += `\n            <div style=\"display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--gray-50); border-radius: 8px;\">\n                <span style=\"font-size: 1.25rem;\">${finding.icon}</span>\n                <div>\n                    <div style=\"font-size: 0.875rem; color: var(--gray-700);\">${finding.finding}</div>\n                </div>\n            </div>\n        `;\n    });\n    html += '</div>';\n\n    // Risk assessment summary\n    const risk = interpretation.riskAssessment;\n    const riskColors = {\n        critical: { bg: 'var(--danger)', text: 'white' },\n        high: { bg: 'var(--warning)', text: 'white' },\n        medium: { bg: '#fbbf24', text: 'var(--gray-800)' },\n        low: { bg: 'var(--secondary)', text: 'white' }\n    };\n    const riskColor = riskColors[risk.overallLevel] || riskColors.medium;\n\n    html += `\n        <div style=\"display: flex; align-items: center; justify-content: space-between; padding: 16px; background: var(--gray-50); border-radius: 8px;\">\n            <div>\n                <div style=\"font-size: 0.875rem; color: var(--gray-500); margin-bottom: 4px;\">Overall Risk Assessment</div>\n                <div style=\"display: flex; align-items: center; gap: 12px;\">\n                    <span style=\"background: ${riskColor.bg}; color: ${riskColor.text}; padding: 4px 12px; border-radius: 20px; font-size: 0.875rem; font-weight: 600; text-transform: uppercase;\">${risk.overallLevel}</span>\n                    <span style=\"color: var(--gray-600); font-size: 0.875rem;\">Score: ${risk.overallScore}/100</span>\n                </div>\n            </div>\n            <div style=\"text-align: right;\">\n                ${risk.riskCount.critical > 0 ? `<span style=\"color: var(--danger); font-weight: 600;\">${risk.riskCount.critical} Critical</span> ` : ''}\n                ${risk.riskCount.high > 0 ? `<span style=\"color: var(--warning); font-weight: 600;\">${risk.riskCount.high} High</span> ` : ''}\n                ${risk.riskCount.medium > 0 ? `<span style=\"color: var(--gray-500);\">${risk.riskCount.medium} Medium</span>` : ''}\n            </div>\n        </div>\n    `;\n\n    container.innerHTML = html;\n\n    // Detailed interpretation content\n    let detailsHtml = '';\n\n    // Narrative Summary\n    detailsHtml += `\n        <div style=\"margin-bottom: 24px;\">\n            <h4 style=\"margin-bottom: 12px; color: var(--gray-700);\"> Narrative Summary</h4>\n            <p style=\"color: var(--gray-600); line-height: 1.6; font-size: 0.925rem;\">${interpretation.narrativeSummary}</p>\n        </div>\n    `;\n\n    // Risk Details\n    if (risk.risks.length > 0) {\n        detailsHtml += `\n            <div style=\"margin-bottom: 24px;\">\n                <h4 style=\"margin-bottom: 12px; color: var(--gray-700);\"> Identified Risks</h4>\n                <div style=\"display: grid; gap: 12px;\">\n        `;\n        risk.risks.forEach(r => {\n            const levelColor = r.level === 'critical' ? 'var(--danger)' : r.level === 'high' ? 'var(--warning)' : 'var(--gray-500)';\n            detailsHtml += `\n                <div style=\"padding: 16px; background: var(--gray-50); border-radius: 8px; border-left: 3px solid ${levelColor};\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;\">\n                        <span style=\"font-weight: 600; color: var(--gray-700);\">${r.type.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}</span>\n                        <span style=\"color: ${levelColor}; font-size: 0.75rem; font-weight: 600; text-transform: uppercase;\">${r.level}</span>\n                    </div>\n                    <p style=\"font-size: 0.875rem; color: var(--gray-600); margin-bottom: 8px;\">${r.description}</p>\n                    <p style=\"font-size: 0.8rem; color: var(--primary);\"> ${r.mitigation}</p>\n                </div>\n            `;\n        });\n        detailsHtml += '</div></div>';\n    }\n\n    // Policy Recommendations\n    const recommendations = interpretation.policyRecommendations.slice(0, 5);\n    detailsHtml += `\n        <div style=\"margin-bottom: 24px;\">\n            <h4 style=\"margin-bottom: 12px; color: var(--gray-700);\"> Policy Recommendations</h4>\n            <div style=\"display: grid; gap: 12px;\">\n    `;\n    recommendations.forEach(rec => {\n        const priorityBadge = {\n            high: { bg: 'var(--danger)', text: 'HIGH PRIORITY' },\n            medium: { bg: 'var(--warning)', text: 'MEDIUM' },\n            standard: { bg: 'var(--gray-400)', text: 'STANDARD' }\n        };\n        const badge = priorityBadge[rec.priority] || priorityBadge.standard;\n\n        detailsHtml += `\n            <div style=\"padding: 16px; background: var(--gray-50); border-radius: 8px;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;\">\n                    <span style=\"font-weight: 600; color: var(--gray-700);\">${rec.title}</span>\n                    <span style=\"background: ${badge.bg}; color: white; font-size: 0.65rem; padding: 2px 8px; border-radius: 10px;\">${badge.text}</span>\n                </div>\n                <p style=\"font-size: 0.875rem; color: var(--gray-600); margin-bottom: 6px;\">${rec.description}</p>\n                <p style=\"font-size: 0.8rem; color: var(--secondary);\">Expected: ${rec.expectedImpact}</p>\n            </div>\n        `;\n    });\n    detailsHtml += '</div></div>';\n\n    // Comparative Benchmarks\n    const benchmarks = interpretation.comparativeBenchmarks;\n    detailsHtml += `\n        <div style=\"margin-bottom: 24px;\">\n            <h4 style=\"margin-bottom: 12px; color: var(--gray-700);\"> Comparative Benchmarks</h4>\n            <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;\">\n                <div style=\"padding: 16px; background: var(--gray-50); border-radius: 8px;\">\n                    <div style=\"font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 12px;\">Unemployment Comparison</div>\n                    ${benchmarks.unemploymentBenchmarks.map(b => `\n                        <div style=\"display: flex; justify-content: space-between; padding: 6px 0; ${b.current ? 'font-weight: 600; color: var(--primary);' : 'color: var(--gray-600);'}\">\n                            <span>${b.label}</span>\n                            <span>${b.value}%</span>\n                        </div>\n                    `).join('')}\n                </div>\n                <div style=\"padding: 16px; background: var(--gray-50); border-radius: 8px;\">\n                    <div style=\"font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 12px;\">Displacement Comparison</div>\n                    ${benchmarks.displacementBenchmarks.map(b => `\n                        <div style=\"display: flex; justify-content: space-between; padding: 6px 0; ${b.current ? 'font-weight: 600; color: var(--primary);' : 'color: var(--gray-600);'}\">\n                            <span>${b.label}</span>\n                            <span>${b.value}</span>\n                        </div>\n                    `).join('')}\n                </div>\n            </div>\n            <p style=\"font-size: 0.875rem; color: var(--gray-500); margin-top: 12px; text-align: center;\">${benchmarks.context}</p>\n        </div>\n    `;\n\n    detailsContainer.innerHTML = detailsHtml;\n}\n\n/**\n * Transform ABM results to format expected by ResultsInterpreter\n */\nfunction transformABMResultsForInterpreter(results) {\n    const summary = results.summary;\n\n    return {\n        summary: {\n            labor_market_changes: {\n                unemployment_rate: {\n                    initial: summary.initial.unemploymentRate * 100,\n                    final: summary.final.unemploymentRate * 100,\n                    change: (summary.final.unemploymentRate - summary.initial.unemploymentRate) * 100\n                },\n                total_employment: {\n                    initial: summary.initial.totalEmployed || 150000000,\n                    final: summary.final.totalEmployed || 150000000,\n                    change: (summary.final.totalEmployed || 0) - (summary.initial.totalEmployed || 0)\n                }\n            },\n            ai_impact: {\n                ai_adoption: {\n                    initial: summary.initial.aiAdoptionRate * 100,\n                    final: summary.final.aiAdoptionRate * 100\n                },\n                cumulative_displacement: summary.totalLayoffs || 0,\n                cumulative_new_jobs: summary.totalHires || 0,\n                net_impact: (summary.totalHires || 0) - (summary.totalLayoffs || 0)\n            },\n            wages: {\n                average_hourly: {\n                    initial: 30,\n                    final: 30 * (1 + (summary.wageChange || 0)),\n                    change_percent: (summary.wageChange || 0) * 100\n                }\n            },\n            productivity: {\n                growth_rate: {\n                    initial: 1.5,\n                    final: summary.final.productivityGrowth || 2.5\n                }\n            },\n            inequality: summary.inequality || null,\n            sectorImpacts: summary.sectorImpacts || null\n        },\n        scenario: results.scenario || {\n            name: 'Custom Scenario',\n            timeframe: { start_year: 2024, end_year: 2029 }\n        },\n        monthlyData: results.monthlyData || [],\n        policySupport: results.policySupport || []\n    };\n}\n\n/**\n * Toggle interpretation details visibility\n */\nfunction toggleInterpretationDetails() {\n    const details = document.getElementById('abmInterpretationDetails');\n    const btn = event.target;\n\n    if (details.style.display === 'none') {\n        details.style.display = 'block';\n        btn.textContent = 'Hide Details';\n    } else {\n        details.style.display = 'none';\n        btn.textContent = 'Show Details';\n    }\n}\n\n/**\n * Render ABM charts\n */\nfunction renderABMCharts(results) {\n    // Destroy existing charts\n    Object.values(abmCharts).forEach(chart => chart.destroy());\n    abmCharts = {};\n\n    const months = results.monthlyData.map((_, i) => `Month ${i + 1}`);\n\n    // Unemployment Chart\n    const urCtx = document.getElementById('abmUnemploymentChart').getContext('2d');\n    abmCharts.unemployment = new Chart(urCtx, {\n        type: 'line',\n        data: {\n            labels: months,\n            datasets: [{\n                label: 'Unemployment Rate',\n                data: results.monthlyData.map(d => d.unemploymentRate * 100),\n                borderColor: '#ef4444',\n                backgroundColor: 'rgba(239, 68, 68, 0.1)',\n                fill: true,\n                tension: 0.4\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n                legend: { display: false }\n            },\n            scales: {\n                y: {\n                    beginAtZero: true,\n                    title: { display: true, text: 'Unemployment Rate (%)' }\n                }\n            }\n        }\n    });\n\n    // Policy Support Chart\n    const psCtx = document.getElementById('abmPolicySupportChart').getContext('2d');\n    const policies = ['ubi', 'retraining', 'aiRegulation'];\n    const colors = ['#6366f1', '#10b981', '#f59e0b'];\n\n    abmCharts.policySupport = new Chart(psCtx, {\n        type: 'line',\n        data: {\n            labels: months,\n            datasets: policies.map((policy, i) => ({\n                label: policy === 'ubi' ? 'UBI' : policy === 'retraining' ? 'Retraining' : 'AI Regulation',\n                data: results.monthlyData.map(d => d.policySupport?.[policy]?.mean * 100 || 50),\n                borderColor: colors[i],\n                backgroundColor: 'transparent',\n                tension: 0.4\n            }))\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n                legend: { position: 'top' }\n            },\n            scales: {\n                y: {\n                    min: 0,\n                    max: 100,\n                    title: { display: true, text: 'Support (%)' }\n                }\n            }\n        }\n    });\n\n    // AI Adoption Chart\n    const aiCtx = document.getElementById('abmAIAdoptionChart').getContext('2d');\n    abmCharts.aiAdoption = new Chart(aiCtx, {\n        type: 'line',\n        data: {\n            labels: months,\n            datasets: [{\n                label: 'AI Adoption Rate',\n                data: results.monthlyData.map(d => d.aiAdoptionRate * 100),\n                borderColor: '#8b5cf6',\n                backgroundColor: 'rgba(139, 92, 246, 0.1)',\n                fill: true,\n                tension: 0.4\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n                legend: { display: false }\n            },\n            scales: {\n                y: {\n                    beginAtZero: true,\n                    title: { display: true, text: 'AI Adoption (%)' }\n                }\n            }\n        }\n    });\n}\n\n/**\n * Display emergent patterns\n */\nfunction displayEmergentPatterns(patterns) {\n    const container = document.getElementById('abmPatternsContent');\n\n    if (!patterns || patterns.length === 0) {\n        container.innerHTML = '<p style=\"color: var(--gray-500);\">No significant emergent patterns detected in this simulation.</p>';\n        return;\n    }\n\n    let html = '<div style=\"display: flex; flex-direction: column; gap: 12px;\">';\n\n    patterns.forEach(pattern => {\n        const icon = pattern.type === 'tipping_point' ? '' :\n                    pattern.type === 'feedback_loop' ? '' :\n                    pattern.type === 'cascade' ? '' : '';\n\n        const severity = pattern.severity || 'medium';\n        const color = severity === 'high' ? 'var(--danger)' :\n                     severity === 'medium' ? 'var(--warning)' : 'var(--gray-500)';\n\n        html += `\n            <div style=\"background: var(--gray-50); border-radius: 8px; padding: 16px; border-left: 4px solid ${color};\">\n                <div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 8px;\">\n                    <span style=\"font-size: 1.25rem;\">${icon}</span>\n                    <span style=\"font-weight: 600;\">${pattern.type.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}</span>\n                    <span style=\"margin-left: auto; font-size: 0.75rem; color: var(--gray-500);\">Month ${pattern.month || '--'}</span>\n                </div>\n                <p style=\"margin: 0; color: var(--text-secondary); font-size: 0.875rem;\">${pattern.description || ''}</p>\n            </div>\n        `;\n    });\n\n    html += '</div>';\n    container.innerHTML = html;\n}\n\n/**\n * Display ABM demographics breakdown\n */\nfunction displayABMDemographics(results) {\n    const container = document.getElementById('abmDemographicsContent');\n\n    // Get final state demographics\n    const finalData = results.monthlyData[results.monthlyData.length - 1];\n    const policySupport = results.summary.finalPolicySupport;\n\n    let html = `\n        <div style=\"display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px;\">\n            <div>\n                <h5 style=\"margin-bottom: 12px; color: var(--primary);\">Employment Status Breakdown</h5>\n                <div style=\"background: var(--gray-50); border-radius: 8px; padding: 16px;\">\n                    <div style=\"display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-200);\">\n                        <span>Employed</span>\n                        <span style=\"font-weight: 600; color: var(--secondary);\">${((1 - finalData.unemploymentRate) * 100).toFixed(1)}%</span>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-200);\">\n                        <span>Unemployed</span>\n                        <span style=\"font-weight: 600; color: var(--danger);\">${(finalData.unemploymentRate * 100).toFixed(1)}%</span>\n                    </div>\n                    <div style=\"display: flex; justify-content: space-between; padding: 8px 0;\">\n                        <span>In Retraining</span>\n                        <span style=\"font-weight: 600; color: var(--primary);\">${(finalData.retrainingRate * 100 || 0).toFixed(1)}%</span>\n                    </div>\n                </div>\n            </div>\n\n            <div>\n                <h5 style=\"margin-bottom: 12px; color: var(--primary);\">Top Policy Priorities</h5>\n                <div style=\"background: var(--gray-50); border-radius: 8px; padding: 16px;\">\n                    ${Object.entries(policySupport)\n                        .sort((a, b) => b[1].mean - a[1].mean)\n                        .slice(0, 3)\n                        .map(([policy, stats], i) => `\n                            <div style=\"display: flex; justify-content: space-between; padding: 8px 0; ${i < 2 ? 'border-bottom: 1px solid var(--gray-200);' : ''}\">\n                                <span>${policy.replace(/([A-Z])/g, ' $1').replace(/^./, s => s.toUpperCase())}</span>\n                                <span style=\"font-weight: 600; color: var(--primary);\">${Math.round(stats.mean * 100)}%</span>\n                            </div>\n                        `).join('')}\n                </div>\n            </div>\n        </div>\n\n        <div style=\"margin-top: 24px;\">\n            <h5 style=\"margin-bottom: 12px; color: var(--primary);\">Simulation Summary</h5>\n            <div style=\"background: var(--gray-50); border-radius: 8px; padding: 16px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; text-align: center;\">\n                <div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--secondary);\">${results.summary.totalHires.toLocaleString()}</div>\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500);\">Total Hires</div>\n                </div>\n                <div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--danger);\">${results.summary.totalLayoffs.toLocaleString()}</div>\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500);\">Total Layoffs</div>\n                </div>\n                <div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--primary);\">${(results.summary.emergentPatterns?.length || 0)}</div>\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500);\">Patterns Found</div>\n                </div>\n                <div>\n                    <div style=\"font-size: 1.5rem; font-weight: 700; color: var(--warning);\">${results.monthlyData.length}</div>\n                    <div style=\"font-size: 0.75rem; color: var(--gray-500);\">Months Simulated</div>\n                </div>\n            </div>\n        </div>\n    `;\n\n    container.innerHTML = html;\n}\n\n/**\n * Export ABM results to JSON\n */\nfunction exportABMResults() {\n    if (!currentABMResults) {\n        showNotification('No ABM results to export. Run a simulation first.', 'warning');\n        return;\n    }\n\n    const blob = new Blob([JSON.stringify(currentABMResults, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `abm-simulation-${new Date().toISOString().split('T')[0]}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n    showNotification('ABM results exported!', 'success');\n}\n\n// Add keyboard listener for password modal\ndocument.addEventListener('keydown', (e) => {\n    if (e.key === 'Enter' && document.getElementById('passwordModal').style.display === 'flex') {\n        submitAIPassword();\n    }\n    if (e.key === 'Escape') {\n        hidePasswordModal();\n        hideTrainingModal();\n        hideAIResultsModal();\n    }\n});\n\n// Initialize AI model status on load\ndocument.addEventListener('DOMContentLoaded', () => {\n    setTimeout(updateAIModelStatus, 500);\n});\n\n// Initialize theme early (before DOMContentLoaded to prevent flash)\ninitTheme();\n\n// Initialize on page load (only if not loaded via module)\nif (typeof window !== 'undefined' && !window.__VITE_MODULE_LOADED__) {\n    document.addEventListener('DOMContentLoaded', initApp);\n}\n\n// Mark as loaded by Vite module system\nif (typeof window !== 'undefined') {\n    window.__VITE_MODULE_LOADED__ = true;\n}\n\n// Export all functions to window for onclick handlers\nif (typeof window !== 'undefined') {\n    // Core functions\n    window.initApp = initApp;\n    window.showSection = showSection;\n    window.loadPreset = loadPreset;\n    window.runSimulation = runSimulation;\n    window.getCurrentScenario = getCurrentScenario;\n\n    // Optimizer functions\n    window.toggleTargetOptimizer = toggleTargetOptimizer;\n    window.optimizeInterventions = optimizeInterventions;\n    window.applyOptimizedInterventions = applyOptimizedInterventions;\n\n    // PDF functions\n    window.downloadPDFReport = downloadPDFReport;\n\n    // Intervention functions\n    window.showInterventionModal = showInterventionModal;\n    window.hideInterventionModal = hideInterventionModal;\n    window.updateInterventionParams = updateInterventionParams;\n    window.addIntervention = addIntervention;\n    window.quickAddIntervention = quickAddIntervention;\n    window.toggleIntervention = toggleIntervention;\n    window.removeIntervention = removeIntervention;\n\n    // Export functions\n    window.exportResults = exportResults;\n    window.exportAsPDF = exportAsPDF;\n    window.exportAsJSON = exportAsJSON;\n\n    // Reset functions\n    window.resetSimulation = resetSimulation;\n    window.resetToDefaults = resetToDefaults;\n    window.resetEverything = resetEverything;\n    window.resetToBaselineData = resetToBaselineData;\n\n    // Saved simulations\n    window.saveSimulation = saveSimulation;\n    window.loadSavedSimulation = loadSavedSimulation;\n    window.deleteSavedSimulation = deleteSavedSimulation;\n    window.showSavedSimulationsModal = showSavedSimulationsModal;\n    window.hideSavedSimulationsModal = hideSavedSimulationsModal;\n    window.clearAllSavedSimulations = clearAllSavedSimulations;\n\n    // Hypothetical indicators\n    window.renderHypotheticalIndicators = renderHypotheticalIndicators;\n    window.updateIndicatorValue = updateIndicatorValue;\n    window.resetIndicator = resetIndicator;\n    window.resetAllHypotheticalIndicators = resetAllHypotheticalIndicators;\n    window.showIndicatorDetails = showIndicatorDetails;\n    window.toggleSourcesDetails = toggleSourcesDetails;\n    window.showCustomIndicatorModal = showCustomIndicatorModal;\n    window.hideCustomIndicatorModal = hideCustomIndicatorModal;\n    window.saveCustomIndicator = saveCustomIndicator;\n    window.deleteCustomIndicator = deleteCustomIndicator;\n\n    // AI functions\n    window.generateAISummary = generateAISummary;\n    window.regenerateAISummary = regenerateAISummary;\n    window.runAdvancedAISimulation = runAdvancedAISimulation;\n    window.showPasswordModal = showPasswordModal;\n    window.hidePasswordModal = hidePasswordModal;\n    window.submitAIPassword = submitAIPassword;\n    window.showAIAnalysis = showAIAnalysis;\n    window.hideAIResultsModal = hideAIResultsModal;\n    window.showTrainingModal = showTrainingModal;\n    window.hideTrainingModal = hideTrainingModal;\n    window.trainModel = trainModel;\n    window.exportTrainingData = exportTrainingData;\n\n    // Comparison functions\n    window.renderComparisonView = renderComparisonView;\n    window.addToComparison = addToComparison;\n    window.clearAllComparisons = clearAllComparisons;\n    window.removeFromComparison = removeFromComparison;\n\n    // Occupation functions\n    window.renderOccupationList = renderOccupationList;\n    window.showOccupationDetails = showOccupationDetails;\n    window.hideOccupationDetails = hideOccupationDetails;\n\n    // Sensitivity functions\n    window.renderSensitivityOverview = renderSensitivityOverview;\n    window.runParameterSensitivity = runParameterSensitivity;\n\n    // Settings functions\n    window.initializeSettings = initializeSettings;\n    window.updateApiStatus = updateApiStatus;\n    window.fetchLiveData = fetchLiveData;\n\n    // Sharing functions\n    window.shareSimulation = shareSimulation;\n    window.showShareButton = showShareButton;\n\n    // Monte Carlo\n    window.runMonteCarloAnalysis = runMonteCarloAnalysis;\n\n    // Mobile menu\n    window.openMobileMenu = openMobileMenu;\n    window.closeMobileMenu = closeMobileMenu;\n\n    // History functions\n    window.showHistoryModal = showHistoryModal;\n    window.hideHistoryModal = hideHistoryModal;\n    window.loadFromHistory = loadFromHistory;\n    window.deleteFromHistory = deleteFromHistory;\n    window.clearAllHistory = clearAllHistory;\n\n    // Theme functions\n    window.toggleTheme = toggleTheme;\n\n    // Notification\n    window.showNotification = showNotification;\n\n    // ABM functions\n    window.runABMSimulation = runABMSimulation;\n    window.runQuickABMTest = runQuickABMTest;\n    window.runABMSensitivityAnalysis = runABMSensitivityAnalysis;\n    window.getABMConfig = getABMConfig;\n    window.toggleInterpretationDetails = toggleInterpretationDetails;\n    window.exportABMResults = exportABMResults;\n}\n\n// Export for ES modules\nexport {\n    initApp,\n    showSection,\n    loadPreset,\n    runSimulation,\n    getCurrentScenario,\n    escapeHtml\n};\n"],"names":["escapeHtml","str","div","dataService","indicators","simulationEngine","interventionSystem","vizManager","currentResults","currentAIAnalysis","isAISimulationResult","DEFAULT_CONFIG","STORAGE_KEY","initApp","setupEventListeners","populateCurrentSnapshot","populateSectorTable","populateInterventionTypes","createHistoricalChart","createSectorChart","updateSavedSimulationsList","updateAISettingsStatus","renderHypotheticalIndicators","renderOccupationList","renderSensitivityOverview","initializeRealMetrics","initializeSettings","checkForSharedSimulation","error","showSection","sectionId","s","snapshot","sectors","tbody","sectorExposure","riskSummary","html","key","data","riskClass","summaryDiv","createRiskLevelChart","types","container","type","historical","ctx","d","loadPreset","preset","config","updateInterventionsList","getCurrentScenario","_a","_b","_c","_d","_e","_f","currentYear","runSimulation","resultsDiv","loadingCard","t","scenario","i","results","displaySimulationResults","showShareButton","calculateAndDisplayBaseline","baselineUnemploymentRate","toggleTargetOptimizer","enabled","controls","actions","initialTarget","savedInterventions","baselineScenario","display","optimizeInterventions","showNotification","targetRate","btn","contentDiv","reductionNeeded","optimization","findOptimalInterventionMix","generateOptimizationResultsHTML","sortedInterventions","a","b","recommendedMix","remainingReduction","totalAnnualCost","totalMultiYearCost","simulationYears","budgetNeeded","actualBudget","actualReduction","achievableReduction","achievableRate","formatCost","n","feasibilityClass","feasibilityText","rec","applyOptimizedInterventions","generateInterventionImpactHTML","interventionSummary","interventions","formatNumber","safePercent","totalJobs","totalEconomic","totalFiscal","avgWageEffect","detailsHTML","jobEffect","wageEffect","economicImpact","fiscalCost","generateDemographicsHTML","demographics","ageGroupsHTML","group","displacement","rate","educationHTML","level","vulnerableHTML","v","recommendationsHTML","target","generateSkillsGapHTML","skillsGap","formatSalary","safeRate","decliningHTML","skill","growingHTML","trainingHTML","skillName","priority","careerOutcomes","firstProgram","duration","cost","provider","transitionsHTML","path","from","paths","downloadPDFReport","originalText","enrichedResults","filename","summary","aiAvailable","comparisonAvailable","canAddToComparison","comparisonCount","comparisonButton","hasEnhancedAnalysis","inlineAIAnalysisHTML","generateInlineAIAnalysisHTML","aiSummarySection","showInterventionModal","updateInterventionParams","hideInterventionModal","params","o","addIntervention","paramDefs","el","quickAddIntervention","intervention","toggleIntervention","id","removeIntervention","exportResults","exportAsPDF","exportAsJSON","blob","url","resetSimulation","resetToDefaults","getSavedSimulations","saved","saveSimulation","name","simulations","simulationToSave","loadSavedSimulation","simulation","hideSavedSimulationsModal","deleteSavedSimulation","event","filtered","recentSimulations","sim","date","showSavedSimulationsModal","modal","time","clearAllSavedSimulations","allIndicators","categoryNames","grouped","ind","cat","category","isAdjusted","isCustom","trendIcon","trendClass","formatIndicatorValue","value","unit","updateIndicatorValue","numValue","slider","input","resetIndicator","resetAllHypotheticalIndicators","showIndicatorDetails","linkedInfo","metric","coef","toggleSourcesDetails","details","showCustomIndicatorModal","hideCustomIndicatorModal","saveCustomIndicator","linkedMetrics","linkageFormula","deleteCustomIndicator","statusDiv","generateAISummary","formattedSummary","para","regenerateAISummary","renderComparisonView","countSpan","clearBtn","count","addToComparison","result","updateComparisonButton","clearAllComparisons","removeFromComparison","showOccupationDetails","occupationId","aiAdoptionRate","targetYear","hideOccupationDetails","runParameterSensitivity","parameterId","baseConfig","analysisResults","renderRealMetrics","renderRealMetricsSources","metricsByCategory","categoryId","formatRealMetricValue","formatRealMetricInput","getMetricStep","sources","source","updateAllApiStatuses","updateAutoDataStatus","initializeGeminiCounter","checkbox","updateGeminiCounterDisplay","stats","totalEl","todayEl","weekEl","lastCallEl","lastTime","timeAgo","getTimeAgo","seconds","liveStatus","formattedDate","updateApiStatus","service","elementId","fetchLiveData","resetEverything","resetToBaselineData","shareSimulation","description","shareBtn","_g","e","sharedId","notification","monteCarloInstance","runMonteCarloAnalysis","content","progress","progressEl","progressBar","displayMonteCarloResults","dist","fmt","decimals","report","createMonteCarloHistogram","canvasId","distribution","label","color","formatAsJobs","histogram","labels","h","val","openMobileMenu","sidebar","overlay","closeMobileMenu","showHistoryModal","renderHistoryList","hideHistoryModal","history","item","loadFromHistory","endYear","targetUR","automationPace","adoptionCurve","deleteFromHistory","clearAllHistory","toggleTheme","newTheme","updateThemeIcon","updateChartTheme","theme","icon","isDark","textColor","gridColor","chart","scaleKey","initTheme","savedTheme","prefersDark","message","colors","isPersistent","messageSpan","dismissBtn","DEFAULT_AI_PASSWORD","AI_USAGE_LIMIT","AI_USAGE_STORAGE_KEY","AI_LIMIT_ALERT_KEY","getAIUsageCount","incrementAIUsageCount","newCount","isAIUsageLimitReached","sendUsageLimitAlert","usageCount","alertData","subject","body","getAIUsageStats","resetAIUsageCount","setAIUsageCount","runAdvancedAISimulation","showPasswordModal","executeAdvancedAISimulation","hidePasswordModal","submitAIPassword","password","simpleInputs","updateAIStatus","enhancedParams","enhancedScenario","createEnhancedScenario","analysis","simId","updateAIModelStatus","statusEl","_h","_i","f","p","displayAIAnalysis","hideAIResultsModal","showAIAnalysis","showTrainingModal","updateTrainingModalStatus","hideTrainingModal","status","trainBtn","messageDiv","trainModel","exportTrainingData","currentABMEngine","currentABMResults","abmCharts","abmWorkerManager","runABMSimulation","updateABMProgress","useWebWorker","runABMWithWorker","displayABMResults","runQuickABMTest","percent","finalUR","initialUR","urChange","finalAI","initialAI","aiChange","netJobs","displayResultsInterpretation","displayPolicySupportResults","renderABMCharts","displayEmergentPatterns","displayABMDemographics","displayRegionalHeatMap","runABMSensitivityAnalysis","getABMConfig","progressDiv","progressText","paramsToAnalyze","overallProgress","policySupport","policyNames","policyIcons","getMomentum","policy","recent","first","change","getFeasibilityLabel","score","isPolicyWindowOpen","feasibleCount","totalPolicies","k","supportPercent","strongSupport","strongOppose","feasibilityScore","feasibility","momentum","windowOpen","mainColor","openWindows","_","detailsContainer","interpretableResults","transformABMResultsForInterpreter","interpretation","overview","outlookColors","quickInsights","finding","statusColors","risk","riskColors","riskColor","detailsHtml","r","levelColor","l","recommendations","priorityBadge","badge","benchmarks","toggleInterpretationDetails","months","urCtx","psCtx","policies","aiCtx","patterns","pattern","severity","finalData","exportABMResults"],"mappings":"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"}