var Eo=Object.defineProperty;var Io=(a,t,e)=>t in a?Eo(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var w=(a,t,e)=>Io(a,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();const Po="modulepreload",Oo=function(a,t){return new URL(a,t).href},wn={},Ro=function(t,e,i){let n=Promise.resolve();if(e&&e.length>0){const o=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=Promise.allSettled(e.map(c=>{if(c=Oo(c,i),c in wn)return;wn[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(!!i)for(let p=o.length-1;p>=0;p--){const g=o[p];if(g.href===c&&(!d||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${h}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":Po,d||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),d)return new Promise((p,g)=>{m.addEventListener("load",p),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o}return n.then(o=>{for(const r of o||[])r.status==="rejected"&&s(r.reason);return t().catch(s)})};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Le(a){return a+.5|0}const Et=(a,t,e)=>Math.max(Math.min(a,e),t);function pe(a){return Et(Le(a*2.55),0,255)}function Tt(a){return Et(Le(a*255),0,255)}function St(a){return Et(Le(a/2.55)/100,0,1)}function Sn(a){return Et(Le(a*100),0,100)}const ct={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ji=[..."0123456789ABCDEF"],To=a=>ji[a&15],Lo=a=>ji[(a&240)>>4]+ji[a&15],je=a=>(a&240)>>4===(a&15),Do=a=>je(a.r)&&je(a.g)&&je(a.b)&&je(a.a);function Fo(a){var t=a.length,e;return a[0]==="#"&&(t===4||t===5?e={r:255&ct[a[1]]*17,g:255&ct[a[2]]*17,b:255&ct[a[3]]*17,a:t===5?ct[a[4]]*17:255}:(t===7||t===9)&&(e={r:ct[a[1]]<<4|ct[a[2]],g:ct[a[3]]<<4|ct[a[4]],b:ct[a[5]]<<4|ct[a[6]],a:t===9?ct[a[7]]<<4|ct[a[8]]:255})),e}const No=(a,t)=>a<255?t(a):"";function jo(a){var t=Do(a)?To:Lo;return a?"#"+t(a.r)+t(a.g)+t(a.b)+No(a.a,t):void 0}const $o=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Ya(a,t,e){const i=t*Math.min(e,1-e),n=(s,o=(s+a/30)%12)=>e-i*Math.max(Math.min(o-3,9-o,1),-1);return[n(0),n(8),n(4)]}function Wo(a,t,e){const i=(n,s=(n+a/60)%6)=>e-e*t*Math.max(Math.min(s,4-s,1),0);return[i(5),i(3),i(1)]}function zo(a,t,e){const i=Ya(a,1,.5);let n;for(t+e>1&&(n=1/(t+e),t*=n,e*=n),n=0;n<3;n++)i[n]*=1-t-e,i[n]+=t;return i}function Ho(a,t,e,i,n){return a===n?(t-e)/i+(t<e?6:0):t===n?(e-a)/i+2:(a-t)/i+4}function an(a){const e=a.r/255,i=a.g/255,n=a.b/255,s=Math.max(e,i,n),o=Math.min(e,i,n),r=(s+o)/2;let l,c,d;return s!==o&&(d=s-o,c=r>.5?d/(2-s-o):d/(s+o),l=Ho(e,i,n,d,s),l=l*60+.5),[l|0,c||0,r]}function sn(a,t,e,i){return(Array.isArray(t)?a(t[0],t[1],t[2]):a(t,e,i)).map(Tt)}function on(a,t,e){return sn(Ya,a,t,e)}function Bo(a,t,e){return sn(zo,a,t,e)}function Uo(a,t,e){return sn(Wo,a,t,e)}function Ga(a){return(a%360+360)%360}function Vo(a){const t=$o.exec(a);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?pe(+t[5]):Tt(+t[5]));const n=Ga(+t[2]),s=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?i=Bo(n,s,o):t[1]==="hsv"?i=Uo(n,s,o):i=on(n,s,o),{r:i[0],g:i[1],b:i[2],a:e}}function Yo(a,t){var e=an(a);e[0]=Ga(e[0]+t),e=on(e),a.r=e[0],a.g=e[1],a.b=e[2]}function Go(a){if(!a)return;const t=an(a),e=t[0],i=Sn(t[1]),n=Sn(t[2]);return a.a<255?`hsla(${e}, ${i}%, ${n}%, ${St(a.a)})`:`hsl(${e}, ${i}%, ${n}%)`}const kn={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Mn={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Jo(){const a={},t=Object.keys(Mn),e=Object.keys(kn);let i,n,s,o,r;for(i=0;i<t.length;i++){for(o=r=t[i],n=0;n<e.length;n++)s=e[n],r=r.replace(s,kn[s]);s=parseInt(Mn[o],16),a[r]=[s>>16&255,s>>8&255,s&255]}return a}let $e;function qo(a){$e||($e=Jo(),$e.transparent=[0,0,0,0]);const t=$e[a.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Ko=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Xo(a){const t=Ko.exec(a);let e=255,i,n,s;if(t){if(t[7]!==i){const o=+t[7];e=t[8]?pe(o):Et(o*255,0,255)}return i=+t[1],n=+t[3],s=+t[5],i=255&(t[2]?pe(i):Et(i,0,255)),n=255&(t[4]?pe(n):Et(n,0,255)),s=255&(t[6]?pe(s):Et(s,0,255)),{r:i,g:n,b:s,a:e}}}function Qo(a){return a&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${St(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`)}const Si=a=>a<=.0031308?a*12.92:Math.pow(a,1/2.4)*1.055-.055,ee=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function Zo(a,t,e){const i=ee(St(a.r)),n=ee(St(a.g)),s=ee(St(a.b));return{r:Tt(Si(i+e*(ee(St(t.r))-i))),g:Tt(Si(n+e*(ee(St(t.g))-n))),b:Tt(Si(s+e*(ee(St(t.b))-s))),a:a.a+e*(t.a-a.a)}}function We(a,t,e){if(a){let i=an(a);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=on(i),a.r=i[0],a.g=i[1],a.b=i[2]}}function Ja(a,t){return a&&Object.assign(t||{},a)}function An(a){var t={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(t={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(t.a=Tt(a[3]))):(t=Ja(a,{r:0,g:0,b:0,a:1}),t.a=Tt(t.a)),t}function tr(a){return a.charAt(0)==="r"?Xo(a):Vo(a)}class Me{constructor(t){if(t instanceof Me)return t;const e=typeof t;let i;e==="object"?i=An(t):e==="string"&&(i=Fo(t)||qo(t)||tr(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Ja(this._rgb);return t&&(t.a=St(t.a)),t}set rgb(t){this._rgb=An(t)}rgbString(){return this._valid?Qo(this._rgb):void 0}hexString(){return this._valid?jo(this._rgb):void 0}hslString(){return this._valid?Go(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,n=t.rgb;let s;const o=e===s?.5:e,r=2*o-1,l=i.a-n.a,c=((r*l===-1?r:(r+l)/(1+r*l))+1)/2;s=1-c,i.r=255&c*i.r+s*n.r+.5,i.g=255&c*i.g+s*n.g+.5,i.b=255&c*i.b+s*n.b+.5,i.a=o*i.a+(1-o)*n.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Zo(this._rgb,t._rgb,e)),this}clone(){return new Me(this.rgb)}alpha(t){return this._rgb.a=Tt(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Le(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return We(this._rgb,2,t),this}darken(t){return We(this._rgb,2,-t),this}saturate(t){return We(this._rgb,1,t),this}desaturate(t){return We(this._rgb,1,-t),this}rotate(t){return Yo(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function vt(){}const er=(()=>{let a=0;return()=>a++})();function R(a){return a==null}function H(a){if(Array.isArray&&Array.isArray(a))return!0;const t=Object.prototype.toString.call(a);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function T(a){return a!==null&&Object.prototype.toString.call(a)==="[object Object]"}function U(a){return(typeof a=="number"||a instanceof Number)&&isFinite(+a)}function lt(a,t){return U(a)?a:t}function E(a,t){return typeof a>"u"?t:a}const ir=(a,t)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100:+a/t,qa=(a,t)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100*t:+a;function j(a,t,e){if(a&&typeof a.call=="function")return a.apply(e,t)}function F(a,t,e,i){let n,s,o;if(H(a))for(s=a.length,n=0;n<s;n++)t.call(e,a[n],n);else if(T(a))for(o=Object.keys(a),s=o.length,n=0;n<s;n++)t.call(e,a[o[n]],o[n])}function ri(a,t){let e,i,n,s;if(!a||!t||a.length!==t.length)return!1;for(e=0,i=a.length;e<i;++e)if(n=a[e],s=t[e],n.datasetIndex!==s.datasetIndex||n.index!==s.index)return!1;return!0}function li(a){if(H(a))return a.map(li);if(T(a)){const t=Object.create(null),e=Object.keys(a),i=e.length;let n=0;for(;n<i;++n)t[e[n]]=li(a[e[n]]);return t}return a}function Ka(a){return["__proto__","prototype","constructor"].indexOf(a)===-1}function nr(a,t,e,i){if(!Ka(a))return;const n=t[a],s=e[a];T(n)&&T(s)?Ae(n,s,i):t[a]=li(s)}function Ae(a,t,e){const i=H(t)?t:[t],n=i.length;if(!T(a))return a;e=e||{};const s=e.merger||nr;let o;for(let r=0;r<n;++r){if(o=i[r],!T(o))continue;const l=Object.keys(o);for(let c=0,d=l.length;c<d;++c)s(l[c],a,o,e)}return a}function ve(a,t){return Ae(a,t,{merger:ar})}function ar(a,t,e){if(!Ka(a))return;const i=t[a],n=e[a];T(i)&&T(n)?ve(i,n):Object.prototype.hasOwnProperty.call(t,a)||(t[a]=li(n))}const Cn={"":a=>a,x:a=>a.x,y:a=>a.y};function sr(a){const t=a.split("."),e=[];let i="";for(const n of t)i+=n,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function or(a){const t=sr(a);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function Lt(a,t){return(Cn[t]||(Cn[t]=or(t)))(a)}function rn(a){return a.charAt(0).toUpperCase()+a.slice(1)}const Ce=a=>typeof a<"u",Dt=a=>typeof a=="function",En=(a,t)=>{if(a.size!==t.size)return!1;for(const e of a)if(!t.has(e))return!1;return!0};function rr(a){return a.type==="mouseup"||a.type==="click"||a.type==="contextmenu"}const D=Math.PI,$=2*D,lr=$+D,ci=Number.POSITIVE_INFINITY,cr=D/180,G=D/2,$t=D/4,In=D*2/3,It=Math.log10,bt=Math.sign;function xe(a,t,e){return Math.abs(a-t)<e}function Pn(a){const t=Math.round(a);a=xe(a,t,a/1e3)?t:a;const e=Math.pow(10,Math.floor(It(a))),i=a/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function dr(a){const t=[],e=Math.sqrt(a);let i;for(i=1;i<e;i++)a%i===0&&(t.push(i),t.push(a/i));return e===(e|0)&&t.push(e),t.sort((n,s)=>n-s).pop(),t}function hr(a){return typeof a=="symbol"||typeof a=="object"&&a!==null&&!(Symbol.toPrimitive in a||"toString"in a||"valueOf"in a)}function ae(a){return!hr(a)&&!isNaN(parseFloat(a))&&isFinite(a)}function ur(a,t){const e=Math.round(a);return e-t<=a&&e+t>=a}function Xa(a,t,e){let i,n,s;for(i=0,n=a.length;i<n;i++)s=a[i][e],isNaN(s)||(t.min=Math.min(t.min,s),t.max=Math.max(t.max,s))}function mt(a){return a*(D/180)}function ln(a){return a*(180/D)}function On(a){if(!U(a))return;let t=1,e=0;for(;Math.round(a*t)/t!==a;)t*=10,e++;return e}function Qa(a,t){const e=t.x-a.x,i=t.y-a.y,n=Math.sqrt(e*e+i*i);let s=Math.atan2(i,e);return s<-.5*D&&(s+=$),{angle:s,distance:n}}function $i(a,t){return Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2))}function mr(a,t){return(a-t+lr)%$-D}function it(a){return(a%$+$)%$}function Ee(a,t,e,i){const n=it(a),s=it(t),o=it(e),r=it(s-n),l=it(o-n),c=it(n-s),d=it(n-o);return n===s||n===o||i&&s===o||r>l&&c<d}function X(a,t,e){return Math.max(t,Math.min(e,a))}function pr(a){return X(a,-32768,32767)}function kt(a,t,e,i=1e-6){return a>=Math.min(t,e)-i&&a<=Math.max(t,e)+i}function cn(a,t,e){e=e||(o=>a[o]<t);let i=a.length-1,n=0,s;for(;i-n>1;)s=n+i>>1,e(s)?n=s:i=s;return{lo:n,hi:i}}const Mt=(a,t,e,i)=>cn(a,e,i?n=>{const s=a[n][t];return s<e||s===e&&a[n+1][t]===e}:n=>a[n][t]<e),gr=(a,t,e)=>cn(a,e,i=>a[i][t]>=e);function fr(a,t,e){let i=0,n=a.length;for(;i<n&&a[i]<t;)i++;for(;n>i&&a[n-1]>e;)n--;return i>0||n<a.length?a.slice(i,n):a}const Za=["push","pop","shift","splice","unshift"];function yr(a,t){if(a._chartjs){a._chartjs.listeners.push(t);return}Object.defineProperty(a,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Za.forEach(e=>{const i="_onData"+rn(e),n=a[e];Object.defineProperty(a,e,{configurable:!0,enumerable:!1,value(...s){const o=n.apply(this,s);return a._chartjs.listeners.forEach(r=>{typeof r[i]=="function"&&r[i](...s)}),o}})})}function Rn(a,t){const e=a._chartjs;if(!e)return;const i=e.listeners,n=i.indexOf(t);n!==-1&&i.splice(n,1),!(i.length>0)&&(Za.forEach(s=>{delete a[s]}),delete a._chartjs)}function ts(a){const t=new Set(a);return t.size===a.length?a:Array.from(t)}const es=function(){return typeof window>"u"?function(a){return a()}:window.requestAnimationFrame}();function is(a,t){let e=[],i=!1;return function(...n){e=n,i||(i=!0,es.call(window,()=>{i=!1,a.apply(t,e)}))}}function _r(a,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(a,t,i)):a.apply(this,i),t}}const dn=a=>a==="start"?"left":a==="end"?"right":"center",et=(a,t,e)=>a==="start"?t:a==="end"?e:(t+e)/2,br=(a,t,e,i)=>a===(i?"left":"right")?e:a==="center"?(t+e)/2:t;function ns(a,t,e){const i=t.length;let n=0,s=i;if(a._sorted){const{iScale:o,vScale:r,_parsed:l}=a,c=a.dataset&&a.dataset.options?a.dataset.options.spanGaps:null,d=o.axis,{min:h,max:u,minDefined:m,maxDefined:p}=o.getUserBounds();if(m){if(n=Math.min(Mt(l,d,h).lo,e?i:Mt(t,d,o.getPixelForValue(h)).lo),c){const g=l.slice(0,n+1).reverse().findIndex(f=>!R(f[r.axis]));n-=Math.max(0,g)}n=X(n,0,i-1)}if(p){let g=Math.max(Mt(l,o.axis,u,!0).hi+1,e?0:Mt(t,d,o.getPixelForValue(u),!0).hi+1);if(c){const f=l.slice(g-1).findIndex(y=>!R(y[r.axis]));g+=Math.max(0,f)}s=X(g,n,i)-n}else s=i-n}return{start:n,count:s}}function as(a){const{xScale:t,yScale:e,_scaleRanges:i}=a,n={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return a._scaleRanges=n,!0;const s=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,n),s}const ze=a=>a===0||a===1,Tn=(a,t,e)=>-(Math.pow(2,10*(a-=1))*Math.sin((a-t)*$/e)),Ln=(a,t,e)=>Math.pow(2,-10*a)*Math.sin((a-t)*$/e)+1,we={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>-Math.cos(a*G)+1,easeOutSine:a=>Math.sin(a*G),easeInOutSine:a=>-.5*(Math.cos(D*a)-1),easeInExpo:a=>a===0?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>a===1?1:-Math.pow(2,-10*a)+1,easeInOutExpo:a=>ze(a)?a:a<.5?.5*Math.pow(2,10*(a*2-1)):.5*(-Math.pow(2,-10*(a*2-1))+2),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>ze(a)?a:Tn(a,.075,.3),easeOutElastic:a=>ze(a)?a:Ln(a,.075,.3),easeInOutElastic(a){return ze(a)?a:a<.5?.5*Tn(a*2,.1125,.45):.5+.5*Ln(a*2-1,.1125,.45)},easeInBack(a){return a*a*((1.70158+1)*a-1.70158)},easeOutBack(a){return(a-=1)*a*((1.70158+1)*a+1.70158)+1},easeInOutBack(a){let t=1.70158;return(a/=.5)<1?.5*(a*a*(((t*=1.525)+1)*a-t)):.5*((a-=2)*a*(((t*=1.525)+1)*a+t)+2)},easeInBounce:a=>1-we.easeOutBounce(1-a),easeOutBounce(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInOutBounce:a=>a<.5?we.easeInBounce(a*2)*.5:we.easeOutBounce(a*2-1)*.5+.5};function hn(a){if(a&&typeof a=="object"){const t=a.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Dn(a){return hn(a)?a:new Me(a)}function ki(a){return hn(a)?a:new Me(a).saturate(.5).darken(.1).hexString()}const vr=["x","y","borderWidth","radius","tension"],xr=["color","borderColor","backgroundColor"];function wr(a){a.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),a.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),a.set("animations",{colors:{type:"color",properties:xr},numbers:{type:"number",properties:vr}}),a.describe("animations",{_fallback:"animation"}),a.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Sr(a){a.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Fn=new Map;function kr(a,t){t=t||{};const e=a+JSON.stringify(t);let i=Fn.get(e);return i||(i=new Intl.NumberFormat(a,t),Fn.set(e,i)),i}function De(a,t,e){return kr(t,e).format(a)}const ss={values(a){return H(a)?a:""+a},numeric(a,t,e){if(a===0)return"0";const i=this.chart.options.locale;let n,s=a;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(n="scientific"),s=Mr(a,e)}const o=It(Math.abs(s)),r=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:n,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(l,this.options.ticks.format),De(a,i,l)},logarithmic(a,t,e){if(a===0)return"0";const i=e[t].significand||a/Math.pow(10,Math.floor(It(a)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?ss.numeric.call(this,a,t,e):""}};function Mr(a,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&a!==Math.floor(a)&&(e=a-Math.floor(a)),e}var fi={formatters:ss};function Ar(a){a.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:fi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),a.route("scale.ticks","color","","color"),a.route("scale.grid","color","","borderColor"),a.route("scale.border","color","","borderColor"),a.route("scale.title","color","","color"),a.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),a.describe("scales",{_fallback:"scale"}),a.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Kt=Object.create(null),Wi=Object.create(null);function Se(a,t){if(!t)return a;const e=t.split(".");for(let i=0,n=e.length;i<n;++i){const s=e[i];a=a[s]||(a[s]=Object.create(null))}return a}function Mi(a,t,e){return typeof t=="string"?Ae(Se(a,t),e):Ae(Se(a,""),t)}class Cr{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,n)=>ki(n.backgroundColor),this.hoverBorderColor=(i,n)=>ki(n.borderColor),this.hoverColor=(i,n)=>ki(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Mi(this,t,e)}get(t){return Se(this,t)}describe(t,e){return Mi(Wi,t,e)}override(t,e){return Mi(Kt,t,e)}route(t,e,i,n){const s=Se(this,t),o=Se(this,i),r="_"+e;Object.defineProperties(s,{[r]:{value:s[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[r],c=o[n];return T(l)?Object.assign({},c,l):E(l,c)},set(l){this[r]=l}}})}apply(t){t.forEach(e=>e(this))}}var B=new Cr({_scriptable:a=>!a.startsWith("on"),_indexable:a=>a!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[wr,Sr,Ar]);function Er(a){return!a||R(a.size)||R(a.family)?null:(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family}function di(a,t,e,i,n){let s=t[n];return s||(s=t[n]=a.measureText(n).width,e.push(n)),s>i&&(i=s),i}function Ir(a,t,e,i){i=i||{};let n=i.data=i.data||{},s=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(n=i.data={},s=i.garbageCollect=[],i.font=t),a.save(),a.font=t;let o=0;const r=e.length;let l,c,d,h,u;for(l=0;l<r;l++)if(h=e[l],h!=null&&!H(h))o=di(a,n,s,o,h);else if(H(h))for(c=0,d=h.length;c<d;c++)u=h[c],u!=null&&!H(u)&&(o=di(a,n,s,o,u));a.restore();const m=s.length/2;if(m>e.length){for(l=0;l<m;l++)delete n[s[l]];s.splice(0,m)}return o}function Wt(a,t,e){const i=a.currentDevicePixelRatio,n=e!==0?Math.max(e/2,.5):0;return Math.round((t-n)*i)/i+n}function Nn(a,t){!t&&!a||(t=t||a.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,a.width,a.height),t.restore())}function zi(a,t,e,i){os(a,t,e,i,null)}function os(a,t,e,i,n){let s,o,r,l,c,d,h,u;const m=t.pointStyle,p=t.rotation,g=t.radius;let f=(p||0)*cr;if(m&&typeof m=="object"&&(s=m.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){a.save(),a.translate(e,i),a.rotate(f),a.drawImage(m,-m.width/2,-m.height/2,m.width,m.height),a.restore();return}if(!(isNaN(g)||g<=0)){switch(a.beginPath(),m){default:n?a.ellipse(e,i,n/2,g,0,0,$):a.arc(e,i,g,0,$),a.closePath();break;case"triangle":d=n?n/2:g,a.moveTo(e+Math.sin(f)*d,i-Math.cos(f)*g),f+=In,a.lineTo(e+Math.sin(f)*d,i-Math.cos(f)*g),f+=In,a.lineTo(e+Math.sin(f)*d,i-Math.cos(f)*g),a.closePath();break;case"rectRounded":c=g*.516,l=g-c,o=Math.cos(f+$t)*l,h=Math.cos(f+$t)*(n?n/2-c:l),r=Math.sin(f+$t)*l,u=Math.sin(f+$t)*(n?n/2-c:l),a.arc(e-h,i-r,c,f-D,f-G),a.arc(e+u,i-o,c,f-G,f),a.arc(e+h,i+r,c,f,f+G),a.arc(e-u,i+o,c,f+G,f+D),a.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*g,d=n?n/2:l,a.rect(e-d,i-l,2*d,2*l);break}f+=$t;case"rectRot":h=Math.cos(f)*(n?n/2:g),o=Math.cos(f)*g,r=Math.sin(f)*g,u=Math.sin(f)*(n?n/2:g),a.moveTo(e-h,i-r),a.lineTo(e+u,i-o),a.lineTo(e+h,i+r),a.lineTo(e-u,i+o),a.closePath();break;case"crossRot":f+=$t;case"cross":h=Math.cos(f)*(n?n/2:g),o=Math.cos(f)*g,r=Math.sin(f)*g,u=Math.sin(f)*(n?n/2:g),a.moveTo(e-h,i-r),a.lineTo(e+h,i+r),a.moveTo(e+u,i-o),a.lineTo(e-u,i+o);break;case"star":h=Math.cos(f)*(n?n/2:g),o=Math.cos(f)*g,r=Math.sin(f)*g,u=Math.sin(f)*(n?n/2:g),a.moveTo(e-h,i-r),a.lineTo(e+h,i+r),a.moveTo(e+u,i-o),a.lineTo(e-u,i+o),f+=$t,h=Math.cos(f)*(n?n/2:g),o=Math.cos(f)*g,r=Math.sin(f)*g,u=Math.sin(f)*(n?n/2:g),a.moveTo(e-h,i-r),a.lineTo(e+h,i+r),a.moveTo(e+u,i-o),a.lineTo(e-u,i+o);break;case"line":o=n?n/2:Math.cos(f)*g,r=Math.sin(f)*g,a.moveTo(e-o,i-r),a.lineTo(e+o,i+r);break;case"dash":a.moveTo(e,i),a.lineTo(e+Math.cos(f)*(n?n/2:g),i+Math.sin(f)*g);break;case!1:a.closePath();break}a.fill(),t.borderWidth>0&&a.stroke()}}function At(a,t,e){return e=e||.5,!t||a&&a.x>t.left-e&&a.x<t.right+e&&a.y>t.top-e&&a.y<t.bottom+e}function yi(a,t){a.save(),a.beginPath(),a.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),a.clip()}function _i(a){a.restore()}function Pr(a,t,e,i,n){if(!t)return a.lineTo(e.x,e.y);if(n==="middle"){const s=(t.x+e.x)/2;a.lineTo(s,t.y),a.lineTo(s,e.y)}else n==="after"!=!!i?a.lineTo(t.x,e.y):a.lineTo(e.x,t.y);a.lineTo(e.x,e.y)}function Or(a,t,e,i){if(!t)return a.lineTo(e.x,e.y);a.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function Rr(a,t){t.translation&&a.translate(t.translation[0],t.translation[1]),R(t.rotation)||a.rotate(t.rotation),t.color&&(a.fillStyle=t.color),t.textAlign&&(a.textAlign=t.textAlign),t.textBaseline&&(a.textBaseline=t.textBaseline)}function Tr(a,t,e,i,n){if(n.strikethrough||n.underline){const s=a.measureText(i),o=t-s.actualBoundingBoxLeft,r=t+s.actualBoundingBoxRight,l=e-s.actualBoundingBoxAscent,c=e+s.actualBoundingBoxDescent,d=n.strikethrough?(l+c)/2:c;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=n.decorationWidth||2,a.moveTo(o,d),a.lineTo(r,d),a.stroke()}}function Lr(a,t){const e=a.fillStyle;a.fillStyle=t.color,a.fillRect(t.left,t.top,t.width,t.height),a.fillStyle=e}function Xt(a,t,e,i,n,s={}){const o=H(t)?t:[t],r=s.strokeWidth>0&&s.strokeColor!=="";let l,c;for(a.save(),a.font=n.string,Rr(a,s),l=0;l<o.length;++l)c=o[l],s.backdrop&&Lr(a,s.backdrop),r&&(s.strokeColor&&(a.strokeStyle=s.strokeColor),R(s.strokeWidth)||(a.lineWidth=s.strokeWidth),a.strokeText(c,e,i,s.maxWidth)),a.fillText(c,e,i,s.maxWidth),Tr(a,e,i,c,s),i+=Number(n.lineHeight);a.restore()}function Ie(a,t){const{x:e,y:i,w:n,h:s,radius:o}=t;a.arc(e+o.topLeft,i+o.topLeft,o.topLeft,1.5*D,D,!0),a.lineTo(e,i+s-o.bottomLeft),a.arc(e+o.bottomLeft,i+s-o.bottomLeft,o.bottomLeft,D,G,!0),a.lineTo(e+n-o.bottomRight,i+s),a.arc(e+n-o.bottomRight,i+s-o.bottomRight,o.bottomRight,G,0,!0),a.lineTo(e+n,i+o.topRight),a.arc(e+n-o.topRight,i+o.topRight,o.topRight,0,-G,!0),a.lineTo(e+o.topLeft,i)}const Dr=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Fr=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Nr(a,t){const e=(""+a).match(Dr);if(!e||e[1]==="normal")return t*1.2;switch(a=+e[2],e[3]){case"px":return a;case"%":a/=100;break}return t*a}const jr=a=>+a||0;function un(a,t){const e={},i=T(t),n=i?Object.keys(t):t,s=T(a)?i?o=>E(a[o],a[t[o]]):o=>a[o]:()=>a;for(const o of n)e[o]=jr(s(o));return e}function rs(a){return un(a,{top:"y",right:"x",bottom:"y",left:"x"})}function Jt(a){return un(a,["topLeft","topRight","bottomLeft","bottomRight"])}function at(a){const t=rs(a);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function K(a,t){a=a||{},t=t||B.font;let e=E(a.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=E(a.style,t.style);i&&!(""+i).match(Fr)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const n={family:E(a.family,t.family),lineHeight:Nr(E(a.lineHeight,t.lineHeight),e),size:e,style:i,weight:E(a.weight,t.weight),string:""};return n.string=Er(n),n}function ge(a,t,e,i){let n,s,o;for(n=0,s=a.length;n<s;++n)if(o=a[n],o!==void 0&&o!==void 0)return o}function $r(a,t,e){const{min:i,max:n}=a,s=qa(t,(n-i)/2),o=(r,l)=>e&&r===0?0:r+l;return{min:o(i,-Math.abs(s)),max:o(n,s)}}function Ft(a,t){return Object.assign(Object.create(a),t)}function mn(a,t=[""],e,i,n=()=>a[0]){const s=e||a;typeof i>"u"&&(i=hs("_fallback",a));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:s,_fallback:i,_getTarget:n,override:r=>mn([r,...a],t,s,i)};return new Proxy(o,{deleteProperty(r,l){return delete r[l],delete r._keys,delete a[0][l],!0},get(r,l){return cs(r,l,()=>Gr(l,t,a,r))},getOwnPropertyDescriptor(r,l){return Reflect.getOwnPropertyDescriptor(r._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(a[0])},has(r,l){return $n(r).includes(l)},ownKeys(r){return $n(r)},set(r,l,c){const d=r._storage||(r._storage=n());return r[l]=d[l]=c,delete r._keys,!0}})}function se(a,t,e,i){const n={_cacheable:!1,_proxy:a,_context:t,_subProxy:e,_stack:new Set,_descriptors:ls(a,i),setContext:s=>se(a,s,e,i),override:s=>se(a.override(s),t,e,i)};return new Proxy(n,{deleteProperty(s,o){return delete s[o],delete a[o],!0},get(s,o,r){return cs(s,o,()=>zr(s,o,r))},getOwnPropertyDescriptor(s,o){return s._descriptors.allKeys?Reflect.has(a,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,o)},getPrototypeOf(){return Reflect.getPrototypeOf(a)},has(s,o){return Reflect.has(a,o)},ownKeys(){return Reflect.ownKeys(a)},set(s,o,r){return a[o]=r,delete s[o],!0}})}function ls(a,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:n=t.allKeys}=a;return{allKeys:n,scriptable:e,indexable:i,isScriptable:Dt(e)?e:()=>e,isIndexable:Dt(i)?i:()=>i}}const Wr=(a,t)=>a?a+rn(t):t,pn=(a,t)=>T(t)&&a!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function cs(a,t,e){if(Object.prototype.hasOwnProperty.call(a,t)||t==="constructor")return a[t];const i=e();return a[t]=i,i}function zr(a,t,e){const{_proxy:i,_context:n,_subProxy:s,_descriptors:o}=a;let r=i[t];return Dt(r)&&o.isScriptable(t)&&(r=Hr(t,r,a,e)),H(r)&&r.length&&(r=Br(t,r,a,o.isIndexable)),pn(t,r)&&(r=se(r,n,s&&s[t],o)),r}function Hr(a,t,e,i){const{_proxy:n,_context:s,_subProxy:o,_stack:r}=e;if(r.has(a))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+a);r.add(a);let l=t(s,o||i);return r.delete(a),pn(a,l)&&(l=gn(n._scopes,n,a,l)),l}function Br(a,t,e,i){const{_proxy:n,_context:s,_subProxy:o,_descriptors:r}=e;if(typeof s.index<"u"&&i(a))return t[s.index%t.length];if(T(t[0])){const l=t,c=n._scopes.filter(d=>d!==l);t=[];for(const d of l){const h=gn(c,n,a,d);t.push(se(h,s,o&&o[a],r))}}return t}function ds(a,t,e){return Dt(a)?a(t,e):a}const Ur=(a,t)=>a===!0?t:typeof a=="string"?Lt(t,a):void 0;function Vr(a,t,e,i,n){for(const s of t){const o=Ur(e,s);if(o){a.add(o);const r=ds(o._fallback,e,n);if(typeof r<"u"&&r!==e&&r!==i)return r}else if(o===!1&&typeof i<"u"&&e!==i)return null}return!1}function gn(a,t,e,i){const n=t._rootScopes,s=ds(t._fallback,e,i),o=[...a,...n],r=new Set;r.add(i);let l=jn(r,o,e,s||e,i);return l===null||typeof s<"u"&&s!==e&&(l=jn(r,o,s,l,i),l===null)?!1:mn(Array.from(r),[""],n,s,()=>Yr(t,e,i))}function jn(a,t,e,i,n){for(;e;)e=Vr(a,t,e,i,n);return e}function Yr(a,t,e){const i=a._getTarget();t in i||(i[t]={});const n=i[t];return H(n)&&T(e)?e:n||{}}function Gr(a,t,e,i){let n;for(const s of t)if(n=hs(Wr(s,a),e),typeof n<"u")return pn(a,n)?gn(e,i,a,n):n}function hs(a,t){for(const e of t){if(!e)continue;const i=e[a];if(typeof i<"u")return i}}function $n(a){let t=a._keys;return t||(t=a._keys=Jr(a._scopes)),t}function Jr(a){const t=new Set;for(const e of a)for(const i of Object.keys(e).filter(n=>!n.startsWith("_")))t.add(i);return Array.from(t)}function us(a,t,e,i){const{iScale:n}=a,{key:s="r"}=this._parsing,o=new Array(i);let r,l,c,d;for(r=0,l=i;r<l;++r)c=r+e,d=t[c],o[r]={r:n.parse(Lt(d,s),c)};return o}const qr=Number.EPSILON||1e-14,oe=(a,t)=>t<a.length&&!a[t].skip&&a[t],ms=a=>a==="x"?"y":"x";function Kr(a,t,e,i){const n=a.skip?t:a,s=t,o=e.skip?t:e,r=$i(s,n),l=$i(o,s);let c=r/(r+l),d=l/(r+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const h=i*c,u=i*d;return{previous:{x:s.x-h*(o.x-n.x),y:s.y-h*(o.y-n.y)},next:{x:s.x+u*(o.x-n.x),y:s.y+u*(o.y-n.y)}}}function Xr(a,t,e){const i=a.length;let n,s,o,r,l,c=oe(a,0);for(let d=0;d<i-1;++d)if(l=c,c=oe(a,d+1),!(!l||!c)){if(xe(t[d],0,qr)){e[d]=e[d+1]=0;continue}n=e[d]/t[d],s=e[d+1]/t[d],r=Math.pow(n,2)+Math.pow(s,2),!(r<=9)&&(o=3/Math.sqrt(r),e[d]=n*o*t[d],e[d+1]=s*o*t[d])}}function Qr(a,t,e="x"){const i=ms(e),n=a.length;let s,o,r,l=oe(a,0);for(let c=0;c<n;++c){if(o=r,r=l,l=oe(a,c+1),!r)continue;const d=r[e],h=r[i];o&&(s=(d-o[e])/3,r[`cp1${e}`]=d-s,r[`cp1${i}`]=h-s*t[c]),l&&(s=(l[e]-d)/3,r[`cp2${e}`]=d+s,r[`cp2${i}`]=h+s*t[c])}}function Zr(a,t="x"){const e=ms(t),i=a.length,n=Array(i).fill(0),s=Array(i);let o,r,l,c=oe(a,0);for(o=0;o<i;++o)if(r=l,l=c,c=oe(a,o+1),!!l){if(c){const d=c[t]-l[t];n[o]=d!==0?(c[e]-l[e])/d:0}s[o]=r?c?bt(n[o-1])!==bt(n[o])?0:(n[o-1]+n[o])/2:n[o-1]:n[o]}Xr(a,n,s),Qr(a,s,t)}function He(a,t,e){return Math.max(Math.min(a,e),t)}function tl(a,t){let e,i,n,s,o,r=At(a[0],t);for(e=0,i=a.length;e<i;++e)o=s,s=r,r=e<i-1&&At(a[e+1],t),s&&(n=a[e],o&&(n.cp1x=He(n.cp1x,t.left,t.right),n.cp1y=He(n.cp1y,t.top,t.bottom)),r&&(n.cp2x=He(n.cp2x,t.left,t.right),n.cp2y=He(n.cp2y,t.top,t.bottom)))}function el(a,t,e,i,n){let s,o,r,l;if(t.spanGaps&&(a=a.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")Zr(a,n);else{let c=i?a[a.length-1]:a[0];for(s=0,o=a.length;s<o;++s)r=a[s],l=Kr(c,r,a[Math.min(s+1,o-(i?0:1))%o],t.tension),r.cp1x=l.previous.x,r.cp1y=l.previous.y,r.cp2x=l.next.x,r.cp2y=l.next.y,c=r}t.capBezierPoints&&tl(a,e)}function fn(){return typeof window<"u"&&typeof document<"u"}function yn(a){let t=a.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function hi(a,t,e){let i;return typeof a=="string"?(i=parseInt(a,10),a.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=a,i}const bi=a=>a.ownerDocument.defaultView.getComputedStyle(a,null);function il(a,t){return bi(a).getPropertyValue(t)}const nl=["top","right","bottom","left"];function qt(a,t,e){const i={};e=e?"-"+e:"";for(let n=0;n<4;n++){const s=nl[n];i[s]=parseFloat(a[t+"-"+s+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const al=(a,t,e)=>(a>0||t>0)&&(!e||!e.shadowRoot);function sl(a,t){const e=a.touches,i=e&&e.length?e[0]:a,{offsetX:n,offsetY:s}=i;let o=!1,r,l;if(al(n,s,a.target))r=n,l=s;else{const c=t.getBoundingClientRect();r=i.clientX-c.left,l=i.clientY-c.top,o=!0}return{x:r,y:l,box:o}}function Bt(a,t){if("native"in a)return a;const{canvas:e,currentDevicePixelRatio:i}=t,n=bi(e),s=n.boxSizing==="border-box",o=qt(n,"padding"),r=qt(n,"border","width"),{x:l,y:c,box:d}=sl(a,e),h=o.left+(d&&r.left),u=o.top+(d&&r.top);let{width:m,height:p}=t;return s&&(m-=o.width+r.width,p-=o.height+r.height),{x:Math.round((l-h)/m*e.width/i),y:Math.round((c-u)/p*e.height/i)}}function ol(a,t,e){let i,n;if(t===void 0||e===void 0){const s=a&&yn(a);if(!s)t=a.clientWidth,e=a.clientHeight;else{const o=s.getBoundingClientRect(),r=bi(s),l=qt(r,"border","width"),c=qt(r,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,i=hi(r.maxWidth,s,"clientWidth"),n=hi(r.maxHeight,s,"clientHeight")}}return{width:t,height:e,maxWidth:i||ci,maxHeight:n||ci}}const Pt=a=>Math.round(a*10)/10;function rl(a,t,e,i){const n=bi(a),s=qt(n,"margin"),o=hi(n.maxWidth,a,"clientWidth")||ci,r=hi(n.maxHeight,a,"clientHeight")||ci,l=ol(a,t,e);let{width:c,height:d}=l;if(n.boxSizing==="content-box"){const u=qt(n,"border","width"),m=qt(n,"padding");c-=m.width+u.width,d-=m.height+u.height}return c=Math.max(0,c-s.width),d=Math.max(0,i?c/i:d-s.height),c=Pt(Math.min(c,o,l.maxWidth)),d=Pt(Math.min(d,r,l.maxHeight)),c&&!d&&(d=Pt(c/2)),(t!==void 0||e!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Pt(Math.floor(d*i))),{width:c,height:d}}function Wn(a,t,e){const i=t||1,n=Pt(a.height*i),s=Pt(a.width*i);a.height=Pt(a.height),a.width=Pt(a.width);const o=a.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${a.height}px`,o.style.width=`${a.width}px`),a.currentDevicePixelRatio!==i||o.height!==n||o.width!==s?(a.currentDevicePixelRatio=i,o.height=n,o.width=s,a.ctx.setTransform(i,0,0,i,0,0),!0):!1}const ll=function(){let a=!1;try{const t={get passive(){return a=!0,!1}};fn()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return a}();function zn(a,t){const e=il(a,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Ut(a,t,e,i){return{x:a.x+e*(t.x-a.x),y:a.y+e*(t.y-a.y)}}function cl(a,t,e,i){return{x:a.x+e*(t.x-a.x),y:i==="middle"?e<.5?a.y:t.y:i==="after"?e<1?a.y:t.y:e>0?t.y:a.y}}function dl(a,t,e,i){const n={x:a.cp2x,y:a.cp2y},s={x:t.cp1x,y:t.cp1y},o=Ut(a,n,e),r=Ut(n,s,e),l=Ut(s,t,e),c=Ut(o,r,e),d=Ut(r,l,e);return Ut(c,d,e)}const hl=function(a,t){return{x(e){return a+a+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},ul=function(){return{x(a){return a},setWidth(a){},textAlign(a){return a},xPlus(a,t){return a+t},leftForLtr(a,t){return a}}};function ne(a,t,e){return a?hl(t,e):ul()}function ps(a,t){let e,i;(t==="ltr"||t==="rtl")&&(e=a.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),a.prevTextDirection=i)}function gs(a,t){t!==void 0&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",t[0],t[1]))}function fs(a){return a==="angle"?{between:Ee,compare:mr,normalize:it}:{between:kt,compare:(t,e)=>t-e,normalize:t=>t}}function Hn({start:a,end:t,count:e,loop:i,style:n}){return{start:a%e,end:t%e,loop:i&&(t-a+1)%e===0,style:n}}function ml(a,t,e){const{property:i,start:n,end:s}=e,{between:o,normalize:r}=fs(i),l=t.length;let{start:c,end:d,loop:h}=a,u,m;if(h){for(c+=l,d+=l,u=0,m=l;u<m&&o(r(t[c%l][i]),n,s);++u)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:h,style:a.style}}function ys(a,t,e){if(!e)return[a];const{property:i,start:n,end:s}=e,o=t.length,{compare:r,between:l,normalize:c}=fs(i),{start:d,end:h,loop:u,style:m}=ml(a,t,e),p=[];let g=!1,f=null,y,_,b;const x=()=>l(n,b,y)&&r(n,b)!==0,v=()=>r(s,y)===0||l(s,b,y),S=()=>g||x(),k=()=>!g||v();for(let M=d,C=d;M<=h;++M)_=t[M%o],!_.skip&&(y=c(_[i]),y!==b&&(g=l(y,n,s),f===null&&S()&&(f=r(y,n)===0?M:C),f!==null&&k()&&(p.push(Hn({start:f,end:M,loop:u,count:o,style:m})),f=null),C=M,b=y));return f!==null&&p.push(Hn({start:f,end:h,loop:u,count:o,style:m})),p}function _s(a,t){const e=[],i=a.segments;for(let n=0;n<i.length;n++){const s=ys(i[n],a.points,t);s.length&&e.push(...s)}return e}function pl(a,t,e,i){let n=0,s=t-1;if(e&&!i)for(;n<t&&!a[n].skip;)n++;for(;n<t&&a[n].skip;)n++;for(n%=t,e&&(s+=n);s>n&&a[s%t].skip;)s--;return s%=t,{start:n,end:s}}function gl(a,t,e,i){const n=a.length,s=[];let o=t,r=a[t],l;for(l=t+1;l<=e;++l){const c=a[l%n];c.skip||c.stop?r.skip||(i=!1,s.push({start:t%n,end:(l-1)%n,loop:i}),t=o=c.stop?l:null):(o=l,r.skip&&(t=l)),r=c}return o!==null&&s.push({start:t%n,end:o%n,loop:i}),s}function fl(a,t){const e=a.points,i=a.options.spanGaps,n=e.length;if(!n)return[];const s=!!a._loop,{start:o,end:r}=pl(e,n,s,i);if(i===!0)return Bn(a,[{start:o,end:r,loop:s}],e,t);const l=r<o?r+n:r,c=!!a._fullLoop&&o===0&&r===n-1;return Bn(a,gl(e,o,l,c),e,t)}function Bn(a,t,e,i){return!i||!i.setContext||!e?t:yl(a,t,e,i)}function yl(a,t,e,i){const n=a._chart.getContext(),s=Un(a.options),{_datasetIndex:o,options:{spanGaps:r}}=a,l=e.length,c=[];let d=s,h=t[0].start,u=h;function m(p,g,f,y){const _=r?-1:1;if(p!==g){for(p+=l;e[p%l].skip;)p-=_;for(;e[g%l].skip;)g+=_;p%l!==g%l&&(c.push({start:p%l,end:g%l,loop:f,style:y}),d=y,h=g%l)}}for(const p of t){h=r?h:p.start;let g=e[h%l],f;for(u=h+1;u<=p.end;u++){const y=e[u%l];f=Un(i.setContext(Ft(n,{type:"segment",p0:g,p1:y,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:o}))),_l(f,d)&&m(h,u-1,p.loop,d),g=y,d=f}h<u-1&&m(h,u-1,p.loop,d)}return c}function Un(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function _l(a,t){if(!t)return!1;const e=[],i=function(n,s){return hn(s)?(e.includes(s)||e.push(s),e.indexOf(s)):s};return JSON.stringify(a,i)!==JSON.stringify(t,i)}function Be(a,t,e){return a.options.clip?a[e]:t[e]}function bl(a,t){const{xScale:e,yScale:i}=a;return e&&i?{left:Be(e,t,"left"),right:Be(e,t,"right"),top:Be(i,t,"top"),bottom:Be(i,t,"bottom")}:t}function bs(a,t){const e=t._clip;if(e.disabled)return!1;const i=bl(t,a.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?a.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?a.height:i.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class vl{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,n){const s=e.listeners[n],o=e.duration;s.forEach(r=>r({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=es.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,n)=>{if(!i.running||!i.items.length)return;const s=i.items;let o=s.length-1,r=!1,l;for(;o>=0;--o)l=s[o],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),r=!0):(s[o]=s[s.length-1],s.pop());r&&(n.draw(),this._notify(n,i,t,"progress")),s.length||(i.running=!1,this._notify(n,i,t,"complete"),i.initial=!1),e+=s.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,n)=>Math.max(i,n._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var xt=new vl;const Vn="transparent",xl={boolean(a,t,e){return e>.5?t:a},color(a,t,e){const i=Dn(a||Vn),n=i.valid&&Dn(t||Vn);return n&&n.valid?n.mix(i,e).hexString():t},number(a,t,e){return a+(t-a)*e}};class wl{constructor(t,e,i,n){const s=e[i];n=ge([t.to,n,s,t.from]);const o=ge([t.from,s,n]);this._active=!0,this._fn=t.fn||xl[t.type||typeof o],this._easing=we[t.easing]||we.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=n,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const n=this._target[this._prop],s=i-this._start,o=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=s,this._loop=!!t.loop,this._to=ge([t.to,e,n,t.from]),this._from=ge([t.from,n,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,n=this._prop,s=this._from,o=this._loop,r=this._to;let l;if(this._active=s!==r&&(o||e<i),!this._active){this._target[n]=r,this._notify(!0);return}if(e<0){this._target[n]=s;return}l=e/i%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[n]=this._fn(s,r,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let n=0;n<i.length;n++)i[n][e]()}}class vs{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!T(t))return;const e=Object.keys(B.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(n=>{const s=t[n];if(!T(s))return;const o={};for(const r of e)o[r]=s[r];(H(s.properties)&&s.properties||[n]).forEach(r=>{(r===n||!i.has(r))&&i.set(r,o)})})}_animateOptions(t,e){const i=e.options,n=kl(t,i);if(!n)return[];const s=this._createAnimations(n,i);return i.$shared&&Sl(t.options.$animations,i).then(()=>{t.options=i},()=>{}),s}_createAnimations(t,e){const i=this._properties,n=[],s=t.$animations||(t.$animations={}),o=Object.keys(e),r=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){n.push(...this._animateOptions(t,e));continue}const d=e[c];let h=s[c];const u=i.get(c);if(h)if(u&&h.active()){h.update(u,d,r);continue}else h.cancel();if(!u||!u.duration){t[c]=d;continue}s[c]=h=new wl(u,t,c,d),n.push(h)}return n}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return xt.add(this._chart,i),!0}}function Sl(a,t){const e=[],i=Object.keys(t);for(let n=0;n<i.length;n++){const s=a[i[n]];s&&s.active()&&e.push(s.wait())}return Promise.all(e)}function kl(a,t){if(!t)return;let e=a.options;if(!e){a.options=t;return}return e.$shared&&(a.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Yn(a,t){const e=a&&a.options||{},i=e.reverse,n=e.min===void 0?t:0,s=e.max===void 0?t:0;return{start:i?s:n,end:i?n:s}}function Ml(a,t,e){if(e===!1)return!1;const i=Yn(a,e),n=Yn(t,e);return{top:n.end,right:i.end,bottom:n.start,left:i.start}}function Al(a){let t,e,i,n;return T(a)?(t=a.top,e=a.right,i=a.bottom,n=a.left):t=e=i=n=a,{top:t,right:e,bottom:i,left:n,disabled:a===!1}}function xs(a,t){const e=[],i=a._getSortedDatasetMetas(t);let n,s;for(n=0,s=i.length;n<s;++n)e.push(i[n].index);return e}function Gn(a,t,e,i={}){const n=a.keys,s=i.mode==="single";let o,r,l,c;if(t===null)return;let d=!1;for(o=0,r=n.length;o<r;++o){if(l=+n[o],l===e){if(d=!0,i.all)continue;break}c=a.values[l],U(c)&&(s||t===0||bt(t)===bt(c))&&(t+=c)}return!d&&!i.all?0:t}function Cl(a,t){const{iScale:e,vScale:i}=t,n=e.axis==="x"?"x":"y",s=i.axis==="x"?"x":"y",o=Object.keys(a),r=new Array(o.length);let l,c,d;for(l=0,c=o.length;l<c;++l)d=o[l],r[l]={[n]:d,[s]:a[d]};return r}function Ai(a,t){const e=a&&a.options.stacked;return e||e===void 0&&t.stack!==void 0}function El(a,t,e){return`${a.id}.${t.id}.${e.stack||e.type}`}function Il(a){const{min:t,max:e,minDefined:i,maxDefined:n}=a.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:n?e:Number.POSITIVE_INFINITY}}function Pl(a,t,e){const i=a[t]||(a[t]={});return i[e]||(i[e]={})}function Jn(a,t,e,i){for(const n of t.getMatchingVisibleMetas(i).reverse()){const s=a[n.index];if(e&&s>0||!e&&s<0)return n.index}return null}function qn(a,t){const{chart:e,_cachedMeta:i}=a,n=e._stacks||(e._stacks={}),{iScale:s,vScale:o,index:r}=i,l=s.axis,c=o.axis,d=El(s,o,i),h=t.length;let u;for(let m=0;m<h;++m){const p=t[m],{[l]:g,[c]:f}=p,y=p._stacks||(p._stacks={});u=y[c]=Pl(n,d,g),u[r]=f,u._top=Jn(u,o,!0,i.type),u._bottom=Jn(u,o,!1,i.type);const _=u._visualValues||(u._visualValues={});_[r]=f}}function Ci(a,t){const e=a.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function Ol(a,t){return Ft(a,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Rl(a,t,e){return Ft(a,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function ce(a,t){const e=a.controller.index,i=a.vScale&&a.vScale.axis;if(i){t=t||a._parsed;for(const n of t){const s=n._stacks;if(!s||s[i]===void 0||s[i][e]===void 0)return;delete s[i][e],s[i]._visualValues!==void 0&&s[i]._visualValues[e]!==void 0&&delete s[i]._visualValues[e]}}}const Ei=a=>a==="reset"||a==="none",Kn=(a,t)=>t?a:Object.assign({},a),Tl=(a,t,e)=>a&&!t.hidden&&t._stacked&&{keys:xs(e,!0),values:null};class pt{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=Ai(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&ce(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),n=(h,u,m,p)=>h==="x"?u:h==="r"?p:m,s=e.xAxisID=E(i.xAxisID,Ci(t,"x")),o=e.yAxisID=E(i.yAxisID,Ci(t,"y")),r=e.rAxisID=E(i.rAxisID,Ci(t,"r")),l=e.indexAxis,c=e.iAxisID=n(l,s,o,r),d=e.vAxisID=n(l,o,s,r);e.xScale=this.getScaleForId(s),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(r),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Rn(this._data,this),t._stacked&&ce(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(T(e)){const n=this._cachedMeta;this._data=Cl(e,n)}else if(i!==e){if(i){Rn(i,this);const n=this._cachedMeta;ce(n),n._parsed=[]}e&&Object.isExtensible(e)&&yr(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const s=e._stacked;e._stacked=Ai(e.vScale,e),e.stack!==i.stack&&(n=!0,ce(e),e.stack=i.stack),this._resyncElements(t),(n||s!==e._stacked)&&(qn(this,e._parsed),e._stacked=Ai(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:n}=this,{iScale:s,_stacked:o}=i,r=s.axis;let l=t===0&&e===n.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,h,u;if(this._parsing===!1)i._parsed=n,i._sorted=!0,u=n;else{H(n[t])?u=this.parseArrayData(i,n,t,e):T(n[t])?u=this.parseObjectData(i,n,t,e):u=this.parsePrimitiveData(i,n,t,e);const m=()=>h[r]===null||c&&h[r]<c[r];for(d=0;d<e;++d)i._parsed[d+t]=h=u[d],l&&(m()&&(l=!1),c=h);i._sorted=l}o&&qn(this,u)}parsePrimitiveData(t,e,i,n){const{iScale:s,vScale:o}=t,r=s.axis,l=o.axis,c=s.getLabels(),d=s===o,h=new Array(n);let u,m,p;for(u=0,m=n;u<m;++u)p=u+i,h[u]={[r]:d||s.parse(c[p],p),[l]:o.parse(e[p],p)};return h}parseArrayData(t,e,i,n){const{xScale:s,yScale:o}=t,r=new Array(n);let l,c,d,h;for(l=0,c=n;l<c;++l)d=l+i,h=e[d],r[l]={x:s.parse(h[0],d),y:o.parse(h[1],d)};return r}parseObjectData(t,e,i,n){const{xScale:s,yScale:o}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,c=new Array(n);let d,h,u,m;for(d=0,h=n;d<h;++d)u=d+i,m=e[u],c[d]={x:s.parse(Lt(m,r),u),y:o.parse(Lt(m,l),u)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const n=this.chart,s=this._cachedMeta,o=e[t.axis],r={keys:xs(n,!0),values:e._stacks[t.axis]._visualValues};return Gn(r,o,s.index,{mode:i})}updateRangeFromParsed(t,e,i,n){const s=i[e.axis];let o=s===null?NaN:s;const r=n&&i._stacks[e.axis];n&&r&&(n.values=r,o=Gn(n,s,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,n=i._parsed,s=i._sorted&&t===i.iScale,o=n.length,r=this._getOtherScale(t),l=Tl(e,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:h}=Il(r);let u,m;function p(){m=n[u];const g=m[r.axis];return!U(m[t.axis])||d>g||h<g}for(u=0;u<o&&!(!p()&&(this.updateRangeFromParsed(c,t,m,l),s));++u);if(s){for(u=o-1;u>=0;--u)if(!p()){this.updateRangeFromParsed(c,t,m,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let n,s,o;for(n=0,s=e.length;n<s;++n)o=e[n][t.axis],U(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,n=e.vScale,s=this.getParsed(t);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:n?""+n.getLabelForValue(s[n.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Al(E(this.options.clip,Ml(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,n=i.data||[],s=e.chartArea,o=[],r=this._drawStart||0,l=this._drawCount||n.length-r,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,s,r,l),d=r;d<r+l;++d){const h=n[d];h.hidden||(h.active&&c?o.push(h):h.draw(t,s))}for(d=0;d<o.length;++d)o[d].draw(t,s)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const n=this.getDataset();let s;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];s=o.$context||(o.$context=Rl(this.getContext(),t,o)),s.parsed=this.getParsed(t),s.raw=n.data[t],s.index=s.dataIndex=t}else s=this.$context||(this.$context=Ol(this.chart.getContext(),this.index)),s.dataset=n,s.index=s.datasetIndex=this.index;return s.active=!!e,s.mode=i,s}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const n=e==="active",s=this._cachedDataOpts,o=t+"-"+e,r=s[o],l=this.enableOptionSharing&&Ce(i);if(r)return Kn(r,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),h=n?[`${t}Hover`,"hover",t,""]:[t,""],u=c.getOptionScopes(this.getDataset(),d),m=Object.keys(B.elements[t]),p=()=>this.getContext(i,n,e),g=c.resolveNamedOptions(u,m,p,h);return g.$shared&&(g.$shared=l,s[o]=Object.freeze(Kn(g,l))),g}_resolveAnimations(t,e,i){const n=this.chart,s=this._cachedDataOpts,o=`animation-${e}`,r=s[o];if(r)return r;let l;if(n.options.animation!==!1){const d=this.chart.config,h=d.datasetAnimationScopeKeys(this._type,e),u=d.getOptionScopes(this.getDataset(),h);l=d.createResolver(u,this.getContext(t,i,e))}const c=new vs(n,l&&l.animations);return l&&l._cacheable&&(s[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Ei(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),n=this._sharedOptions,s=this.getSharedOptions(i),o=this.includeOptions(e,s)||s!==n;return this.updateSharedOptions(s,e,i),{sharedOptions:s,includeOptions:o}}updateElement(t,e,i,n){Ei(n)?Object.assign(t,i):this._resolveAnimations(e,n).update(t,i)}updateSharedOptions(t,e,i){t&&!Ei(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,n){t.active=n;const s=this.getStyle(e,n);this._resolveAnimations(e,i,n).update(t,{options:!n&&this.getSharedOptions(s)||s})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[r,l,c]of this._syncList)this[r](l,c);this._syncList=[];const n=i.length,s=e.length,o=Math.min(s,n);o&&this.parse(0,o),s>n?this._insertElements(n,s-n,t):s<n&&this._removeElements(s,n-s)}_insertElements(t,e,i=!0){const n=this._cachedMeta,s=n.data,o=t+e;let r;const l=c=>{for(c.length+=e,r=c.length-1;r>=o;r--)c[r]=c[r-e]};for(l(s),r=t;r<o;++r)s[r]=new this.dataElementType;this._parsing&&l(n._parsed),this.parse(t,e),i&&this.updateElements(s,t,e,"reset")}updateElements(t,e,i,n){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(t,e);i._stacked&&ce(i,n)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,n]=t;this[e](i,n)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}w(pt,"defaults",{}),w(pt,"datasetElementType",null),w(pt,"dataElementType",null);function Ll(a,t){if(!a._cache.$bar){const e=a.getMatchingVisibleMetas(t);let i=[];for(let n=0,s=e.length;n<s;n++)i=i.concat(e[n].controller.getAllParsedValues(a));a._cache.$bar=ts(i.sort((n,s)=>n-s))}return a._cache.$bar}function Dl(a){const t=a.iScale,e=Ll(t,a.type);let i=t._length,n,s,o,r;const l=()=>{o===32767||o===-32768||(Ce(r)&&(i=Math.min(i,Math.abs(o-r)||i)),r=o)};for(n=0,s=e.length;n<s;++n)o=t.getPixelForValue(e[n]),l();for(r=void 0,n=0,s=t.ticks.length;n<s;++n)o=t.getPixelForTick(n),l();return i}function Fl(a,t,e,i){const n=e.barThickness;let s,o;return R(n)?(s=t.min*e.categoryPercentage,o=e.barPercentage):(s=n*i,o=1),{chunk:s/i,ratio:o,start:t.pixels[a]-s/2}}function Nl(a,t,e,i){const n=t.pixels,s=n[a];let o=a>0?n[a-1]:null,r=a<n.length-1?n[a+1]:null;const l=e.categoryPercentage;o===null&&(o=s-(r===null?t.end-t.start:r-s)),r===null&&(r=s+s-o);const c=s-(s-Math.min(o,r))/2*l;return{chunk:Math.abs(r-o)/2*l/i,ratio:e.barPercentage,start:c}}function jl(a,t,e,i){const n=e.parse(a[0],i),s=e.parse(a[1],i),o=Math.min(n,s),r=Math.max(n,s);let l=o,c=r;Math.abs(o)>Math.abs(r)&&(l=r,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:n,end:s,min:o,max:r}}function ws(a,t,e,i){return H(a)?jl(a,t,e,i):t[e.axis]=e.parse(a,i),t}function Xn(a,t,e,i){const n=a.iScale,s=a.vScale,o=n.getLabels(),r=n===s,l=[];let c,d,h,u;for(c=e,d=e+i;c<d;++c)u=t[c],h={},h[n.axis]=r||n.parse(o[c],c),l.push(ws(u,h,s,c));return l}function Ii(a){return a&&a.barStart!==void 0&&a.barEnd!==void 0}function $l(a,t,e){return a!==0?bt(a):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function Wl(a){let t,e,i,n,s;return a.horizontal?(t=a.base>a.x,e="left",i="right"):(t=a.base<a.y,e="bottom",i="top"),t?(n="end",s="start"):(n="start",s="end"),{start:e,end:i,reverse:t,top:n,bottom:s}}function zl(a,t,e,i){let n=t.borderSkipped;const s={};if(!n){a.borderSkipped=s;return}if(n===!0){a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:r,reverse:l,top:c,bottom:d}=Wl(a);n==="middle"&&e&&(a.enableBorderRadius=!0,(e._top||0)===i?n=c:(e._bottom||0)===i?n=d:(s[Qn(d,o,r,l)]=!0,n=c)),s[Qn(n,o,r,l)]=!0,a.borderSkipped=s}function Qn(a,t,e,i){return i?(a=Hl(a,t,e),a=Zn(a,e,t)):a=Zn(a,t,e),a}function Hl(a,t,e){return a===t?e:a===e?t:a}function Zn(a,t,e){return a==="start"?t:a==="end"?e:a}function Bl(a,{inflateAmount:t},e){a.inflateAmount=t==="auto"?e===1?.33:0:t}class Xe extends pt{parsePrimitiveData(t,e,i,n){return Xn(t,e,i,n)}parseArrayData(t,e,i,n){return Xn(t,e,i,n)}parseObjectData(t,e,i,n){const{iScale:s,vScale:o}=t,{xAxisKey:r="x",yAxisKey:l="y"}=this._parsing,c=s.axis==="x"?r:l,d=o.axis==="x"?r:l,h=[];let u,m,p,g;for(u=i,m=i+n;u<m;++u)g=e[u],p={},p[s.axis]=s.parse(Lt(g,c),u),h.push(ws(Lt(g,d),p,o,u));return h}updateRangeFromParsed(t,e,i,n){super.updateRangeFromParsed(t,e,i,n);const s=i._custom;s&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,s.min),t.max=Math.max(t.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:n}=e,s=this.getParsed(t),o=s._custom,r=Ii(o)?"["+o.start+", "+o.end+"]":""+n.getLabelForValue(s[n.axis]);return{label:""+i.getLabelForValue(s[i.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,n){const s=n==="reset",{index:o,_cachedMeta:{vScale:r}}=this,l=r.getBasePixel(),c=r.isHorizontal(),d=this._getRuler(),{sharedOptions:h,includeOptions:u}=this._getSharedOptions(e,n);for(let m=e;m<e+i;m++){const p=this.getParsed(m),g=s||R(p[r.axis])?{base:l,head:l}:this._calculateBarValuePixels(m),f=this._calculateBarIndexPixels(m,d),y=(p._stacks||{})[r.axis],_={horizontal:c,base:g.base,enableBorderRadius:!y||Ii(p._custom)||o===y._top||o===y._bottom,x:c?g.head:f.center,y:c?f.center:g.head,height:c?f.size:Math.abs(g.size),width:c?Math.abs(g.size):f.size};u&&(_.options=h||this.resolveDataElementOptions(m,t[m].active?"active":n));const b=_.options||t[m].options;zl(_,b,y,o),Bl(_,b,d.ratio),this.updateElement(t[m],m,_,n)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),s=i.options.stacked,o=[],r=this._cachedMeta.controller.getParsed(e),l=r&&r[i.axis],c=d=>{const h=d._parsed.find(m=>m[i.axis]===l),u=h&&h[d.vScale.axis];if(R(u)||isNaN(u))return!0};for(const d of n)if(!(e!==void 0&&c(d))&&((s===!1||o.indexOf(d.stack)===-1||s===void 0&&d.stack===void 0)&&o.push(d.stack),d.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[E(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const n=this._getStacks(t,i),s=e!==void 0?n.indexOf(e):-1;return s===-1?n.length-1:s}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,n=[];let s,o;for(s=0,o=e.data.length;s<o;++s)n.push(i.getPixelForValue(this.getParsed(s)[i.axis],s));const r=t.barThickness;return{min:r||Dl(e),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:r?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:n},options:{base:s,minBarLength:o}}=this,r=s||0,l=this.getParsed(t),c=l._custom,d=Ii(c);let h=l[e.axis],u=0,m=i?this.applyStack(e,l,i):h,p,g;m!==h&&(u=m-h,m=h),d&&(h=c.barStart,m=c.barEnd-c.barStart,h!==0&&bt(h)!==bt(c.barEnd)&&(u=0),u+=h);const f=!R(s)&&!d?s:u;let y=e.getPixelForValue(f);if(this.chart.getDataVisibility(t)?p=e.getPixelForValue(u+m):p=y,g=p-y,Math.abs(g)<o){g=$l(g,e,r)*o,h===r&&(y-=g/2);const _=e.getPixelForDecimal(0),b=e.getPixelForDecimal(1),x=Math.min(_,b),v=Math.max(_,b);y=Math.max(Math.min(y,v),x),p=y+g,i&&!d&&(l._stacks[e.axis]._visualValues[n]=e.getValueForPixel(p)-e.getValueForPixel(y))}if(y===e.getPixelForValue(r)){const _=bt(g)*e.getLineWidthForValue(r)/2;y+=_,g-=_}return{size:g,base:y,head:p,center:p+g/2}}_calculateBarIndexPixels(t,e){const i=e.scale,n=this.options,s=n.skipNull,o=E(n.maxBarThickness,1/0);let r,l;const c=this._getAxisCount();if(e.grouped){const d=s?this._getStackCount(t):e.stackCount,h=n.barThickness==="flex"?Nl(t,e,n,d*c):Fl(t,e,n,d*c),u=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,m=this._getAxis().indexOf(E(u,this.getFirstScaleIdForIndexAxis())),p=this._getStackIndex(this.index,this._cachedMeta.stack,s?t:void 0)+m;r=h.start+h.chunk*p+h.chunk/2,l=Math.min(o,h.chunk*h.ratio)}else r=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(o,e.min*e.ratio);return{base:r-l/2,head:r+l/2,center:r,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,n=i.length;let s=0;for(;s<n;++s)this.getParsed(s)[e.axis]!==null&&!i[s].hidden&&i[s].draw(this._ctx)}}w(Xe,"id","bar"),w(Xe,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),w(Xe,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Qe extends pt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,n){const s=super.parsePrimitiveData(t,e,i,n);for(let o=0;o<s.length;o++)s[o]._custom=this.resolveDataElementOptions(o+i).radius;return s}parseArrayData(t,e,i,n){const s=super.parseArrayData(t,e,i,n);for(let o=0;o<s.length;o++){const r=e[i+o];s[o]._custom=E(r[2],this.resolveDataElementOptions(o+i).radius)}return s}parseObjectData(t,e,i,n){const s=super.parseObjectData(t,e,i,n);for(let o=0;o<s.length;o++){const r=e[i+o];s[o]._custom=E(r&&r.r&&+r.r,this.resolveDataElementOptions(o+i).radius)}return s}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:s}=e,o=this.getParsed(t),r=n.getLabelForValue(o.x),l=s.getLabelForValue(o.y),c=o._custom;return{label:i[t]||"",value:"("+r+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,n){const s=n==="reset",{iScale:o,vScale:r}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,n),d=o.axis,h=r.axis;for(let u=e;u<e+i;u++){const m=t[u],p=!s&&this.getParsed(u),g={},f=g[d]=s?o.getPixelForDecimal(.5):o.getPixelForValue(p[d]),y=g[h]=s?r.getBasePixel():r.getPixelForValue(p[h]);g.skip=isNaN(f)||isNaN(y),c&&(g.options=l||this.resolveDataElementOptions(u,m.active?"active":n),s&&(g.options.radius=0)),this.updateElement(m,u,g,n)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let n=super.resolveDataElementOptions(t,e);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const s=n.radius;return e!=="active"&&(n.radius=0),n.radius+=E(i&&i._custom,s),n}}w(Qe,"id","bubble"),w(Qe,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),w(Qe,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Ul(a,t,e){let i=1,n=1,s=0,o=0;if(t<$){const r=a,l=r+t,c=Math.cos(r),d=Math.sin(r),h=Math.cos(l),u=Math.sin(l),m=(b,x,v)=>Ee(b,r,l,!0)?1:Math.max(x,x*e,v,v*e),p=(b,x,v)=>Ee(b,r,l,!0)?-1:Math.min(x,x*e,v,v*e),g=m(0,c,h),f=m(G,d,u),y=p(D,c,h),_=p(D+G,d,u);i=(g-y)/2,n=(f-_)/2,s=-(g+y)/2,o=-(f+_)/2}return{ratioX:i,ratioY:n,offsetX:s,offsetY:o}}class Gt extends pt{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=i;else{let s=l=>+i[l];if(T(i[t])){const{key:l="value"}=this._parsing;s=c=>+Lt(i[c],l)}let o,r;for(o=t,r=t+e;o<r;++o)n._parsed[o]=s(o)}}_getRotation(){return mt(this.options.rotation-90)}_getCircumference(){return mt(this.options.circumference)}_getRotationExtents(){let t=$,e=-$;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,s=n._getRotation(),o=n._getCircumference();t=Math.min(t,s),e=Math.max(e,s+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,n=this._cachedMeta,s=n.data,o=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,r=Math.max((Math.min(i.width,i.height)-o)/2,0),l=Math.min(ir(this.options.cutout,r),1),c=this._getRingWeight(this.index),{circumference:d,rotation:h}=this._getRotationExtents(),{ratioX:u,ratioY:m,offsetX:p,offsetY:g}=Ul(h,d,l),f=(i.width-o)/u,y=(i.height-o)/m,_=Math.max(Math.min(f,y)/2,0),b=qa(this.options.radius,_),x=Math.max(b*l,0),v=(b-x)/this._getVisibleDatasetWeightTotal();this.offsetX=p*b,this.offsetY=g*b,n.total=this.calculateTotal(),this.outerRadius=b-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(s,0,s.length,t)}_circumference(t,e){const i=this.options,n=this._cachedMeta,s=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||n._parsed[t]===null||n.data[t].hidden?0:this.calculateCircumference(n._parsed[t]*s/$)}updateElements(t,e,i,n){const s=n==="reset",o=this.chart,r=o.chartArea,c=o.options.animation,d=(r.left+r.right)/2,h=(r.top+r.bottom)/2,u=s&&c.animateScale,m=u?0:this.innerRadius,p=u?0:this.outerRadius,{sharedOptions:g,includeOptions:f}=this._getSharedOptions(e,n);let y=this._getRotation(),_;for(_=0;_<e;++_)y+=this._circumference(_,s);for(_=e;_<e+i;++_){const b=this._circumference(_,s),x=t[_],v={x:d+this.offsetX,y:h+this.offsetY,startAngle:y,endAngle:y+b,circumference:b,outerRadius:p,innerRadius:m};f&&(v.options=g||this.resolveDataElementOptions(_,x.active?"active":n)),y+=b,this.updateElement(x,_,v,n)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,n;for(n=0;n<e.length;n++){const s=t._parsed[n];s!==null&&!isNaN(s)&&this.chart.getDataVisibility(n)&&!e[n].hidden&&(i+=Math.abs(s))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?$*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],s=De(e._parsed[t],i.options.locale);return{label:n[t]||"",value:s}}getMaxBorderWidth(t){let e=0;const i=this.chart;let n,s,o,r,l;if(!t){for(n=0,s=i.data.datasets.length;n<s;++n)if(i.isDatasetVisible(n)){o=i.getDatasetMeta(n),t=o.data,r=o.controller;break}}if(!t)return 0;for(n=0,s=t.length;n<s;++n)l=r.resolveDataElementOptions(n),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,n=t.length;i<n;++i){const s=this.resolveDataElementOptions(i);e=Math.max(e,s.offset||0,s.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(E(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}w(Gt,"id","doughnut"),w(Gt,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),w(Gt,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),w(Gt,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:n,color:s,useBorderRadius:o,borderRadius:r}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const h=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:h.backgroundColor,fontColor:s,hidden:!t.getDataVisibility(c),lineDash:h.borderDash,lineDashOffset:h.borderDashOffset,lineJoin:h.borderJoinStyle,lineWidth:h.borderWidth,strokeStyle:h.borderColor,textAlign:n,pointStyle:i,borderRadius:o&&(r||h.borderRadius),index:c}}):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}});class Ze extends pt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:n=[],_dataset:s}=e,o=this.chart._animationsDisabled;let{start:r,count:l}=ns(e,n,o);this._drawStart=r,this._drawCount=l,as(e)&&(r=0,l=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=n;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:c},t),this.updateElements(n,r,l,t)}updateElements(t,e,i,n){const s=n==="reset",{iScale:o,vScale:r,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:h}=this._getSharedOptions(e,n),u=o.axis,m=r.axis,{spanGaps:p,segment:g}=this.options,f=ae(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||s||n==="none",_=e+i,b=t.length;let x=e>0&&this.getParsed(e-1);for(let v=0;v<b;++v){const S=t[v],k=y?S:{};if(v<e||v>=_){k.skip=!0;continue}const M=this.getParsed(v),C=R(M[m]),P=k[u]=o.getPixelForValue(M[u],v),O=k[m]=s||C?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,M,l):M[m],v);k.skip=isNaN(P)||isNaN(O)||C,k.stop=v>0&&Math.abs(M[u]-x[u])>f,g&&(k.parsed=M,k.raw=c.data[v]),h&&(k.options=d||this.resolveDataElementOptions(v,S.active?"active":n)),y||this.updateElement(S,v,k,n),x=M}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,n=t.data||[];if(!n.length)return i;const s=n[0].size(this.resolveDataElementOptions(0)),o=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,s,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}w(Ze,"id","line"),w(Ze,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),w(Ze,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ke extends pt{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,n=i.data.labels||[],s=De(e._parsed[t].r,i.options.locale);return{label:n[t]||"",value:s}}parseObjectData(t,e,i,n){return us.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,n)=>{const s=this.getParsed(n).r;!isNaN(s)&&this.chart.getDataVisibility(n)&&(s<e.min&&(e.min=s),s>e.max&&(e.max=s))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,n=Math.min(e.right-e.left,e.bottom-e.top),s=Math.max(n/2,0),o=Math.max(i.cutoutPercentage?s/100*i.cutoutPercentage:1,0),r=(s-o)/t.getVisibleDatasetCount();this.outerRadius=s-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(t,e,i,n){const s=n==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,h=c.yCenter,u=c.getIndexAngle(0)-.5*D;let m=u,p;const g=360/this.countVisibleElements();for(p=0;p<e;++p)m+=this._computeAngle(p,n,g);for(p=e;p<e+i;p++){const f=t[p];let y=m,_=m+this._computeAngle(p,n,g),b=o.getDataVisibility(p)?c.getDistanceFromCenterForValue(this.getParsed(p).r):0;m=_,s&&(l.animateScale&&(b=0),l.animateRotate&&(y=_=u));const x={x:d,y:h,innerRadius:0,outerRadius:b,startAngle:y,endAngle:_,options:this.resolveDataElementOptions(p,f.active?"active":n)};this.updateElement(f,p,x,n)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?mt(this.resolveDataElementOptions(t,e).angle||i):0}}w(ke,"id","polarArea"),w(ke,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),w(ke,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:n}}=t.legend.options;return e.labels.map((s,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:s,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:n,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Hi extends Gt{}w(Hi,"id","pie"),w(Hi,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class ti extends pt{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,n){return us.bind(this)(t,e,i,n)}update(t){const e=this._cachedMeta,i=e.dataset,n=e.data||[],s=e.iScale.getLabels();if(i.points=n,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const r={_loop:!0,_fullLoop:s.length===n.length,options:o};this.updateElement(i,void 0,r,t)}this.updateElements(n,0,n.length,t)}updateElements(t,e,i,n){const s=this._cachedMeta.rScale,o=n==="reset";for(let r=e;r<e+i;r++){const l=t[r],c=this.resolveDataElementOptions(r,l.active?"active":n),d=s.getPointPositionForValue(r,this.getParsed(r).r),h=o?s.xCenter:d.x,u=o?s.yCenter:d.y,m={x:h,y:u,angle:d.angle,skip:isNaN(h)||isNaN(u),options:c};this.updateElement(l,r,m,n)}}}w(ti,"id","radar"),w(ti,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),w(ti,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class ei extends pt{getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:s}=e,o=this.getParsed(t),r=n.getLabelForValue(o.x),l=s.getLabelForValue(o.y);return{label:i[t]||"",value:"("+r+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,n=this.chart._animationsDisabled;let{start:s,count:o}=ns(e,i,n);if(this._drawStart=s,this._drawCount=o,as(e)&&(s=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:l}=e;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!l._decimated,r.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(r,void 0,{animated:!n,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,s,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,n){const s=n==="reset",{iScale:o,vScale:r,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(e,n),h=this.getSharedOptions(d),u=this.includeOptions(n,h),m=o.axis,p=r.axis,{spanGaps:g,segment:f}=this.options,y=ae(g)?g:Number.POSITIVE_INFINITY,_=this.chart._animationsDisabled||s||n==="none";let b=e>0&&this.getParsed(e-1);for(let x=e;x<e+i;++x){const v=t[x],S=this.getParsed(x),k=_?v:{},M=R(S[p]),C=k[m]=o.getPixelForValue(S[m],x),P=k[p]=s||M?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,S,l):S[p],x);k.skip=isNaN(C)||isNaN(P)||M,k.stop=x>0&&Math.abs(S[m]-b[m])>y,f&&(k.parsed=S,k.raw=c.data[x]),u&&(k.options=h||this.resolveDataElementOptions(x,v.active?"active":n)),_||this.updateElement(v,x,k,n),b=S}this.updateSharedOptions(h,n,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let r=0;for(let l=e.length-1;l>=0;--l)r=Math.max(r,e[l].size(this.resolveDataElementOptions(l))/2);return r>0&&r}const i=t.dataset,n=i.options&&i.options.borderWidth||0;if(!e.length)return n;const s=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(n,s,o)/2}}w(ei,"id","scatter"),w(ei,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),w(ei,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Vl=Object.freeze({__proto__:null,BarController:Xe,BubbleController:Qe,DoughnutController:Gt,LineController:Ze,PieController:Hi,PolarAreaController:ke,RadarController:ti,ScatterController:ei});function zt(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class _n{constructor(t){w(this,"options");this.options=t||{}}static override(t){Object.assign(_n.prototype,t)}init(){}formats(){return zt()}parse(){return zt()}format(){return zt()}add(){return zt()}diff(){return zt()}startOf(){return zt()}endOf(){return zt()}}var Yl={_date:_n};function Gl(a,t,e,i){const{controller:n,data:s,_sorted:o}=a,r=n._cachedMeta.iScale,l=a.dataset&&a.dataset.options?a.dataset.options.spanGaps:null;if(r&&t===r.axis&&t!=="r"&&o&&s.length){const c=r._reversePixels?gr:Mt;if(i){if(n._sharedOptions){const d=s[0],h=typeof d.getRange=="function"&&d.getRange(t);if(h){const u=c(s,t,e-h),m=c(s,t,e+h);return{lo:u.lo,hi:m.hi}}}}else{const d=c(s,t,e);if(l){const{vScale:h}=n._cachedMeta,{_parsed:u}=a,m=u.slice(0,d.lo+1).reverse().findIndex(g=>!R(g[h.axis]));d.lo-=Math.max(0,m);const p=u.slice(d.hi).findIndex(g=>!R(g[h.axis]));d.hi+=Math.max(0,p)}return d}}return{lo:0,hi:s.length-1}}function vi(a,t,e,i,n){const s=a.getSortedVisibleDatasetMetas(),o=e[t];for(let r=0,l=s.length;r<l;++r){const{index:c,data:d}=s[r],{lo:h,hi:u}=Gl(s[r],t,o,n);for(let m=h;m<=u;++m){const p=d[m];p.skip||i(p,c,m)}}}function Jl(a){const t=a.indexOf("x")!==-1,e=a.indexOf("y")!==-1;return function(i,n){const s=t?Math.abs(i.x-n.x):0,o=e?Math.abs(i.y-n.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(o,2))}}function Pi(a,t,e,i,n){const s=[];return!n&&!a.isPointInArea(t)||vi(a,e,t,function(r,l,c){!n&&!At(r,a.chartArea,0)||r.inRange(t.x,t.y,i)&&s.push({element:r,datasetIndex:l,index:c})},!0),s}function ql(a,t,e,i){let n=[];function s(o,r,l){const{startAngle:c,endAngle:d}=o.getProps(["startAngle","endAngle"],i),{angle:h}=Qa(o,{x:t.x,y:t.y});Ee(h,c,d)&&n.push({element:o,datasetIndex:r,index:l})}return vi(a,e,t,s),n}function Kl(a,t,e,i,n,s){let o=[];const r=Jl(e);let l=Number.POSITIVE_INFINITY;function c(d,h,u){const m=d.inRange(t.x,t.y,n);if(i&&!m)return;const p=d.getCenterPoint(n);if(!(!!s||a.isPointInArea(p))&&!m)return;const f=r(t,p);f<l?(o=[{element:d,datasetIndex:h,index:u}],l=f):f===l&&o.push({element:d,datasetIndex:h,index:u})}return vi(a,e,t,c),o}function Oi(a,t,e,i,n,s){return!s&&!a.isPointInArea(t)?[]:e==="r"&&!i?ql(a,t,e,n):Kl(a,t,e,i,n,s)}function ta(a,t,e,i,n){const s=[],o=e==="x"?"inXRange":"inYRange";let r=!1;return vi(a,e,t,(l,c,d)=>{l[o]&&l[o](t[e],n)&&(s.push({element:l,datasetIndex:c,index:d}),r=r||l.inRange(t.x,t.y,n))}),i&&!r?[]:s}var Xl={modes:{index(a,t,e,i){const n=Bt(t,a),s=e.axis||"x",o=e.includeInvisible||!1,r=e.intersect?Pi(a,n,s,i,o):Oi(a,n,s,!1,i,o),l=[];return r.length?(a.getSortedVisibleDatasetMetas().forEach(c=>{const d=r[0].index,h=c.data[d];h&&!h.skip&&l.push({element:h,datasetIndex:c.index,index:d})}),l):[]},dataset(a,t,e,i){const n=Bt(t,a),s=e.axis||"xy",o=e.includeInvisible||!1;let r=e.intersect?Pi(a,n,s,i,o):Oi(a,n,s,!1,i,o);if(r.length>0){const l=r[0].datasetIndex,c=a.getDatasetMeta(l).data;r=[];for(let d=0;d<c.length;++d)r.push({element:c[d],datasetIndex:l,index:d})}return r},point(a,t,e,i){const n=Bt(t,a),s=e.axis||"xy",o=e.includeInvisible||!1;return Pi(a,n,s,i,o)},nearest(a,t,e,i){const n=Bt(t,a),s=e.axis||"xy",o=e.includeInvisible||!1;return Oi(a,n,s,e.intersect,i,o)},x(a,t,e,i){const n=Bt(t,a);return ta(a,n,"x",e.intersect,i)},y(a,t,e,i){const n=Bt(t,a);return ta(a,n,"y",e.intersect,i)}}};const Ss=["left","top","right","bottom"];function de(a,t){return a.filter(e=>e.pos===t)}function ea(a,t){return a.filter(e=>Ss.indexOf(e.pos)===-1&&e.box.axis===t)}function he(a,t){return a.sort((e,i)=>{const n=t?i:e,s=t?e:i;return n.weight===s.weight?n.index-s.index:n.weight-s.weight})}function Ql(a){const t=[];let e,i,n,s,o,r;for(e=0,i=(a||[]).length;e<i;++e)n=a[e],{position:s,options:{stack:o,stackWeight:r=1}}=n,t.push({index:e,box:n,pos:s,horizontal:n.isHorizontal(),weight:n.weight,stack:o&&s+o,stackWeight:r});return t}function Zl(a){const t={};for(const e of a){const{stack:i,pos:n,stackWeight:s}=e;if(!i||!Ss.includes(n))continue;const o=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=s}return t}function tc(a,t){const e=Zl(a),{vBoxMaxWidth:i,hBoxMaxHeight:n}=t;let s,o,r;for(s=0,o=a.length;s<o;++s){r=a[s];const{fullSize:l}=r.box,c=e[r.stack],d=c&&r.stackWeight/c.weight;r.horizontal?(r.width=d?d*i:l&&t.availableWidth,r.height=n):(r.width=i,r.height=d?d*n:l&&t.availableHeight)}return e}function ec(a){const t=Ql(a),e=he(t.filter(c=>c.box.fullSize),!0),i=he(de(t,"left"),!0),n=he(de(t,"right")),s=he(de(t,"top"),!0),o=he(de(t,"bottom")),r=ea(t,"x"),l=ea(t,"y");return{fullSize:e,leftAndTop:i.concat(s),rightAndBottom:n.concat(l).concat(o).concat(r),chartArea:de(t,"chartArea"),vertical:i.concat(n).concat(l),horizontal:s.concat(o).concat(r)}}function ia(a,t,e,i){return Math.max(a[e],t[e])+Math.max(a[i],t[i])}function ks(a,t){a.top=Math.max(a.top,t.top),a.left=Math.max(a.left,t.left),a.bottom=Math.max(a.bottom,t.bottom),a.right=Math.max(a.right,t.right)}function ic(a,t,e,i){const{pos:n,box:s}=e,o=a.maxPadding;if(!T(n)){e.size&&(a[n]-=e.size);const h=i[e.stack]||{size:0,count:1};h.size=Math.max(h.size,e.horizontal?s.height:s.width),e.size=h.size/h.count,a[n]+=e.size}s.getPadding&&ks(o,s.getPadding());const r=Math.max(0,t.outerWidth-ia(o,a,"left","right")),l=Math.max(0,t.outerHeight-ia(o,a,"top","bottom")),c=r!==a.w,d=l!==a.h;return a.w=r,a.h=l,e.horizontal?{same:c,other:d}:{same:d,other:c}}function nc(a){const t=a.maxPadding;function e(i){const n=Math.max(t[i]-a[i],0);return a[i]+=n,n}a.y+=e("top"),a.x+=e("left"),e("right"),e("bottom")}function ac(a,t){const e=t.maxPadding;function i(n){const s={left:0,top:0,right:0,bottom:0};return n.forEach(o=>{s[o]=Math.max(t[o],e[o])}),s}return i(a?["left","right"]:["top","bottom"])}function fe(a,t,e,i){const n=[];let s,o,r,l,c,d;for(s=0,o=a.length,c=0;s<o;++s){r=a[s],l=r.box,l.update(r.width||t.w,r.height||t.h,ac(r.horizontal,t));const{same:h,other:u}=ic(t,e,r,i);c|=h&&n.length,d=d||u,l.fullSize||n.push(r)}return c&&fe(n,t,e,i)||d}function Ue(a,t,e,i,n){a.top=e,a.left=t,a.right=t+i,a.bottom=e+n,a.width=i,a.height=n}function na(a,t,e,i){const n=e.padding;let{x:s,y:o}=t;for(const r of a){const l=r.box,c=i[r.stack]||{placed:0,weight:1},d=r.stackWeight/c.weight||1;if(r.horizontal){const h=t.w*d,u=c.size||l.height;Ce(c.start)&&(o=c.start),l.fullSize?Ue(l,n.left,o,e.outerWidth-n.right-n.left,u):Ue(l,t.left+c.placed,o,h,u),c.start=o,c.placed+=h,o=l.bottom}else{const h=t.h*d,u=c.size||l.width;Ce(c.start)&&(s=c.start),l.fullSize?Ue(l,s,n.top,u,e.outerHeight-n.bottom-n.top):Ue(l,s,t.top+c.placed,u,h),c.start=s,c.placed+=h,s=l.right}}t.x=s,t.y=o}var nt={addBox(a,t){a.boxes||(a.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},a.boxes.push(t)},removeBox(a,t){const e=a.boxes?a.boxes.indexOf(t):-1;e!==-1&&a.boxes.splice(e,1)},configure(a,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(a,t,e,i){if(!a)return;const n=at(a.options.layout.padding),s=Math.max(t-n.width,0),o=Math.max(e-n.height,0),r=ec(a.boxes),l=r.vertical,c=r.horizontal;F(a.boxes,g=>{typeof g.beforeLayout=="function"&&g.beforeLayout()});const d=l.reduce((g,f)=>f.box.options&&f.box.options.display===!1?g:g+1,0)||1,h=Object.freeze({outerWidth:t,outerHeight:e,padding:n,availableWidth:s,availableHeight:o,vBoxMaxWidth:s/2/d,hBoxMaxHeight:o/2}),u=Object.assign({},n);ks(u,at(i));const m=Object.assign({maxPadding:u,w:s,h:o,x:n.left,y:n.top},n),p=tc(l.concat(c),h);fe(r.fullSize,m,h,p),fe(l,m,h,p),fe(c,m,h,p)&&fe(l,m,h,p),nc(m),na(r.leftAndTop,m,h,p),m.x+=m.w,m.y+=m.h,na(r.rightAndBottom,m,h,p),a.chartArea={left:m.left,top:m.top,right:m.left+m.w,bottom:m.top+m.h,height:m.h,width:m.w},F(r.chartArea,g=>{const f=g.box;Object.assign(f,a.chartArea),f.update(m.w,m.h,{left:0,top:0,right:0,bottom:0})})}};class Ms{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,n){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,n?Math.floor(e/n):i)}}isAttached(t){return!0}updateConfig(t){}}class sc extends Ms{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const ii="$chartjs",oc={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},aa=a=>a===null||a==="";function rc(a,t){const e=a.style,i=a.getAttribute("height"),n=a.getAttribute("width");if(a[ii]={initial:{height:i,width:n,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",aa(n)){const s=zn(a,"width");s!==void 0&&(a.width=s)}if(aa(i))if(a.style.height==="")a.height=a.width/(t||2);else{const s=zn(a,"height");s!==void 0&&(a.height=s)}return a}const As=ll?{passive:!0}:!1;function lc(a,t,e){a&&a.addEventListener(t,e,As)}function cc(a,t,e){a&&a.canvas&&a.canvas.removeEventListener(t,e,As)}function dc(a,t){const e=oc[a.type]||a.type,{x:i,y:n}=Bt(a,t);return{type:e,chart:t,native:a,x:i!==void 0?i:null,y:n!==void 0?n:null}}function ui(a,t){for(const e of a)if(e===t||e.contains(t))return!0}function hc(a,t,e){const i=a.canvas,n=new MutationObserver(s=>{let o=!1;for(const r of s)o=o||ui(r.addedNodes,i),o=o&&!ui(r.removedNodes,i);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}function uc(a,t,e){const i=a.canvas,n=new MutationObserver(s=>{let o=!1;for(const r of s)o=o||ui(r.removedNodes,i),o=o&&!ui(r.addedNodes,i);o&&e()});return n.observe(document,{childList:!0,subtree:!0}),n}const Pe=new Map;let sa=0;function Cs(){const a=window.devicePixelRatio;a!==sa&&(sa=a,Pe.forEach((t,e)=>{e.currentDevicePixelRatio!==a&&t()}))}function mc(a,t){Pe.size||window.addEventListener("resize",Cs),Pe.set(a,t)}function pc(a){Pe.delete(a),Pe.size||window.removeEventListener("resize",Cs)}function gc(a,t,e){const i=a.canvas,n=i&&yn(i);if(!n)return;const s=is((r,l)=>{const c=n.clientWidth;e(r,l),c<n.clientWidth&&e()},window),o=new ResizeObserver(r=>{const l=r[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||s(c,d)});return o.observe(n),mc(a,s),o}function Ri(a,t,e){e&&e.disconnect(),t==="resize"&&pc(a)}function fc(a,t,e){const i=a.canvas,n=is(s=>{a.ctx!==null&&e(dc(s,a))},a);return lc(i,t,n),n}class yc extends Ms{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(rc(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[ii])return!1;const i=e[ii].initial;["height","width"].forEach(s=>{const o=i[s];R(o)?e.removeAttribute(s):e.setAttribute(s,o)});const n=i.style||{};return Object.keys(n).forEach(s=>{e.style[s]=n[s]}),e.width=e.width,delete e[ii],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const n=t.$proxies||(t.$proxies={}),o={attach:hc,detach:uc,resize:gc}[e]||fc;n[e]=o(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),n=i[e];if(!n)return;({attach:Ri,detach:Ri,resize:Ri}[e]||cc)(t,e,n),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,n){return rl(t,e,i,n)}isAttached(t){const e=t&&yn(t);return!!(e&&e.isConnected)}}function _c(a){return!fn()||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas?sc:yc}class gt{constructor(){w(this,"x");w(this,"y");w(this,"active",!1);w(this,"options");w(this,"$animations")}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return ae(this.x)&&ae(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const n={};return t.forEach(s=>{n[s]=i[s]&&i[s].active()?i[s]._to:this[s]}),n}}w(gt,"defaults",{}),w(gt,"defaultRoutes");function bc(a,t){const e=a.options.ticks,i=vc(a),n=Math.min(e.maxTicksLimit||i,i),s=e.major.enabled?wc(t):[],o=s.length,r=s[0],l=s[o-1],c=[];if(o>n)return Sc(t,c,s,o/n),c;const d=xc(s,t,n);if(o>0){let h,u;const m=o>1?Math.round((l-r)/(o-1)):null;for(Ve(t,c,d,R(m)?0:r-m,r),h=0,u=o-1;h<u;h++)Ve(t,c,d,s[h],s[h+1]);return Ve(t,c,d,l,R(m)?t.length:l+m),c}return Ve(t,c,d),c}function vc(a){const t=a.options.offset,e=a._tickSize(),i=a._length/e+(t?0:1),n=a._maxLength/e;return Math.floor(Math.min(i,n))}function xc(a,t,e){const i=kc(a),n=t.length/e;if(!i)return Math.max(n,1);const s=dr(i);for(let o=0,r=s.length-1;o<r;o++){const l=s[o];if(l>n)return l}return Math.max(n,1)}function wc(a){const t=[];let e,i;for(e=0,i=a.length;e<i;e++)a[e].major&&t.push(e);return t}function Sc(a,t,e,i){let n=0,s=e[0],o;for(i=Math.ceil(i),o=0;o<a.length;o++)o===s&&(t.push(a[o]),n++,s=e[n*i])}function Ve(a,t,e,i,n){const s=E(i,0),o=Math.min(E(n,a.length),a.length);let r=0,l,c,d;for(e=Math.ceil(e),n&&(l=n-i,e=l/Math.floor(l/e)),d=s;d<0;)r++,d=Math.round(s+r*e);for(c=Math.max(s,0);c<o;c++)c===d&&(t.push(a[c]),r++,d=Math.round(s+r*e))}function kc(a){const t=a.length;let e,i;if(t<2)return!1;for(i=a[0],e=1;e<t;++e)if(a[e]-a[e-1]!==i)return!1;return i}const Mc=a=>a==="left"?"right":a==="right"?"left":a,oa=(a,t,e)=>t==="top"||t==="left"?a[t]+e:a[t]-e,ra=(a,t)=>Math.min(t||a,a);function la(a,t){const e=[],i=a.length/t,n=a.length;let s=0;for(;s<n;s+=i)e.push(a[Math.floor(s)]);return e}function Ac(a,t,e){const i=a.ticks.length,n=Math.min(t,i-1),s=a._startPixel,o=a._endPixel,r=1e-6;let l=a.getPixelForTick(n),c;if(!(e&&(i===1?c=Math.max(l-s,o-l):t===0?c=(a.getPixelForTick(1)-l)/2:c=(l-a.getPixelForTick(n-1))/2,l+=n<t?c:-c,l<s-r||l>o+r)))return l}function Cc(a,t){F(a,e=>{const i=e.gc,n=i.length/2;let s;if(n>t){for(s=0;s<n;++s)delete e.data[i[s]];i.splice(0,n)}})}function ue(a){return a.drawTicks?a.tickLength:0}function ca(a,t){if(!a.display)return 0;const e=K(a.font,t),i=at(a.padding);return(H(a.text)?a.text.length:1)*e.lineHeight+i.height}function Ec(a,t){return Ft(a,{scale:t,type:"scale"})}function Ic(a,t,e){return Ft(a,{tick:e,index:t,type:"tick"})}function Pc(a,t,e){let i=dn(a);return(e&&t!=="right"||!e&&t==="right")&&(i=Mc(i)),i}function Oc(a,t,e,i){const{top:n,left:s,bottom:o,right:r,chart:l}=a,{chartArea:c,scales:d}=l;let h=0,u,m,p;const g=o-n,f=r-s;if(a.isHorizontal()){if(m=et(i,s,r),T(e)){const y=Object.keys(e)[0],_=e[y];p=d[y].getPixelForValue(_)+g-t}else e==="center"?p=(c.bottom+c.top)/2+g-t:p=oa(a,e,t);u=r-s}else{if(T(e)){const y=Object.keys(e)[0],_=e[y];m=d[y].getPixelForValue(_)-f+t}else e==="center"?m=(c.left+c.right)/2-f+t:m=oa(a,e,t);p=et(i,o,n),h=e==="left"?-G:G}return{titleX:m,titleY:p,maxWidth:u,rotation:h}}class Qt extends gt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:n}=this;return t=lt(t,Number.POSITIVE_INFINITY),e=lt(e,Number.NEGATIVE_INFINITY),i=lt(i,Number.POSITIVE_INFINITY),n=lt(n,Number.NEGATIVE_INFINITY),{min:lt(t,i),max:lt(e,n),minDefined:U(t),maxDefined:U(e)}}getMinMax(t){let{min:e,max:i,minDefined:n,maxDefined:s}=this.getUserBounds(),o;if(n&&s)return{min:e,max:i};const r=this.getMatchingVisibleMetas();for(let l=0,c=r.length;l<c;++l)o=r[l].controller.getMinMax(this,t),n||(e=Math.min(e,o.min)),s||(i=Math.max(i,o.max));return e=s&&e>i?i:e,i=n&&e>i?e:i,{min:lt(e,lt(i,e)),max:lt(i,lt(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){j(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:n,grace:s,ticks:o}=this.options,r=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=$r(this,s,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=r<this.ticks.length;this._convertTicksToLabels(l?la(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=bc(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){j(this.options.afterUpdate,[this])}beforeSetDimensions(){j(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){j(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),j(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){j(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,n,s;for(i=0,n=t.length;i<n;i++)s=t[i],s.label=j(e.callback,[s.value,i,t],this)}afterTickToLabelConversion(){j(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){j(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=ra(this.ticks.length,t.ticks.maxTicksLimit),n=e.minRotation||0,s=e.maxRotation;let o=n,r,l,c;if(!this._isVisible()||!e.display||n>=s||i<=1||!this.isHorizontal()){this.labelRotation=n;return}const d=this._getLabelSizes(),h=d.widest.width,u=d.highest.height,m=X(this.chart.width-h,0,this.maxWidth);r=t.offset?this.maxWidth/i:m/(i-1),h+6>r&&(r=m/(i-(t.offset?.5:1)),l=this.maxHeight-ue(t.grid)-e.padding-ca(t.title,this.chart.options.font),c=Math.sqrt(h*h+u*u),o=ln(Math.min(Math.asin(X((d.highest.height+6)/r,-1,1)),Math.asin(X(l/c,-1,1))-Math.asin(X(u/c,-1,1)))),o=Math.max(n,Math.min(s,o))),this.labelRotation=o}afterCalculateLabelRotation(){j(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){j(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:n,grid:s}}=this,o=this._isVisible(),r=this.isHorizontal();if(o){const l=ca(n,e.options.font);if(r?(t.width=this.maxWidth,t.height=ue(s)+l):(t.height=this.maxHeight,t.width=ue(s)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:h,highest:u}=this._getLabelSizes(),m=i.padding*2,p=mt(this.labelRotation),g=Math.cos(p),f=Math.sin(p);if(r){const y=i.mirror?0:f*h.width+g*u.height;t.height=Math.min(this.maxHeight,t.height+y+m)}else{const y=i.mirror?0:g*h.width+f*u.height;t.width=Math.min(this.maxWidth,t.width+y+m)}this._calculatePadding(c,d,f,g)}}this._handleMargins(),r?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,n){const{ticks:{align:s,padding:o},position:r}=this.options,l=this.labelRotation!==0,c=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,m=0;l?c?(u=n*t.width,m=i*e.height):(u=i*t.height,m=n*e.width):s==="start"?m=e.width:s==="end"?u=t.width:s!=="inner"&&(u=t.width/2,m=e.width/2),this.paddingLeft=Math.max((u-d+o)*this.width/(this.width-d),0),this.paddingRight=Math.max((m-h+o)*this.width/(this.width-h),0)}else{let d=e.height/2,h=t.height/2;s==="start"?(d=0,h=t.height):s==="end"&&(d=e.height,h=0),this.paddingTop=d+o,this.paddingBottom=h+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){j(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)R(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=la(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:n,_longestTextCache:s}=this,o=[],r=[],l=Math.floor(e/ra(e,i));let c=0,d=0,h,u,m,p,g,f,y,_,b,x,v;for(h=0;h<e;h+=l){if(p=t[h].label,g=this._resolveTickFontOptions(h),n.font=f=g.string,y=s[f]=s[f]||{data:{},gc:[]},_=g.lineHeight,b=x=0,!R(p)&&!H(p))b=di(n,y.data,y.gc,b,p),x=_;else if(H(p))for(u=0,m=p.length;u<m;++u)v=p[u],!R(v)&&!H(v)&&(b=di(n,y.data,y.gc,b,v),x+=_);o.push(b),r.push(x),c=Math.max(b,c),d=Math.max(x,d)}Cc(s,e);const S=o.indexOf(c),k=r.indexOf(d),M=C=>({width:o[C]||0,height:r[C]||0});return{first:M(0),last:M(e-1),widest:M(S),highest:M(k),widths:o,heights:r}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return pr(this._alignToPixels?Wt(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=Ic(this.getContext(),t,i))}return this.$context||(this.$context=Ec(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=mt(this.labelRotation),i=Math.abs(Math.cos(e)),n=Math.abs(Math.sin(e)),s=this._getLabelSizes(),o=t.autoSkipPadding||0,r=s?s.widest.width+o:0,l=s?s.highest.height+o:0;return this.isHorizontal()?l*i>r*n?r/i:l/n:l*n<r*i?l/i:r/n}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,n=this.options,{grid:s,position:o,border:r}=n,l=s.offset,c=this.isHorizontal(),h=this.ticks.length+(l?1:0),u=ue(s),m=[],p=r.setContext(this.getContext()),g=p.display?p.width:0,f=g/2,y=function(W){return Wt(i,W,g)};let _,b,x,v,S,k,M,C,P,O,L,Q;if(o==="top")_=y(this.bottom),k=this.bottom-u,C=_-f,O=y(t.top)+f,Q=t.bottom;else if(o==="bottom")_=y(this.top),O=t.top,Q=y(t.bottom)-f,k=_+f,C=this.top+u;else if(o==="left")_=y(this.right),S=this.right-u,M=_-f,P=y(t.left)+f,L=t.right;else if(o==="right")_=y(this.left),P=t.left,L=y(t.right)-f,S=_+f,M=this.left+u;else if(e==="x"){if(o==="center")_=y((t.top+t.bottom)/2+.5);else if(T(o)){const W=Object.keys(o)[0],V=o[W];_=y(this.chart.scales[W].getPixelForValue(V))}O=t.top,Q=t.bottom,k=_+f,C=k+u}else if(e==="y"){if(o==="center")_=y((t.left+t.right)/2);else if(T(o)){const W=Object.keys(o)[0],V=o[W];_=y(this.chart.scales[W].getPixelForValue(V))}S=_-f,M=S-u,P=t.left,L=t.right}const rt=E(n.ticks.maxTicksLimit,h),N=Math.max(1,Math.ceil(h/rt));for(b=0;b<h;b+=N){const W=this.getContext(b),V=s.setContext(W),dt=r.setContext(W),tt=V.lineWidth,Zt=V.color,Ne=dt.dash||[],te=dt.dashOffset,re=V.tickWidth,Nt=V.tickColor,le=V.tickBorderDash||[],jt=V.tickBorderDashOffset;x=Ac(this,b,l),x!==void 0&&(v=Wt(i,x,tt),c?S=M=P=L=v:k=C=O=Q=v,m.push({tx1:S,ty1:k,tx2:M,ty2:C,x1:P,y1:O,x2:L,y2:Q,width:tt,color:Zt,borderDash:Ne,borderDashOffset:te,tickWidth:re,tickColor:Nt,tickBorderDash:le,tickBorderDashOffset:jt}))}return this._ticksLength=h,this._borderValue=_,m}_computeLabelItems(t){const e=this.axis,i=this.options,{position:n,ticks:s}=i,o=this.isHorizontal(),r=this.ticks,{align:l,crossAlign:c,padding:d,mirror:h}=s,u=ue(i.grid),m=u+d,p=h?-d:m,g=-mt(this.labelRotation),f=[];let y,_,b,x,v,S,k,M,C,P,O,L,Q="middle";if(n==="top")S=this.bottom-p,k=this._getXAxisLabelAlignment();else if(n==="bottom")S=this.top+p,k=this._getXAxisLabelAlignment();else if(n==="left"){const N=this._getYAxisLabelAlignment(u);k=N.textAlign,v=N.x}else if(n==="right"){const N=this._getYAxisLabelAlignment(u);k=N.textAlign,v=N.x}else if(e==="x"){if(n==="center")S=(t.top+t.bottom)/2+m;else if(T(n)){const N=Object.keys(n)[0],W=n[N];S=this.chart.scales[N].getPixelForValue(W)+m}k=this._getXAxisLabelAlignment()}else if(e==="y"){if(n==="center")v=(t.left+t.right)/2-m;else if(T(n)){const N=Object.keys(n)[0],W=n[N];v=this.chart.scales[N].getPixelForValue(W)}k=this._getYAxisLabelAlignment(u).textAlign}e==="y"&&(l==="start"?Q="top":l==="end"&&(Q="bottom"));const rt=this._getLabelSizes();for(y=0,_=r.length;y<_;++y){b=r[y],x=b.label;const N=s.setContext(this.getContext(y));M=this.getPixelForTick(y)+s.labelOffset,C=this._resolveTickFontOptions(y),P=C.lineHeight,O=H(x)?x.length:1;const W=O/2,V=N.color,dt=N.textStrokeColor,tt=N.textStrokeWidth;let Zt=k;o?(v=M,k==="inner"&&(y===_-1?Zt=this.options.reverse?"left":"right":y===0?Zt=this.options.reverse?"right":"left":Zt="center"),n==="top"?c==="near"||g!==0?L=-O*P+P/2:c==="center"?L=-rt.highest.height/2-W*P+P:L=-rt.highest.height+P/2:c==="near"||g!==0?L=P/2:c==="center"?L=rt.highest.height/2-W*P:L=rt.highest.height-O*P,h&&(L*=-1),g!==0&&!N.showLabelBackdrop&&(v+=P/2*Math.sin(g))):(S=M,L=(1-O)*P/2);let Ne;if(N.showLabelBackdrop){const te=at(N.backdropPadding),re=rt.heights[y],Nt=rt.widths[y];let le=L-te.top,jt=0-te.left;switch(Q){case"middle":le-=re/2;break;case"bottom":le-=re;break}switch(k){case"center":jt-=Nt/2;break;case"right":jt-=Nt;break;case"inner":y===_-1?jt-=Nt:y>0&&(jt-=Nt/2);break}Ne={left:jt,top:le,width:Nt+te.width,height:re+te.height,color:N.backdropColor}}f.push({label:x,font:C,textOffset:L,options:{rotation:g,color:V,strokeColor:dt,strokeWidth:tt,textAlign:Zt,textBaseline:Q,translation:[v,S],backdrop:Ne}})}return f}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-mt(this.labelRotation))return t==="top"?"left":"right";let n="center";return e.align==="start"?n="left":e.align==="end"?n="right":e.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:n,padding:s}}=this.options,o=this._getLabelSizes(),r=t+s,l=o.widest.width;let c,d;return e==="left"?n?(d=this.right+s,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-r,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):e==="right"?n?(d=this.left+s,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+r,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:n,width:s,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,n,s,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const n=this.ticks.findIndex(s=>s.value===t);return n>=0?e.setContext(this.getContext(n)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let s,o;const r=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(e.display)for(s=0,o=n.length;s<o;++s){const l=n[s];e.drawOnChartArea&&r({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&r({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:n}}=this,s=i.setContext(this.getContext()),o=i.display?s.width:0;if(!o)return;const r=n.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,h,u;this.isHorizontal()?(c=Wt(t,this.left,o)-o/2,d=Wt(t,this.right,r)+r/2,h=u=l):(h=Wt(t,this.top,o)-o/2,u=Wt(t,this.bottom,r)+r/2,c=d=l),e.save(),e.lineWidth=s.width,e.strokeStyle=s.color,e.beginPath(),e.moveTo(c,h),e.lineTo(d,u),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,n=this._computeLabelArea();n&&yi(i,n);const s=this.getLabelItems(t);for(const o of s){const r=o.options,l=o.font,c=o.label,d=o.textOffset;Xt(i,c,0,d,l,r)}n&&_i(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:n}}=this;if(!i.display)return;const s=K(i.font),o=at(i.padding),r=i.align;let l=s.lineHeight/2;e==="bottom"||e==="center"||T(e)?(l+=o.bottom,H(i.text)&&(l+=s.lineHeight*(i.text.length-1))):l+=o.top;const{titleX:c,titleY:d,maxWidth:h,rotation:u}=Oc(this,l,e,r);Xt(t,i.text,0,0,s,{color:i.color,maxWidth:h,rotation:u,textAlign:Pc(r,e,n),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=E(t.grid&&t.grid.z,-1),n=E(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==Qt.prototype.draw?[{z:e,draw:s=>{this.draw(s)}}]:[{z:i,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:e,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let s,o;for(s=0,o=e.length;s<o;++s){const r=e[s];r[i]===this.id&&(!t||r.type===t)&&n.push(r)}return n}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return K(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Ye{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;Lc(e)&&(i=this.register(e));const n=this.items,s=t.id,o=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+t);return s in n||(n[s]=t,Rc(t,o,i),this.override&&B.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,n=this.scope;i in e&&delete e[i],n&&i in B[n]&&(delete B[n][i],this.override&&delete Kt[i])}}function Rc(a,t,e){const i=Ae(Object.create(null),[e?B.get(e):{},B.get(t),a.defaults]);B.set(t,i),a.defaultRoutes&&Tc(t,a.defaultRoutes),a.descriptors&&B.describe(t,a.descriptors)}function Tc(a,t){Object.keys(t).forEach(e=>{const i=e.split("."),n=i.pop(),s=[a].concat(i).join("."),o=t[e].split("."),r=o.pop(),l=o.join(".");B.route(s,n,l,r)})}function Lc(a){return"id"in a&&"defaults"in a}class Dc{constructor(){this.controllers=new Ye(pt,"datasets",!0),this.elements=new Ye(gt,"elements"),this.plugins=new Ye(Object,"plugins"),this.scales=new Ye(Qt,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(n=>{const s=i||this._getRegistryForType(n);i||s.isForType(n)||s===this.plugins&&n.id?this._exec(t,s,n):F(n,o=>{const r=i||this._getRegistryForType(o);this._exec(t,r,o)})})}_exec(t,e,i){const n=rn(t);j(i["before"+n],[],i),e[t](i),j(i["after"+n],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const n=e.get(t);if(n===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return n}}var _t=new Dc;class Fc{constructor(){this._init=void 0}notify(t,e,i,n){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const s=n?this._descriptors(t).filter(n):this._descriptors(t),o=this._notify(s,t,e,i);return e==="afterDestroy"&&(this._notify(s,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,i,n){n=n||{};for(const s of t){const o=s.plugin,r=o[i],l=[e,n,s.options];if(j(r,l,o)===!1&&n.cancelable)return!1}return!0}invalidate(){R(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,n=E(i.options&&i.options.plugins,{}),s=Nc(i);return n===!1&&!e?[]:$c(t,s,n,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,n=(s,o)=>s.filter(r=>!o.some(l=>r.plugin.id===l.plugin.id));this._notify(n(e,i),t,"stop"),this._notify(n(i,e),t,"start")}}function Nc(a){const t={},e=[],i=Object.keys(_t.plugins.items);for(let s=0;s<i.length;s++)e.push(_t.getPlugin(i[s]));const n=a.plugins||[];for(let s=0;s<n.length;s++){const o=n[s];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function jc(a,t){return!t&&a===!1?null:a===!0?{}:a}function $c(a,{plugins:t,localIds:e},i,n){const s=[],o=a.getContext();for(const r of t){const l=r.id,c=jc(i[l],n);c!==null&&s.push({plugin:r,options:Wc(a.config,{plugin:r,local:e[l]},c,o)})}return s}function Wc(a,{plugin:t,local:e},i,n){const s=a.pluginScopeKeys(t),o=a.getOptionScopes(i,s);return e&&t.defaults&&o.push(t.defaults),a.createResolver(o,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Bi(a,t){const e=B.datasets[a]||{};return((t.datasets||{})[a]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function zc(a,t){let e=a;return a==="_index_"?e=t:a==="_value_"&&(e=t==="x"?"y":"x"),e}function Hc(a,t){return a===t?"_index_":"_value_"}function da(a){if(a==="x"||a==="y"||a==="r")return a}function Bc(a){if(a==="top"||a==="bottom")return"x";if(a==="left"||a==="right")return"y"}function Ui(a,...t){if(da(a))return a;for(const e of t){const i=e.axis||Bc(e.position)||a.length>1&&da(a[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${a}' axis. Please provide 'axis' or 'position' option.`)}function ha(a,t,e){if(e[t+"AxisID"]===a)return{axis:t}}function Uc(a,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===a||i.yAxisID===a);if(e.length)return ha(a,"x",e[0])||ha(a,"y",e[0])}return{}}function Vc(a,t){const e=Kt[a.type]||{scales:{}},i=t.scales||{},n=Bi(a.type,t),s=Object.create(null);return Object.keys(i).forEach(o=>{const r=i[o];if(!T(r))return console.error(`Invalid scale configuration for scale: ${o}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Ui(o,r,Uc(o,a),B.scales[r.type]),c=Hc(l,n),d=e.scales||{};s[o]=ve(Object.create(null),[{axis:l},r,d[l],d[c]])}),a.data.datasets.forEach(o=>{const r=o.type||a.type,l=o.indexAxis||Bi(r,t),d=(Kt[r]||{}).scales||{};Object.keys(d).forEach(h=>{const u=zc(h,l),m=o[u+"AxisID"]||u;s[m]=s[m]||Object.create(null),ve(s[m],[{axis:u},i[m],d[h]])})}),Object.keys(s).forEach(o=>{const r=s[o];ve(r,[B.scales[r.type],B.scale])}),s}function Es(a){const t=a.options||(a.options={});t.plugins=E(t.plugins,{}),t.scales=Vc(a,t)}function Is(a){return a=a||{},a.datasets=a.datasets||[],a.labels=a.labels||[],a}function Yc(a){return a=a||{},a.data=Is(a.data),Es(a),a}const ua=new Map,Ps=new Set;function Ge(a,t){let e=ua.get(a);return e||(e=t(),ua.set(a,e),Ps.add(e)),e}const me=(a,t,e)=>{const i=Lt(t,e);i!==void 0&&a.add(i)};class Gc{constructor(t){this._config=Yc(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Is(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Es(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Ge(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Ge(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Ge(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return Ge(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let n=i.get(t);return(!n||e)&&(n=new Map,i.set(t,n)),n}getOptionScopes(t,e,i){const{options:n,type:s}=this,o=this._cachedScopes(t,i),r=o.get(e);if(r)return r;const l=new Set;e.forEach(d=>{t&&(l.add(t),d.forEach(h=>me(l,t,h))),d.forEach(h=>me(l,n,h)),d.forEach(h=>me(l,Kt[s]||{},h)),d.forEach(h=>me(l,B,h)),d.forEach(h=>me(l,Wi,h))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Ps.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,Kt[e]||{},B.datasets[e]||{},{type:e},B,Wi]}resolveNamedOptions(t,e,i,n=[""]){const s={$shared:!0},{resolver:o,subPrefixes:r}=ma(this._resolverCache,t,n);let l=o;if(qc(o,e)){s.$shared=!1,i=Dt(i)?i():i;const c=this.createResolver(t,i,r);l=se(o,i,c)}for(const c of e)s[c]=l[c];return s}createResolver(t,e,i=[""],n){const{resolver:s}=ma(this._resolverCache,t,i);return T(e)?se(s,e,void 0,n):s}}function ma(a,t,e){let i=a.get(t);i||(i=new Map,a.set(t,i));const n=e.join();let s=i.get(n);return s||(s={resolver:mn(t,e),subPrefixes:e.filter(r=>!r.toLowerCase().includes("hover"))},i.set(n,s)),s}const Jc=a=>T(a)&&Object.getOwnPropertyNames(a).some(t=>Dt(a[t]));function qc(a,t){const{isScriptable:e,isIndexable:i}=ls(a);for(const n of t){const s=e(n),o=i(n),r=(o||s)&&a[n];if(s&&(Dt(r)||Jc(r))||o&&H(r))return!0}return!1}var Kc="4.5.1";const Xc=["top","bottom","left","right","chartArea"];function pa(a,t){return a==="top"||a==="bottom"||Xc.indexOf(a)===-1&&t==="x"}function ga(a,t){return function(e,i){return e[a]===i[a]?e[t]-i[t]:e[a]-i[a]}}function fa(a){const t=a.chart,e=t.options.animation;t.notifyPlugins("afterRender"),j(e&&e.onComplete,[a],t)}function Qc(a){const t=a.chart,e=t.options.animation;j(e&&e.onProgress,[a],t)}function Os(a){return fn()&&typeof a=="string"?a=document.getElementById(a):a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}const ni={},ya=a=>{const t=Os(a);return Object.values(ni).filter(e=>e.canvas===t).pop()};function Zc(a,t,e){const i=Object.keys(a);for(const n of i){const s=+n;if(s>=t){const o=a[n];delete a[n],(e>0||s>t)&&(a[s+e]=o)}}}function td(a,t,e,i){return!e||a.type==="mouseout"?null:i?t:a}var Ct;let bn=(Ct=class{static register(...t){_t.add(...t),_a()}static unregister(...t){_t.remove(...t),_a()}constructor(t,e){const i=this.config=new Gc(e),n=Os(t),s=ya(n);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||_c(n)),this.platform.updateConfig(i);const r=this.platform.acquireContext(n,o.aspectRatio),l=r&&r.canvas,c=l&&l.height,d=l&&l.width;if(this.id=er(),this.ctx=r,this.canvas=l,this.width=d,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Fc,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=_r(h=>this.update(h),o.resizeDelay||0),this._dataChanges=[],ni[this.id]=this,!r||!l){console.error("Failed to create chart: can't acquire context from the given item");return}xt.listen(this,"complete",fa),xt.listen(this,"progress",Qc),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:n,_aspectRatio:s}=this;return R(t)?e&&s?s:n?i/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return _t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Wn(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Nn(this.canvas,this.ctx),this}stop(){return xt.stop(this),this}resize(t,e){xt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,n=this.canvas,s=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(n,t,e,s),r=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,Wn(this,r,!0)&&(this.notifyPlugins("resize",{size:o}),j(i.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};F(e,(i,n)=>{i.id=n})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,n=Object.keys(i).reduce((o,r)=>(o[r]=!1,o),{});let s=[];e&&(s=s.concat(Object.keys(e).map(o=>{const r=e[o],l=Ui(o,r),c=l==="r",d=l==="x";return{options:r,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),F(s,o=>{const r=o.options,l=r.id,c=Ui(l,r),d=E(r.type,o.dtype);(r.position===void 0||pa(r.position,c)!==pa(o.dposition))&&(r.position=o.dposition),n[l]=!0;let h=null;if(l in i&&i[l].type===d)h=i[l];else{const u=_t.getScale(d);h=new u({id:l,type:d,ctx:this.ctx,chart:this}),i[h.id]=h}h.init(r,t)}),F(n,(o,r)=>{o||delete i[r]}),F(i,o=>{nt.configure(this,o,o.options),nt.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((n,s)=>n.index-s.index),i>e){for(let n=e;n<i;++n)this._destroyDatasetMeta(n);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(ga("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,n)=>{e.filter(s=>s===i._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=e.length;i<n;i++){const s=e[i];let o=this.getDatasetMeta(i);const r=s.type||this.config.type;if(o.type&&o.type!==r&&(this._destroyDatasetMeta(i),o=this.getDatasetMeta(i)),o.type=r,o.indexAxis=s.indexAxis||Bi(r,this.options),o.order=s.order||0,o.index=i,o.label=""+s.label,o.visible=this.isDatasetVisible(i),o.controller)o.controller.updateIndex(i),o.controller.linkScales();else{const l=_t.getController(r),{datasetElementType:c,dataElementType:d}=B.datasets[r];Object.assign(l,{dataElementType:_t.getElement(d),datasetElementType:c&&_t.getElement(c)}),o.controller=new l(this,i),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){F(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:h}=this.getDatasetMeta(c),u=!n&&s.indexOf(h)===-1;h.buildOrUpdateElements(u),o=Math.max(+h.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),n||F(s,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(ga("z","_idx"));const{_active:r,_lastEvent:l}=this;l?this._eventHandler(l,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){F(this.scales,t=>{nt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!En(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:s}of e){const o=i==="_removeElements"?-s:s;Zc(t,n,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=s=>new Set(t.filter(o=>o[0]===s).map((o,r)=>r+","+o.splice(1).join(","))),n=i(0);for(let s=1;s<e;s++)if(!En(n,i(s)))return;return Array.from(n).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;nt.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],F(this.boxes,n=>{i&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,s)=>{n._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,Dt(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),n={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(i.controller._update(e),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(xt.has(this)?this.attached&&!xt.running(this)&&xt.start(this):(this.draw(),fa({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let n,s;for(n=0,s=e.length;n<s;++n){const o=e[n];(!t||o.visible)&&i.push(o)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},n=bs(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(n&&yi(e,n),t.controller.draw(),n&&_i(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return At(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,n){const s=Xl.modes[e];return typeof s=="function"?s(this,t,i,n):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let n=i.filter(s=>s&&s._dataset===e).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=Ft(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const n=i?"show":"hide",s=this.getDatasetMeta(t),o=s.controller._resolveAnimations(void 0,n);Ce(e)?(s.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(s,{visible:i}),this.update(r=>r.datasetIndex===t?n:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),xt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Nn(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete ni[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(s,o)=>{e.addEventListener(this,s,o),t[s]=o},n=(s,o,r)=>{s.offsetX=o,s.offsetY=r,this._eventHandler(s)};F(this.options.events,s=>i(s,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},n=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},s=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const r=()=>{n("attach",r),this.attached=!0,this.resize(),i("resize",s),i("detach",o)};o=()=>{this.attached=!1,n("resize",s),this._stop(),this._resize(0,0),i("attach",r)},e.isAttached(this.canvas)?r():o()}unbindEvents(){F(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},F(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const n=i?"set":"remove";let s,o,r,l;for(e==="dataset"&&(s=this.getDatasetMeta(t[0].datasetIndex),s.controller["_"+n+"DatasetHoverStyle"]()),r=0,l=t.length;r<l;++r){o=t[r];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[n+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:s,index:o})=>{const r=this.getDatasetMeta(s);if(!r)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:r.data[o],index:o}});!ri(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const n=this.options.hover,s=(l,c)=>l.filter(d=>!c.some(h=>d.datasetIndex===h.datasetIndex&&d.index===h.index)),o=s(e,t),r=i?t:s(t,e);o.length&&this.updateHoverStyle(o,n.mode,!1),r.length&&n.mode&&this.updateHoverStyle(r,n.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},n=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,n)===!1)return;const s=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(s||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:n=[],options:s}=this,o=e,r=this._getActiveElements(t,n,i,o),l=rr(t),c=td(t,this._lastEvent,i,l);i&&(this._lastEvent=null,j(s.onHover,[t,r,this],this),l&&j(s.onClick,[t,r,this],this));const d=!ri(r,n);return(d||e)&&(this._active=r,this._updateHoverStyles(r,n,e)),this._lastEvent=c,d}_getActiveElements(t,e,i,n){if(t.type==="mouseout")return[];if(!i)return e;const s=this.options.hover;return this.getElementsAtEventForMode(t,s.mode,s,n)}},w(Ct,"defaults",B),w(Ct,"instances",ni),w(Ct,"overrides",Kt),w(Ct,"registry",_t),w(Ct,"version",Kc),w(Ct,"getChart",ya),Ct);function _a(){return F(bn.instances,a=>a._plugins.invalidate())}function ed(a,t,e){const{startAngle:i,x:n,y:s,outerRadius:o,innerRadius:r,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,h=Math.min(c/o,it(i-e));if(a.beginPath(),a.arc(n,s,o-c/2,i+h/2,e-h/2),r>0){const u=Math.min(c/r,it(i-e));a.arc(n,s,r+c/2,e-u/2,i+u/2,!0)}else{const u=Math.min(c/2,o*it(i-e));if(d==="round")a.arc(n,s,u,e-D/2,i+D/2,!0);else if(d==="bevel"){const m=2*u*u,p=-m*Math.cos(e+D/2)+n,g=-m*Math.sin(e+D/2)+s,f=m*Math.cos(i+D/2)+n,y=m*Math.sin(i+D/2)+s;a.lineTo(p,g),a.lineTo(f,y)}}a.closePath(),a.moveTo(0,0),a.rect(0,0,a.canvas.width,a.canvas.height),a.clip("evenodd")}function id(a,t,e){const{startAngle:i,pixelMargin:n,x:s,y:o,outerRadius:r,innerRadius:l}=t;let c=n/r;a.beginPath(),a.arc(s,o,r,i-c,e+c),l>n?(c=n/l,a.arc(s,o,l,e+c,i-c,!0)):a.arc(s,o,n,e+G,i-G),a.closePath(),a.clip()}function nd(a){return un(a,["outerStart","outerEnd","innerStart","innerEnd"])}function ad(a,t,e,i){const n=nd(a.options.borderRadius),s=(e-t)/2,o=Math.min(s,i*t/2),r=l=>{const c=(e-Math.min(s,l))*i/2;return X(l,0,Math.min(s,c))};return{outerStart:r(n.outerStart),outerEnd:r(n.outerEnd),innerStart:X(n.innerStart,0,o),innerEnd:X(n.innerEnd,0,o)}}function ie(a,t,e,i){return{x:e+a*Math.cos(t),y:i+a*Math.sin(t)}}function mi(a,t,e,i,n,s){const{x:o,y:r,startAngle:l,pixelMargin:c,innerRadius:d}=t,h=Math.max(t.outerRadius+i+e-c,0),u=d>0?d+i+e+c:0;let m=0;const p=n-l;if(i){const N=d>0?d-i:0,W=h>0?h-i:0,V=(N+W)/2,dt=V!==0?p*V/(V+i):p;m=(p-dt)/2}const g=Math.max(.001,p*h-e/D)/h,f=(p-g)/2,y=l+f+m,_=n-f-m,{outerStart:b,outerEnd:x,innerStart:v,innerEnd:S}=ad(t,u,h,_-y),k=h-b,M=h-x,C=y+b/k,P=_-x/M,O=u+v,L=u+S,Q=y+v/O,rt=_-S/L;if(a.beginPath(),s){const N=(C+P)/2;if(a.arc(o,r,h,C,N),a.arc(o,r,h,N,P),x>0){const tt=ie(M,P,o,r);a.arc(tt.x,tt.y,x,P,_+G)}const W=ie(L,_,o,r);if(a.lineTo(W.x,W.y),S>0){const tt=ie(L,rt,o,r);a.arc(tt.x,tt.y,S,_+G,rt+Math.PI)}const V=(_-S/u+(y+v/u))/2;if(a.arc(o,r,u,_-S/u,V,!0),a.arc(o,r,u,V,y+v/u,!0),v>0){const tt=ie(O,Q,o,r);a.arc(tt.x,tt.y,v,Q+Math.PI,y-G)}const dt=ie(k,y,o,r);if(a.lineTo(dt.x,dt.y),b>0){const tt=ie(k,C,o,r);a.arc(tt.x,tt.y,b,y-G,C)}}else{a.moveTo(o,r);const N=Math.cos(C)*h+o,W=Math.sin(C)*h+r;a.lineTo(N,W);const V=Math.cos(P)*h+o,dt=Math.sin(P)*h+r;a.lineTo(V,dt)}a.closePath()}function sd(a,t,e,i,n){const{fullCircles:s,startAngle:o,circumference:r}=t;let l=t.endAngle;if(s){mi(a,t,e,i,l,n);for(let c=0;c<s;++c)a.fill();isNaN(r)||(l=o+(r%$||$))}return mi(a,t,e,i,l,n),a.fill(),l}function od(a,t,e,i,n){const{fullCircles:s,startAngle:o,circumference:r,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:h,borderDashOffset:u,borderRadius:m}=l,p=l.borderAlign==="inner";if(!c)return;a.setLineDash(h||[]),a.lineDashOffset=u,p?(a.lineWidth=c*2,a.lineJoin=d||"round"):(a.lineWidth=c,a.lineJoin=d||"bevel");let g=t.endAngle;if(s){mi(a,t,e,i,g,n);for(let f=0;f<s;++f)a.stroke();isNaN(r)||(g=o+(r%$||$))}p&&id(a,t,g),l.selfJoin&&g-o>=D&&m===0&&d!=="miter"&&ed(a,t,g),s||(mi(a,t,e,i,g,n),a.stroke())}class ye extends gt{constructor(e){super();w(this,"circumference");w(this,"endAngle");w(this,"fullCircles");w(this,"innerRadius");w(this,"outerRadius");w(this,"pixelMargin");w(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,i,n){const s=this.getProps(["x","y"],n),{angle:o,distance:r}=Qa(s,{x:e,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:h,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),m=(this.options.spacing+this.options.borderWidth)/2,p=E(u,c-l),g=Ee(o,l,c)&&l!==c,f=p>=$||g,y=kt(r,d+m,h+m);return f&&y}getCenterPoint(e){const{x:i,y:n,startAngle:s,endAngle:o,innerRadius:r,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,h=(s+o)/2,u=(r+l+d+c)/2;return{x:i+Math.cos(h)*u,y:n+Math.sin(h)*u}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:i,circumference:n}=this,s=(i.offset||0)/4,o=(i.spacing||0)/2,r=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=n>$?Math.floor(n/$):0,n===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*s,Math.sin(l)*s);const c=1-Math.sin(Math.min(D,n||0)),d=s*c;e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,sd(e,this,d,o,r),od(e,this,d,o,r),e.restore()}}w(ye,"id","arc"),w(ye,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),w(ye,"defaultRoutes",{backgroundColor:"backgroundColor"}),w(ye,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function Rs(a,t,e=t){a.lineCap=E(e.borderCapStyle,t.borderCapStyle),a.setLineDash(E(e.borderDash,t.borderDash)),a.lineDashOffset=E(e.borderDashOffset,t.borderDashOffset),a.lineJoin=E(e.borderJoinStyle,t.borderJoinStyle),a.lineWidth=E(e.borderWidth,t.borderWidth),a.strokeStyle=E(e.borderColor,t.borderColor)}function rd(a,t,e){a.lineTo(e.x,e.y)}function ld(a){return a.stepped?Pr:a.tension||a.cubicInterpolationMode==="monotone"?Or:rd}function Ts(a,t,e={}){const i=a.length,{start:n=0,end:s=i-1}=e,{start:o,end:r}=t,l=Math.max(n,o),c=Math.min(s,r),d=n<o&&s<o||n>r&&s>r;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function cd(a,t,e,i){const{points:n,options:s}=t,{count:o,start:r,loop:l,ilen:c}=Ts(n,e,i),d=ld(s);let{move:h=!0,reverse:u}=i||{},m,p,g;for(m=0;m<=c;++m)p=n[(r+(u?c-m:m))%o],!p.skip&&(h?(a.moveTo(p.x,p.y),h=!1):d(a,g,p,u,s.stepped),g=p);return l&&(p=n[(r+(u?c:0))%o],d(a,g,p,u,s.stepped)),!!l}function dd(a,t,e,i){const n=t.points,{count:s,start:o,ilen:r}=Ts(n,e,i),{move:l=!0,reverse:c}=i||{};let d=0,h=0,u,m,p,g,f,y;const _=x=>(o+(c?r-x:x))%s,b=()=>{g!==f&&(a.lineTo(d,f),a.lineTo(d,g),a.lineTo(d,y))};for(l&&(m=n[_(0)],a.moveTo(m.x,m.y)),u=0;u<=r;++u){if(m=n[_(u)],m.skip)continue;const x=m.x,v=m.y,S=x|0;S===p?(v<g?g=v:v>f&&(f=v),d=(h*d+x)/++h):(b(),a.lineTo(x,v),p=S,h=0,g=f=v),y=v}b()}function Vi(a){const t=a.options,e=t.borderDash&&t.borderDash.length;return!a._decimated&&!a._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?dd:cd}function hd(a){return a.stepped?cl:a.tension||a.cubicInterpolationMode==="monotone"?dl:Ut}function ud(a,t,e,i){let n=t._path;n||(n=t._path=new Path2D,t.path(n,e,i)&&n.closePath()),Rs(a,t.options),a.stroke(n)}function md(a,t,e,i){const{segments:n,options:s}=t,o=Vi(t);for(const r of n)Rs(a,s,r.style),a.beginPath(),o(a,t,r,{start:e,end:e+i-1})&&a.closePath(),a.stroke()}const pd=typeof Path2D=="function";function gd(a,t,e,i){pd&&!t.options.segment?ud(a,t,e,i):md(a,t,e,i)}class Ot extends gt{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;el(this._points,i,t,n,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=fl(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,n=t[e],s=this.points,o=_s(this,{property:e,start:n,end:n});if(!o.length)return;const r=[],l=hd(i);let c,d;for(c=0,d=o.length;c<d;++c){const{start:h,end:u}=o[c],m=s[h],p=s[u];if(m===p){r.push(m);continue}const g=Math.abs((n-m[e])/(p[e]-m[e])),f=l(m,p,g,i.stepped);f[e]=t[e],r.push(f)}return r.length===1?r[0]:r}pathSegment(t,e,i){return Vi(this)(t,this,e,i)}path(t,e,i){const n=this.segments,s=Vi(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const r of n)o&=s(t,this,r,{start:e,end:e+i-1});return!!o}draw(t,e,i,n){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(t.save(),gd(t,this,i,n),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}w(Ot,"id","line"),w(Ot,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),w(Ot,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),w(Ot,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function ba(a,t,e,i){const n=a.options,{[e]:s}=a.getProps([e],i);return Math.abs(t-s)<n.radius+n.hitRadius}class ai extends gt{constructor(e){super();w(this,"parsed");w(this,"skip");w(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,i,n){const s=this.options,{x:o,y:r}=this.getProps(["x","y"],n);return Math.pow(e-o,2)+Math.pow(i-r,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(e,i){return ba(this,e,"x",i)}inYRange(e,i){return ba(this,e,"y",i)}getCenterPoint(e){const{x:i,y:n}=this.getProps(["x","y"],e);return{x:i,y:n}}size(e){e=e||this.options||{};let i=e.radius||0;i=Math.max(i,i&&e.hoverRadius||0);const n=i&&e.borderWidth||0;return(i+n)*2}draw(e,i){const n=this.options;this.skip||n.radius<.1||!At(this,i,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,zi(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}w(ai,"id","point"),w(ai,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),w(ai,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Ls(a,t){const{x:e,y:i,base:n,width:s,height:o}=a.getProps(["x","y","base","width","height"],t);let r,l,c,d,h;return a.horizontal?(h=o/2,r=Math.min(e,n),l=Math.max(e,n),c=i-h,d=i+h):(h=s/2,r=e-h,l=e+h,c=Math.min(i,n),d=Math.max(i,n)),{left:r,top:c,right:l,bottom:d}}function Rt(a,t,e,i){return a?0:X(t,e,i)}function fd(a,t,e){const i=a.options.borderWidth,n=a.borderSkipped,s=rs(i);return{t:Rt(n.top,s.top,0,e),r:Rt(n.right,s.right,0,t),b:Rt(n.bottom,s.bottom,0,e),l:Rt(n.left,s.left,0,t)}}function yd(a,t,e){const{enableBorderRadius:i}=a.getProps(["enableBorderRadius"]),n=a.options.borderRadius,s=Jt(n),o=Math.min(t,e),r=a.borderSkipped,l=i||T(n);return{topLeft:Rt(!l||r.top||r.left,s.topLeft,0,o),topRight:Rt(!l||r.top||r.right,s.topRight,0,o),bottomLeft:Rt(!l||r.bottom||r.left,s.bottomLeft,0,o),bottomRight:Rt(!l||r.bottom||r.right,s.bottomRight,0,o)}}function _d(a){const t=Ls(a),e=t.right-t.left,i=t.bottom-t.top,n=fd(a,e/2,i/2),s=yd(a,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:s},inner:{x:t.left+n.l,y:t.top+n.t,w:e-n.l-n.r,h:i-n.t-n.b,radius:{topLeft:Math.max(0,s.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,s.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,s.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,s.bottomRight-Math.max(n.b,n.r))}}}}function Ti(a,t,e,i){const n=t===null,s=e===null,r=a&&!(n&&s)&&Ls(a,i);return r&&(n||kt(t,r.left,r.right))&&(s||kt(e,r.top,r.bottom))}function bd(a){return a.topLeft||a.topRight||a.bottomLeft||a.bottomRight}function vd(a,t){a.rect(t.x,t.y,t.w,t.h)}function Li(a,t,e={}){const i=a.x!==e.x?-t:0,n=a.y!==e.y?-t:0,s=(a.x+a.w!==e.x+e.w?t:0)-i,o=(a.y+a.h!==e.y+e.h?t:0)-n;return{x:a.x+i,y:a.y+n,w:a.w+s,h:a.h+o,radius:a.radius}}class si extends gt{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:n}}=this,{inner:s,outer:o}=_d(this),r=bd(o.radius)?Ie:vd;t.save(),(o.w!==s.w||o.h!==s.h)&&(t.beginPath(),r(t,Li(o,e,s)),t.clip(),r(t,Li(s,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),r(t,Li(s,e)),t.fillStyle=n,t.fill(),t.restore()}inRange(t,e,i){return Ti(this,t,e,i)}inXRange(t,e){return Ti(this,t,null,e)}inYRange(t,e){return Ti(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:n,horizontal:s}=this.getProps(["x","y","base","horizontal"],t);return{x:s?(e+n)/2:e,y:s?i:(i+n)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}w(si,"id","bar"),w(si,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),w(si,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var xd=Object.freeze({__proto__:null,ArcElement:ye,BarElement:si,LineElement:Ot,PointElement:ai});const Yi=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],va=Yi.map(a=>a.replace("rgb(","rgba(").replace(")",", 0.5)"));function Ds(a){return Yi[a%Yi.length]}function Fs(a){return va[a%va.length]}function wd(a,t){return a.borderColor=Ds(t),a.backgroundColor=Fs(t),++t}function Sd(a,t){return a.backgroundColor=a.data.map(()=>Ds(t++)),t}function kd(a,t){return a.backgroundColor=a.data.map(()=>Fs(t++)),t}function Md(a){let t=0;return(e,i)=>{const n=a.getDatasetMeta(i).controller;n instanceof Gt?t=Sd(e,t):n instanceof ke?t=kd(e,t):n&&(t=wd(e,t))}}function xa(a){let t;for(t in a)if(a[t].borderColor||a[t].backgroundColor)return!0;return!1}function Ad(a){return a&&(a.borderColor||a.backgroundColor)}function Cd(){return B.borderColor!=="rgba(0,0,0,0.1)"||B.backgroundColor!=="rgba(0,0,0,0.1)"}var Ed={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(a,t,e){if(!e.enabled)return;const{data:{datasets:i},options:n}=a.config,{elements:s}=n,o=xa(i)||Ad(n)||s&&xa(s)||Cd();if(!e.forceOverride&&o)return;const r=Md(a);i.forEach(r)}};function Id(a,t,e,i,n){const s=n.samples||i;if(s>=e)return a.slice(t,t+e);const o=[],r=(e-2)/(s-2);let l=0;const c=t+e-1;let d=t,h,u,m,p,g;for(o[l++]=a[d],h=0;h<s-2;h++){let f=0,y=0,_;const b=Math.floor((h+1)*r)+1+t,x=Math.min(Math.floor((h+2)*r)+1,e)+t,v=x-b;for(_=b;_<x;_++)f+=a[_].x,y+=a[_].y;f/=v,y/=v;const S=Math.floor(h*r)+1+t,k=Math.min(Math.floor((h+1)*r)+1,e)+t,{x:M,y:C}=a[d];for(m=p=-1,_=S;_<k;_++)p=.5*Math.abs((M-f)*(a[_].y-C)-(M-a[_].x)*(y-C)),p>m&&(m=p,u=a[_],g=_);o[l++]=u,d=g}return o[l++]=a[c],o}function Pd(a,t,e,i){let n=0,s=0,o,r,l,c,d,h,u,m,p,g;const f=[],y=t+e-1,_=a[t].x,x=a[y].x-_;for(o=t;o<t+e;++o){r=a[o],l=(r.x-_)/x*i,c=r.y;const v=l|0;if(v===d)c<p?(p=c,h=o):c>g&&(g=c,u=o),n=(s*n+r.x)/++s;else{const S=o-1;if(!R(h)&&!R(u)){const k=Math.min(h,u),M=Math.max(h,u);k!==m&&k!==S&&f.push({...a[k],x:n}),M!==m&&M!==S&&f.push({...a[M],x:n})}o>0&&S!==m&&f.push(a[S]),f.push(r),d=v,s=0,p=g=c,h=u=m=o}}return f}function Ns(a){if(a._decimated){const t=a._data;delete a._decimated,delete a._data,Object.defineProperty(a,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function wa(a){a.data.datasets.forEach(t=>{Ns(t)})}function Od(a,t){const e=t.length;let i=0,n;const{iScale:s}=a,{min:o,max:r,minDefined:l,maxDefined:c}=s.getUserBounds();return l&&(i=X(Mt(t,s.axis,o).lo,0,e-1)),c?n=X(Mt(t,s.axis,r).hi+1,i,e)-i:n=e-i,{start:i,count:n}}var Rd={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(a,t,e)=>{if(!e.enabled){wa(a);return}const i=a.width;a.data.datasets.forEach((n,s)=>{const{_data:o,indexAxis:r}=n,l=a.getDatasetMeta(s),c=o||n.data;if(ge([r,a.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=a.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||a.options.parsing)return;let{start:h,count:u}=Od(l,c);const m=e.threshold||4*i;if(u<=m){Ns(n);return}R(o)&&(n._data=c,delete n.data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(g){this._data=g}}));let p;switch(e.algorithm){case"lttb":p=Id(c,h,u,i,e);break;case"min-max":p=Pd(c,h,u,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}n._decimated=p})},destroy(a){wa(a)}};function Td(a,t,e){const i=a.segments,n=a.points,s=t.points,o=[];for(const r of i){let{start:l,end:c}=r;c=xi(l,c,n);const d=Gi(e,n[l],n[c],r.loop);if(!t.segments){o.push({source:r,target:d,start:n[l],end:n[c]});continue}const h=_s(t,d);for(const u of h){const m=Gi(e,s[u.start],s[u.end],u.loop),p=ys(r,n,m);for(const g of p)o.push({source:g,target:u,start:{[e]:Sa(d,m,"start",Math.max)},end:{[e]:Sa(d,m,"end",Math.min)}})}}return o}function Gi(a,t,e,i){if(i)return;let n=t[a],s=e[a];return a==="angle"&&(n=it(n),s=it(s)),{property:a,start:n,end:s}}function Ld(a,t){const{x:e=null,y:i=null}=a||{},n=t.points,s=[];return t.segments.forEach(({start:o,end:r})=>{r=xi(o,r,n);const l=n[o],c=n[r];i!==null?(s.push({x:l.x,y:i}),s.push({x:c.x,y:i})):e!==null&&(s.push({x:e,y:l.y}),s.push({x:e,y:c.y}))}),s}function xi(a,t,e){for(;t>a;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function Sa(a,t,e,i){return a&&t?i(a[e],t[e]):a?a[e]:t?t[e]:0}function js(a,t){let e=[],i=!1;return H(a)?(i=!0,e=a):e=Ld(a,t),e.length?new Ot({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function ka(a){return a&&a.fill!==!1}function Dd(a,t,e){let n=a[t].fill;const s=[t];let o;if(!e)return n;for(;n!==!1&&s.indexOf(n)===-1;){if(!U(n))return n;if(o=a[n],!o)return!1;if(o.visible)return n;s.push(n),n=o.fill}return!1}function Fd(a,t,e){const i=Wd(a);if(T(i))return isNaN(i.value)?!1:i;let n=parseFloat(i);return U(n)&&Math.floor(n)===n?Nd(i[0],t,n,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Nd(a,t,e,i){return(a==="-"||a==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function jd(a,t){let e=null;return a==="start"?e=t.bottom:a==="end"?e=t.top:T(a)?e=t.getPixelForValue(a.value):t.getBasePixel&&(e=t.getBasePixel()),e}function $d(a,t,e){let i;return a==="start"?i=e:a==="end"?i=t.options.reverse?t.min:t.max:T(a)?i=a.value:i=t.getBaseValue(),i}function Wd(a){const t=a.options,e=t.fill;let i=E(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function zd(a){const{scale:t,index:e,line:i}=a,n=[],s=i.segments,o=i.points,r=Hd(t,e);r.push(js({x:null,y:t.bottom},i));for(let l=0;l<s.length;l++){const c=s[l];for(let d=c.start;d<=c.end;d++)Bd(n,o[d],r)}return new Ot({points:n,options:{}})}function Hd(a,t){const e=[],i=a.getMatchingVisibleMetas("line");for(let n=0;n<i.length;n++){const s=i[n];if(s.index===t)break;s.hidden||e.unshift(s.dataset)}return e}function Bd(a,t,e){const i=[];for(let n=0;n<e.length;n++){const s=e[n],{first:o,last:r,point:l}=Ud(s,t,"x");if(!(!l||o&&r)){if(o)i.unshift(l);else if(a.push(l),!r)break}}a.push(...i)}function Ud(a,t,e){const i=a.interpolate(t,e);if(!i)return{};const n=i[e],s=a.segments,o=a.points;let r=!1,l=!1;for(let c=0;c<s.length;c++){const d=s[c],h=o[d.start][e],u=o[d.end][e];if(kt(n,h,u)){r=n===h,l=n===u;break}}return{first:r,last:l,point:i}}class $s{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:n,y:s,radius:o}=this;return e=e||{start:0,end:$},t.arc(n,s,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:n}=this,s=t.angle;return{x:e+Math.cos(s)*n,y:i+Math.sin(s)*n,angle:s}}}function Vd(a){const{chart:t,fill:e,line:i}=a;if(U(e))return Yd(t,e);if(e==="stack")return zd(a);if(e==="shape")return!0;const n=Gd(a);return n instanceof $s?n:js(n,i)}function Yd(a,t){const e=a.getDatasetMeta(t);return e&&a.isDatasetVisible(t)?e.dataset:null}function Gd(a){return(a.scale||{}).getPointPositionForValue?qd(a):Jd(a)}function Jd(a){const{scale:t={},fill:e}=a,i=jd(e,t);if(U(i)){const n=t.isHorizontal();return{x:n?i:null,y:n?null:i}}return null}function qd(a){const{scale:t,fill:e}=a,i=t.options,n=t.getLabels().length,s=i.reverse?t.max:t.min,o=$d(e,t,s),r=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,s);return new $s({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<n;++l)r.push(t.getPointPositionForValue(l,o));return r}function Di(a,t,e){const i=Vd(t),{chart:n,index:s,line:o,scale:r,axis:l}=t,c=o.options,d=c.fill,h=c.backgroundColor,{above:u=h,below:m=h}=d||{},p=n.getDatasetMeta(s),g=bs(n,p);i&&o.points.length&&(yi(a,e),Kd(a,{line:o,target:i,above:u,below:m,area:e,scale:r,axis:l,clip:g}),_i(a))}function Kd(a,t){const{line:e,target:i,above:n,below:s,area:o,scale:r,clip:l}=t,c=e._loop?"angle":t.axis;a.save();let d=s;s!==n&&(c==="x"?(Ma(a,i,o.top),Fi(a,{line:e,target:i,color:n,scale:r,property:c,clip:l}),a.restore(),a.save(),Ma(a,i,o.bottom)):c==="y"&&(Aa(a,i,o.left),Fi(a,{line:e,target:i,color:s,scale:r,property:c,clip:l}),a.restore(),a.save(),Aa(a,i,o.right),d=n)),Fi(a,{line:e,target:i,color:d,scale:r,property:c,clip:l}),a.restore()}function Ma(a,t,e){const{segments:i,points:n}=t;let s=!0,o=!1;a.beginPath();for(const r of i){const{start:l,end:c}=r,d=n[l],h=n[xi(l,c,n)];s?(a.moveTo(d.x,d.y),s=!1):(a.lineTo(d.x,e),a.lineTo(d.x,d.y)),o=!!t.pathSegment(a,r,{move:o}),o?a.closePath():a.lineTo(h.x,e)}a.lineTo(t.first().x,e),a.closePath(),a.clip()}function Aa(a,t,e){const{segments:i,points:n}=t;let s=!0,o=!1;a.beginPath();for(const r of i){const{start:l,end:c}=r,d=n[l],h=n[xi(l,c,n)];s?(a.moveTo(d.x,d.y),s=!1):(a.lineTo(e,d.y),a.lineTo(d.x,d.y)),o=!!t.pathSegment(a,r,{move:o}),o?a.closePath():a.lineTo(e,h.y)}a.lineTo(e,t.first().y),a.closePath(),a.clip()}function Fi(a,t){const{line:e,target:i,property:n,color:s,scale:o,clip:r}=t,l=Td(e,i,n);for(const{source:c,target:d,start:h,end:u}of l){const{style:{backgroundColor:m=s}={}}=c,p=i!==!0;a.save(),a.fillStyle=m,Xd(a,o,r,p&&Gi(n,h,u)),a.beginPath();const g=!!e.pathSegment(a,c);let f;if(p){g?a.closePath():Ca(a,i,u,n);const y=!!i.pathSegment(a,d,{move:g,reverse:!0});f=g&&y,f||Ca(a,i,h,n)}a.closePath(),a.fill(f?"evenodd":"nonzero"),a.restore()}}function Xd(a,t,e,i){const n=t.chart.chartArea,{property:s,start:o,end:r}=i||{};if(s==="x"||s==="y"){let l,c,d,h;s==="x"?(l=o,c=n.top,d=r,h=n.bottom):(l=n.left,c=o,d=n.right,h=r),a.beginPath(),e&&(l=Math.max(l,e.left),d=Math.min(d,e.right),c=Math.max(c,e.top),h=Math.min(h,e.bottom)),a.rect(l,c,d-l,h-c),a.clip()}}function Ca(a,t,e,i){const n=t.interpolate(e,i);n&&a.lineTo(n.x,n.y)}var Qd={id:"filler",afterDatasetsUpdate(a,t,e){const i=(a.data.datasets||[]).length,n=[];let s,o,r,l;for(o=0;o<i;++o)s=a.getDatasetMeta(o),r=s.dataset,l=null,r&&r.options&&r instanceof Ot&&(l={visible:a.isDatasetVisible(o),index:o,fill:Fd(r,o,i),chart:a,axis:s.controller.options.indexAxis,scale:s.vScale,line:r}),s.$filler=l,n.push(l);for(o=0;o<i;++o)l=n[o],!(!l||l.fill===!1)&&(l.fill=Dd(n,o,e.propagate))},beforeDraw(a,t,e){const i=e.drawTime==="beforeDraw",n=a.getSortedVisibleDatasetMetas(),s=a.chartArea;for(let o=n.length-1;o>=0;--o){const r=n[o].$filler;r&&(r.line.updateControlPoints(s,r.axis),i&&r.fill&&Di(a.ctx,r,s))}},beforeDatasetsDraw(a,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=a.getSortedVisibleDatasetMetas();for(let n=i.length-1;n>=0;--n){const s=i[n].$filler;ka(s)&&Di(a.ctx,s,a.chartArea)}},beforeDatasetDraw(a,t,e){const i=t.meta.$filler;!ka(i)||e.drawTime!=="beforeDatasetDraw"||Di(a.ctx,i,a.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Ea=(a,t)=>{let{boxHeight:e=t,boxWidth:i=t}=a;return a.usePointStyle&&(e=Math.min(e,t),i=a.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},Zd=(a,t)=>a!==null&&t!==null&&a.datasetIndex===t.datasetIndex&&a.index===t.index;class Ia extends gt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=j(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,n)=>t.sort(i,n,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,n=K(i.font),s=n.size,o=this._computeTitleHeight(),{boxWidth:r,itemHeight:l}=Ea(i,s);let c,d;e.font=n.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(o,s,r,l)+10):(d=this.maxHeight,c=this._fitCols(o,n,r,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,n){const{ctx:s,maxWidth:o,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=n+r;let h=t;s.textAlign="left",s.textBaseline="middle";let u=-1,m=-d;return this.legendItems.forEach((p,g)=>{const f=i+e/2+s.measureText(p.text).width;(g===0||c[c.length-1]+f+2*r>o)&&(h+=d,c[c.length-(g>0?0:1)]=0,m+=d,u++),l[g]={left:0,top:m,row:u,width:f,height:n},c[c.length-1]+=f+r}),h}_fitCols(t,e,i,n){const{ctx:s,maxHeight:o,options:{labels:{padding:r}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=o-t;let h=r,u=0,m=0,p=0,g=0;return this.legendItems.forEach((f,y)=>{const{itemWidth:_,itemHeight:b}=th(i,e,s,f,n);y>0&&m+b+2*r>d&&(h+=u+r,c.push({width:u,height:m}),p+=u+r,g++,u=m=0),l[y]={left:p,top:m,col:g,width:_,height:b},u=Math.max(u,_),m+=b+r}),h+=u,c.push({width:u,height:m}),h}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:n},rtl:s}}=this,o=ne(s,this.left,this.width);if(this.isHorizontal()){let r=0,l=et(i,this.left+n,this.right-this.lineWidths[r]);for(const c of e)r!==c.row&&(r=c.row,l=et(i,this.left+n,this.right-this.lineWidths[r])),c.top+=this.top+t+n,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+n}else{let r=0,l=et(i,this.top+t+n,this.bottom-this.columnSizes[r].height);for(const c of e)c.col!==r&&(r=c.col,l=et(i,this.top+t+n,this.bottom-this.columnSizes[r].height)),c.top=l,c.left+=this.left+n,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;yi(t,this),this._draw(),_i(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:n}=this,{align:s,labels:o}=t,r=B.color,l=ne(t.rtl,this.left,this.width),c=K(o.font),{padding:d}=o,h=c.size,u=h/2;let m;this.drawTitle(),n.textAlign=l.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=c.string;const{boxWidth:p,boxHeight:g,itemHeight:f}=Ea(o,h),y=function(S,k,M){if(isNaN(p)||p<=0||isNaN(g)||g<0)return;n.save();const C=E(M.lineWidth,1);if(n.fillStyle=E(M.fillStyle,r),n.lineCap=E(M.lineCap,"butt"),n.lineDashOffset=E(M.lineDashOffset,0),n.lineJoin=E(M.lineJoin,"miter"),n.lineWidth=C,n.strokeStyle=E(M.strokeStyle,r),n.setLineDash(E(M.lineDash,[])),o.usePointStyle){const P={radius:g*Math.SQRT2/2,pointStyle:M.pointStyle,rotation:M.rotation,borderWidth:C},O=l.xPlus(S,p/2),L=k+u;os(n,P,O,L,o.pointStyleWidth&&p)}else{const P=k+Math.max((h-g)/2,0),O=l.leftForLtr(S,p),L=Jt(M.borderRadius);n.beginPath(),Object.values(L).some(Q=>Q!==0)?Ie(n,{x:O,y:P,w:p,h:g,radius:L}):n.rect(O,P,p,g),n.fill(),C!==0&&n.stroke()}n.restore()},_=function(S,k,M){Xt(n,M.text,S,k+f/2,c,{strikethrough:M.hidden,textAlign:l.textAlign(M.textAlign)})},b=this.isHorizontal(),x=this._computeTitleHeight();b?m={x:et(s,this.left+d,this.right-i[0]),y:this.top+d+x,line:0}:m={x:this.left+d,y:et(s,this.top+x+d,this.bottom-e[0].height),line:0},ps(this.ctx,t.textDirection);const v=f+d;this.legendItems.forEach((S,k)=>{n.strokeStyle=S.fontColor,n.fillStyle=S.fontColor;const M=n.measureText(S.text).width,C=l.textAlign(S.textAlign||(S.textAlign=o.textAlign)),P=p+u+M;let O=m.x,L=m.y;l.setWidth(this.width),b?k>0&&O+P+d>this.right&&(L=m.y+=v,m.line++,O=m.x=et(s,this.left+d,this.right-i[m.line])):k>0&&L+v>this.bottom&&(O=m.x=O+e[m.line].width+d,m.line++,L=m.y=et(s,this.top+x+d,this.bottom-e[m.line].height));const Q=l.x(O);if(y(Q,L,S),O=br(C,O+p+u,b?O+P:this.right,t.rtl),_(l.x(O),L,S),b)m.x+=P+d;else if(typeof S.text!="string"){const rt=c.lineHeight;m.y+=Ws(S,rt)+d}else m.y+=v}),gs(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=K(e.font),n=at(e.padding);if(!e.display)return;const s=ne(t.rtl,this.left,this.width),o=this.ctx,r=e.position,l=i.size/2,c=n.top+l;let d,h=this.left,u=this.width;if(this.isHorizontal())u=Math.max(...this.lineWidths),d=this.top+c,h=et(t.align,h,this.right-u);else{const p=this.columnSizes.reduce((g,f)=>Math.max(g,f.height),0);d=c+et(t.align,this.top,this.bottom-p-t.labels.padding-this._computeTitleHeight())}const m=et(r,h,h+u);o.textAlign=s.textAlign(dn(r)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,Xt(o,e.text,m,d,i)}_computeTitleHeight(){const t=this.options.title,e=K(t.font),i=at(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,n,s;if(kt(t,this.left,this.right)&&kt(e,this.top,this.bottom)){for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(n=s[i],kt(t,n.left,n.left+n.width)&&kt(e,n.top,n.top+n.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!nh(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const n=this._hoveredItem,s=Zd(n,i);n&&!s&&j(e.onLeave,[t,n,this],this),this._hoveredItem=i,i&&!s&&j(e.onHover,[t,i,this],this)}else i&&j(e.onClick,[t,i,this],this)}}function th(a,t,e,i,n){const s=eh(i,a,t,e),o=ih(n,i,t.lineHeight);return{itemWidth:s,itemHeight:o}}function eh(a,t,e,i){let n=a.text;return n&&typeof n!="string"&&(n=n.reduce((s,o)=>s.length>o.length?s:o)),t+e.size/2+i.measureText(n).width}function ih(a,t,e){let i=a;return typeof t.text!="string"&&(i=Ws(t,e)),i}function Ws(a,t){const e=a.text?a.text.length:0;return t*e}function nh(a,t){return!!((a==="mousemove"||a==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(a==="click"||a==="mouseup"))}var ah={id:"legend",_element:Ia,start(a,t,e){const i=a.legend=new Ia({ctx:a.ctx,options:e,chart:a});nt.configure(a,i,e),nt.addBox(a,i)},stop(a){nt.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,t,e){const i=a.legend;nt.configure(a,i,e),i.options=e},afterUpdate(a){const t=a.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(a,t){t.replay||a.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,t,e){const i=t.datasetIndex,n=e.chart;n.isDatasetVisible(i)?(n.hide(i),t.hidden=!0):(n.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){const t=a.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:n,color:s,useBorderRadius:o,borderRadius:r}}=a.legend.options;return a._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),d=at(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:s,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:n||c.textAlign,borderRadius:o&&(r||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}};class vn extends gt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const n=H(i.text)?i.text.length:1;this._padding=at(i.padding);const s=n*K(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:n,right:s,options:o}=this,r=o.align;let l=0,c,d,h;return this.isHorizontal()?(d=et(r,i,s),h=e+t,c=s-i):(o.position==="left"?(d=i+t,h=et(r,n,e),l=D*-.5):(d=s-t,h=et(r,e,n),l=D*.5),c=n-e),{titleX:d,titleY:h,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=K(e.font),s=i.lineHeight/2+this._padding.top,{titleX:o,titleY:r,maxWidth:l,rotation:c}=this._drawArgs(s);Xt(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:c,textAlign:dn(e.align),textBaseline:"middle",translation:[o,r]})}}function sh(a,t){const e=new vn({ctx:a.ctx,options:t,chart:a});nt.configure(a,e,t),nt.addBox(a,e),a.titleBlock=e}var oh={id:"title",_element:vn,start(a,t,e){sh(a,e)},stop(a){const t=a.titleBlock;nt.removeBox(a,t),delete a.titleBlock},beforeUpdate(a,t,e){const i=a.titleBlock;nt.configure(a,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Je=new WeakMap;var rh={id:"subtitle",start(a,t,e){const i=new vn({ctx:a.ctx,options:e,chart:a});nt.configure(a,i,e),nt.addBox(a,i),Je.set(a,i)},stop(a){nt.removeBox(a,Je.get(a)),Je.delete(a)},beforeUpdate(a,t,e){const i=Je.get(a);nt.configure(a,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const _e={average(a){if(!a.length)return!1;let t,e,i=new Set,n=0,s=0;for(t=0,e=a.length;t<e;++t){const r=a[t].element;if(r&&r.hasValue()){const l=r.tooltipPosition();i.add(l.x),n+=l.y,++s}}return s===0||i.size===0?!1:{x:[...i].reduce((r,l)=>r+l)/i.size,y:n/s}},nearest(a,t){if(!a.length)return!1;let e=t.x,i=t.y,n=Number.POSITIVE_INFINITY,s,o,r;for(s=0,o=a.length;s<o;++s){const l=a[s].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=$i(t,c);d<n&&(n=d,r=l)}}if(r){const l=r.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function ft(a,t){return t&&(H(t)?Array.prototype.push.apply(a,t):a.push(t)),a}function wt(a){return(typeof a=="string"||a instanceof String)&&a.indexOf(`
`)>-1?a.split(`
`):a}function lh(a,t){const{element:e,datasetIndex:i,index:n}=t,s=a.getDatasetMeta(i).controller,{label:o,value:r}=s.getLabelAndValue(n);return{chart:a,label:o,parsed:s.getParsed(n),raw:a.data.datasets[i].data[n],formattedValue:r,dataset:s.getDataset(),dataIndex:n,datasetIndex:i,element:e}}function Pa(a,t){const e=a.chart.ctx,{body:i,footer:n,title:s}=a,{boxWidth:o,boxHeight:r}=t,l=K(t.bodyFont),c=K(t.titleFont),d=K(t.footerFont),h=s.length,u=n.length,m=i.length,p=at(t.padding);let g=p.height,f=0,y=i.reduce((x,v)=>x+v.before.length+v.lines.length+v.after.length,0);if(y+=a.beforeBody.length+a.afterBody.length,h&&(g+=h*c.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),y){const x=t.displayColors?Math.max(r,l.lineHeight):l.lineHeight;g+=m*x+(y-m)*l.lineHeight+(y-1)*t.bodySpacing}u&&(g+=t.footerMarginTop+u*d.lineHeight+(u-1)*t.footerSpacing);let _=0;const b=function(x){f=Math.max(f,e.measureText(x).width+_)};return e.save(),e.font=c.string,F(a.title,b),e.font=l.string,F(a.beforeBody.concat(a.afterBody),b),_=t.displayColors?o+2+t.boxPadding:0,F(i,x=>{F(x.before,b),F(x.lines,b),F(x.after,b)}),_=0,e.font=d.string,F(a.footer,b),e.restore(),f+=p.width,{width:f,height:g}}function ch(a,t){const{y:e,height:i}=t;return e<i/2?"top":e>a.height-i/2?"bottom":"center"}function dh(a,t,e,i){const{x:n,width:s}=i,o=e.caretSize+e.caretPadding;if(a==="left"&&n+s+o>t.width||a==="right"&&n-s-o<0)return!0}function hh(a,t,e,i){const{x:n,width:s}=e,{width:o,chartArea:{left:r,right:l}}=a;let c="center";return i==="center"?c=n<=(r+l)/2?"left":"right":n<=s/2?c="left":n>=o-s/2&&(c="right"),dh(c,a,t,e)&&(c="center"),c}function Oa(a,t,e){const i=e.yAlign||t.yAlign||ch(a,e);return{xAlign:e.xAlign||t.xAlign||hh(a,t,e,i),yAlign:i}}function uh(a,t){let{x:e,width:i}=a;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function mh(a,t,e){let{y:i,height:n}=a;return t==="top"?i+=e:t==="bottom"?i-=n+e:i-=n/2,i}function Ra(a,t,e,i){const{caretSize:n,caretPadding:s,cornerRadius:o}=a,{xAlign:r,yAlign:l}=e,c=n+s,{topLeft:d,topRight:h,bottomLeft:u,bottomRight:m}=Jt(o);let p=uh(t,r);const g=mh(t,l,c);return l==="center"?r==="left"?p+=c:r==="right"&&(p-=c):r==="left"?p-=Math.max(d,u)+n:r==="right"&&(p+=Math.max(h,m)+n),{x:X(p,0,i.width-t.width),y:X(g,0,i.height-t.height)}}function qe(a,t,e){const i=at(e.padding);return t==="center"?a.x+a.width/2:t==="right"?a.x+a.width-i.right:a.x+i.left}function Ta(a){return ft([],wt(a))}function ph(a,t,e){return Ft(a,{tooltip:t,tooltipItems:e,type:"tooltip"})}function La(a,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?a.override(e):a}const zs={beforeTitle:vt,title(a){if(a.length>0){const t=a[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:vt,beforeBody:vt,beforeLabel:vt,label(a){if(this&&this.options&&this.options.mode==="dataset")return a.label+": "+a.formattedValue||a.formattedValue;let t=a.dataset.label||"";t&&(t+=": ");const e=a.formattedValue;return R(e)||(t+=e),t},labelColor(a){const e=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){const e=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:vt,afterBody:vt,beforeFooter:vt,footer:vt,afterFooter:vt};function st(a,t,e,i){const n=a[t].call(e,i);return typeof n>"u"?zs[t].call(e,i):n}class Ji extends gt{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&e.options.animation&&i.animations,s=new vs(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=ph(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,n=st(i,"beforeTitle",this,t),s=st(i,"title",this,t),o=st(i,"afterTitle",this,t);let r=[];return r=ft(r,wt(n)),r=ft(r,wt(s)),r=ft(r,wt(o)),r}getBeforeBody(t,e){return Ta(st(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,n=[];return F(t,s=>{const o={before:[],lines:[],after:[]},r=La(i,s);ft(o.before,wt(st(r,"beforeLabel",this,s))),ft(o.lines,st(r,"label",this,s)),ft(o.after,wt(st(r,"afterLabel",this,s))),n.push(o)}),n}getAfterBody(t,e){return Ta(st(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,n=st(i,"beforeFooter",this,t),s=st(i,"footer",this,t),o=st(i,"afterFooter",this,t);let r=[];return r=ft(r,wt(n)),r=ft(r,wt(s)),r=ft(r,wt(o)),r}_createItems(t){const e=this._active,i=this.chart.data,n=[],s=[],o=[];let r=[],l,c;for(l=0,c=e.length;l<c;++l)r.push(lh(this.chart,e[l]));return t.filter&&(r=r.filter((d,h,u)=>t.filter(d,h,u,i))),t.itemSort&&(r=r.sort((d,h)=>t.itemSort(d,h,i))),F(r,d=>{const h=La(t.callbacks,d);n.push(st(h,"labelColor",this,d)),s.push(st(h,"labelPointStyle",this,d)),o.push(st(h,"labelTextColor",this,d))}),this.labelColors=n,this.labelPointStyles=s,this.labelTextColors=o,this.dataPoints=r,r}update(t,e){const i=this.options.setContext(this.getContext()),n=this._active;let s,o=[];if(!n.length)this.opacity!==0&&(s={opacity:0});else{const r=_e[i.position].call(this,n,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const l=this._size=Pa(this,i),c=Object.assign({},r,l),d=Oa(this.chart,i,c),h=Ra(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,s={opacity:1,x:h.x,y:h.y,width:l.width,height:l.height,caretX:r.x,caretY:r.y}}this._tooltipItems=o,this.$context=void 0,s&&this._resolveAnimations().update(this,s),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,n){const s=this.getCaretPosition(t,i,n);e.lineTo(s.x1,s.y1),e.lineTo(s.x2,s.y2),e.lineTo(s.x3,s.y3)}getCaretPosition(t,e,i){const{xAlign:n,yAlign:s}=this,{caretSize:o,cornerRadius:r}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:h}=Jt(r),{x:u,y:m}=t,{width:p,height:g}=e;let f,y,_,b,x,v;return s==="center"?(x=m+g/2,n==="left"?(f=u,y=f-o,b=x+o,v=x-o):(f=u+p,y=f+o,b=x-o,v=x+o),_=f):(n==="left"?y=u+Math.max(l,d)+o:n==="right"?y=u+p-Math.max(c,h)-o:y=this.caretX,s==="top"?(b=m,x=b-o,f=y-o,_=y+o):(b=m+g,x=b+o,f=y+o,_=y-o),v=b),{x1:f,x2:y,x3:_,y1:b,y2:x,y3:v}}drawTitle(t,e,i){const n=this.title,s=n.length;let o,r,l;if(s){const c=ne(i.rtl,this.x,this.width);for(t.x=qe(this,i.titleAlign,i),e.textAlign=c.textAlign(i.titleAlign),e.textBaseline="middle",o=K(i.titleFont),r=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,l=0;l<s;++l)e.fillText(n[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+r,l+1===s&&(t.y+=i.titleMarginBottom-r)}}_drawColorBox(t,e,i,n,s){const o=this.labelColors[i],r=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=s,d=K(s.bodyFont),h=qe(this,"left",s),u=n.x(h),m=l<d.lineHeight?(d.lineHeight-l)/2:0,p=e.y+m;if(s.usePointStyle){const g={radius:Math.min(c,l)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},f=n.leftForLtr(u,c)+c/2,y=p+l/2;t.strokeStyle=s.multiKeyBackground,t.fillStyle=s.multiKeyBackground,zi(t,g,f,y),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,zi(t,g,f,y)}else{t.lineWidth=T(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const g=n.leftForLtr(u,c),f=n.leftForLtr(n.xPlus(u,1),c-2),y=Jt(o.borderRadius);Object.values(y).some(_=>_!==0)?(t.beginPath(),t.fillStyle=s.multiKeyBackground,Ie(t,{x:g,y:p,w:c,h:l,radius:y}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),Ie(t,{x:f,y:p+1,w:c-2,h:l-2,radius:y}),t.fill()):(t.fillStyle=s.multiKeyBackground,t.fillRect(g,p,c,l),t.strokeRect(g,p,c,l),t.fillStyle=o.backgroundColor,t.fillRect(f,p+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:n}=this,{bodySpacing:s,bodyAlign:o,displayColors:r,boxHeight:l,boxWidth:c,boxPadding:d}=i,h=K(i.bodyFont);let u=h.lineHeight,m=0;const p=ne(i.rtl,this.x,this.width),g=function(M){e.fillText(M,p.x(t.x+m),t.y+u/2),t.y+=u+s},f=p.textAlign(o);let y,_,b,x,v,S,k;for(e.textAlign=o,e.textBaseline="middle",e.font=h.string,t.x=qe(this,f,i),e.fillStyle=i.bodyColor,F(this.beforeBody,g),m=r&&f!=="right"?o==="center"?c/2+d:c+2+d:0,x=0,S=n.length;x<S;++x){for(y=n[x],_=this.labelTextColors[x],e.fillStyle=_,F(y.before,g),b=y.lines,r&&b.length&&(this._drawColorBox(e,t,x,p,i),u=Math.max(h.lineHeight,l)),v=0,k=b.length;v<k;++v)g(b[v]),u=h.lineHeight;F(y.after,g)}m=0,u=h.lineHeight,F(this.afterBody,g),t.y-=s}drawFooter(t,e,i){const n=this.footer,s=n.length;let o,r;if(s){const l=ne(i.rtl,this.x,this.width);for(t.x=qe(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",o=K(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,r=0;r<s;++r)e.fillText(n[r],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,n){const{xAlign:s,yAlign:o}=this,{x:r,y:l}=t,{width:c,height:d}=i,{topLeft:h,topRight:u,bottomLeft:m,bottomRight:p}=Jt(n.cornerRadius);e.fillStyle=n.backgroundColor,e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.beginPath(),e.moveTo(r+h,l),o==="top"&&this.drawCaret(t,e,i,n),e.lineTo(r+c-u,l),e.quadraticCurveTo(r+c,l,r+c,l+u),o==="center"&&s==="right"&&this.drawCaret(t,e,i,n),e.lineTo(r+c,l+d-p),e.quadraticCurveTo(r+c,l+d,r+c-p,l+d),o==="bottom"&&this.drawCaret(t,e,i,n),e.lineTo(r+m,l+d),e.quadraticCurveTo(r,l+d,r,l+d-m),o==="center"&&s==="left"&&this.drawCaret(t,e,i,n),e.lineTo(r,l+h),e.quadraticCurveTo(r,l,r+h,l),e.closePath(),e.fill(),n.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,n=i&&i.x,s=i&&i.y;if(n||s){const o=_e[t.position].call(this,this._active,this._eventPosition);if(!o)return;const r=this._size=Pa(this,t),l=Object.assign({},o,this._size),c=Oa(e,t,l),d=Ra(t,l,c,e);(n._to!==d.x||s._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=r.width,this.height=r.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const n={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=at(e.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&r&&(t.save(),t.globalAlpha=i,this.drawBackground(s,t,n,e),ps(t,e.textDirection),s.y+=o.top,this.drawTitle(s,t,e),this.drawBody(s,t,e),this.drawFooter(s,t,e),gs(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,n=t.map(({datasetIndex:r,index:l})=>{const c=this.chart.getDatasetMeta(r);if(!c)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:c.data[l],index:l}}),s=!ri(i,n),o=this._positionChanged(n,e);(s||o)&&(this._active=n,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,s=this._active||[],o=this._getActiveElements(t,s,e,i),r=this._positionChanged(o,t),l=e||!ri(o,s)||r;return l&&(this._active=o,(n.enabled||n.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,n){const s=this.options;if(t.type==="mouseout")return[];if(!n)return e.filter(r=>this.chart.data.datasets[r.datasetIndex]&&this.chart.getDatasetMeta(r.datasetIndex).controller.getParsed(r.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,s.mode,s,i);return s.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:n,options:s}=this,o=_e[s.position].call(this,t,e);return o!==!1&&(i!==o.x||n!==o.y)}}w(Ji,"positioners",_e);var gh={id:"tooltip",_element:Ji,positioners:_e,afterInit(a,t,e){e&&(a.tooltip=new Ji({chart:a,options:e}))},beforeUpdate(a,t,e){a.tooltip&&a.tooltip.initialize(e)},reset(a,t,e){a.tooltip&&a.tooltip.initialize(e)},afterDraw(a){const t=a.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(a.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",e)}},afterEvent(a,t){if(a.tooltip){const e=t.replay;a.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,t)=>t.bodyFont.size,boxWidth:(a,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:zs},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>a!=="filter"&&a!=="itemSort"&&a!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},fh=Object.freeze({__proto__:null,Colors:Ed,Decimation:Rd,Filler:Qd,Legend:ah,SubTitle:rh,Title:oh,Tooltip:gh});const yh=(a,t,e,i)=>(typeof t=="string"?(e=a.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function _h(a,t,e,i){const n=a.indexOf(t);if(n===-1)return yh(a,t,e,i);const s=a.lastIndexOf(t);return n!==s?e:n}const bh=(a,t)=>a===null?null:X(Math.round(a),0,t);function Da(a){const t=this.getLabels();return a>=0&&a<t.length?t[a]:a}class qi extends Qt{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:n,label:s}of e)i[n]===s&&i.splice(n,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(R(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:_h(i,t,E(e,t),this._addedLabels),bh(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,n=[];let s=this.getLabels();s=t===0&&e===s.length-1?s:s.slice(t,e+1),this._valueRange=Math.max(s.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let o=t;o<=e;o++)n.push({value:o});return n}getLabelForValue(t){return Da.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}w(qi,"id","category"),w(qi,"defaults",{ticks:{callback:Da}});function vh(a,t){const e=[],{bounds:n,step:s,min:o,max:r,precision:l,count:c,maxTicks:d,maxDigits:h,includeBounds:u}=a,m=s||1,p=d-1,{min:g,max:f}=t,y=!R(o),_=!R(r),b=!R(c),x=(f-g)/(h+1);let v=Pn((f-g)/p/m)*m,S,k,M,C;if(v<1e-14&&!y&&!_)return[{value:g},{value:f}];C=Math.ceil(f/v)-Math.floor(g/v),C>p&&(v=Pn(C*v/p/m)*m),R(l)||(S=Math.pow(10,l),v=Math.ceil(v*S)/S),n==="ticks"?(k=Math.floor(g/v)*v,M=Math.ceil(f/v)*v):(k=g,M=f),y&&_&&s&&ur((r-o)/s,v/1e3)?(C=Math.round(Math.min((r-o)/v,d)),v=(r-o)/C,k=o,M=r):b?(k=y?o:k,M=_?r:M,C=c-1,v=(M-k)/C):(C=(M-k)/v,xe(C,Math.round(C),v/1e3)?C=Math.round(C):C=Math.ceil(C));const P=Math.max(On(v),On(k));S=Math.pow(10,R(l)?P:l),k=Math.round(k*S)/S,M=Math.round(M*S)/S;let O=0;for(y&&(u&&k!==o?(e.push({value:o}),k<o&&O++,xe(Math.round((k+O*v)*S)/S,o,Fa(o,x,a))&&O++):k<o&&O++);O<C;++O){const L=Math.round((k+O*v)*S)/S;if(_&&L>r)break;e.push({value:L})}return _&&u&&M!==r?e.length&&xe(e[e.length-1].value,r,Fa(r,x,a))?e[e.length-1].value=r:e.push({value:r}):(!_||M===r)&&e.push({value:M}),e}function Fa(a,t,{horizontal:e,minRotation:i}){const n=mt(i),s=(e?Math.sin(n):Math.cos(n))||.001,o=.75*t*(""+a).length;return Math.min(t/s,o)}class pi extends Qt{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return R(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:n,max:s}=this;const o=l=>n=e?n:l,r=l=>s=i?s:l;if(t){const l=bt(n),c=bt(s);l<0&&c<0?r(0):l>0&&c>0&&o(0)}if(n===s){let l=s===0?1:Math.abs(s*.05);r(s+l),t||o(n-l)}this.min=n,this.max=s}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,n;return i?(n=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),e=e||11),e&&(n=Math.min(e,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},s=this._range||this,o=vh(n,s);return t.bounds==="ticks"&&Xa(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const n=(i-e)/Math.max(t.length-1,1)/2;e-=n,i+=n}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return De(t,this.chart.options.locale,this.options.ticks.format)}}class Ki extends pi{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=U(t)?t:0,this.max=U(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=mt(this.options.ticks.minRotation),n=(t?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,s.lineHeight/n))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}w(Ki,"id","linear"),w(Ki,"defaults",{ticks:{callback:fi.formatters.numeric}});const Oe=a=>Math.floor(It(a)),Ht=(a,t)=>Math.pow(10,Oe(a)+t);function Na(a){return a/Math.pow(10,Oe(a))===1}function ja(a,t,e){const i=Math.pow(10,e),n=Math.floor(a/i);return Math.ceil(t/i)-n}function xh(a,t){const e=t-a;let i=Oe(e);for(;ja(a,t,i)>10;)i++;for(;ja(a,t,i)<10;)i--;return Math.min(i,Oe(a))}function wh(a,{min:t,max:e}){t=lt(a.min,t);const i=[],n=Oe(t);let s=xh(t,e),o=s<0?Math.pow(10,Math.abs(s)):1;const r=Math.pow(10,s),l=n>s?Math.pow(10,n):0,c=Math.round((t-l)*o)/o,d=Math.floor((t-l)/r/10)*r*10;let h=Math.floor((c-d)/Math.pow(10,s)),u=lt(a.min,Math.round((l+d+h*Math.pow(10,s))*o)/o);for(;u<e;)i.push({value:u,major:Na(u),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(s++,h=2,o=s>=0?1:o),u=Math.round((l+d+h*Math.pow(10,s))*o)/o;const m=lt(a.max,u);return i.push({value:m,major:Na(m),significand:h}),i}class Xi extends Qt{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=pi.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return U(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=U(t)?Math.max(0,t):null,this.max=U(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!U(this._userMin)&&(this.min=t===Ht(this.min,0)?Ht(this.min,-1):Ht(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,n=this.max;const s=r=>i=t?i:r,o=r=>n=e?n:r;i===n&&(i<=0?(s(1),o(10)):(s(Ht(i,-1)),o(Ht(n,1)))),i<=0&&s(Ht(n,-1)),n<=0&&o(Ht(i,1)),this.min=i,this.max=n}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=wh(e,this);return t.bounds==="ticks"&&Xa(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":De(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=It(t),this._valueRange=It(this.max)-It(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(It(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}w(Xi,"id","logarithmic"),w(Xi,"defaults",{ticks:{callback:fi.formatters.logarithmic,major:{enabled:!0}}});function Qi(a){const t=a.ticks;if(t.display&&a.display){const e=at(t.backdropPadding);return E(t.font&&t.font.size,B.font.size)+e.height}return 0}function Sh(a,t,e){return e=H(e)?e:[e],{w:Ir(a,t.string,e),h:e.length*t.lineHeight}}function $a(a,t,e,i,n){return a===i||a===n?{start:t-e/2,end:t+e/2}:a<i||a>n?{start:t-e,end:t}:{start:t,end:t+e}}function kh(a){const t={l:a.left+a._padding.left,r:a.right-a._padding.right,t:a.top+a._padding.top,b:a.bottom-a._padding.bottom},e=Object.assign({},t),i=[],n=[],s=a._pointLabels.length,o=a.options.pointLabels,r=o.centerPointLabels?D/s:0;for(let l=0;l<s;l++){const c=o.setContext(a.getPointLabelContext(l));n[l]=c.padding;const d=a.getPointPosition(l,a.drawingArea+n[l],r),h=K(c.font),u=Sh(a.ctx,h,a._pointLabels[l]);i[l]=u;const m=it(a.getIndexAngle(l)+r),p=Math.round(ln(m)),g=$a(p,d.x,u.w,0,180),f=$a(p,d.y,u.h,90,270);Mh(e,t,m,g,f)}a.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),a._pointLabelItems=Eh(a,i,n)}function Mh(a,t,e,i,n){const s=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let r=0,l=0;i.start<t.l?(r=(t.l-i.start)/s,a.l=Math.min(a.l,t.l-r)):i.end>t.r&&(r=(i.end-t.r)/s,a.r=Math.max(a.r,t.r+r)),n.start<t.t?(l=(t.t-n.start)/o,a.t=Math.min(a.t,t.t-l)):n.end>t.b&&(l=(n.end-t.b)/o,a.b=Math.max(a.b,t.b+l))}function Ah(a,t,e){const i=a.drawingArea,{extra:n,additionalAngle:s,padding:o,size:r}=e,l=a.getPointPosition(t,i+n+o,s),c=Math.round(ln(it(l.angle+G))),d=Oh(l.y,r.h,c),h=Ih(c),u=Ph(l.x,r.w,h);return{visible:!0,x:l.x,y:d,textAlign:h,left:u,top:d,right:u+r.w,bottom:d+r.h}}function Ch(a,t){if(!t)return!0;const{left:e,top:i,right:n,bottom:s}=a;return!(At({x:e,y:i},t)||At({x:e,y:s},t)||At({x:n,y:i},t)||At({x:n,y:s},t))}function Eh(a,t,e){const i=[],n=a._pointLabels.length,s=a.options,{centerPointLabels:o,display:r}=s.pointLabels,l={extra:Qi(s)/2,additionalAngle:o?D/n:0};let c;for(let d=0;d<n;d++){l.padding=e[d],l.size=t[d];const h=Ah(a,d,l);i.push(h),r==="auto"&&(h.visible=Ch(h,c),h.visible&&(c=h))}return i}function Ih(a){return a===0||a===180?"center":a<180?"left":"right"}function Ph(a,t,e){return e==="right"?a-=t:e==="center"&&(a-=t/2),a}function Oh(a,t,e){return e===90||e===270?a-=t/2:(e>270||e<90)&&(a-=t),a}function Rh(a,t,e){const{left:i,top:n,right:s,bottom:o}=e,{backdropColor:r}=t;if(!R(r)){const l=Jt(t.borderRadius),c=at(t.backdropPadding);a.fillStyle=r;const d=i-c.left,h=n-c.top,u=s-i+c.width,m=o-n+c.height;Object.values(l).some(p=>p!==0)?(a.beginPath(),Ie(a,{x:d,y:h,w:u,h:m,radius:l}),a.fill()):a.fillRect(d,h,u,m)}}function Th(a,t){const{ctx:e,options:{pointLabels:i}}=a;for(let n=t-1;n>=0;n--){const s=a._pointLabelItems[n];if(!s.visible)continue;const o=i.setContext(a.getPointLabelContext(n));Rh(e,o,s);const r=K(o.font),{x:l,y:c,textAlign:d}=s;Xt(e,a._pointLabels[n],l,c+r.lineHeight/2,r,{color:o.color,textAlign:d,textBaseline:"middle"})}}function Hs(a,t,e,i){const{ctx:n}=a;if(e)n.arc(a.xCenter,a.yCenter,t,0,$);else{let s=a.getPointPosition(0,t);n.moveTo(s.x,s.y);for(let o=1;o<i;o++)s=a.getPointPosition(o,t),n.lineTo(s.x,s.y)}}function Lh(a,t,e,i,n){const s=a.ctx,o=t.circular,{color:r,lineWidth:l}=t;!o&&!i||!r||!l||e<0||(s.save(),s.strokeStyle=r,s.lineWidth=l,s.setLineDash(n.dash||[]),s.lineDashOffset=n.dashOffset,s.beginPath(),Hs(a,e,o,i),s.closePath(),s.stroke(),s.restore())}function Dh(a,t,e){return Ft(a,{label:e,index:t,type:"pointLabel"})}class be extends pi{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=at(Qi(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=U(t)&&!isNaN(t)?t:0,this.max=U(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Qi(this.options))}generateTickLabels(t){pi.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const n=j(this.options.pointLabels.callback,[e,i],this);return n||n===0?n:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?kh(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,n){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,n))}getIndexAngle(t){const e=$/(this._pointLabels.length||1),i=this.options.startAngle||0;return it(t*e+mt(i))}getDistanceFromCenterForValue(t){if(R(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(R(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return Dh(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const n=this.getIndexAngle(t)-G+i;return{x:Math.cos(n)*e+this.xCenter,y:Math.sin(n)*e+this.yCenter,angle:n}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:n,bottom:s}=this._pointLabelItems[t];return{left:e,top:i,right:n,bottom:s}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Hs(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:n,border:s}=e,o=this._pointLabels.length;let r,l,c;if(e.pointLabels.display&&Th(this,o),n.display&&this.ticks.forEach((d,h)=>{if(h!==0||h===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const u=this.getContext(h),m=n.setContext(u),p=s.setContext(u);Lh(this,m,l,o,p)}}),i.display){for(t.save(),r=o-1;r>=0;r--){const d=i.setContext(this.getPointLabelContext(r)),{color:h,lineWidth:u}=d;!u||!h||(t.lineWidth=u,t.strokeStyle=h,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(r,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let s,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(n),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((r,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=i.setContext(this.getContext(l)),d=K(c.font);if(s=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,o=t.measureText(r.label).width,t.fillStyle=c.backdropColor;const h=at(c.backdropPadding);t.fillRect(-o/2-h.left,-s-d.size/2-h.top,o+h.width,d.size+h.height)}Xt(t,r.label,0,-s,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}w(be,"id","radialLinear"),w(be,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:fi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),w(be,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),w(be,"descriptors",{angleLines:{_fallback:"grid"}});const wi={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ot=Object.keys(wi);function Wa(a,t){return a-t}function za(a,t){if(R(t))return null;const e=a._adapter,{parser:i,round:n,isoWeekday:s}=a._parseOpts;let o=t;return typeof i=="function"&&(o=i(o)),U(o)||(o=typeof i=="string"?e.parse(o,i):e.parse(o)),o===null?null:(n&&(o=n==="week"&&(ae(s)||s===!0)?e.startOf(o,"isoWeek",s):e.startOf(o,n)),+o)}function Ha(a,t,e,i){const n=ot.length;for(let s=ot.indexOf(a);s<n-1;++s){const o=wi[ot[s]],r=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(r*o.size))<=i)return ot[s]}return ot[n-1]}function Fh(a,t,e,i,n){for(let s=ot.length-1;s>=ot.indexOf(e);s--){const o=ot[s];if(wi[o].common&&a._adapter.diff(n,i,o)>=t-1)return o}return ot[e?ot.indexOf(e):0]}function Nh(a){for(let t=ot.indexOf(a)+1,e=ot.length;t<e;++t)if(wi[ot[t]].common)return ot[t]}function Ba(a,t,e){if(!e)a[t]=!0;else if(e.length){const{lo:i,hi:n}=cn(e,t),s=e[i]>=t?e[i]:e[n];a[s]=!0}}function jh(a,t,e,i){const n=a._adapter,s=+n.startOf(t[0].value,i),o=t[t.length-1].value;let r,l;for(r=s;r<=o;r=+n.add(r,1,i))l=e[r],l>=0&&(t[l].major=!0);return t}function Ua(a,t,e){const i=[],n={},s=t.length;let o,r;for(o=0;o<s;++o)r=t[o],n[r]=o,i.push({value:r,major:!1});return s===0||!e?i:jh(a,i,n,e)}class Re extends Qt{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),n=this._adapter=new Yl._date(t.adapters.date);n.init(e),ve(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:za(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:n,max:s,minDefined:o,maxDefined:r}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(n=Math.min(n,c.min)),!r&&!isNaN(c.max)&&(s=Math.max(s,c.max))}(!o||!r)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),n=U(n)&&!isNaN(n)?n:+e.startOf(Date.now(),i),s=U(s)&&!isNaN(s)?s:+e.endOf(Date.now(),i)+1,this.min=Math.min(n,s-1),this.max=Math.max(n+1,s)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,n=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const s=this.min,o=this.max,r=fr(n,s,o);return this._unit=e.unit||(i.autoSkip?Ha(e.minUnit,this.min,this.max,this._getLabelCapacity(s)):Fh(this,r.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:Nh(this._unit),this.initOffsets(n),t.reverse&&r.reverse(),Ua(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,n,s;this.options.offset&&t.length&&(n=this.getDecimalForValue(t[0]),t.length===1?e=1-n:e=(this.getDecimalForValue(t[1])-n)/2,s=this.getDecimalForValue(t[t.length-1]),t.length===1?i=s:i=(s-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=X(e,0,o),i=X(i,0,o),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,n=this.options,s=n.time,o=s.unit||Ha(s.minUnit,e,i,this._getLabelCapacity(e)),r=E(n.ticks.stepSize,1),l=o==="week"?s.isoWeekday:!1,c=ae(l)||l===!0,d={};let h=e,u,m;if(c&&(h=+t.startOf(h,"isoWeek",l)),h=+t.startOf(h,c?"day":o),t.diff(i,e,o)>1e5*r)throw new Error(e+" and "+i+" are too far apart with stepSize of "+r+" "+o);const p=n.ticks.source==="data"&&this.getDataTimestamps();for(u=h,m=0;u<i;u=+t.add(u,r,o),m++)Ba(d,u,p);return(u===i||n.bounds==="ticks"||m===1)&&Ba(d,u,p),Object.keys(d).sort(Wa).map(g=>+g)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const n=this.options.time.displayFormats,s=this._unit,o=e||n[s];return this._adapter.format(t,o)}_tickFormatFunction(t,e,i,n){const s=this.options,o=s.ticks.callback;if(o)return j(o,[t,e,i],this);const r=s.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&r[l],h=c&&r[c],u=i[e],m=c&&h&&u&&u.major;return this._adapter.format(t,n||(m?h:d))}generateTickLabels(t){let e,i,n;for(e=0,i=t.length;e<i;++e)n=t[e],n.label=this._tickFormatFunction(n.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,n=mt(this.isHorizontal()?e.maxRotation:e.minRotation),s=Math.cos(n),o=Math.sin(n),r=this._resolveTickFontOptions(0).size;return{w:i*s+r*o,h:i*o+r*s}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,n=i[e.unit]||i.millisecond,s=this._tickFormatFunction(t,0,Ua(this,[t],this._majorUnit),n),o=this._getLabelSize(s),r=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return r>0?r:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(e=0,i=n.length;e<i;++e)t=t.concat(n[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const n=this.getLabels();for(e=0,i=n.length;e<i;++e)t.push(za(this,n[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return ts(t.sort(Wa))}}w(Re,"id","time"),w(Re,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Ke(a,t,e){let i=0,n=a.length-1,s,o,r,l;e?(t>=a[i].pos&&t<=a[n].pos&&({lo:i,hi:n}=Mt(a,"pos",t)),{pos:s,time:r}=a[i],{pos:o,time:l}=a[n]):(t>=a[i].time&&t<=a[n].time&&({lo:i,hi:n}=Mt(a,"time",t)),{time:s,pos:r}=a[i],{time:o,pos:l}=a[n]);const c=o-s;return c?r+(l-r)*(t-s)/c:r}class Zi extends Re{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Ke(e,this.min),this._tableRange=Ke(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,n=[],s=[];let o,r,l,c,d;for(o=0,r=t.length;o<r;++o)c=t[o],c>=e&&c<=i&&n.push(c);if(n.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,r=n.length;o<r;++o)d=n[o+1],l=n[o-1],c=n[o],Math.round((d+l)/2)!==c&&s.push({time:c,pos:o/(r-1)});return s}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((n,s)=>n-s)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(Ke(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return Ke(this._table,i*this._tableRange+this._minPos,!0)}}w(Zi,"id","timeseries"),w(Zi,"defaults",Re.defaults);var $h=Object.freeze({__proto__:null,CategoryScale:qi,LinearScale:Ki,LogarithmicScale:Xi,RadialLinearScale:be,TimeScale:Re,TimeSeriesScale:Zi});const Wh=[Vl,xd,fh,$h];bn.register(...Wh);class zh{constructor(){this.cache=new Map,this.cacheExpiry=36e5,this.baselineData=null,this.liveData=null,this.endpoints={bls:"https://api.bls.gov/publicAPI/v2/timeseries/data/",fred:"https://api.stlouisfed.org/fred/series/observations"},this.blsSeries={unemployment_rate:"LNS14000000",total_employment:"CES0000000001",labor_force_participation:"LNS11300000",average_hourly_earnings:"CES0500000003",job_openings:"JTS000000000000000JOL",quits_rate:"JTS000000000000000QUR",productivity:"PRS85006092",manufacturing_employment:"CES3000000001",retail_employment:"CES4200000001",healthcare_employment:"CES6562000001",technology_employment:"CES5051200001",finance_employment:"CES5500000001",transportation_employment:"CES4300000001",construction_employment:"CES2000000001"},this.fredSeries={gdp:"GDP",real_gdp_growth:"A191RL1Q225SBEA",labor_share:"LABSHPUSA156NRUG",corporate_profits:"CP",business_investment:"PNFI",median_income:"MEHOINUSA672N",gini_coefficient:"SIPOVGINIUSA"}}async loadBaselineData(){if(this.baselineData)return this.baselineData;try{const t=await fetch("./data/baseline-data.json");return this.baselineData=await t.json(),await this.loadLiveData(),this.baselineData}catch(t){throw console.error("Failed to load baseline data:",t),t}}async loadLiveData(){if(this.liveData)return this.liveData;try{const t=await fetch("./data/live-data.json");if(t.ok)return this.liveData=await t.json(),console.log("Live data loaded, last updated:",this.liveData.lastUpdated),this.liveData}catch{console.log("No live data available, using baseline data")}return null}getLiveDataStatus(){return this.liveData?{available:!0,lastUpdated:this.liveData.lastUpdated,sources:this.liveData.sources||{},summary:this.liveData.summary||{}}:{available:!1,lastUpdated:null,sources:{bls:"unavailable",fred:"unavailable"}}}async getCurrentSnapshot(){var c;const t=await this.loadBaselineData(),e=this.liveData,i=e&&e.summary&&((c=e.sources)==null?void 0:c.bls)==="success",n=i&&e.summary.unemployment_rate?e.summary.unemployment_rate:t.labor_market.unemployment_rate.value,s=i&&e.summary.total_employment?e.summary.total_employment:t.labor_market.total_employment.value,o=i&&e.summary.labor_force_participation?e.summary.labor_force_participation:t.labor_market.labor_force_participation.value,r=i&&e.summary.job_openings?e.summary.job_openings:t.labor_market.job_openings.value,l=i&&e.summary.average_hourly_earnings?e.summary.average_hourly_earnings:t.wages.average_hourly_earnings.value;return{timestamp:new Date().toISOString(),dataSource:i?"live":"baseline",dataDate:i?e.summary.data_date:"Oct 2024",lastUpdated:i?e.lastUpdated:null,labor_market:{total_employment:s,unemployment_rate:n,labor_force_participation:o,job_openings:r,unemployed_count:Math.round(s*(n/100)/(1-n/100))},wages:{median_weekly:t.wages.median_weekly_earnings.value,average_hourly:l,real_wage_growth:t.wages.real_wage_growth.value},productivity:{growth_rate:t.productivity.labor_productivity_growth.value,output_per_hour:t.productivity.output_per_hour.value},sectors:t.sectors,ai_indicators:t.ai_indicators.real||t.ai_indicators,demographics:t.demographics}}async fetchBLSData(t,e,i,n=null){const s=`bls_${t.join("_")}_${e}_${i}`;if(this.cache.has(s)){const r=this.cache.get(s);if(Date.now()-r.timestamp<this.cacheExpiry)return r.data}const o={seriesid:t,startyear:e.toString(),endyear:i.toString()};n&&(o.registrationkey=n);try{const l=await(await fetch(this.endpoints.bls,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();if(l.status==="REQUEST_SUCCEEDED")return this.cache.set(s,{timestamp:Date.now(),data:l.Results.series}),l.Results.series;throw new Error(`BLS API error: ${l.message}`)}catch(r){return console.warn("BLS API fetch failed, using baseline data:",r),this.getHistoricalFromBaseline(t)}}async fetchFREDData(t,e,i=null,n=null){const s=`fred_${t}_${i}_${n}`;if(this.cache.has(s)){const r=this.cache.get(s);if(Date.now()-r.timestamp<this.cacheExpiry)return r.data}let o=`${this.endpoints.fred}?series_id=${t}&api_key=${e}&file_type=json`;i&&(o+=`&observation_start=${i}`),n&&(o+=`&observation_end=${n}`);try{const l=await(await fetch(o)).json();return this.cache.set(s,{timestamp:Date.now(),data:l.observations}),l.observations}catch(r){return console.warn("FRED API fetch failed:",r),null}}getHistoricalFromBaseline(t){if(!this.baselineData)return null;const e=this.baselineData.historical_trends,i={};return t.forEach(n=>{e[n]&&(i[n]=e[n])}),i}async getSectorData(){return(await this.loadBaselineData()).sectors}async getDemographicData(){return(await this.loadBaselineData()).demographics}async getAIIndicators(){return(await this.loadBaselineData()).ai_indicators}async getHistoricalTrends(){return(await this.loadBaselineData()).historical_trends}calculateDerivedMetrics(t){const{labor_market:e,wages:i,productivity:n}=t;return{employment_ratio:e.total_employment/21e7*100,vacancy_rate:e.job_openings/(e.total_employment+e.job_openings)*100,market_tightness:e.job_openings/e.unemployed_count,productivity_wage_gap:n.output_per_hour-i.average_hourly/.3,annual_median_wage:i.median_weekly*52}}async exportData(t="json"){const e=await this.getCurrentSnapshot(),i=this.calculateDerivedMetrics(e),n={snapshot:e,derived:i,historical:await this.getHistoricalTrends(),exported_at:new Date().toISOString()};return t==="json"?JSON.stringify(n,null,2):t==="csv"?[["Metric","Value","Unit"],["Unemployment Rate",e.labor_market.unemployment_rate,"%"],["Total Employment",e.labor_market.total_employment,"persons"],["Labor Force Participation",e.labor_market.labor_force_participation,"%"],["Job Openings",e.labor_market.job_openings,"positions"],["Median Weekly Earnings",e.wages.median_weekly,"USD"],["Productivity Growth",e.productivity.growth_rate,"%"],["Market Tightness",i.market_tightness.toFixed(2),"ratio"]].map(o=>o.join(",")).join(`
`):n}}typeof window<"u"&&(window.EconomicDataService=zh);class Hh{constructor(){this.indicators=this.defineIndicators(),this.weights=this.defineWeights()}defineIndicators(){return{labor_market:{unemployment_rate:{name:"Unemployment Rate",description:"Percentage of labor force unemployed",unit:"%",source:"BLS",frequency:"monthly",ai_relevance:"high",direction:"lower_better"},underemployment_rate:{name:"U-6 Underemployment Rate",description:"Includes marginally attached and part-time for economic reasons",unit:"%",source:"BLS",frequency:"monthly",ai_relevance:"high",direction:"lower_better"},labor_force_participation:{name:"Labor Force Participation Rate",description:"Percentage of working-age population in labor force",unit:"%",source:"BLS",frequency:"monthly",ai_relevance:"medium",direction:"context_dependent"},job_openings:{name:"Job Openings (JOLTS)",description:"Number of unfilled job positions",unit:"millions",source:"BLS JOLTS",frequency:"monthly",ai_relevance:"high",direction:"context_dependent"},hires_rate:{name:"Hires Rate",description:"Rate of new hires as percentage of employment",unit:"%",source:"BLS JOLTS",frequency:"monthly",ai_relevance:"medium",direction:"higher_better"},separations_rate:{name:"Separations Rate",description:"Rate of job separations (quits + layoffs)",unit:"%",source:"BLS JOLTS",frequency:"monthly",ai_relevance:"medium",direction:"context_dependent"},unemployment_duration:{name:"Average Unemployment Duration",description:"Average weeks unemployed",unit:"weeks",source:"BLS",frequency:"monthly",ai_relevance:"high",direction:"lower_better"}},wages:{real_wage_growth:{name:"Real Wage Growth",description:"Year-over-year growth in inflation-adjusted wages",unit:"%",source:"BLS",frequency:"monthly",ai_relevance:"high",direction:"higher_better"},wage_percentile_10:{name:"10th Percentile Wage",description:"Hourly wage at 10th percentile",unit:"USD/hr",source:"BLS",frequency:"annual",ai_relevance:"high",direction:"higher_better"},wage_percentile_50:{name:"Median Wage",description:"Hourly wage at 50th percentile",unit:"USD/hr",source:"BLS",frequency:"annual",ai_relevance:"medium",direction:"higher_better"},wage_percentile_90:{name:"90th Percentile Wage",description:"Hourly wage at 90th percentile",unit:"USD/hr",source:"BLS",frequency:"annual",ai_relevance:"medium",direction:"context_dependent"},wage_polarization:{name:"Wage Polarization Index",description:"Ratio of 90th to 10th percentile wages",unit:"ratio",source:"calculated",frequency:"annual",ai_relevance:"high",direction:"lower_better"},labor_share:{name:"Labor Share of Income",description:"Percentage of national income going to workers",unit:"%",source:"BLS/FRED",frequency:"quarterly",ai_relevance:"high",direction:"higher_better"},gini_coefficient:{name:"Gini Coefficient",description:"Income inequality measure (0=equal, 1=unequal)",unit:"index",source:"Census",frequency:"annual",ai_relevance:"high",direction:"lower_better"}},productivity:{labor_productivity:{name:"Labor Productivity Growth",description:"Output per hour worked, year-over-year growth",unit:"%",source:"BLS",frequency:"quarterly",ai_relevance:"high",direction:"higher_better"},multifactor_productivity:{name:"Multifactor Productivity",description:"Output growth not explained by labor/capital inputs",unit:"%",source:"BLS",frequency:"annual",ai_relevance:"high",direction:"higher_better"},productivity_wage_gap:{name:"Productivity-Wage Gap",description:"Difference between productivity and wage growth",unit:"%",source:"calculated",frequency:"annual",ai_relevance:"high",direction:"lower_better"}},ai_impact:{automation_exposure_index:{name:"Automation Exposure Index",description:"Weighted average of job automation risk",unit:"index 0-100",source:"calculated",frequency:"calculated",ai_relevance:"critical",direction:"context_dependent"},ai_job_postings_share:{name:"AI Job Postings Share",description:"Percentage of job postings requiring AI skills",unit:"%",source:"Indeed/LinkedIn",frequency:"monthly",ai_relevance:"critical",direction:"context_dependent"},ai_adoption_rate:{name:"AI Adoption Rate",description:"Percentage of firms using AI technologies",unit:"%",source:"Census/Surveys",frequency:"quarterly",ai_relevance:"critical",direction:"context_dependent"},displaced_worker_ratio:{name:"Displaced Worker Ratio",description:"Workers displaced by technology as share of separations",unit:"%",source:"calculated",frequency:"monthly",ai_relevance:"critical",direction:"lower_better"},skill_premium:{name:"AI Skill Premium",description:"Wage premium for AI-complementary skills",unit:"%",source:"calculated",frequency:"annual",ai_relevance:"high",direction:"context_dependent"},task_automation_rate:{name:"Task Automation Rate",description:"Percentage of tasks automated by AI/ML",unit:"%",source:"estimated",frequency:"annual",ai_relevance:"critical",direction:"context_dependent"},new_job_creation_rate:{name:"AI-Related Job Creation",description:"New jobs created in AI-related fields",unit:"thousands/month",source:"BLS/Indeed",frequency:"monthly",ai_relevance:"critical",direction:"higher_better"}},sector:{sector_employment_change:{name:"Sector Employment Change",description:"Year-over-year employment change by sector",unit:"%",source:"BLS",frequency:"monthly",ai_relevance:"high",direction:"context_dependent"},sector_productivity:{name:"Sector Productivity",description:"Labor productivity by sector",unit:"index",source:"BLS",frequency:"annual",ai_relevance:"high",direction:"higher_better"},sector_automation_exposure:{name:"Sector Automation Exposure",description:"Automation risk score by sector",unit:"index 0-1",source:"calculated",frequency:"annual",ai_relevance:"critical",direction:"context_dependent"}},skills:{skill_mismatch_index:{name:"Skill Mismatch Index",description:"Gap between job requirements and worker skills",unit:"index",source:"calculated",frequency:"annual",ai_relevance:"high",direction:"lower_better"},retraining_participation:{name:"Retraining Participation Rate",description:"Workers enrolled in retraining programs",unit:"%",source:"DOL",frequency:"annual",ai_relevance:"high",direction:"higher_better"},education_wage_premium:{name:"Education Wage Premium",description:"Wage difference by education level",unit:"%",source:"BLS",frequency:"annual",ai_relevance:"medium",direction:"context_dependent"},stem_employment_share:{name:"STEM Employment Share",description:"Percentage of employment in STEM fields",unit:"%",source:"BLS",frequency:"annual",ai_relevance:"medium",direction:"context_dependent"}}}}defineWeights(){return{ai_impact_composite:{automation_exposure_index:.25,displaced_worker_ratio:.2,productivity_wage_gap:.15,ai_adoption_rate:.15,new_job_creation_rate:.1,skill_mismatch_index:.1,wage_polarization:.05},labor_market_health:{unemployment_rate:.3,labor_force_participation:.15,real_wage_growth:.2,job_openings:.15,underemployment_rate:.1,unemployment_duration:.1}}}calculateAIImpactScore(t){const e=this.weights.ai_impact_composite;let i=0,n=0;for(const[s,o]of Object.entries(e))if(t[s]!==void 0){let r=this.normalizeValue(s,t[s]);i+=r*o,n+=o}return n>0?i/n:null}calculateLaborMarketHealth(t){const e=this.weights.labor_market_health;let i=100;return t.unemployment_rate!==void 0&&(i-=(t.unemployment_rate-4)*5*e.unemployment_rate),t.labor_force_participation!==void 0&&(i+=(t.labor_force_participation-62)*2*e.labor_force_participation),t.real_wage_growth!==void 0&&(i+=t.real_wage_growth*5*e.real_wage_growth),Math.max(0,Math.min(100,i))}normalizeValue(t,e){const n={automation_exposure_index:{min:0,max:100},displaced_worker_ratio:{min:0,max:20},productivity_wage_gap:{min:-5,max:10},ai_adoption_rate:{min:0,max:100},new_job_creation_rate:{min:-100,max:500},skill_mismatch_index:{min:0,max:100},wage_polarization:{min:2,max:8},unemployment_rate:{min:2,max:15}}[t]||{min:0,max:100};return(e-n.min)/(n.max-n.min)*100}getIndicatorInfo(t,e){return this.indicators[t]&&this.indicators[t][e]?this.indicators[t][e]:null}getCategoryIndicators(t){return this.indicators[t]||{}}getCategories(){return Object.keys(this.indicators)}calculateSectorExposure(t){const e={};for(const[i,n]of Object.entries(t))e[i]={name:i.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()),exposure:n.automation_exposure,employment:n.employment,at_risk_jobs:Math.round(n.employment*n.automation_exposure),risk_level:this.getRiskLevel(n.automation_exposure)};return e}getRiskLevel(t){return t>=.7?"high":t>=.5?"medium-high":t>=.3?"medium":"low"}calculateJobsAtRisk(t){let e=0,i=0;const n={high:0,"medium-high":0,medium:0,low:0};for(const s of Object.values(t)){e+=s.employment;const o=s.employment*s.automation_exposure;i+=o;const r=this.getRiskLevel(s.automation_exposure);n[r]+=s.employment}return{total_employment:e,total_at_risk:Math.round(i),percentage_at_risk:(i/e*100).toFixed(1),by_risk_level:n}}projectIndicator(t,e,i){const n=e-new Date().getFullYear(),s=i.annual_growth||0,o=i.shock||0;return t*Math.pow(1+s,n)+o}exportDefinitions(){return JSON.stringify(this.indicators,null,2)}}typeof window<"u"&&(window.EconomicIndicators=Hh);class Bs{constructor(){this.STORAGE_KEY="ai_labor_sim_real_metrics_adjustments",this.metrics=null,this.adjustments=this.loadAdjustments()}async initialize(t){const e=await t.loadBaselineData();return this.metrics=this.buildMetricsStructure(e),this.applyAdjustments(),this.metrics}buildMetricsStructure(t){return{labor_market:{category:"Labor Market",icon:"",metrics:{unemployment_rate:{id:"unemployment_rate",name:"Unemployment Rate",shortName:"UR",description:"Percentage of labor force that is unemployed and actively seeking work",value:t.labor_market.unemployment_rate.value,baseValue:t.labor_market.unemployment_rate.value,unit:"percent",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/cps/",seriesId:"LNS14000000",date:t.labor_market.unemployment_rate.date,range:{min:0,max:25},methodology:"Current Population Survey (CPS) - monthly household survey of ~60,000 households",trend:"stable",manuallyAdjusted:!1},total_employment:{id:"total_employment",name:"Total Nonfarm Employment",shortName:"EMP",description:"Total number of persons employed in nonfarm industries",value:t.labor_market.total_employment.value,baseValue:t.labor_market.total_employment.value,unit:"millions",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/ces/",seriesId:"CES0000000001",date:t.labor_market.total_employment.date,range:{min:1e8,max:2e8},methodology:"Current Employment Statistics (CES) - monthly survey of ~131,000 businesses",trend:"increasing",manuallyAdjusted:!1},labor_force_participation:{id:"labor_force_participation",name:"Labor Force Participation Rate",shortName:"LFPR",description:"Percentage of working-age population in the labor force",value:t.labor_market.labor_force_participation.value,baseValue:t.labor_market.labor_force_participation.value,unit:"percent",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/cps/",seriesId:"LNS11300000",date:t.labor_market.labor_force_participation.date,range:{min:50,max:75},methodology:"Current Population Survey (CPS) - labor force / civilian noninstitutional population",trend:"stable",manuallyAdjusted:!1},job_openings:{id:"job_openings",name:"Job Openings",shortName:"JO",description:"Total number of job openings on the last business day of the month",value:t.labor_market.job_openings.value,baseValue:t.labor_market.job_openings.value,unit:"millions",source:"Job Openings and Labor Turnover Survey (JOLTS)",sourceUrl:"https://www.bls.gov/jlt/",seriesId:"JTS000000000000000JOL",date:t.labor_market.job_openings.date,range:{min:3e6,max:15e6},methodology:"JOLTS survey of ~21,000 establishments",trend:"decreasing",manuallyAdjusted:!1},quits_rate:{id:"quits_rate",name:"Quits Rate",shortName:"QR",description:"Voluntary separations as a percent of total employment",value:t.labor_market.quits_rate.value,baseValue:t.labor_market.quits_rate.value,unit:"percent",source:"Job Openings and Labor Turnover Survey (JOLTS)",sourceUrl:"https://www.bls.gov/jlt/",seriesId:"JTS000000000000000QUR",date:t.labor_market.quits_rate.date,range:{min:1,max:4},methodology:"JOLTS - quits / total employment  100",trend:"stable",manuallyAdjusted:!1}}},wages:{category:"Wages & Earnings",icon:"",metrics:{average_hourly_earnings:{id:"average_hourly_earnings",name:"Average Hourly Earnings",shortName:"AHE",description:"Average hourly earnings of all employees on private nonfarm payrolls",value:t.wages.average_hourly_earnings.value,baseValue:t.wages.average_hourly_earnings.value,unit:"currency",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/ces/",seriesId:"CES0500000003",date:t.wages.average_hourly_earnings.date,range:{min:20,max:60},methodology:"Current Employment Statistics - total earnings / total hours",trend:"increasing",manuallyAdjusted:!1},median_weekly_earnings:{id:"median_weekly_earnings",name:"Median Weekly Earnings",shortName:"MWE",description:"Median usual weekly earnings of full-time wage and salary workers",value:t.wages.median_weekly_earnings.value,baseValue:t.wages.median_weekly_earnings.value,unit:"currency",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/cps/",seriesId:"LEU0252881500",date:t.wages.median_weekly_earnings.date,range:{min:500,max:2e3},methodology:"Current Population Survey - median of all full-time workers",trend:"increasing",manuallyAdjusted:!1},real_wage_growth:{id:"real_wage_growth",name:"Real Wage Growth",shortName:"RWG",description:"Year-over-year change in inflation-adjusted wages",value:t.wages.real_wage_growth.value,baseValue:t.wages.real_wage_growth.value,unit:"percent",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/",date:t.wages.real_wage_growth.date,range:{min:-5,max:10},methodology:"Nominal wage growth minus CPI inflation rate",trend:"stable",manuallyAdjusted:!1}}},productivity:{category:"Productivity",icon:"",metrics:{labor_productivity_growth:{id:"labor_productivity_growth",name:"Labor Productivity Growth",shortName:"LPG",description:"Year-over-year change in output per hour worked",value:t.productivity.labor_productivity_growth.value,baseValue:t.productivity.labor_productivity_growth.value,unit:"percent",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/lpc/",seriesId:"PRS85006092",date:t.productivity.labor_productivity_growth.date,range:{min:-3,max:8},methodology:"Major Sector Productivity Program - real output / hours worked",trend:"increasing",manuallyAdjusted:!1},output_per_hour:{id:"output_per_hour",name:"Output Per Hour Index",shortName:"OPH",description:"Index of output per hour of all persons (2017=100)",value:t.productivity.output_per_hour.value,baseValue:t.productivity.output_per_hour.value,unit:"index",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/lpc/",seriesId:"PRS85006093",date:t.productivity.output_per_hour.date,range:{min:90,max:150},methodology:"Major Sector Productivity Program - indexed to 2017 base year",trend:"increasing",manuallyAdjusted:!1},unit_labor_costs:{id:"unit_labor_costs",name:"Unit Labor Costs Growth",shortName:"ULC",description:"Year-over-year change in labor costs per unit of output",value:t.productivity.unit_labor_costs.value,baseValue:t.productivity.unit_labor_costs.value,unit:"percent",source:"Bureau of Labor Statistics (BLS)",sourceUrl:"https://www.bls.gov/lpc/",seriesId:"PRS85006112",date:t.productivity.unit_labor_costs.date,range:{min:-3,max:8},methodology:"Major Sector Productivity - compensation / productivity",trend:"stable",manuallyAdjusted:!1}}},demographics:{category:"Demographics",icon:"",metrics:{working_age_population:{id:"working_age_population",name:"Working Age Population",shortName:"WAP",description:"Civilian noninstitutional population 16 years and older",value:t.demographics.working_age_population.value,baseValue:t.demographics.working_age_population.value,unit:"millions",source:"U.S. Census Bureau",sourceUrl:"https://www.census.gov/",date:"2024",range:{min:18e7,max:25e7},methodology:"Census population estimates and American Community Survey",trend:"increasing",manuallyAdjusted:!1}}}}}getAllMetrics(){const t={};return this.metrics&&Object.values(this.metrics).forEach(e=>{Object.entries(e.metrics).forEach(([i,n])=>{t[i]={...n,category:e.category,categoryIcon:e.icon}})}),t}getMetricsByCategory(){return this.metrics}getMetric(t){return this.getAllMetrics()[t]||null}setMetricValue(t,e){const i=this.findMetricById(t);i&&(i.value=parseFloat(e),i.manuallyAdjusted=!0,this.saveAdjustments())}findMetricById(t){if(!this.metrics)return null;for(const e of Object.values(this.metrics))if(e.metrics[t])return e.metrics[t];return null}resetMetric(t){const e=this.findMetricById(t);e&&(e.value=e.baseValue,e.manuallyAdjusted=!1,this.saveAdjustments())}resetAllMetrics(){this.metrics&&(Object.values(this.metrics).forEach(t=>{Object.values(t.metrics).forEach(e=>{e.value=e.baseValue,e.manuallyAdjusted=!1})}),localStorage.removeItem(this.STORAGE_KEY))}saveAdjustments(){if(!this.metrics)return;const t={};Object.values(this.metrics).forEach(e=>{Object.entries(e.metrics).forEach(([i,n])=>{n.manuallyAdjusted&&(t[i]=n.value)})}),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}loadAdjustments(){try{const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("Error loading metric adjustments:",t),{}}}applyAdjustments(){!this.metrics||!this.adjustments||Object.entries(this.adjustments).forEach(([t,e])=>{const i=this.findMetricById(t);i&&(i.value=e,i.manuallyAdjusted=!0)})}getCurrentValues(){const t={},e=this.getAllMetrics();return Object.entries(e).forEach(([i,n])=>{t[i]=n.value}),t}getDataSources(){return[{id:"bls",name:"Bureau of Labor Statistics (BLS)",type:"Government",url:"https://www.bls.gov/",description:"Primary source for employment, unemployment, wages, and productivity data",metrics:["Unemployment Rate","Employment","Wages","Productivity","JOLTS"],updateFrequency:"Monthly/Quarterly"},{id:"fred",name:"Federal Reserve Economic Data (FRED)",type:"Government",url:"https://fred.stlouisfed.org/",description:"Comprehensive database of economic time series from various sources",metrics:["GDP","Interest Rates","Labor Share","Corporate Profits"],updateFrequency:"Varies by series"},{id:"census",name:"U.S. Census Bureau",type:"Government",url:"https://www.census.gov/",description:"Population estimates, demographic data, and economic surveys",metrics:["Population","Demographics","Income Distribution"],updateFrequency:"Annual/Decennial"},{id:"jolts",name:"Job Openings and Labor Turnover Survey (JOLTS)",type:"Government",url:"https://www.bls.gov/jlt/",description:"Data on job openings, hires, and separations",metrics:["Job Openings","Hires Rate","Quits Rate","Layoffs"],updateFrequency:"Monthly"},{id:"onet",name:"O*NET (Occupational Information Network)",type:"Government",url:"https://www.onetonline.org/",description:"Comprehensive database of occupational characteristics",metrics:["Occupation Skills","Task Requirements","Work Activities"],updateFrequency:"Annual"}]}}const Bh=new Bs;typeof window<"u"&&(window.RealMetricsSystem=Bs,window.realMetricsSystem=Bh);class Us{constructor(){this.STORAGE_KEY="ai_labor_sim_hypothetical_indicators",this.CUSTOM_STORAGE_KEY="ai_labor_sim_custom_indicators",this.indicators=this.getDefaultIndicators(),this.loadSavedAdjustments(),this.customIndicators=this.loadCustomIndicators()}getDefaultIndicators(){return{task_automation_rate:{id:"task_automation_rate",name:"Task Automation Rate",shortName:"TAR",value:43,baseValue:43,unit:"percent",description:"Percentage of economic tasks performed via AI automation (vs. augmentation)",methodology:"Measures the share of AI interactions that involve task delegation rather than human-AI collaboration",source:"Anthropic Economic Index",sourceUrl:"https://www.anthropic.com/economic-index",confidence:"medium",category:"automation",linkedMetrics:["ai_adoption","productivity_growth"],linkageFormula:{ai_adoption:.5,productivity_growth:.3},range:{min:0,max:100},trend:"increasing",icon:""},ai_occupational_exposure:{id:"ai_occupational_exposure",name:"AI Occupational Exposure Index",shortName:"AIOE",value:36,baseValue:36,unit:"percent_jobs_exposed",description:"Percentage of jobs with significant AI exposure (25%+ of tasks)",methodology:"Maps AI capabilities to O*NET occupational tasks to calculate exposure scores",source:"Felten, Raj, Seamans (2023) / Anthropic Economic Index",sourceUrl:"https://www.anthropic.com/news/the-anthropic-economic-index",confidence:"high",category:"exposure",linkedMetrics:["unemployment_rate","ai_adoption"],linkageFormula:{unemployment_rate:-.8,ai_adoption:.4},range:{min:0,max:100},trend:"increasing",icon:""},genai_workforce_adoption:{id:"genai_workforce_adoption",name:"GenAI Workforce Adoption Rate",shortName:"GWAR",value:23,baseValue:23,unit:"percent_workers",description:"Percentage of workers using generative AI weekly for work tasks",methodology:"Based on Real-Time Population Survey measuring actual workplace AI usage",source:"Stanford Digital Economy Lab / Census surveys",sourceUrl:"https://digitaleconomy.stanford.edu/",confidence:"high",category:"adoption",linkedMetrics:["ai_adoption","productivity_growth"],linkageFormula:{ai_adoption:.3,productivity_growth:.2},range:{min:0,max:100},trend:"increasing",icon:""},skills_transformation_score:{id:"skills_transformation_score",name:"Skills-Based Transformation Score",shortName:"STS",value:28,baseValue:28,unit:"index_0_100",description:"Measures skills disruption invisible to traditional employment metrics",methodology:"Models individual workers as agents with skills mapped across 32,000 skill categories",source:"MIT Iceberg Index",sourceUrl:"https://iceberg.mit.edu",confidence:"medium",category:"skills",linkedMetrics:["ai_adoption","unemployment_rate","wage_growth"],linkageFormula:{ai_adoption:.35,unemployment_rate:.2,wage_growth:-.15},range:{min:0,max:100},trend:"increasing",icon:""},job_displacement_velocity:{id:"job_displacement_velocity",name:"AI Job Displacement Velocity",shortName:"JDV",value:.8,baseValue:.8,unit:"percent_monthly",description:"Monthly rate of job displacement attributable to AI/automation",methodology:"Isolates AI-related employment changes from cyclical and other structural factors",source:"Yale Budget Lab / IMF Research",sourceUrl:"https://budgetlab.yale.edu/",confidence:"low",category:"displacement",linkedMetrics:["unemployment_rate","ai_adoption","automation_pace"],linkageFormula:{unemployment_rate:.15,ai_adoption:.08,automation_pace:.25},range:{min:0,max:5},trend:"uncertain",icon:""},human_ai_collaboration_index:{id:"human_ai_collaboration_index",name:"Human-AI Collaboration Index",shortName:"HACI",value:57,baseValue:57,unit:"percent_augmented",description:"Percentage of AI usage that augments (vs. replaces) human work",methodology:"Classifies AI interactions as automation vs. augmentation based on human involvement",source:"Anthropic Economic Index / ILO",sourceUrl:"https://www.ilo.org/publications/generative-ai-and-jobs-2025-update",confidence:"medium",category:"collaboration",linkedMetrics:["productivity_growth","wage_growth"],linkageFormula:{productivity_growth:.25,wage_growth:.15},range:{min:0,max:100},trend:"decreasing",icon:""},ai_wage_premium:{id:"ai_wage_premium",name:"AI Skills Wage Premium",shortName:"AIWP",value:18,baseValue:18,unit:"percent_premium",description:"Wage premium for workers with AI-complementary skills",methodology:"Compares wages for similar roles with/without AI skill requirements",source:"Research synthesis / Job posting analysis",sourceUrl:"https://eig.org/ai-and-jobs-the-final-word/",confidence:"medium",category:"wages",linkedMetrics:["wage_growth","ai_adoption","unemployment_rate"],linkageFormula:{wage_growth:.5,ai_adoption:.2,unemployment_rate:-.3},range:{min:-20,max:50},trend:"increasing",icon:""},emerging_role_creation:{id:"emerging_role_creation",name:"Emerging Role Creation Rate",shortName:"ERCR",value:2.1,baseValue:2.1,unit:"percent_new_roles",description:"Annual rate of new job categories created by AI advancement",methodology:"Tracks job postings for roles not in standard BLS occupation codes",source:"BLS methodology gap / Indeed analysis",sourceUrl:"https://www.bls.gov/opub/mlr/2025/article/incorporating-ai-impacts-in-bls-employment-projections.htm",confidence:"low",category:"creation",linkedMetrics:["ai_adoption","productivity_growth","job_openings"],linkageFormula:{ai_adoption:.05,productivity_growth:.03,job_openings:.02},range:{min:0,max:10},trend:"increasing",icon:""},regional_ai_vulnerability:{id:"regional_ai_vulnerability",name:"Regional AI Vulnerability Score",shortName:"RAVS",value:34,baseValue:34,unit:"index_0_100",description:"Geographic concentration of AI displacement risk",methodology:"Combines regional industry mix with occupation-level AI exposure",source:"Anthropic Economic Index Geography / IMF",sourceUrl:"https://www.anthropic.com/research/economic-index-geography",confidence:"medium",category:"geographic",linkedMetrics:["unemployment_rate","ai_adoption"],linkageFormula:{unemployment_rate:.4,ai_adoption:.25},range:{min:0,max:100},trend:"increasing",icon:""},labor_share_ai_impact:{id:"labor_share_ai_impact",name:"Labor Share AI Impact",shortName:"LSAI",value:-.8,baseValue:-.8,unit:"percent_annual_change",description:"Annual change in labor share of income attributable to AI",methodology:"Isolates AI contribution to labor-capital income shift",source:"IMF Research / FRED data analysis",sourceUrl:"https://www.imf.org/en/Publications/WP/Issues/2024/09/13/The-Labor-Market-Impact-of-Artificial-Intelligence-Evidence-from-US-Regions-554845",confidence:"low",category:"distribution",linkedMetrics:["productivity_growth","wage_growth","ai_adoption"],linkageFormula:{productivity_growth:-.2,wage_growth:.15,ai_adoption:-.1},range:{min:-5,max:5},trend:"decreasing",icon:""}}}getAllIndicators(){return{...this.indicators,...this.customIndicators}}getIndicator(t){return this.indicators[t]||this.customIndicators[t]}setIndicatorValue(t,e){const i=this.getIndicator(t);return i?(i.value=Math.max(i.range.min,Math.min(i.range.max,e)),i.manuallyAdjusted=!0,this.saveAdjustments(),i):null}resetIndicator(t){const e=this.getIndicator(t);return e?(e.value=e.baseValue,e.manuallyAdjusted=!1,this.saveAdjustments(),e):null}resetAllIndicators(){Object.values(this.indicators).forEach(t=>{t.value=t.baseValue,t.manuallyAdjusted=!1}),this.saveAdjustments()}calculateFromRealMetrics(t,e){const i={};return Object.entries(this.indicators).forEach(([n,s])=>{if(s.manuallyAdjusted){i[n]=s.value;return}let o=s.baseValue;Object.entries(s.linkageFormula).forEach(([r,l])=>{const c=t[r],d=e[r];if(c!==void 0&&d!==void 0){const h=c-d;o+=h*l}}),o=Math.max(s.range.min,Math.min(s.range.max,o)),s.value=o,i[n]=o}),i}projectIndicators(t){const e={},{ai_adoption:i,unemployment_rate:n,productivity_growth:s,wage_growth:o,automation_pace:r}=t,l={slow:.7,moderate:1,fast:1.4,accelerating:1.8}[r]||1;return Object.entries(this.indicators).forEach(([c,d])=>{let h=d.baseValue;if(d.linkageFormula.ai_adoption&&i!==void 0){const u=i-35;h+=u*d.linkageFormula.ai_adoption}if(d.linkageFormula.unemployment_rate&&n!==void 0){const u=n-4.1;h+=u*d.linkageFormula.unemployment_rate}if(d.linkageFormula.productivity_growth&&s!==void 0){const u=s-2.2;h+=u*d.linkageFormula.productivity_growth}if(d.linkageFormula.wage_growth&&o!==void 0){const u=o-1.4;h+=u*d.linkageFormula.wage_growth}d.linkageFormula.automation_pace&&(h*=l),h=Math.max(d.range.min,Math.min(d.range.max,h)),e[c]={...d,projectedValue:h,change:h-d.baseValue,percentChange:(h-d.baseValue)/Math.abs(d.baseValue||1)*100}}),e}addCustomIndicator(t){const e=t.id||`custom_${Date.now()}`,i={id:e,name:t.name,shortName:t.shortName||t.name.substring(0,4).toUpperCase(),value:t.value||0,baseValue:t.value||0,unit:t.unit||"index",description:t.description||"",methodology:t.methodology||"User-defined metric",source:"Custom",sourceUrl:"",confidence:"user_defined",category:t.category||"custom",linkedMetrics:t.linkedMetrics||[],linkageFormula:t.linkageFormula||{},range:t.range||{min:0,max:100},trend:t.trend||"unknown",icon:t.icon||"",isCustom:!0};return this.customIndicators[e]=i,this.saveCustomIndicators(),i}removeCustomIndicator(t){return this.customIndicators[t]?(delete this.customIndicators[t],this.saveCustomIndicators(),!0):!1}updateCustomIndicator(t,e){return this.customIndicators[t]?(Object.assign(this.customIndicators[t],e),this.saveCustomIndicators(),this.customIndicators[t]):null}saveAdjustments(){try{const t={};Object.entries(this.indicators).forEach(([e,i])=>{i.manuallyAdjusted&&(t[e]={value:i.value,manuallyAdjusted:!0})}),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(t){console.error("Failed to save indicator adjustments:",t)}}loadSavedAdjustments(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(t){const e=JSON.parse(t);Object.entries(e).forEach(([i,n])=>{this.indicators[i]&&(this.indicators[i].value=n.value,this.indicators[i].manuallyAdjusted=n.manuallyAdjusted)})}}catch(t){console.error("Failed to load indicator adjustments:",t)}}saveCustomIndicators(){try{localStorage.setItem(this.CUSTOM_STORAGE_KEY,JSON.stringify(this.customIndicators))}catch(t){console.error("Failed to save custom indicators:",t)}}loadCustomIndicators(){try{const t=localStorage.getItem(this.CUSTOM_STORAGE_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("Failed to load custom indicators:",t),{}}}getIndicatorsByCategory(){const t=this.getAllIndicators(),e={};return Object.values(t).forEach(i=>{const n=i.category||"other";e[n]||(e[n]=[]),e[n].push(i)}),e}getCategoryDisplayNames(){return{automation:"Task Automation",exposure:"AI Exposure",adoption:"Adoption Metrics",skills:"Skills & Training",displacement:"Job Displacement",collaboration:"Human-AI Collaboration",wages:"Wage Impacts",creation:"Job Creation",geographic:"Geographic Impact",distribution:"Income Distribution",custom:"Custom Indicators"}}exportIndicators(){return{builtIn:this.indicators,custom:this.customIndicators,exportDate:new Date().toISOString()}}importIndicators(t){t.builtIn&&Object.entries(t.builtIn).forEach(([e,i])=>{this.indicators[e]&&(this.indicators[e].value=i.value,this.indicators[e].manuallyAdjusted=i.manuallyAdjusted)}),t.custom&&(this.customIndicators={...this.customIndicators,...t.custom}),this.saveAdjustments(),this.saveCustomIndicators()}}const Uh=new Us;typeof window<"u"&&(window.HypotheticalIndicatorsSystem=Us,window.hypotheticalIndicators=Uh);class Vh{constructor(t,e){this.dataService=t,this.indicators=e,this.baselineSnapshot=null,this.currentScenario=null,this.results=[]}async initialize(){return this.baselineSnapshot=await this.dataService.getCurrentSnapshot(),this.baselineSnapshot}createScenario(t){const e={id:Date.now(),name:t.name||"Unnamed Scenario",description:t.description||"",created:new Date().toISOString(),timeframe:{start_year:new Date().getFullYear(),end_year:t.end_year||new Date().getFullYear()+5,steps_per_year:t.steps_per_year||12},targets:{unemployment_rate:t.target_unemployment,ai_adoption_rate:t.ai_adoption_rate||50,productivity_growth:t.productivity_growth||3,automation_pace:t.automation_pace||"moderate"},ai_parameters:{adoption_curve:t.adoption_curve||"s_curve",sector_variation:t.sector_variation!==!1,displacement_lag:t.displacement_lag||6,new_job_multiplier:t.new_job_multiplier||.3},economic_parameters:{gdp_growth:t.gdp_growth||2,inflation:t.inflation||2.5,interest_rate:t.interest_rate||4,labor_elasticity:t.labor_elasticity||-.5},interventions:[]};return this.currentScenario=e,e}async runSimulation(){if(!this.currentScenario)throw new Error("No scenario configured");this.baselineSnapshot||await this.initialize();const t=this.currentScenario,e=[],n=(t.timeframe.end_year-t.timeframe.start_year)*t.timeframe.steps_per_year;let s=this.initializeState();for(let o=0;o<=n;o++){const r=t.timeframe.start_year+o/t.timeframe.steps_per_year,l=o/n,c=this.calculateAIAdoption(l,t),d=this.calculateLaborImpact(s,c,t),h=this.applyInterventions(s,d,t.interventions);s=this.updateState(s,d,h),e.push({step:o,year:parseFloat(r.toFixed(2)),progress:parseFloat((l*100).toFixed(1)),ai_adoption:c,labor_market:{...s.labor_market},wages:{...s.wages},productivity:{...s.productivity},sectors:JSON.parse(JSON.stringify(s.sectors)),interventions:h,derived:this.calculateDerivedMetrics(s)})}return this.results=e,{scenario:this.currentScenario,results:e,summary:this.generateSummary(e)}}getAIAdoptionValue(t){return t.companies_using_ai?t.companies_using_ai.value:t.real&&t.real.companies_using_ai?t.real.companies_using_ai.value:35}initializeState(){const t=this.baselineSnapshot;return{labor_market:{total_employment:t.labor_market.total_employment,unemployment_rate:t.labor_market.unemployment_rate,labor_force_participation:t.labor_market.labor_force_participation,job_openings:t.labor_market.job_openings,labor_force:t.labor_market.total_employment/(1-t.labor_market.unemployment_rate/100)},wages:{average_hourly:t.wages.average_hourly,median_weekly:t.wages.median_weekly,real_wage_growth:t.wages.real_wage_growth},productivity:{growth_rate:t.productivity.growth_rate,output_per_hour:t.productivity.output_per_hour},sectors:JSON.parse(JSON.stringify(t.sectors)),ai:{adoption_rate:this.getAIAdoptionValue(t.ai_indicators),displaced_workers:0,new_jobs_created:0}}}calculateAIAdoption(t,e){const i=this.getAIAdoptionValue(this.baselineSnapshot.ai_indicators),n=e.targets.ai_adoption_rate,s=e.ai_parameters.adoption_curve;let o;switch(s){case"linear":o=i+(n-i)*t;break;case"exponential":o=i*Math.pow(n/i,t);break;case"s_curve":default:const l=1/(1+Math.exp(-10*(t-.5)));o=i+(n-i)*l;break}return{rate:Math.min(100,Math.max(0,o)),change_from_baseline:o-i,curve_type:s}}calculateLaborImpact(t,e,i){const n=e.rate-t.ai.adoption_rate,s=this.getAutomationPaceMultiplier(i.targets.automation_pace);let o=0,r=0;const l={};for(const[d,h]of Object.entries(t.sectors)){const u=h.automation_exposure,m=h.employment,p=u*(n/100)*s*.1,g=Math.round(m*p),f=i.ai_parameters.new_job_multiplier*(n/100)*.05,y=Math.round(m*f*(1-u));l[d]={displaced:g,new_jobs:y,net_change:y-g},o+=g,r+=y}const c=this.calculateTargetAdjustment(t,i);return{total_displaced:o,total_new_jobs:r,net_job_change:r-o+c,sector_impacts:l,productivity_gain:n*.02,wage_pressure:-n*.01}}getAutomationPaceMultiplier(t){return{slow:.5,moderate:1,fast:1.5,accelerating:2}[t]||1}calculateTargetAdjustment(t,e){if(!e.targets.unemployment_rate)return 0;const i=t.labor_market.unemployment_rate,n=e.targets.unemployment_rate,s=1/(e.timeframe.end_year-e.timeframe.start_year),o=t.labor_market.labor_force,r=o*(i/100),l=o*(n/100),c=(r-l)*s;return Math.round(c)}applyInterventions(t,e,i){if(!i||i.length===0)return{applied:[],total_effect:0};const n=[];let s=0,o=0;for(const r of i){if(!r.active)continue;const l=this.calculateInterventionEffect(r,t,e);n.push({name:r.name,type:r.type,...l}),s+=l.job_effect||0,o+=l.wage_effect||0}return{applied:n,total_job_effect:s,total_wage_effect:o}}calculateInterventionEffect(t,e,i){return{job_effect:0,wage_effect:0,cost:0}}updateState(t,e,i){const n=JSON.parse(JSON.stringify(t)),s=e.net_job_change+(i.total_job_effect||0);n.labor_market.total_employment+=s;const o=n.labor_market.labor_force,r=n.labor_market.total_employment;n.labor_market.unemployment_rate=(o-r)/o*100,n.labor_market.unemployment_rate=Math.max(0,Math.min(50,n.labor_market.unemployment_rate));const l=n.labor_market.unemployment_rate-t.labor_market.unemployment_rate;n.labor_market.job_openings=Math.max(1e6,t.labor_market.job_openings*(1-l*.05)),n.wages.real_wage_growth=t.wages.real_wage_growth+e.wage_pressure+(i.total_wage_effect||0),n.wages.average_hourly*=1+n.wages.real_wage_growth/100/12,n.wages.median_weekly*=1+n.wages.real_wage_growth/100/12,n.productivity.growth_rate=t.productivity.growth_rate+e.productivity_gain,n.productivity.output_per_hour*=1+n.productivity.growth_rate/100/12;for(const[c,d]of Object.entries(e.sector_impacts))n.sectors[c]&&(n.sectors[c].employment+=d.net_change);return n.ai.displaced_workers+=e.total_displaced,n.ai.new_jobs_created+=e.total_new_jobs,n}calculateDerivedMetrics(t){return{employment_to_population:t.labor_market.total_employment/21e7*100,jobs_per_unemployed:t.labor_market.job_openings/(t.labor_market.labor_force-t.labor_market.total_employment),cumulative_displacement:t.ai.displaced_workers,cumulative_new_jobs:t.ai.new_jobs_created,net_ai_job_impact:t.ai.new_jobs_created-t.ai.displaced_workers}}generateSummary(t){const e=t[0],i=t[t.length-1],n=this.calculateInterventionSummary(t);return{timeframe:{start_year:e.year,end_year:i.year,duration_years:i.year-e.year},labor_market_changes:{unemployment_rate:{initial:e.labor_market.unemployment_rate.toFixed(1),final:i.labor_market.unemployment_rate.toFixed(1),change:(i.labor_market.unemployment_rate-e.labor_market.unemployment_rate).toFixed(1)},total_employment:{initial:e.labor_market.total_employment,final:i.labor_market.total_employment,change:i.labor_market.total_employment-e.labor_market.total_employment},job_openings:{initial:e.labor_market.job_openings,final:i.labor_market.job_openings,change:i.labor_market.job_openings-e.labor_market.job_openings}},ai_impact:{ai_adoption:{initial:e.ai_adoption.rate.toFixed(1),final:i.ai_adoption.rate.toFixed(1)},cumulative_displacement:i.derived.cumulative_displacement,cumulative_new_jobs:i.derived.cumulative_new_jobs,net_impact:i.derived.net_ai_job_impact},wages:{average_hourly:{initial:e.wages.average_hourly.toFixed(2),final:i.wages.average_hourly.toFixed(2),change_percent:((i.wages.average_hourly-e.wages.average_hourly)/e.wages.average_hourly*100).toFixed(1)}},productivity:{growth_rate:{initial:e.productivity.growth_rate.toFixed(1),final:i.productivity.growth_rate.toFixed(1)}},interventions:n,sector_summary:this.generateSectorSummary(e.sectors,i.sectors)}}calculateInterventionSummary(t){var s;const e={total_job_effect:0,total_wage_effect:0,total_fiscal_cost:0,total_economic_impact:0,monthly_averages:{job_effect:0,wage_effect:0,fiscal_cost:0,economic_impact:0},details:[]};for(const o of t)o.interventions&&(e.total_job_effect+=o.interventions.total_job_effect||0,e.total_wage_effect+=o.interventions.total_wage_effect||0,e.total_fiscal_cost+=o.interventions.total_fiscal_cost||0,e.total_economic_impact+=o.interventions.total_economic_impact||0);const i=t.length;i>0&&(e.monthly_averages.job_effect=e.total_job_effect/i,e.monthly_averages.wage_effect=e.total_wage_effect/i,e.monthly_averages.fiscal_cost=e.total_fiscal_cost/i,e.monthly_averages.economic_impact=e.total_economic_impact/i);const n=t[t.length-1];return(s=n==null?void 0:n.interventions)!=null&&s.details&&(e.details=n.interventions.details),e}generateSectorSummary(t,e){const i={};for(const s of Object.keys(t))i[s]={employment_change:e[s].employment-t[s].employment,employment_change_percent:((e[s].employment-t[s].employment)/t[s].employment*100).toFixed(1),automation_exposure:t[s].automation_exposure};const n=Object.entries(i).sort((s,o)=>s[1].employment_change-o[1].employment_change);return{most_affected:n.slice(0,3).map(([s,o])=>({name:s,...o})),least_affected:n.slice(-3).reverse().map(([s,o])=>({name:s,...o}))}}getResultsForYear(t){return this.results.filter(e=>Math.floor(e.year)===t)}exportResults(t="json"){if(t==="json")return JSON.stringify({scenario:this.currentScenario,results:this.results,summary:this.generateSummary(this.results)},null,2);if(t==="csv"){const e=["Year","AI Adoption %","Unemployment Rate %","Total Employment","Job Openings","Avg Hourly Wage","Productivity Growth %","Cumulative Displaced","Cumulative New Jobs"],i=this.results.map(n=>[n.year,n.ai_adoption.rate.toFixed(1),n.labor_market.unemployment_rate.toFixed(2),n.labor_market.total_employment,Math.round(n.labor_market.job_openings),n.wages.average_hourly.toFixed(2),n.productivity.growth_rate.toFixed(2),n.derived.cumulative_displacement,n.derived.cumulative_new_jobs]);return[e,...i].map(n=>n.join(",")).join(`
`)}return this.results}async runSensitivityAnalysis(t,e){const i=JSON.parse(JSON.stringify(this.currentScenario)),n=[];for(const s of e){this.setParameter(t,s);const o=await this.runSimulation();n.push({parameter_value:s,summary:o.summary})}return this.currentScenario=i,{parameter:t,analysis:n}}setParameter(t,e){const i=t.split(".");let n=this.currentScenario;for(let s=0;s<i.length-1;s++)n=n[i[s]];n[i[i.length-1]]=e}}typeof window<"u"&&(window.SimulationEngine=Vh);class Yh{constructor(){this.interventions=[],this.interventionTypes=this.defineInterventionTypes()}defineInterventionTypes(){return{ubi:{name:"Universal Basic Income",description:"Monthly cash payment to all adult citizens",category:"income_support",parameters:{monthly_amount:{type:"number",default:1e3,min:0,max:5e3,unit:"USD/month"},eligibility_age:{type:"number",default:18,min:16,max:25},phase_out_threshold:{type:"number",default:0,min:0,max:2e5,unit:"USD/year",description:"Income level at which UBI phases out (0 = universal)"}},effects:{labor_force_participation:{direction:"decrease",magnitude:"small"},consumption:{direction:"increase",magnitude:"medium"},poverty_rate:{direction:"decrease",magnitude:"large"},entrepreneurship:{direction:"increase",magnitude:"small"}},cost_model:"population_based"},job_retraining:{name:"Job Retraining Programs",description:"Government-funded programs to retrain displaced workers",category:"workforce_development",parameters:{funding_per_worker:{type:"number",default:1e4,min:1e3,max:5e4,unit:"USD"},program_duration:{type:"number",default:6,min:1,max:24,unit:"months"},success_rate:{type:"number",default:60,min:0,max:100,unit:"%"},eligibility:{type:"select",options:["all_unemployed","displaced_only","means_tested"],default:"displaced_only"}},effects:{skill_mismatch:{direction:"decrease",magnitude:"large"},unemployment_duration:{direction:"decrease",magnitude:"medium"},wages_post_displacement:{direction:"increase",magnitude:"medium"}},cost_model:"participant_based"},wage_subsidy:{name:"Wage Subsidies",description:"Government subsidies to employers for maintaining employment",category:"employment_support",parameters:{subsidy_rate:{type:"number",default:25,min:0,max:100,unit:"% of wage"},max_wage_covered:{type:"number",default:5e4,min:0,max:15e4,unit:"USD/year"},duration:{type:"number",default:12,min:1,max:36,unit:"months"},sector_targeting:{type:"multiselect",options:["all","high_automation_risk","manufacturing","retail","transportation"],default:["high_automation_risk"]}},effects:{employment_retention:{direction:"increase",magnitude:"large"},business_costs:{direction:"decrease",magnitude:"medium"},wage_pressure:{direction:"decrease",magnitude:"small"}},cost_model:"wage_based"},reduced_workweek:{name:"Reduced Work Week",description:"Mandate or incentivize shorter work weeks to spread employment",category:"work_sharing",parameters:{target_hours:{type:"number",default:32,min:20,max:40,unit:"hours/week"},wage_adjustment:{type:"select",options:["full_wage","proportional","partial_subsidy"],default:"partial_subsidy"},implementation:{type:"select",options:["mandate","incentive","voluntary"],default:"incentive"}},effects:{employment:{direction:"increase",magnitude:"medium"},productivity_per_hour:{direction:"increase",magnitude:"small"},worker_wellbeing:{direction:"increase",magnitude:"medium"}},cost_model:"economy_wide"},robot_tax:{name:"Automation Tax",description:"Tax on automation/robots to fund worker transition",category:"taxation",parameters:{tax_rate:{type:"number",default:5,min:0,max:50,unit:"% of labor cost savings"},revenue_allocation:{type:"multiselect",options:["ubi","retraining","education","general_fund"],default:["retraining","education"]},exemptions:{type:"multiselect",options:["small_business","healthcare","research"],default:["small_business"]}},effects:{automation_pace:{direction:"decrease",magnitude:"small"},tax_revenue:{direction:"increase",magnitude:"medium"},business_investment:{direction:"decrease",magnitude:"small"}},cost_model:"revenue_generating"},education_subsidy:{name:"Education & Skills Subsidy",description:"Subsidized education for AI-complementary skills",category:"workforce_development",parameters:{subsidy_amount:{type:"number",default:15e3,min:0,max:1e5,unit:"USD/year"},program_types:{type:"multiselect",options:["stem_degree","vocational","bootcamp","apprenticeship"],default:["stem_degree","bootcamp"]},income_cap:{type:"number",default:75e3,min:0,max:2e5,unit:"USD/year"}},effects:{skill_supply:{direction:"increase",magnitude:"large"},wage_premium:{direction:"decrease",magnitude:"small"},inequality:{direction:"decrease",magnitude:"medium"}},cost_model:"participant_based"},job_guarantee:{name:"Federal Job Guarantee",description:"Government as employer of last resort",category:"employment_support",parameters:{hourly_wage:{type:"number",default:20,min:15,max:30,unit:"USD/hour"},job_types:{type:"multiselect",options:["infrastructure","caregiving","environment","community_service"],default:["infrastructure","caregiving"]},eligibility:{type:"select",options:["all_unemployed","long_term_only","displaced_only"],default:"all_unemployed"}},effects:{unemployment_floor:{direction:"establish",magnitude:"large"},wage_floor:{direction:"increase",magnitude:"medium"},public_services:{direction:"increase",magnitude:"medium"}},cost_model:"participant_based"},portable_benefits:{name:"Portable Benefits System",description:"Benefits that follow workers across jobs and gig work",category:"safety_net",parameters:{benefit_types:{type:"multiselect",options:["healthcare","retirement","unemployment","disability"],default:["healthcare","retirement"]},funding_model:{type:"select",options:["employer_mandate","payroll_tax","general_revenue"],default:"payroll_tax"},contribution_rate:{type:"number",default:5,min:0,max:20,unit:"% of earnings"}},effects:{gig_worker_security:{direction:"increase",magnitude:"large"},job_mobility:{direction:"increase",magnitude:"medium"},entrepreneurship:{direction:"increase",magnitude:"small"}},cost_model:"earnings_based"},transition_assistance:{name:"Transition Assistance",description:"Direct payments to workers displaced by automation",category:"income_support",parameters:{replacement_rate:{type:"number",default:70,min:0,max:100,unit:"% of previous wage"},duration:{type:"number",default:24,min:6,max:48,unit:"months"},retraining_requirement:{type:"boolean",default:!0}},effects:{consumption_stability:{direction:"increase",magnitude:"large"},job_search_quality:{direction:"increase",magnitude:"medium"},skill_preservation:{direction:"increase",magnitude:"medium"}},cost_model:"displaced_based"}}}addIntervention(t,e={},i={}){const n=this.interventionTypes[t];if(!n)throw new Error(`Unknown intervention type: ${t}`);const s={};for(const[r,l]of Object.entries(n.parameters))s[r]=e[r]!==void 0?e[r]:l.default;const o={id:Date.now()+Math.random(),type:t,name:i.name||n.name,description:n.description,category:n.category,parameters:s,effects:n.effects,cost_model:n.cost_model,active:i.active!==!1,start_year:i.start_year||null,end_year:i.end_year||null};return this.interventions.push(o),o}removeIntervention(t){this.interventions=this.interventions.filter(e=>e.id!==t)}updateIntervention(t,e){const i=this.interventions.find(n=>n.id===t);return i&&(e.parameters&&Object.assign(i.parameters,e.parameters),e.active!==void 0&&(i.active=e.active),e.start_year!==void 0&&(i.start_year=e.start_year),e.end_year!==void 0&&(i.end_year=e.end_year)),i}calculateEffects(t,e,i){const n={job_effect:0,wage_effect:0,lfpr_effect:0,fiscal_cost:0,economic_impact:0,details:[]};for(const s of this.interventions){if(!s.active||s.start_year&&e<s.start_year||s.end_year&&e>s.end_year)continue;const o=this.calculateSingleEffect(s,t,i);n.job_effect+=o.job_effect,n.wage_effect+=o.wage_effect,n.lfpr_effect+=o.lfpr_effect,n.fiscal_cost+=o.fiscal_cost,n.economic_impact+=o.economic_impact||0,n.details.push({intervention:s.name,type:s.type,...o})}return n.total_job_effect=n.job_effect,n.total_wage_effect=n.wage_effect,n.total_fiscal_cost=n.fiscal_cost,n.total_economic_impact=n.economic_impact,n}calculateSingleEffect(t,e,i){const n=t.parameters;let s={job_effect:0,wage_effect:0,lfpr_effect:0,fiscal_cost:0,economic_impact:0};switch(t.type){case"ubi":s=this.calculateUBIEffect(n,e);break;case"job_retraining":s=this.calculateRetrainingEffect(n,e,i);break;case"wage_subsidy":s=this.calculateWageSubsidyEffect(n,e);break;case"reduced_workweek":s=this.calculateWorkweekEffect(n,e);break;case"robot_tax":s=this.calculateRobotTaxEffect(n,e,i);break;case"education_subsidy":s=this.calculateEducationEffect(n,e);break;case"job_guarantee":s=this.calculateJobGuaranteeEffect(n,e);break;case"portable_benefits":s=this.calculatePortableBenefitsEffect(n,e);break;case"transition_assistance":s=this.calculateTransitionEffect(n,e,i);break}return s}calculateUBIEffect(t,e){const n=t.monthly_amount*12*1638e5,s=-.5*(t.monthly_amount/1e3),o=.7,l=n*o*1e-5,d=n*o*1.2;return{job_effect:Math.round(l/12),wage_effect:.1*(t.monthly_amount/1e3),lfpr_effect:s/12,fiscal_cost:n/12,economic_impact:d/12}}calculateRetrainingEffect(t,e,i){const s=(i.total_displaced||0)*(t.eligibility==="all_unemployed"?2:1),o=s*(t.success_rate/100),r=t.program_duration,l=o*.8,c=s*t.funding_per_worker/r,d=e.wages.average_hourly*2080,h=o*d*1.15;return{job_effect:Math.round(l),wage_effect:.05,lfpr_effect:.02,fiscal_cost:c,economic_impact:h/12}}calculateWageSubsidyEffect(t,e){const i=e.labor_market.total_employment*.15,n=e.wages.average_hourly*2080,s=Math.min(n,t.max_wage_covered)*(t.subsidy_rate/100),o=i*s,r=i*.05*(t.subsidy_rate/100),l=r*n*.8;return{job_effect:Math.round(r/12),wage_effect:-.02,lfpr_effect:0,fiscal_cost:o/12,economic_impact:l/12}}calculateWorkweekEffect(t,e){const n=(40-t.target_hours)/40,s=e.labor_market.total_employment*n*.5;let o=0;t.wage_adjustment==="partial_subsidy"&&(o=s*e.wages.average_hourly*2080*.25);const r=e.wages.average_hourly*2080,l=s*r*.7;return{job_effect:Math.round(s/12),wage_effect:t.wage_adjustment==="full_wage"?.1:-.05,lfpr_effect:.05,fiscal_cost:o/12,economic_impact:l/12}}calculateRobotTaxEffect(t,e,i){const s=i.total_displaced*e.wages.average_hourly*2080*(t.tax_rate/100),o=i.total_displaced*.1*(t.tax_rate/100),r=e.wages.average_hourly*2080,l=o*r*.5,c=s*.3,d=s+l-c;return{job_effect:Math.round(o/12),wage_effect:0,lfpr_effect:0,fiscal_cost:-s/12,economic_impact:d/12}}calculateEducationEffect(t,e){const n=105e5*(t.income_cap/1e5),s=n*t.subsidy_amount,o=n*.001,r=e.wages.average_hourly*2080,l=o*r*1.2,c=s*.8+l;return{job_effect:Math.round(o/12),wage_effect:.02,lfpr_effect:-.01,fiscal_cost:s/12,economic_impact:c/12}}calculateJobGuaranteeEffect(t,e){const i=e.labor_market.labor_force-e.labor_market.total_employment,n=t.eligibility==="all_unemployed"?.4:t.eligibility==="long_term_only"?.2:.3,s=i*n,o=t.hourly_wage*2080,r=s*o*1.3,d=s*o*.8*1.5;return{job_effect:Math.round(s/12),wage_effect:.15*(t.hourly_wage/20),lfpr_effect:.1,fiscal_cost:r/12,economic_impact:d/12}}calculatePortableBenefitsEffect(t,e){const i=e.labor_market.total_employment*.15,n=i*e.wages.average_hourly*2080*(t.contribution_rate/100),s=i*.02,o=e.wages.average_hourly*2080,r=i*.03*o*.1,l=s*o*1.2,c=r+l;return{job_effect:Math.round(s/12),wage_effect:0,lfpr_effect:.03,fiscal_cost:t.funding_model==="general_revenue"?n/12:0,economic_impact:c/12}}calculateTransitionEffect(t,e,i){const n=i.total_displaced||0,s=e.wages.average_hourly*2080,o=s*(t.replacement_rate/100),r=n*12*o*(t.duration/12),l=.1,c=r*.8,d=n*l*s*.1,h=c*1.5+d;return{job_effect:Math.round(n*l/12),wage_effect:.05,lfpr_effect:.02,fiscal_cost:r/12,economic_impact:h/12}}getSummary(){return{total_interventions:this.interventions.length,active_interventions:this.interventions.filter(t=>t.active).length,by_category:this.getByCategory(),interventions:this.interventions.map(t=>({id:t.id,name:t.name,type:t.type,active:t.active,parameters:t.parameters}))}}getByCategory(){const t={};for(const e of this.interventions)t[e.category]||(t[e.category]=[]),t[e.category].push(e.name);return t}exportConfig(){return JSON.stringify({interventions:this.interventions,exported_at:new Date().toISOString()},null,2)}importConfig(t){const e=typeof t=="string"?JSON.parse(t):t;this.interventions=e.interventions||[]}getAvailableTypes(){return Object.entries(this.interventionTypes).map(([t,e])=>({type:t,name:e.name,description:e.description,category:e.category,parameters:e.parameters}))}}typeof window<"u"&&(window.InterventionSystem=Yh);const Gh={compoundGrowth(a,t,e){return a*Math.pow(1+t,e)},cagr(a,t,e){return Math.pow(t/a,1/e)-1},unemploymentRate(a,t){return(t-a)/t*100},lfpr(a,t){return a/t*100},employmentRatio(a,t){return a/t*100},okunsLaw(a,t=2){return-t*a},phillipsCurve(a,t=4.5,e=.5){return e*(t-a)},beveridgeCurve(a,t=.5){return t/a},giniCoefficient(a){const t=[...a].sort((s,o)=>s-o),e=t.length,i=t.reduce((s,o)=>s+o,0)/e;let n=0;for(let s=0;s<e;s++)for(let o=0;o<e;o++)n+=Math.abs(t[s]-t[o]);return n/(2*e*e*i)},laborShare(a,t){return a/t*100},productivity(a,t){return a/t},realWage(a,t,e=100){return a*(e/t)},wagePolarization(a,t){return a/t},automationExposure(a){const t=a.reduce((i,n)=>i+n.weight,0);return a.reduce((i,n)=>i+(n.automatable?n.weight:0),0)/t},displacementEstimate(a,t,e,i){const n=t*e*.1;return a*(1-Math.pow(1-n,i))},newJobEstimate(a,t=1e-5){return a*t},matchingEfficiency(a,t,e,i=.5){return a/(Math.pow(t,i)*Math.pow(e,1-i))},skillMismatch(a,t){let e=0,i=0;for(const n of Object.keys(a)){const s=a[n],o=t[n]||0;e+=Math.max(0,s-o),i++}return i>0?e/i:0},npv(a,t){return a.reduce((e,i,n)=>e+i/Math.pow(1+t,n),0)},interventionROI(a,t,e){const i=a.reduce((s,o)=>s+o,0);return(t.reduce((s,o)=>s+o,0)-i)/i*100},logistic(a,t=1,e=1,i=0){return t/(1+Math.exp(-e*(a-i)))},movingAverage(a,t){const e=[];for(let i=0;i<a.length;i++){const n=Math.max(0,i-t+1),s=a.slice(n,i+1);e.push(s.reduce((o,r)=>o+r,0)/s.length)}return e},linearRegression(a,t){const e=a.length,i=a.reduce((c,d)=>c+d,0),n=t.reduce((c,d)=>c+d,0),s=a.reduce((c,d,h)=>c+d*t[h],0),o=a.reduce((c,d)=>c+d*d,0),r=(e*s-i*n)/(e*o-i*i),l=(n-r*i)/e;return{slope:r,intercept:l}},forecast(a,t){const e=a.map((r,l)=>l),i=a,{slope:n,intercept:s}=this.linearRegression(e,i),o=[];for(let r=0;r<t;r++)o.push(n*(a.length+r)+s);return o},standardDeviation(a){const t=a.reduce((i,n)=>i+n,0)/a.length,e=a.map(i=>Math.pow(i-t,2));return Math.sqrt(e.reduce((i,n)=>i+n,0)/a.length)},correlation(a,t){const e=a.length,i=a.reduce((l,c)=>l+c,0)/e,n=t.reduce((l,c)=>l+c,0)/e;let s=0,o=0,r=0;for(let l=0;l<e;l++){const c=a[l]-i,d=t[l]-n;s+=c*d,o+=c*c,r+=d*d}return s/Math.sqrt(o*r)},formatNumber(a,t=1){return a>=1e12?(a/1e12).toFixed(t)+"T":a>=1e9?(a/1e9).toFixed(t)+"B":a>=1e6?(a/1e6).toFixed(t)+"M":a>=1e3?(a/1e3).toFixed(t)+"K":a.toFixed(t)},formatCurrency(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)},formatPercent(a,t=1){return a.toFixed(t)+"%"}};typeof window<"u"&&(window.EconomicCalculations=Gh);function J(a,t="",e={}){const i=document.createElement(a);return t&&(i.textContent=t),Object.entries(e).forEach(([n,s])=>{n==="className"?i.className=s:n==="style"&&typeof s=="object"?Object.assign(i.style,s):n.startsWith("on")&&typeof s=="function"?i.addEventListener(n.slice(2).toLowerCase(),s):n==="dataset"&&typeof s=="object"?Object.entries(s).forEach(([o,r])=>{i.dataset[o]=r}):i.setAttribute(n,s)}),i}function Vs(a,t){const e=typeof a=="string"?document.querySelector(a):a;e&&(e.textContent=t)}function Ys(a){const t=typeof a=="string"?document.querySelector(a):a;if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function Fe(a,...t){t.forEach(e=>{e&&a.appendChild(e)})}function Gs(...a){const t=document.createDocumentFragment();return a.forEach(e=>{e&&t.appendChild(e)}),t}function Js(a,t={}){const e=J("tr","",t);return a.forEach(i=>{const n=document.createElement("td");typeof i=="string"?n.textContent=i:i&&typeof i=="object"&&(n.textContent=i.text||"",i.attrs&&Object.entries(i.attrs).forEach(([s,o])=>{s==="className"?n.className=o:n.setAttribute(s,o)}),i.element&&n.appendChild(i.element)),e.appendChild(n)}),e}function qs({title:a,content:t,className:e="",style:i={}}){const n=J("div","",{className:`card ${e}`.trim(),style:i});if(a){const s=J("h3",a);n.appendChild(s)}if(typeof t=="string"){const s=J("p",t);n.appendChild(s)}else t instanceof HTMLElement&&n.appendChild(t);return n}function Ks(a="Loading..."){const t=J("div","",{className:"loading"}),e=J("div","",{className:"spinner"}),i=J("span",a);return Fe(t,e,i),t}function Xs(a){const t=J("div","",{className:"card",style:{textAlign:"center",padding:"60px"}}),e=J("h3","Error",{style:{color:"var(--danger)"}}),i=J("p",a);return Fe(t,e,i),t}function Qs({label:a,value:t,unit:e="",color:i=""}){const n=J("div","",{className:"indicator-item"}),s=J("div"),o=J("div",a,{className:"indicator-name"});s.appendChild(o);const r=J("div",`${t}${e}`,{className:"indicator-value",style:i?{color:i}:{}});return Fe(n,s,r),n}function Zs({text:a,onClick:t,className:e="btn",disabled:i=!1,style:n={}}){const s=J("button",a,{className:e,style:n,disabled:i?"disabled":null});return t&&s.addEventListener("click",t),s}function to(a,t="var(--primary)"){const e=J("div","",{className:"progress-bar",style:{width:"100px",display:"inline-block",verticalAlign:"middle"}}),i=J("div","",{className:"fill",style:{width:`${a}%`,background:t}});return e.appendChild(i),e}function eo(a,t="medium"){return J("span",a,{className:`tag tag-${t}`})}function io(a){const t=document.createElement("div");return t.textContent=a,t.innerHTML}function no(a){const t=document.createDocumentFragment();return a.split(/(\*\*[^*]+\*\*)/g).forEach(i=>{if(i.startsWith("**")&&i.endsWith("**")){const n=J("strong",i.slice(2,-2));t.appendChild(n)}else t.appendChild(document.createTextNode(i))}),t}typeof window<"u"&&(window.DOMUtils={createElement:J,setText:Vs,clearChildren:Ys,appendChildren:Fe,createFragment:Gs,createTableRow:Js,createCard:qs,createLoadingSpinner:Ks,createErrorMessage:Xs,createStatDisplay:Qs,createButton:Zs,createProgressBar:to,createTag:eo,escapeHtml:io,parseSimpleMarkdown:no});const Jh=Object.freeze(Object.defineProperty({__proto__:null,appendChildren:Fe,clearChildren:Ys,createButton:Zs,createCard:qs,createElement:J,createErrorMessage:Xs,createFragment:Gs,createLoadingSpinner:Ks,createProgressBar:to,createStatDisplay:Qs,createTableRow:Js,createTag:eo,escapeHtml:io,parseSimpleMarkdown:no,setText:Vs},Symbol.toStringTag,{value:"Module"}));class qh{constructor(){this.charts={},this.colors={primary:"#3b82f6",secondary:"#10b981",danger:"#ef4444",warning:"#f59e0b",info:"#6366f1",gray:"#6b7280",sectors:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316","#06b6d4","#84cc16","#a855f7"]}}initDefaults(){typeof Chart<"u"&&(Chart.defaults.font.family="'Inter', 'Segoe UI', sans-serif",Chart.defaults.color="#374151",Chart.defaults.borderColor="#e5e7eb",Chart.defaults.plugins.legend.labels.usePointStyle=!0)}createUnemploymentChart(t,e){const i=document.getElementById(t);return i?(this.charts[t]&&this.charts[t].destroy(),this.charts[t]=new Chart(i,{type:"line",data:{labels:e.map(n=>n.year.toFixed(1)),datasets:[{label:"Unemployment Rate (%)",data:e.map(n=>n.labor_market.unemployment_rate),borderColor:this.colors.danger,backgroundColor:this.colors.danger+"20",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Projected Unemployment Rate"}},scales:{y:{beginAtZero:!0,max:Math.max(45,Math.ceil(Math.max(...e.map(n=>n.labor_market.unemployment_rate))/5)*5+5),title:{display:!0,text:"Rate (%)"}},x:{title:{display:!0,text:"Year"}}}}}),this.charts[t]):null}createSectorEmploymentChart(t,e){const i=document.getElementById(t);if(!i)return null;this.charts[t]&&this.charts[t].destroy();const n=Object.keys(e).map(r=>r.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase())),s=Object.values(e).map(r=>r.employment/1e6),o=Object.values(e).map(r=>r.automation_exposure*100);return this.charts[t]=new Chart(i,{type:"bar",data:{labels:n,datasets:[{label:"Employment (Millions)",data:s,backgroundColor:this.colors.sectors,yAxisID:"y"},{label:"Automation Exposure (%)",data:o,type:"line",borderColor:this.colors.danger,backgroundColor:"transparent",yAxisID:"y1"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Employment & Automation Exposure by Sector"}},scales:{y:{type:"linear",position:"left",title:{display:!0,text:"Employment (M)"}},y1:{type:"linear",position:"right",max:100,grid:{drawOnChartArea:!1},title:{display:!0,text:"Exposure (%)"}},x:{ticks:{maxRotation:45,minRotation:45}}}}}),this.charts[t]}createAdoptionChart(t,e){const i=document.getElementById(t);return i?(this.charts[t]&&this.charts[t].destroy(),this.charts[t]=new Chart(i,{type:"line",data:{labels:e.map(n=>n.year.toFixed(1)),datasets:[{label:"AI Adoption Rate (%)",data:e.map(n=>n.ai_adoption.rate),borderColor:this.colors.info,backgroundColor:this.colors.info+"20",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"AI Adoption Rate Over Time"}},scales:{y:{beginAtZero:!0,max:100,title:{display:!0,text:"Adoption (%)"}}}}}),this.charts[t]):null}createJobImpactChart(t,e){const i=document.getElementById(t);return i?(this.charts[t]&&this.charts[t].destroy(),this.charts[t]=new Chart(i,{type:"line",data:{labels:e.map(n=>n.year.toFixed(1)),datasets:[{label:"Jobs Displaced (Cumulative)",data:e.map(n=>n.derived.cumulative_displacement/1e6),borderColor:this.colors.danger,backgroundColor:"transparent",tension:.4},{label:"New Jobs Created (Cumulative)",data:e.map(n=>n.derived.cumulative_new_jobs/1e6),borderColor:this.colors.secondary,backgroundColor:"transparent",tension:.4},{label:"Net Impact",data:e.map(n=>n.derived.net_ai_job_impact/1e6),borderColor:this.colors.info,backgroundColor:this.colors.info+"20",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"AI Job Impact Over Time"}},scales:{y:{title:{display:!0,text:"Jobs (Millions)"}}}}}),this.charts[t]):null}createWageChart(t,e){const i=document.getElementById(t);return i?(this.charts[t]&&this.charts[t].destroy(),this.charts[t]=new Chart(i,{type:"line",data:{labels:e.map(n=>n.year.toFixed(1)),datasets:[{label:"Average Hourly Wage ($)",data:e.map(n=>n.wages.average_hourly),borderColor:this.colors.primary,backgroundColor:"transparent",tension:.4,yAxisID:"y"},{label:"Real Wage Growth (%)",data:e.map(n=>n.wages.real_wage_growth),borderColor:this.colors.secondary,backgroundColor:"transparent",tension:.4,yAxisID:"y1"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Wage Trends"}},scales:{y:{position:"left",title:{display:!0,text:"Wage ($)"}},y1:{position:"right",grid:{drawOnChartArea:!1},title:{display:!0,text:"Growth (%)"}}}}}),this.charts[t]):null}createProductivityChart(t,e){const i=document.getElementById(t);return i?(this.charts[t]&&this.charts[t].destroy(),this.charts[t]=new Chart(i,{type:"line",data:{labels:e.map(n=>n.year.toFixed(1)),datasets:[{label:"Output per Hour (Index)",data:e.map(n=>n.productivity.output_per_hour),borderColor:this.colors.info,backgroundColor:this.colors.info+"20",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Labor Productivity"}},scales:{y:{title:{display:!0,text:"Index (2017=100)"}}}}}),this.charts[t]):null}createSectorImpactChart(t,e,i){const n=document.getElementById(t);if(!n)return null;this.charts[t]&&this.charts[t].destroy();const s=Object.keys(e).map(l=>l.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase())),o=Object.keys(e).map(l=>(i[l].employment-e[l].employment)/1e6),r=o.map(l=>l>=0?this.colors.secondary:this.colors.danger);return this.charts[t]=new Chart(n,{type:"bar",data:{labels:s,datasets:[{label:"Employment Change (Millions)",data:o,backgroundColor:r}]},options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{title:{display:!0,text:"Employment Change by Sector"}},scales:{x:{title:{display:!0,text:"Change (Millions)"}}}}}),this.charts[t]}createInterventionChart(t,e){const i=document.getElementById(t);if(!i)return null;this.charts[t]&&this.charts[t].destroy();const n=e.map(r=>r.name),s=e.map(r=>r.fiscal_cost/1e9),o=e.map(r=>r.job_effect);return this.charts[t]=new Chart(i,{type:"bar",data:{labels:n,datasets:[{label:"Annual Cost ($B)",data:s,backgroundColor:this.colors.warning,yAxisID:"y"},{label:"Monthly Job Effect",data:o,backgroundColor:this.colors.secondary,yAxisID:"y1"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Intervention Costs & Effects"}},scales:{y:{position:"left",title:{display:!0,text:"Cost ($B)"}},y1:{position:"right",grid:{drawOnChartArea:!1},title:{display:!0,text:"Jobs"}}}}}),this.charts[t]}createHistoricalChart(t,e,i){const n=document.getElementById(t);if(!n)return null;this.charts[t]&&this.charts[t].destroy();const s=e.map(c=>c.year),o=i.map(c=>Math.floor(c.year)),r=[...new Set(o)],l={};return i.forEach(c=>{const d=Math.floor(c.year);l[d]||(l[d]=c.labor_market.unemployment_rate)}),this.charts[t]=new Chart(n,{type:"line",data:{labels:[...s,...r.filter(c=>!s.includes(c))],datasets:[{label:"Historical",data:e.map(c=>({x:c.year,y:c.value})),borderColor:this.colors.primary,backgroundColor:"transparent",tension:.4},{label:"Projected",data:r.map(c=>({x:c,y:l[c]})),borderColor:this.colors.info,backgroundColor:this.colors.info+"20",borderDash:[5,5],fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Historical vs Projected Unemployment"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Unemployment Rate (%)"}}}}}),this.charts[t]}createExposureGauge(t,e){const i=document.getElementById(t);if(!i)return null;this.charts[t]&&this.charts[t].destroy();const n=e>=70?this.colors.danger:e>=50?this.colors.warning:e>=30?this.colors.primary:this.colors.secondary;return this.charts[t]=new Chart(i,{type:"doughnut",data:{labels:["Exposed","Protected"],datasets:[{data:[e,100-e],backgroundColor:[n,"#e5e7eb"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,circumference:180,rotation:-90,cutout:"70%",plugins:{legend:{display:!1},tooltip:{enabled:!1}}}}),this.charts[t]}destroyAll(){for(const t of Object.values(this.charts))t.destroy();this.charts={}}updateChart(t,e){const i=this.charts[t];i&&(i.data=e,i.update())}createSummaryHTML(t){return`
            <div class="summary-grid">
                <div class="summary-card">
                    <h4>Unemployment Rate</h4>
                    <div class="stat-change ${parseFloat(t.labor_market_changes.unemployment_rate.change)>0?"negative":"positive"}">
                        ${t.labor_market_changes.unemployment_rate.initial}%  ${t.labor_market_changes.unemployment_rate.final}%
                        <span>(${t.labor_market_changes.unemployment_rate.change>0?"+":""}${t.labor_market_changes.unemployment_rate.change}%)</span>
                    </div>
                </div>
                <div class="summary-card">
                    <h4>Total Employment</h4>
                    <div class="stat-change ${t.labor_market_changes.total_employment.change<0?"negative":"positive"}">
                        ${(t.labor_market_changes.total_employment.change/1e6).toFixed(1)}M
                        <span>net change</span>
                    </div>
                </div>
                <div class="summary-card">
                    <h4>AI Adoption</h4>
                    <div class="stat-value">
                        ${t.ai_impact.ai_adoption.initial}%  ${t.ai_impact.ai_adoption.final}%
                    </div>
                </div>
                <div class="summary-card">
                    <h4>Net AI Job Impact</h4>
                    <div class="stat-change ${t.ai_impact.net_impact<0?"negative":"positive"}">
                        ${(t.ai_impact.net_impact/1e6).toFixed(1)}M
                        <span>jobs</span>
                    </div>
                </div>
            </div>
        `}}typeof window<"u"&&(window.VisualizationManager=qh);class ao{constructor(){this.proxyEndpoint="https://gemini-proxy.adamconner7.workers.dev",this.lastQuotaInfo=null,this.apiCallCount=parseInt(localStorage.getItem("gemini_api_call_count")||"0",10),this.apiCallHistory=JSON.parse(localStorage.getItem("gemini_api_call_history")||"[]"),this.counterEnabled=localStorage.getItem("gemini_counter_enabled")!=="false"}getApiCallCount(){return this.apiCallCount}getApiCallHistory(){return this.apiCallHistory}isCounterEnabled(){return this.counterEnabled}setCounterEnabled(t){this.counterEnabled=t,localStorage.setItem("gemini_counter_enabled",t.toString())}resetApiCallCount(){this.apiCallCount=0,this.apiCallHistory=[],localStorage.setItem("gemini_api_call_count","0"),localStorage.setItem("gemini_api_call_history","[]")}_trackApiCall(t="unknown"){if(!this.counterEnabled)return;this.apiCallCount++;const e={timestamp:new Date().toISOString(),type:t,mode:this.getMode(),count:this.apiCallCount};this.apiCallHistory.push(e),this.apiCallHistory.length>100&&(this.apiCallHistory=this.apiCallHistory.slice(-100)),localStorage.setItem("gemini_api_call_count",this.apiCallCount.toString()),localStorage.setItem("gemini_api_call_history",JSON.stringify(this.apiCallHistory)),window.dispatchEvent(new CustomEvent("geminiApiCallUpdated",{detail:{count:this.apiCallCount,lastCall:e}}))}getApiCallStats(){const t=new Date().toDateString(),e=this.apiCallHistory.filter(s=>new Date(s.timestamp).toDateString()===t).length,i=new Date;i.setDate(i.getDate()-7);const n=this.apiCallHistory.filter(s=>new Date(s.timestamp)>=i).length;return{total:this.apiCallCount,today:e,thisWeek:n,lastCall:this.apiCallHistory.length>0?this.apiCallHistory[this.apiCallHistory.length-1]:null}}isAvailable(){return this.proxyEndpoint&&this.proxyEndpoint.length>0}getMode(){return"proxy"}getQuotaInfo(){return this.lastQuotaInfo}buildPrompt(t){const e=t.summary,i=t.scenario;return`You are an expert labor economist analyzing AI's impact on employment. Based on the following simulation results, provide a clear, insightful summary in 3-4 paragraphs. Be specific with numbers and highlight key findings, risks, and recommendations.

SIMULATION PARAMETERS:
- Scenario: ${i.name}
- Timeframe: ${i.timeframe.start_year} to ${i.timeframe.end_year}
- Target Unemployment Rate: ${i.targets.unemployment_rate}%
- AI Adoption Rate Target: ${i.targets.ai_adoption_rate}%
- Automation Pace: ${i.targets.automation_pace}
- Adoption Curve: ${i.ai_parameters.adoption_curve}

LABOR MARKET RESULTS:
- Starting Unemployment: ${e.labor_market_changes.unemployment_rate.initial}%
- Final Unemployment: ${e.labor_market_changes.unemployment_rate.final}%
- Unemployment Change: ${e.labor_market_changes.unemployment_rate.change}%
- Starting Employment: ${(e.labor_market_changes.total_employment.initial/1e6).toFixed(1)} million
- Final Employment: ${(e.labor_market_changes.total_employment.final/1e6).toFixed(1)} million
- Net Employment Change: ${(e.labor_market_changes.total_employment.change/1e6).toFixed(2)} million

AI IMPACT:
- Final AI Adoption: ${e.ai_impact.ai_adoption.final}%
- Jobs Displaced by AI: ${(e.ai_impact.cumulative_displacement/1e6).toFixed(2)} million
- New Jobs Created by AI: ${(e.ai_impact.cumulative_new_jobs/1e6).toFixed(2)} million
- Net AI Job Impact: ${(e.ai_impact.net_impact/1e6).toFixed(2)} million

ECONOMIC INDICATORS:
- Final Productivity Growth: ${e.productivity.growth_rate.final}%
- Final Wage Change: ${e.wages.average_hourly.change_percent}%

POLICY INTERVENTIONS ACTIVE: ${i.interventions.length>0?i.interventions.map(n=>n.name).join(", "):"None"}

Please provide:
1. An executive summary of the key findings
2. Analysis of the most significant impacts and which sectors/workers are most affected
3. Economic implications (wages, productivity, inequality)
4. Recommendations or considerations for policymakers

Keep the tone professional but accessible. Use specific numbers from the data.`}async makeRequest(t){if(!this.isAvailable())throw new Error("AI analysis is not available.");return await fetch(this.proxyEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}async generateSummary(t){var i,n,s,o,r;if(!this.isAvailable())throw new Error("AI analysis is not available.");const e=this.buildPrompt(t);try{const l=await this.makeRequest({contents:[{parts:[{text:e}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:1024},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]});if(!l.ok){const d=await l.json();throw l.status===429?new Error("Daily AI analysis limit reached. Please try again tomorrow."):new Error(`API request failed: ${((i=d.error)==null?void 0:i.message)||l.statusText}`)}const c=await l.json();if(c._quota&&(this.lastQuotaInfo=c._quota),this._trackApiCall("summary"),c.candidates&&((r=(o=(s=(n=c.candidates[0])==null?void 0:n.content)==null?void 0:s.parts)==null?void 0:o[0])!=null&&r.text))return c.candidates[0].content.parts[0].text;throw new Error("Unexpected API response format")}catch(l){throw l.message.includes("Failed to fetch")?new Error("Network error. Please check your internet connection."):l}}async generateQuickInsights(t){var n,s,o,r,l;if(!this.isAvailable())return null;const e=t.summary,i=`Based on this labor market simulation data, provide exactly 4 brief, impactful bullet points (max 15 words each):

- Unemployment: ${e.labor_market_changes.unemployment_rate.initial}%  ${e.labor_market_changes.unemployment_rate.final}%
- Jobs Displaced: ${(e.ai_impact.cumulative_displacement/1e6).toFixed(1)}M
- Jobs Created: ${(e.ai_impact.cumulative_new_jobs/1e6).toFixed(1)}M
- Net Impact: ${(e.ai_impact.net_impact/1e6).toFixed(1)}M

Format as 4 bullet points starting with an emoji. Focus on the most important insights.`;try{const c=await this.makeRequest({contents:[{parts:[{text:i}]}],generationConfig:{temperature:.5,maxOutputTokens:256}});if(!c.ok)return null;const d=await c.json();return this._trackApiCall("quick_insights"),d._quota&&(this.lastQuotaInfo=d._quota),((l=(r=(o=(s=(n=d.candidates)==null?void 0:n[0])==null?void 0:s.content)==null?void 0:o.parts)==null?void 0:r[0])==null?void 0:l.text)||null}catch{return null}}}const Kh=new ao;typeof window<"u"&&(window.AISummaryService=ao,window.aiSummaryService=Kh);class so{constructor(){this.proxyEndpoint="https://gemini-proxy.adamconner7.workers.dev",this.storageKey="ai_enhanced_simulations",this.passwordKey="advanced_sim_password_hash"}isAvailable(){return this.proxyEndpoint&&this.proxyEndpoint.length>0}async makeRequest(t,e={}){var o,r,l,c,d,h;const i={contents:[{parts:[{text:t}]}],generationConfig:{temperature:e.temperature||.7,topK:40,topP:.95,maxOutputTokens:e.maxTokens||2048}},n=await fetch(this.proxyEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok){const u=await n.json();throw new Error(((o=u.error)==null?void 0:o.message)||"AI request failed")}return((h=(d=(c=(l=(r=(await n.json()).candidates)==null?void 0:r[0])==null?void 0:l.content)==null?void 0:c.parts)==null?void 0:d[0])==null?void 0:h.text)||""}async enhanceInputs(t){var n;const e=`You are an expert labor economist and AI researcher. Given these simple simulation inputs, generate a comprehensive, nuanced set of parameters for a labor market simulation.

SIMPLE INPUTS:
- Target Unemployment Rate: ${t.targetUnemployment}%
- AI Adoption Rate: ${t.aiAdoption}%
- Automation Pace: ${t.automationPace}
- Timeframe: ${t.years} years (${t.startYear} to ${t.endYear})
- Adoption Curve: ${t.adoptionCurve}
- Active Interventions: ${((n=t.interventions)==null?void 0:n.length)>0?t.interventions.map(s=>s.name).join(", "):"None"}

Based on current economic research and AI development trends, generate enhanced parameters. Consider:
1. How different sectors will be affected differently
2. Labor market dynamics (retraining effectiveness, geographic mobility)
3. Wage effects across skill levels
4. Second-order economic effects
5. Historical patterns from past technological transitions
6. Current AI capabilities and likely progression

IMPORTANT: Respond with ONLY valid JSON. All values must be actual numbers, not ranges. Choose specific values appropriate for this scenario.

VALUE GUIDELINES (pick a specific number within these ranges):
- adoption_multiplier: between 1.0 and 2.0
- displacement_rate: between 0.0 and 0.5
- new_role_creation: between 0.0 and 1.0
- wage_premium: between -0.1 and 0.3
- retraining_effectiveness: between 0.1 and 0.6
- retraining_duration_months: between 3 and 24
- geographic_mobility: between 0.05 and 0.3
- gig_economy_absorption: between 0.1 and 0.4
- early_retirement_rate: between 0.05 and 0.2
- labor_force_participation_change: between -0.05 and 0.05
- skills_mismatch_factor: between 0.1 and 0.5
- skill_premium_growth: between 0.0 and 5.0
- median_wage_pressure: between -3.0 and 2.0
- top_decile_growth: between 0.0 and 8.0
- bottom_decile_pressure: between -5.0 and 0.0
- wage_polarization_index: between 0.0 and 1.0
- productivity_multiplier: between 1.0 and 2.0
- gdp_impact_modifier: between -0.02 and 0.05
- consumer_spending_impact: between -0.03 and 0.02
- business_investment_boost: between 0.0 and 0.1
- inflation_pressure: between -0.01 and 0.03
- displacement_lag_months: between 3 and 18
- new_job_creation_lag_months: between 6 and 36
- peak_disruption_year: between 1 and ${t.years}
- recovery_speed: between 0.5 and 2.0
- structural_unemployment_risk: between 0.0 and 0.3

Return this exact JSON structure with your chosen values:
{
    "sector_dynamics": {
        "technology": { "adoption_multiplier": 1.5, "displacement_rate": 0.2, "new_role_creation": 0.6, "wage_premium": 0.15 },
        "finance": { "adoption_multiplier": 1.4, "displacement_rate": 0.25, "new_role_creation": 0.4, "wage_premium": 0.1 },
        "healthcare": { "adoption_multiplier": 1.2, "displacement_rate": 0.1, "new_role_creation": 0.5, "wage_premium": 0.12 },
        "manufacturing": { "adoption_multiplier": 1.6, "displacement_rate": 0.35, "new_role_creation": 0.2, "wage_premium": -0.05 },
        "retail": { "adoption_multiplier": 1.4, "displacement_rate": 0.3, "new_role_creation": 0.15, "wage_premium": -0.08 },
        "education": { "adoption_multiplier": 1.1, "displacement_rate": 0.05, "new_role_creation": 0.4, "wage_premium": 0.05 },
        "professional_services": { "adoption_multiplier": 1.5, "displacement_rate": 0.2, "new_role_creation": 0.5, "wage_premium": 0.1 },
        "transportation": { "adoption_multiplier": 1.7, "displacement_rate": 0.4, "new_role_creation": 0.1, "wage_premium": -0.1 }
    },
    "labor_market_dynamics": {
        "retraining_effectiveness": 0.35,
        "retraining_duration_months": 12,
        "geographic_mobility": 0.15,
        "gig_economy_absorption": 0.25,
        "early_retirement_rate": 0.1,
        "labor_force_participation_change": -0.02,
        "skills_mismatch_factor": 0.3
    },
    "wage_dynamics": {
        "skill_premium_growth": 2.5,
        "median_wage_pressure": -0.5,
        "top_decile_growth": 4.0,
        "bottom_decile_pressure": -2.0,
        "wage_polarization_index": 0.5
    },
    "economic_effects": {
        "productivity_multiplier": 1.4,
        "gdp_impact_modifier": 0.02,
        "consumer_spending_impact": -0.01,
        "business_investment_boost": 0.05,
        "inflation_pressure": 0.01
    },
    "transition_dynamics": {
        "displacement_lag_months": 9,
        "new_job_creation_lag_months": 18,
        "peak_disruption_year": 3,
        "recovery_speed": 1.2,
        "structural_unemployment_risk": 0.15
    },
    "confidence_intervals": {
        "unemployment_low": 5.5,
        "unemployment_high": 9.5,
        "displacement_low": 8.0,
        "displacement_high": 15.0
    },
    "key_assumptions": [
        "Your first key assumption about this scenario",
        "Your second key assumption",
        "Your third key assumption"
    ],
    "risk_factors": [
        "First major risk factor",
        "Second major risk factor",
        "Third major risk factor"
    ]
}

Adjust all values based on the specific inputs provided. Be realistic and consistent with economic research.`,i=await this.makeRequest(e,{temperature:.6,maxTokens:2500});return this.extractJSON(i,"enhanceInputs")}extractJSON(t,e=""){try{let i=t.trim();i.startsWith("```json")?i=i.slice(7):i.startsWith("```")&&(i=i.slice(3)),i.endsWith("```")&&(i=i.slice(0,-3));const n=i.indexOf("{"),s=i.lastIndexOf("}");return n!==-1&&s!==-1&&s>n&&(i=i.slice(n,s+1)),i=i.trim(),JSON.parse(i)}catch(i){throw console.error(`Failed to parse AI response (${e}):`,t),console.error("Parse error:",i.message),new Error("AI returned invalid JSON. Please try again.")}}async analyzeResults(t,e,i){const n=i.summary,s=`You are an expert labor economist analyzing an AI-enhanced labor market simulation. Provide a comprehensive, nuanced analysis.

SCENARIO INPUTS:
- Target Unemployment: ${t.targetUnemployment}%
- AI Adoption: ${t.aiAdoption}%
- Automation Pace: ${t.automationPace}
- Timeframe: ${t.years} years

AI-ENHANCED PARAMETERS USED:
${JSON.stringify(e,null,2)}

SIMULATION RESULTS:
- Starting Unemployment: ${n.labor_market_changes.unemployment_rate.initial}%
- Final Unemployment: ${n.labor_market_changes.unemployment_rate.final}%
- Jobs Displaced: ${(n.ai_impact.cumulative_displacement/1e6).toFixed(2)} million
- Jobs Created: ${(n.ai_impact.cumulative_new_jobs/1e6).toFixed(2)} million
- Net Impact: ${(n.ai_impact.net_impact/1e6).toFixed(2)} million
- Wage Change: ${n.wages.average_hourly.change_percent}%

Respond with ONLY a valid JSON object (no markdown) in this format:
{
    "executive_summary": "2-3 sentence overview",
    "key_findings": [
        { "finding": "string", "confidence": "high/medium/low", "impact": "high/medium/low" },
        { "finding": "string", "confidence": "high/medium/low", "impact": "high/medium/low" },
        { "finding": "string", "confidence": "high/medium/low", "impact": "high/medium/low" }
    ],
    "sector_analysis": {
        "most_disrupted": ["sector1", "sector2"],
        "most_opportunity": ["sector1", "sector2"],
        "transition_sectors": ["sector1", "sector2"]
    },
    "workforce_impacts": {
        "high_risk_workers": "description of who is most at risk",
        "emerging_opportunities": "description of new opportunities",
        "skills_in_demand": ["skill1", "skill2", "skill3"],
        "skills_declining": ["skill1", "skill2", "skill3"]
    },
    "economic_implications": {
        "wage_inequality": "assessment",
        "productivity_gains": "assessment",
        "consumer_impact": "assessment",
        "regional_disparities": "assessment"
    },
    "policy_recommendations": [
        { "policy": "string", "priority": "immediate/short-term/long-term", "effectiveness": "high/medium/low" },
        { "policy": "string", "priority": "immediate/short-term/long-term", "effectiveness": "high/medium/low" },
        { "policy": "string", "priority": "immediate/short-term/long-term", "effectiveness": "high/medium/low" }
    ],
    "scenario_variations": {
        "optimistic_case": "brief description",
        "pessimistic_case": "brief description",
        "most_likely": "brief description"
    },
    "model_confidence": {
        "overall": "high/medium/low",
        "factors": ["factor affecting confidence 1", "factor 2"]
    },
    "narrative_analysis": "3-4 paragraph detailed narrative analysis of the scenario and its implications"
}`,o=await this.makeRequest(s,{temperature:.5,maxTokens:3e3});return this.extractJSON(o,"analyzeResults")}storeSimulation(t){const e=this.getStoredSimulations(),i={id:Date.now(),timestamp:new Date().toISOString(),inputs:t.inputs,enhancedParams:t.enhancedParams,results:t.results,analysis:t.analysis};return e.push(i),e.length>100&&e.shift(),localStorage.setItem(this.storageKey,JSON.stringify(e)),i.id}getStoredSimulations(){try{return JSON.parse(localStorage.getItem(this.storageKey)||"[]")}catch{return[]}}getSimulation(t){return this.getStoredSimulations().find(i=>i.id===t)}exportForTraining(){const t=this.getStoredSimulations();return{version:"1.0",exportDate:new Date().toISOString(),count:t.length,simulations:t}}setPassword(t){const e=this.simpleHash(t);localStorage.setItem(this.passwordKey,e)}checkPassword(t){const e=localStorage.getItem(this.passwordKey);return e?this.simpleHash(t)===e:!0}hasPassword(){return!!localStorage.getItem(this.passwordKey)}clearPassword(){localStorage.removeItem(this.passwordKey)}simpleHash(t){let e=0;for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return e.toString(36)}}const Xh=new so;typeof window<"u"&&(window.AIScenarioEnhancer=so,window.aiScenarioEnhancer=Xh);class oo{constructor(){this.modelVersion="1.0",this.trainedModelKey="trained_model_params",this.trainingHistoryKey="training_history",this.proxyEndpoint="https://gemini-proxy.adamconner7.workers.dev"}async makeRequest(t,e={}){var o,r,l,c,d;const i={contents:[{parts:[{text:t}]}],generationConfig:{temperature:e.temperature||.3,maxOutputTokens:e.maxTokens||4096}},n=await fetch(this.proxyEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok)throw new Error("Training AI request failed");return((d=(c=(l=(r=(o=(await n.json()).candidates)==null?void 0:o[0])==null?void 0:r.content)==null?void 0:l.parts)==null?void 0:c[0])==null?void 0:d.text)||""}async analyzeStoredSimulations(){const t=aiScenarioEnhancer.getStoredSimulations();if(t.length<3)return{success:!1,message:"Need at least 3 stored AI simulations to analyze patterns",count:t.length};const e=t.map(i=>({inputs:{unemployment:i.inputs.targetUnemployment,aiAdoption:i.inputs.aiAdoption,pace:i.inputs.automationPace,years:i.inputs.years},enhancedParams:i.enhancedParams,outcomes:{finalUnemployment:parseFloat(i.results.summary.labor_market_changes.unemployment_rate.final),displacement:i.results.summary.ai_impact.cumulative_displacement,newJobs:i.results.summary.ai_impact.cumulative_new_jobs,wageChange:parseFloat(i.results.summary.wages.average_hourly.change_percent)}}));return{success:!0,count:t.length,patterns:e}}async trainModel(t={}){const e=await this.analyzeStoredSimulations();if(!e.success)return e;const i=`You are an expert economist and machine learning engineer. Analyze these AI-enhanced labor market simulations and derive optimized parameters for a base economic model.

TRAINING DATA (${e.count} simulations):
${JSON.stringify(e.patterns.slice(0,20),null,2)}

Your task:
1. Identify patterns between inputs and AI-enhanced parameters
2. Find relationships between enhanced parameters and outcomes
3. Generate optimized base model coefficients

Generate improved model parameters that will make the BASE simulation (without AI enhancement) produce more realistic results.

Respond with ONLY a valid JSON object (no markdown):
{
    "model_version": "2.0",
    "training_date": "${new Date().toISOString()}",
    "training_samples": ${e.count},

    "displacement_coefficients": {
        "base_rate": 0.05-0.2,
        "ai_adoption_factor": 0.5-2.0,
        "pace_multipliers": {
            "slow": 0.3-0.7,
            "moderate": 0.8-1.2,
            "fast": 1.3-1.8,
            "accelerating": 1.8-2.5
        },
        "sector_exposure_weights": {
            "technology": 0.1-0.3,
            "finance": 0.3-0.5,
            "healthcare": 0.1-0.3,
            "manufacturing": 0.5-0.8,
            "retail": 0.4-0.7,
            "education": 0.1-0.3,
            "professional_services": 0.3-0.5,
            "transportation": 0.5-0.8
        }
    },

    "job_creation_coefficients": {
        "base_multiplier": 0.2-0.5,
        "ai_complementarity_factor": 0.3-0.8,
        "lag_months": 6-24,
        "sector_creation_rates": {
            "technology": 0.3-0.6,
            "finance": 0.2-0.4,
            "healthcare": 0.3-0.5,
            "manufacturing": 0.1-0.3,
            "retail": 0.1-0.3,
            "education": 0.2-0.4,
            "professional_services": 0.3-0.5,
            "transportation": 0.1-0.2
        }
    },

    "wage_coefficients": {
        "productivity_wage_pass_through": 0.2-0.6,
        "displacement_wage_pressure": -0.02--0.005,
        "skill_premium_growth_rate": 0.01-0.05,
        "polarization_factor": 0.1-0.4
    },

    "transition_coefficients": {
        "retraining_effectiveness": 0.2-0.5,
        "mobility_factor": 0.1-0.3,
        "structural_unemployment_rate": 0.02-0.08,
        "recovery_half_life_months": 12-36
    },

    "feedback_loops": {
        "unemployment_to_spending": -0.3--0.1,
        "productivity_to_investment": 0.1-0.4,
        "wage_to_consumption": 0.4-0.7,
        "ai_adoption_acceleration": 0.05-0.2
    },

    "calibration_notes": [
        "observation about the training data",
        "key insight derived",
        "recommendation for model use"
    ],

    "confidence_score": 0.0-1.0,
    "recommended_for_production": true/false
}

Base your parameters on patterns observed in the training data. Use realistic economic values.`;try{let s=(await this.makeRequest(i,{temperature:.2,maxTokens:4e3})).trim();s.startsWith("```json")?s=s.slice(7):s.startsWith("```")&&(s=s.slice(3)),s.endsWith("```")&&(s=s.slice(0,-3));const o=JSON.parse(s.trim());return this.saveTrainedModel(o),this.logTraining({timestamp:new Date().toISOString(),samples:e.count,version:o.model_version,confidence:o.confidence_score}),{success:!0,model:o,message:`Model trained on ${e.count} simulations`}}catch(n){return console.error("Training failed:",n),{success:!1,message:"Failed to train model: "+n.message}}}saveTrainedModel(t){localStorage.setItem(this.trainedModelKey,JSON.stringify(t))}getTrainedModel(){try{return JSON.parse(localStorage.getItem(this.trainedModelKey))}catch{return null}}hasTrainedModel(){return!!localStorage.getItem(this.trainedModelKey)}clearTrainedModel(){localStorage.removeItem(this.trainedModelKey)}logTraining(t){const e=this.getTrainingHistory();e.push(t),e.length>50&&e.shift(),localStorage.setItem(this.trainingHistoryKey,JSON.stringify(e))}getTrainingHistory(){try{return JSON.parse(localStorage.getItem(this.trainingHistoryKey)||"[]")}catch{return[]}}applyToEngine(t){const e=this.getTrainedModel();return e?(t._originalCoefficients=t._originalCoefficients||{automationPaceMultipliers:{...t.getAutomationPaceMultiplier}},t.trainedModel=e,!0):!1}getStatus(){const t=this.getTrainedModel(),e=this.getTrainingHistory(),i=aiScenarioEnhancer.getStoredSimulations().length;return{hasTrainedModel:!!t,modelVersion:(t==null?void 0:t.model_version)||"None",confidence:(t==null?void 0:t.confidence_score)||0,trainingCount:e.length,lastTraining:e.length>0?e[e.length-1].timestamp:null,storedSimulations:i,readyForTraining:i>=3}}exportAll(){return{exportDate:new Date().toISOString(),trainedModel:this.getTrainedModel(),trainingHistory:this.getTrainingHistory(),simulations:aiScenarioEnhancer.exportForTraining()}}}const Qh=new oo;typeof window<"u"&&(window.ModelTrainer=oo,window.modelTrainer=Qh);class ro{constructor(){this.thresholds={unemployment:{crisis:10,high:7,moderate:5,low:3.5},displacement:{severe:5,significant:2,moderate:.5},jobCreation:{strong:3,moderate:1,weak:.3},wageGrowth:{strong:3,moderate:1.5,stagnant:0,declining:-1},adoption:{rapid:70,moderate:40,slow:20}},this.riskWeights={unemployment:.3,displacement:.25,wageChange:.2,netJobImpact:.15,inequality:.1}}interpret(t){if(!t||!t.summary)return{error:"Invalid results format"};const e=t.summary,i=t.scenario;return{overview:this.generateOverview(e,i),keyFindings:this.extractKeyFindings(e,i),riskAssessment:this.assessRisks(e),trendAnalysis:this.analyzeTrends(t),sectorAnalysis:this.analyzeSectors(e),policyRecommendations:this.generateRecommendations(e,i),comparativeBenchmarks:this.generateBenchmarks(e),narrativeSummary:this.generateNarrativeSummary(e,i),dataPoints:this.extractDataPoints(e)}}generateOverview(t,e){const i=t.labor_market_changes.unemployment_rate.change,n=t.ai_impact.net_impact;t.labor_market_changes.unemployment_rate.final;let s="neutral",o="moderate";return i<=-1&&n>0?(s="positive",o="low"):i>=2||n<-2e6?(s="negative",o="high"):(i>=4||n<-5e6)&&(s="critical",o="critical"),{outlook:s,severity:o,timeframe:`${e.timeframe.start_year}-${e.timeframe.end_year}`,scenarioType:e.name,headline:this.generateHeadline(t,e),subheadline:this.generateSubheadline(t)}}generateHeadline(t,e){const i=t.ai_impact.net_impact,n=t.labor_market_changes.unemployment_rate.change;return i>1e6?`AI Integration Creates ${(i/1e6).toFixed(1)}M Net Jobs`:i<-3e6?`Significant Labor Disruption: ${Math.abs(i/1e6).toFixed(1)}M Net Jobs Lost`:n>=3?`Unemployment Rises ${n.toFixed(1)} Points Amid AI Transition`:n<=-1?"Labor Market Improves Despite AI Automation":"Mixed Results as AI Reshapes Labor Market"}generateSubheadline(t){const e=t.ai_impact.cumulative_displacement,i=t.ai_impact.cumulative_new_jobs,n=t.ai_impact.ai_adoption.final;return`${(e/1e6).toFixed(1)}M jobs displaced, ${(i/1e6).toFixed(1)}M created at ${n.toFixed(0)}% AI adoption`}extractKeyFindings(t,e){const i=[],n=t.labor_market_changes.unemployment_rate.change,s=t.labor_market_changes.unemployment_rate.final;i.push({category:"unemployment",severity:this.getURSeverity(s),finding:`Unemployment ${n>=0?"rises":"falls"} to ${s.toFixed(1)}% (${n>=0?"+":""}${n.toFixed(1)} points)`,impact:n>=2?"high":n>=.5?"medium":"low",icon:n>=0?"":""});const o=t.ai_impact.cumulative_displacement;i.push({category:"displacement",severity:this.getDisplacementSeverity(o),finding:`${(o/1e6).toFixed(2)}M workers displaced by automation`,impact:o>5e6?"high":o>2e6?"medium":"low",icon:""});const r=t.ai_impact.cumulative_new_jobs;i.push({category:"job_creation",severity:this.getCreationSeverity(r),finding:`${(r/1e6).toFixed(2)}M new jobs created by AI economy`,impact:r>3e6?"positive":r>1e6?"neutral":"negative",icon:""});const l=t.ai_impact.net_impact;i.push({category:"net_impact",severity:l>0?"positive":l<-2e6?"critical":"warning",finding:`Net job impact: ${l>=0?"+":""}${(l/1e6).toFixed(2)}M`,impact:l>0?"positive":l<-2e6?"high":"medium",icon:l>=0?"":""});const c=t.wages.average_hourly.change_percent;i.push({category:"wages",severity:c>2?"positive":c<0?"warning":"neutral",finding:`Average wages ${c>=0?"increase":"decrease"} by ${Math.abs(c).toFixed(1)}%`,impact:c>2?"positive":c<-1?"negative":"neutral",icon:c>=0?"":""});const d=t.productivity.growth_rate.final;return i.push({category:"productivity",severity:"positive",finding:`Productivity growth reaches ${d.toFixed(1)}%`,impact:d>3?"high":"medium",icon:""}),i}assessRisks(t){const e=[],i=t.labor_market_changes.unemployment_rate.final;i>this.thresholds.unemployment.high&&e.push({type:"structural_unemployment",level:i>this.thresholds.unemployment.crisis?"critical":"high",description:`Unemployment at ${i.toFixed(1)}% indicates structural labor market issues`,mitigation:"Consider expanded retraining programs and job creation initiatives"});const n=t.ai_impact.cumulative_displacement,s=t.ai_impact.cumulative_new_jobs;n>s*1.5&&e.push({type:"skills_gap",level:"high",description:"Job displacement significantly outpaces creation, suggesting skills mismatch",mitigation:"Invest in education and skills training aligned with AI economy needs"});const o=t.wages.average_hourly.change_percent;if(o<0&&e.push({type:"wage_decline",level:o<-2?"high":"medium",description:`Wage decline of ${Math.abs(o).toFixed(1)}% threatens living standards`,mitigation:"Consider minimum wage adjustments or wage subsidies"}),t.inequality){const l=t.inequality.gini.final-t.inequality.gini.initial;l>.02&&e.push({type:"inequality",level:l>.05?"high":"medium",description:"Income inequality is increasing during AI transition",mitigation:"Progressive tax policies and targeted support for affected workers"})}n>5e6&&e.push({type:"rapid_displacement",level:"high",description:`${(n/1e6).toFixed(1)}M workers displaced may overwhelm support systems`,mitigation:"Phase automation and strengthen unemployment insurance"});const r=this.calculateOverallRiskScore(t);return{risks:e,overallScore:r,overallLevel:r>70?"critical":r>50?"high":r>30?"medium":"low",riskCount:{critical:e.filter(l=>l.level==="critical").length,high:e.filter(l=>l.level==="high").length,medium:e.filter(l=>l.level==="medium").length}}}calculateOverallRiskScore(t){let e=0;const i=t.labor_market_changes.unemployment_rate.final;e+=Math.min(30,i/this.thresholds.unemployment.crisis*30);const n=t.ai_impact.cumulative_displacement/1e6;e+=Math.min(25,n/this.thresholds.displacement.severe*25);const s=t.wages.average_hourly.change_percent;s<0&&(e+=Math.min(20,Math.abs(s)*5));const o=t.ai_impact.net_impact/1e6;if(o<0&&(e+=Math.min(15,Math.abs(o)*3)),t.inequality){const r=t.inequality.gini.final-t.inequality.gini.initial;e+=Math.min(10,r*100)}return Math.min(100,Math.round(e))}analyzeTrends(t){if(!t.monthlyData||t.monthlyData.length<6)return{available:!1};const e=t.monthlyData,i=Math.floor(e.length/2),n=e.slice(0,i),s=e.slice(i),o=(d,h)=>d.reduce((u,m)=>u+(m[h]||0),0)/d.length,r=this.calculateTrendDirection(o(n,"unemploymentRate"),o(s,"unemploymentRate")),l=this.calculateTrendDirection(o(n,"monthlyDisplacement"),o(s,"monthlyDisplacement")),c=this.findInflectionPoints(e);return{available:!0,unemploymentTrend:{direction:r,description:`Unemployment ${r} over simulation period`},displacementTrend:{direction:l,description:`Displacement rate ${l} in later months`},inflectionPoints:c,peakDisplacement:this.findPeakMonth(e,"monthlyDisplacement"),steadyStateReached:this.checkSteadyState(e)}}calculateTrendDirection(t,e){const i=(e-t)/t*100;return i>10?"increasing":i<-10?"decreasing":"stable"}findInflectionPoints(t){const e=[];for(let i=2;i<t.length-2;i++){const n=t[i].unemploymentRate-t[i-2].unemploymentRate,s=t[i+2].unemploymentRate-t[i].unemploymentRate;n>0&&s<0?e.push({month:i,type:"peak",value:t[i].unemploymentRate}):n<0&&s>0&&e.push({month:i,type:"trough",value:t[i].unemploymentRate})}return e}findPeakMonth(t,e){let i=0,n=0;return t.forEach((s,o)=>{s[e]>i&&(i=s[e],n=o)}),{month:n,value:i}}checkSteadyState(t){if(t.length<6)return!1;const i=t.slice(-6).map(s=>s.unemploymentRate);return this.calculateVariance(i)<.5}calculateVariance(t){const e=t.reduce((i,n)=>i+n,0)/t.length;return t.reduce((i,n)=>i+Math.pow(n-e,2),0)/t.length}analyzeSectors(t){if(!t.sectorImpacts)return{available:!1};const e=Object.entries(t.sectorImpacts),i=e.sort((s,o)=>(o[1].displaced||0)-(s[1].displaced||0)).slice(0,5),n=e.filter(([s,o])=>o.created>0).sort((s,o)=>(o[1].created||0)-(s[1].created||0)).slice(0,5);return{available:!0,mostAffected:i.map(([s,o])=>({name:s,displaced:o.displaced,percentAffected:(o.displaced/o.employment*100).toFixed(1)})),mostGrowth:n.map(([s,o])=>({name:s,created:o.created,growthPercent:(o.created/o.employment*100).toFixed(1)})),totalSectorsAffected:e.filter(([s,o])=>o.displaced>0).length}}generateRecommendations(t,e){const i=[],n=t.labor_market_changes.unemployment_rate.final,s=t.ai_impact.cumulative_displacement,o=t.ai_impact.net_impact,r=t.wages.average_hourly.change_percent;n>this.thresholds.unemployment.high&&i.push({priority:"high",category:"employment",title:"Expand Active Labor Market Policies",description:"High unemployment requires immediate intervention through job training, placement services, and employment subsidies.",expectedImpact:"Could reduce unemployment by 1-2 percentage points within 12 months"}),s>3e6&&i.push({priority:"high",category:"transition_support",title:"Strengthen Transition Assistance",description:"Large-scale displacement requires enhanced unemployment insurance, portable benefits, and career counseling.",expectedImpact:"Helps displaced workers maintain income while transitioning to new opportunities"}),o<-2e6&&i.push({priority:"high",category:"job_creation",title:"Invest in New Job Creation",description:"Net job losses require public investment in infrastructure, green economy, and care sectors.",expectedImpact:"Could create 1-3M jobs through targeted public investment"}),r<1&&i.push({priority:"medium",category:"wages",title:"Address Wage Pressures",description:"Stagnant wages may require minimum wage adjustments, profit-sharing incentives, or EITC expansion.",expectedImpact:"Supports living standards and maintains consumer demand"}),i.push({priority:"medium",category:"education",title:"Align Education with AI Economy",description:"Update curricula to emphasize complementary skills: creativity, emotional intelligence, and AI literacy.",expectedImpact:"Prepares future workforce for AI-augmented roles"}),i.push({priority:"standard",category:"monitoring",title:"Establish Early Warning Systems",description:"Create monitoring systems to identify at-risk occupations and regions before displacement occurs.",expectedImpact:"Enables proactive rather than reactive policy responses"});const l={high:0,medium:1,standard:2};return i.sort((c,d)=>l[c.priority]-l[d.priority]),i}generateBenchmarks(t){const e=t.labor_market_changes.unemployment_rate.final,i=t.ai_impact.cumulative_displacement;return{unemploymentBenchmarks:[{label:"Your Scenario",value:e,current:!0},{label:"Historical Average (2010-2019)",value:5.8},{label:"Great Recession Peak",value:10},{label:"Full Employment Target",value:4}],displacementBenchmarks:[{label:"Your Scenario",value:(i/1e6).toFixed(1)+"M",current:!0},{label:"Manufacturing Decline (1980-2010)",value:"7M"},{label:"Great Recession Job Loss",value:"8.7M"},{label:"Monthly Normal Turnover",value:"5M/month"}],context:this.generateBenchmarkContext(t)}}generateBenchmarkContext(t){const e=t.labor_market_changes.unemployment_rate.final,i=t.ai_impact.cumulative_displacement;return e>10?"Results indicate potential crisis exceeding Great Recession levels":e>7?"Unemployment would reach concerning levels requiring significant intervention":i>7e6?"Displacement scale comparable to decades-long manufacturing transition":"Results within range of manageable labor market adjustments"}generateNarrativeSummary(t,e){const i=[],n=t.ai_impact.net_impact,s=t.labor_market_changes.unemployment_rate.change;n>0?i.push(`This ${e.name} scenario projects a net positive labor market outcome, with AI technology creating more jobs than it displaces over the ${e.timeframe.end_year-e.timeframe.start_year}-year period.`):i.push(`This ${e.name} scenario projects significant labor market disruption, with AI automation displacing more workers than new opportunities created.`),i.push(`The simulation shows ${(t.ai_impact.cumulative_displacement/1e6).toFixed(1)} million jobs displaced by automation, while ${(t.ai_impact.cumulative_new_jobs/1e6).toFixed(1)} million new positions emerge in the AI-augmented economy.`),s>2?i.push(`Unemployment rises from ${t.labor_market_changes.unemployment_rate.initial}% to ${t.labor_market_changes.unemployment_rate.final}%, indicating that job creation fails to keep pace with displacement.`):s<-1?i.push(`Unemployment actually decreases from ${t.labor_market_changes.unemployment_rate.initial}% to ${t.labor_market_changes.unemployment_rate.final}%, suggesting successful adaptation to the AI economy.`):i.push(`Unemployment remains relatively stable at ${t.labor_market_changes.unemployment_rate.final}%, suggesting the labor market absorbs changes without major disruption.`);const o=t.wages.average_hourly.change_percent;return o>2?i.push(`Wages grow by ${o.toFixed(1)}%, indicating workers benefit from productivity gains.`):o<0&&i.push(`Average wages decline by ${Math.abs(o).toFixed(1)}%, suggesting increased competition for available positions.`),n<-2e6||s>3?i.push("These results suggest policymakers should prepare robust transition support programs and consider regulatory measures to manage the pace of automation."):i.push("While transition challenges remain, these results suggest manageable adjustment with appropriate policy support."),i.join(" ")}extractDataPoints(t){return{primary:[{label:"Final Unemployment Rate",value:t.labor_market_changes.unemployment_rate.final.toFixed(1),unit:"%",change:t.labor_market_changes.unemployment_rate.change.toFixed(1),changeDirection:t.labor_market_changes.unemployment_rate.change>=0?"up":"down",status:this.getURStatus(t.labor_market_changes.unemployment_rate.final)},{label:"Jobs Displaced",value:(t.ai_impact.cumulative_displacement/1e6).toFixed(2),unit:"M",status:t.ai_impact.cumulative_displacement>3e6?"warning":"neutral"},{label:"Jobs Created",value:(t.ai_impact.cumulative_new_jobs/1e6).toFixed(2),unit:"M",status:"positive"},{label:"Net Impact",value:(t.ai_impact.net_impact/1e6).toFixed(2),unit:"M",status:t.ai_impact.net_impact>=0?"positive":"warning"}],secondary:[{label:"AI Adoption Rate",value:t.ai_impact.ai_adoption.final.toFixed(0),unit:"%"},{label:"Wage Change",value:t.wages.average_hourly.change_percent.toFixed(1),unit:"%"},{label:"Productivity Growth",value:t.productivity.growth_rate.final.toFixed(1),unit:"%"}]}}getURSeverity(t){return t>=this.thresholds.unemployment.crisis?"critical":t>=this.thresholds.unemployment.high?"high":t>=this.thresholds.unemployment.moderate?"moderate":"low"}getURStatus(t){return t>=this.thresholds.unemployment.crisis?"danger":t>=this.thresholds.unemployment.high?"warning":"neutral"}getDisplacementSeverity(t){const e=t/1e6;return e>=this.thresholds.displacement.severe?"critical":e>=this.thresholds.displacement.significant?"high":e>=this.thresholds.displacement.moderate?"moderate":"low"}getCreationSeverity(t){const e=t/1e6;return e>=this.thresholds.jobCreation.strong?"positive":e>=this.thresholds.jobCreation.moderate?"neutral":"low"}getQuickInterpretation(t){const e=t.summary,i=e.ai_impact.net_impact,n=e.labor_market_changes.unemployment_rate.change,s=[];i>1e6?s.push({icon:"",text:`Net positive: ${(i/1e6).toFixed(1)}M more jobs created than displaced`}):i<-2e6?s.push({icon:"",text:`Significant disruption: ${Math.abs(i/1e6).toFixed(1)}M net job losses`}):s.push({icon:"",text:"Balanced transition: modest net job changes"}),n>2?s.push({icon:"",text:`Unemployment rises ${n.toFixed(1)} points - requires intervention`}):n<-1?s.push({icon:"",text:`Unemployment falls ${Math.abs(n).toFixed(1)} points - positive trajectory`}):s.push({icon:"",text:"Unemployment stable - labor market absorbs changes"});const o=e.wages.average_hourly.change_percent;o>2?s.push({icon:"",text:`Wages grow ${o.toFixed(1)}% - workers share in gains`}):o<-1&&s.push({icon:"",text:`Wages decline ${Math.abs(o).toFixed(1)}% - competitive pressure`});const r=e.productivity.growth_rate.final;return s.push({icon:"",text:`Productivity reaches ${r.toFixed(1)}% growth rate`}),s}}const Zh=new ro;typeof window<"u"&&(window.ResultsInterpreter=ro,window.resultsInterpreter=Zh);class lo{constructor(){this.storageKey="simulation_history",this.maxHistory=20}getAll(){try{const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):[]}catch(t){return console.error("Error reading simulation history:",t),[]}}save(t){var s,o,r,l,c,d,h,u;if(!t||!t.scenario||!t.results)return;const e=this.getAll(),i={id:Date.now(),timestamp:new Date().toISOString(),name:t.scenario.name||"Unnamed Scenario",summary:{timeframe:`${t.scenario.timeframe.start_year}-${t.scenario.timeframe.end_year}`,targetUnemployment:t.scenario.targets.unemployment_rate,aiAdoption:t.scenario.targets.ai_adoption_rate,adoptionCurve:t.scenario.ai_parameters.adoption_curve,interventions:((s=t.scenario.interventions)==null?void 0:s.length)||0,finalUnemployment:(l=(r=(o=t.summary)==null?void 0:o.labor_market_changes)==null?void 0:r.unemployment)==null?void 0:l.final,jobsDisplaced:(d=(c=t.summary)==null?void 0:c.labor_market_changes)==null?void 0:d.cumulative_displacement,jobsCreated:(u=(h=t.summary)==null?void 0:h.labor_market_changes)==null?void 0:u.cumulative_new_jobs},scenario:t.scenario,results:t.results,summaryData:t.summary};e.unshift(i);const n=e.slice(0,this.maxHistory);try{localStorage.setItem(this.storageKey,JSON.stringify(n))}catch(m){if(console.error("Error saving simulation history:",m),m.name==="QuotaExceededError"){const p=n.slice(0,Math.floor(this.maxHistory/2));localStorage.setItem(this.storageKey,JSON.stringify(p))}}return i}get(t){return this.getAll().find(i=>i.id===t)||null}delete(t){const i=this.getAll().filter(n=>n.id!==t);localStorage.setItem(this.storageKey,JSON.stringify(i))}clearAll(){localStorage.removeItem(this.storageKey)}getCount(){return this.getAll().length}formatTimestamp(t){const e=new Date(t),n=new Date-e;if(n<36e5){const s=Math.floor(n/6e4);return s<=1?"Just now":`${s} minutes ago`}if(n<864e5){const s=Math.floor(n/36e5);return s===1?"1 hour ago":`${s} hours ago`}if(n<6048e5){const s=Math.floor(n/864e5);return s===1?"Yesterday":`${s} days ago`}return e.toLocaleDateString()}formatNumber(t){return t==null?"N/A":Math.abs(t)>=1e6?(t/1e6).toFixed(1)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(1)+"K":t.toFixed(1)}}const tu=new lo;typeof window<"u"&&(window.SimulationHistoryService=lo,window.simulationHistory=tu);class co{constructor(){this.endpoint="https://gemini-proxy.adamconner7.workers.dev"}async savePublic(t){if(!t.results||!t.scenario)throw new Error("Invalid simulation: missing results or scenario");const e=await fetch(`${this.endpoint}/simulations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name||t.scenario.name||"Untitled Simulation",description:t.description||"",scenario:t.scenario,results:t.results,summary:t.summary||null})});if(!e.ok){const i=await e.json();throw new Error(i.error||"Failed to save simulation")}return await e.json()}async load(t){const e=await fetch(`${this.endpoint}/simulations/${t}`);if(!e.ok){if(e.status===404)throw new Error("Simulation not found. It may have expired or been deleted.");const i=await e.json();throw new Error(i.error||"Failed to load simulation")}return await e.json()}async listRecent(t=20){const e=await fetch(`${this.endpoint}/simulations?limit=${t}`);if(!e.ok){const i=await e.json();throw new Error(i.error||"Failed to list simulations")}return await e.json()}isAvailable(){return this.endpoint&&this.endpoint.length>0}getShareUrl(t){return`${window.location.origin+window.location.pathname}?sim=${t}`}getSharedIdFromUrl(){return new URLSearchParams(window.location.search).get("sim")}async copyShareUrl(t){const e=this.getShareUrl(t);try{return await navigator.clipboard.writeText(e),!0}catch{const i=document.createElement("textarea");return i.value=e,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i),!0}}}const eu=new co;typeof window<"u"&&(window.SimulationSharingService=co,window.simulationSharing=eu);class ho{constructor(){this.scenarios=[],this.maxScenarios=3,this.colors=[{primary:"#3b82f6",light:"rgba(59, 130, 246, 0.1)"},{primary:"#10b981",light:"rgba(16, 185, 129, 0.1)"},{primary:"#f59e0b",light:"rgba(245, 158, 11, 0.1)"}]}addScenario(t,e,i){if(this.scenarios.length>=this.maxScenarios)return{success:!1,message:`Maximum ${this.maxScenarios} scenarios allowed for comparison.`};if(this.scenarios.some(s=>s.name===t))return{success:!1,message:"A scenario with this name already exists in comparison."};const n={id:`scenario_${Date.now()}`,name:t,config:e,results:i,color:this.colors[this.scenarios.length],addedAt:new Date().toISOString()};return this.scenarios.push(n),{success:!0,scenario:n}}removeScenario(t){const e=this.scenarios.findIndex(i=>i.id===t);return e>-1?(this.scenarios.splice(e,1),this.scenarios.forEach((i,n)=>{i.color=this.colors[n]}),!0):!1}clearAll(){this.scenarios=[]}getComparisonData(){return this.scenarios.length<2?null:{scenarios:this.scenarios,metrics:this.extractComparisonMetrics(),charts:this.prepareChartData()}}extractComparisonMetrics(){return this.scenarios.map(t=>{var i;const e=t.results.summary;return t.results.results[t.results.results.length-1],{id:t.id,name:t.name,color:t.color,metrics:{targetYear:t.config.targetYear,targetUR:t.config.targetUR,aiAdoption:t.config.aiAdoption,automationPace:t.config.automationPace,interventions:((i=t.config.interventions)==null?void 0:i.length)||0,finalUnemployment:e.labor_market_changes.unemployment_rate.final,unemploymentChange:e.labor_market_changes.unemployment_rate.change,jobsDisplaced:e.ai_impact.jobs_displaced,jobsCreated:e.ai_impact.jobs_created,netJobImpact:e.ai_impact.net_impact,finalProductivity:e.economic_indicators.productivity_growth.final,finalWageGrowth:e.economic_indicators.wage_growth.final,finalLaborShare:e.economic_indicators.labor_share.final,finalAIAdoption:e.ai_impact.ai_adoption.final}}})}prepareChartData(){var e;const t=((e=this.scenarios[0])==null?void 0:e.results.results.map(i=>i.year))||[];return{unemployment:{labels:t,datasets:this.scenarios.map(i=>({label:i.name,data:i.results.results.map(n=>n.unemployment_rate),borderColor:i.color.primary,backgroundColor:i.color.light,tension:.3,fill:!1}))},employment:{labels:t,datasets:this.scenarios.map(i=>({label:i.name,data:i.results.results.map(n=>n.employment/1e6),borderColor:i.color.primary,backgroundColor:i.color.light,tension:.3,fill:!1}))},aiAdoption:{labels:t,datasets:this.scenarios.map(i=>({label:i.name,data:i.results.results.map(n=>n.ai_adoption),borderColor:i.color.primary,backgroundColor:i.color.light,tension:.3,fill:!1}))},productivity:{labels:t,datasets:this.scenarios.map(i=>({label:i.name,data:i.results.results.map(n=>n.productivity_growth),borderColor:i.color.primary,backgroundColor:i.color.light,tension:.3,fill:!1}))}}}generateComparisonHTML(){if(this.scenarios.length<2)return`
                <div style="text-align: center; padding: 40px; color: var(--gray-500);">
                    <h3 style="margin-bottom: 16px;">Add Scenarios to Compare</h3>
                    <p>Run simulations and click "Add to Comparison" to compare up to ${this.maxScenarios} scenarios side-by-side.</p>
                    <p style="margin-top: 12px; font-size: 0.875rem;">Current scenarios: ${this.scenarios.length}/${this.maxScenarios}</p>
                </div>
            `;const t=this.extractComparisonMetrics();return`
            <div class="comparison-container">
                <!-- Scenario Cards -->
                <div style="display: grid; grid-template-columns: repeat(${this.scenarios.length}, 1fr); gap: 16px; margin-bottom: 24px;">
                    ${t.map(e=>`
                        <div class="card" style="border-top: 4px solid ${e.color.primary};">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                                <div>
                                    <h3 style="color: ${e.color.primary}; margin-bottom: 4px;">${e.name}</h3>
                                    <span style="font-size: 0.75rem; color: var(--gray-500);">Target: ${e.metrics.targetYear}</span>
                                </div>
                                <button class="btn btn-sm btn-outline" onclick="scenarioComparison.removeScenario('${e.id}'); renderComparisonView();" style="font-size: 0.7rem;">
                                    Remove
                                </button>
                            </div>
                            <div class="comparison-metrics">
                                <div class="metric-row">
                                    <span class="metric-label">Final Unemployment</span>
                                    <span class="metric-value" style="color: ${e.metrics.finalUnemployment>6?"var(--danger)":"var(--secondary)"}">
                                        ${e.metrics.finalUnemployment.toFixed(1)}%
                                    </span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Jobs Displaced</span>
                                    <span class="metric-value">${(e.metrics.jobsDisplaced/1e6).toFixed(1)}M</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Jobs Created</span>
                                    <span class="metric-value">${(e.metrics.jobsCreated/1e6).toFixed(1)}M</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Net Impact</span>
                                    <span class="metric-value" style="color: ${e.metrics.netJobImpact<0?"var(--danger)":"var(--secondary)"}">
                                        ${e.metrics.netJobImpact>0?"+":""}${(e.metrics.netJobImpact/1e6).toFixed(1)}M
                                    </span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Interventions</span>
                                    <span class="metric-value">${e.metrics.interventions}</span>
                                </div>
                            </div>
                        </div>
                    `).join("")}
                </div>

                <!-- Comparison Table -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>Detailed Comparison</h3>
                    </div>
                    <table class="data-table comparison-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                ${t.map(e=>`<th style="color: ${e.color.primary};">${e.name}</th>`).join("")}
                                <th>Difference</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.generateComparisonRows(t)}
                        </tbody>
                    </table>
                </div>

                <!-- Comparison Charts -->
                <div class="card-grid" style="margin-bottom: 24px;">
                    <div class="card">
                        <div class="card-header"><h3>Unemployment Rate Comparison</h3></div>
                        <div class="chart-container">
                            <canvas id="comparisonURChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>Employment Comparison</h3></div>
                        <div class="chart-container">
                            <canvas id="comparisonEmpChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card-grid">
                    <div class="card">
                        <div class="card-header"><h3>AI Adoption Comparison</h3></div>
                        <div class="chart-container">
                            <canvas id="comparisonAIChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>Productivity Growth Comparison</h3></div>
                        <div class="chart-container">
                            <canvas id="comparisonProdChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        `}generateComparisonRows(t){return[{label:"Target Year",key:"targetYear",format:i=>i},{label:"Target Unemployment",key:"targetUR",format:i=>`${i}%`},{label:"AI Adoption Target",key:"aiAdoption",format:i=>`${i}%`},{label:"Automation Pace",key:"automationPace",format:i=>i.charAt(0).toUpperCase()+i.slice(1)},{label:"Final Unemployment",key:"finalUnemployment",format:i=>`${i.toFixed(1)}%`,highlight:!0},{label:"Unemployment Change",key:"unemploymentChange",format:i=>`${i>0?"+":""}${i.toFixed(1)}%`},{label:"Jobs Displaced",key:"jobsDisplaced",format:i=>`${(i/1e6).toFixed(2)}M`},{label:"Jobs Created",key:"jobsCreated",format:i=>`${(i/1e6).toFixed(2)}M`},{label:"Net Job Impact",key:"netJobImpact",format:i=>`${i>0?"+":""}${(i/1e6).toFixed(2)}M`,highlight:!0},{label:"Final AI Adoption",key:"finalAIAdoption",format:i=>`${i.toFixed(1)}%`},{label:"Final Productivity Growth",key:"finalProductivity",format:i=>`${i.toFixed(1)}%`},{label:"Final Wage Growth",key:"finalWageGrowth",format:i=>`${i.toFixed(1)}%`},{label:"Final Labor Share",key:"finalLaborShare",format:i=>`${i.toFixed(1)}%`}].map(i=>{const n=t.map(l=>l.metrics[i.key]),s=Math.min(...n.filter(l=>typeof l=="number")),o=Math.max(...n.filter(l=>typeof l=="number")),r=o-s;return`
                <tr ${i.highlight?'style="background: var(--gray-50); font-weight: 600;"':""}>
                    <td>${i.label}</td>
                    ${t.map((l,c)=>{const d=l.metrics[i.key];return`<td style="${d===s&&typeof d=="number"?"color: var(--secondary);":""} ${d===o&&typeof d=="number"&&i.key.includes("Displaced")?"color: var(--danger);":""}">${i.format(d)}</td>`}).join("")}
                    <td style="color: var(--gray-500);">
                        ${typeof n[0]=="number"?i.key.includes("job")?`${(r/1e6).toFixed(2)}M`:`${r.toFixed(1)}${i.key.includes("Rate")||i.key.includes("Unemployment")||i.key.includes("Adoption")||i.key.includes("Growth")||i.key.includes("Share")?"%":""}`:"-"}
                    </td>
                </tr>
            `}).join("")}renderCharts(){if(this.scenarios.length<2)return;const t=this.prepareChartData(),e={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{y:{beginAtZero:!1}}};["comparisonURChart","comparisonEmpChart","comparisonAIChart","comparisonProdChart"].forEach(i=>{const n=document.getElementById(i);if(n){const s=Chart.getChart(n);s&&s.destroy()}}),setTimeout(()=>{new Chart(document.getElementById("comparisonURChart"),{type:"line",data:t.unemployment,options:{...e,scales:{y:{title:{display:!0,text:"Unemployment Rate (%)"}}}}}),new Chart(document.getElementById("comparisonEmpChart"),{type:"line",data:t.employment,options:{...e,scales:{y:{title:{display:!0,text:"Employment (Millions)"}}}}}),new Chart(document.getElementById("comparisonAIChart"),{type:"line",data:t.aiAdoption,options:{...e,scales:{y:{title:{display:!0,text:"AI Adoption (%)"}}}}}),new Chart(document.getElementById("comparisonProdChart"),{type:"line",data:t.productivity,options:{...e,scales:{y:{title:{display:!0,text:"Productivity Growth (%)"}}}}})},100)}getCount(){return this.scenarios.length}canAddMore(){return this.scenarios.length<this.maxScenarios}}const iu=new ho;typeof window<"u"&&(window.ScenarioComparison=ho,window.scenarioComparison=iu);class uo{constructor(){this.occupations=this.getOccupationData(),this.selectedOccupation=null}getOccupationData(){return{data_entry_clerks:{name:"Data Entry Clerks",socCode:"43-9021",category:"Office & Administrative",employment:152e3,medianWage:37810,automationExposure:.92,aiAugmentationPotential:.15,tasks:[{name:"Entering data from source documents",exposure:.95,type:"routine_cognitive"},{name:"Verifying data accuracy",exposure:.85,type:"routine_cognitive"},{name:"Maintaining data entry logs",exposure:.9,type:"routine_cognitive"},{name:"Resolving data discrepancies",exposure:.7,type:"non_routine_cognitive"}],projectedChange:{2025:-8,2027:-22,2029:-38,2034:-65}},customer_service_reps:{name:"Customer Service Representatives",socCode:"43-4051",employment:284e4,category:"Office & Administrative",medianWage:39680,automationExposure:.78,aiAugmentationPotential:.45,tasks:[{name:"Answering routine inquiries",exposure:.9,type:"routine_cognitive"},{name:"Processing orders and returns",exposure:.85,type:"routine_cognitive"},{name:"Handling complaints",exposure:.55,type:"non_routine_interactive"},{name:"Providing product information",exposure:.75,type:"routine_cognitive"},{name:"Escalating complex issues",exposure:.3,type:"non_routine_interactive"}],projectedChange:{2025:-5,2027:-15,2029:-28,2034:-45}},accountants_auditors:{name:"Accountants and Auditors",socCode:"13-2011",category:"Business & Financial",employment:1538e3,medianWage:79880,automationExposure:.68,aiAugmentationPotential:.65,tasks:[{name:"Preparing tax returns",exposure:.8,type:"routine_cognitive"},{name:"Analyzing financial data",exposure:.55,type:"non_routine_analytical"},{name:"Auditing financial statements",exposure:.6,type:"non_routine_analytical"},{name:"Advising on financial strategy",exposure:.25,type:"non_routine_interactive"},{name:"Regulatory compliance",exposure:.7,type:"routine_cognitive"}],projectedChange:{2025:-3,2027:-10,2029:-18,2034:-30}},paralegals:{name:"Paralegals and Legal Assistants",socCode:"23-2011",category:"Legal",employment:358e3,medianWage:60970,automationExposure:.72,aiAugmentationPotential:.6,tasks:[{name:"Legal research",exposure:.75,type:"non_routine_analytical"},{name:"Document review",exposure:.85,type:"routine_cognitive"},{name:"Preparing legal documents",exposure:.7,type:"routine_cognitive"},{name:"Client communication",exposure:.35,type:"non_routine_interactive"},{name:"Case organization",exposure:.65,type:"routine_cognitive"}],projectedChange:{2025:-4,2027:-12,2029:-22,2034:-35}},software_developers:{name:"Software Developers",socCode:"15-1256",category:"Computer & IT",employment:1847e3,medianWage:127260,automationExposure:.45,aiAugmentationPotential:.85,tasks:[{name:"Writing code",exposure:.55,type:"non_routine_analytical"},{name:"Code review",exposure:.5,type:"non_routine_analytical"},{name:"Debugging",exposure:.45,type:"non_routine_analytical"},{name:"System design",exposure:.25,type:"non_routine_analytical"},{name:"Requirements gathering",exposure:.2,type:"non_routine_interactive"}],projectedChange:{2025:5,2027:8,2029:12,2034:18}},radiologic_technologists:{name:"Radiologic Technologists",socCode:"29-2034",category:"Healthcare",employment:241e3,medianWage:65140,automationExposure:.52,aiAugmentationPotential:.7,tasks:[{name:"Positioning patients",exposure:.15,type:"non_routine_manual"},{name:"Operating imaging equipment",exposure:.4,type:"routine_cognitive"},{name:"Image analysis (preliminary)",exposure:.75,type:"non_routine_analytical"},{name:"Patient interaction",exposure:.1,type:"non_routine_interactive"},{name:"Quality control",exposure:.55,type:"routine_cognitive"}],projectedChange:{2025:2,2027:3,2029:4,2034:6}},registered_nurses:{name:"Registered Nurses",socCode:"29-1141",category:"Healthcare",employment:3175e3,medianWage:81220,automationExposure:.28,aiAugmentationPotential:.55,tasks:[{name:"Patient care planning",exposure:.35,type:"non_routine_analytical"},{name:"Administering medications",exposure:.2,type:"routine_manual"},{name:"Patient monitoring",exposure:.45,type:"routine_cognitive"},{name:"Emotional support",exposure:.05,type:"non_routine_interactive"},{name:"Documentation",exposure:.6,type:"routine_cognitive"}],projectedChange:{2025:4,2027:7,2029:10,2034:15}},truck_drivers:{name:"Heavy Truck Drivers",socCode:"53-3032",category:"Transportation",employment:2097e3,medianWage:49920,automationExposure:.65,aiAugmentationPotential:.4,tasks:[{name:"Driving on highways",exposure:.8,type:"routine_manual"},{name:"Loading/unloading",exposure:.35,type:"routine_manual"},{name:"Route planning",exposure:.85,type:"routine_cognitive"},{name:"Vehicle inspection",exposure:.4,type:"routine_cognitive"},{name:"Urban navigation",exposure:.45,type:"non_routine_manual"}],projectedChange:{2025:-2,2027:-8,2029:-15,2034:-30}},retail_salespersons:{name:"Retail Salespersons",socCode:"41-2031",category:"Sales",employment:3686e3,medianWage:31920,automationExposure:.58,aiAugmentationPotential:.35,tasks:[{name:"Processing transactions",exposure:.9,type:"routine_cognitive"},{name:"Product recommendations",exposure:.6,type:"non_routine_interactive"},{name:"Inventory management",exposure:.75,type:"routine_cognitive"},{name:"Customer assistance",exposure:.35,type:"non_routine_interactive"},{name:"Store maintenance",exposure:.2,type:"routine_manual"}],projectedChange:{2025:-4,2027:-10,2029:-18,2034:-28}},financial_analysts:{name:"Financial Analysts",socCode:"13-2051",category:"Business & Financial",employment:33e4,medianWage:99010,automationExposure:.55,aiAugmentationPotential:.75,tasks:[{name:"Data analysis",exposure:.65,type:"non_routine_analytical"},{name:"Report generation",exposure:.7,type:"routine_cognitive"},{name:"Investment recommendations",exposure:.4,type:"non_routine_analytical"},{name:"Client presentations",exposure:.25,type:"non_routine_interactive"},{name:"Market research",exposure:.55,type:"non_routine_analytical"}],projectedChange:{2025:0,2027:-3,2029:-8,2034:-12}},graphic_designers:{name:"Graphic Designers",socCode:"27-1024",category:"Arts & Design",employment:265e3,medianWage:57990,automationExposure:.62,aiAugmentationPotential:.7,tasks:[{name:"Creating visual concepts",exposure:.55,type:"non_routine_analytical"},{name:"Production design work",exposure:.75,type:"routine_cognitive"},{name:"Client collaboration",exposure:.2,type:"non_routine_interactive"},{name:"Asset resizing/formatting",exposure:.9,type:"routine_cognitive"},{name:"Brand strategy",exposure:.25,type:"non_routine_analytical"}],projectedChange:{2025:-3,2027:-10,2029:-18,2034:-25}},marketing_managers:{name:"Marketing Managers",socCode:"11-2021",category:"Management",employment:316e3,medianWage:157620,automationExposure:.35,aiAugmentationPotential:.7,tasks:[{name:"Campaign strategy",exposure:.3,type:"non_routine_analytical"},{name:"Team leadership",exposure:.1,type:"non_routine_interactive"},{name:"Performance analytics",exposure:.6,type:"non_routine_analytical"},{name:"Content oversight",exposure:.45,type:"non_routine_analytical"},{name:"Stakeholder communication",exposure:.15,type:"non_routine_interactive"}],projectedChange:{2025:2,2027:4,2029:6,2034:10}}}}getOccupationsByCategory(){const t={};return Object.entries(this.occupations).forEach(([e,i])=>{t[i.category]||(t[i.category]=[]),t[i.category].push({id:e,...i})}),t}getOccupation(t){return this.occupations[t]||null}calculateTaskImpact(t,e=70){const i=this.occupations[t];if(!i)return null;const n=e/100;return i.tasks.map(s=>{const o=s.exposure*n,r=this.getAutomationLikelihood(o);return{...s,adjustedExposure:o,automationLikelihood:r,impact:this.getImpactLevel(o)}})}getAutomationLikelihood(t){return t>=.8?"Very High":t>=.6?"High":t>=.4?"Moderate":t>=.2?"Low":"Very Low"}getImpactLevel(t){return t>=.7?{level:"high",color:"var(--danger)"}:t>=.4?{level:"medium",color:"var(--warning)"}:{level:"low",color:"var(--secondary)"}}projectEmploymentChange(t,e,i=70){const n=this.occupations[t];if(!n)return null;let s=0;const o=Object.keys(n.projectedChange).map(Number).sort();if(e<=o[0])s=n.projectedChange[o[0]];else if(e>=o[o.length-1])s=n.projectedChange[o[o.length-1]];else for(let c=0;c<o.length-1;c++)if(e>=o[c]&&e<o[c+1]){const d=(e-o[c])/(o[c+1]-o[c]);s=n.projectedChange[o[c]]+d*(n.projectedChange[o[c+1]]-n.projectedChange[o[c]]);break}const r=i/70,l=s*r;return{percentChange:l,absoluteChange:Math.round(n.employment*(l/100)),projectedEmployment:Math.round(n.employment*(1+l/100))}}getTransitionRecommendations(t){const e=this.occupations[t];if(!e)return[];const i={routine_cognitive:["Data analysis and interpretation","AI/ML tool proficiency","Process optimization","Quality assurance oversight"],routine_manual:["Robotics and automation supervision","Technical troubleshooting","Safety and compliance management","Equipment maintenance"],non_routine_analytical:["Strategic thinking and planning","Complex problem-solving","AI model interpretation","Innovation and creativity"],non_routine_interactive:["Emotional intelligence","Negotiation and persuasion","Leadership and mentoring","Cross-cultural communication"],non_routine_manual:["Fine motor skills development","Adaptive response training","Human-robot collaboration","Environmental awareness"]},n={};e.tasks.forEach(r=>{n[r.type]||(n[r.type]=0),n[r.type]+=r.exposure});const s=Object.entries(n).sort((r,l)=>l[1]-r[1]).slice(0,2).map(([r])=>r),o=new Set;return s.forEach(r=>{i[r]&&i[r].forEach(l=>o.add(l))}),Array.from(o).slice(0,6)}generateOccupationListHTML(){const t=this.getOccupationsByCategory();let e='<div class="occupation-drilldown">';return Object.entries(t).forEach(([i,n])=>{e+=`
                <div class="occupation-category" style="margin-bottom: 24px;">
                    <h4 style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
                        ${i}
                    </h4>
                    <div class="occupation-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;">
            `,n.forEach(s=>{const o=s.automationExposure>=.7?"tag-high":s.automationExposure>=.4?"tag-medium":"tag-low",r=s.automationExposure>=.7?"High Risk":s.automationExposure>=.4?"Medium Risk":"Low Risk";e+=`
                    <div class="occupation-card" style="
                        background: var(--gray-50);
                        border: 1px solid var(--gray-200);
                        border-radius: 8px;
                        padding: 16px;
                        cursor: pointer;
                        transition: all 0.2s;
                    " onclick="showOccupationDetails('${s.id}')"
                       onmouseover="this.style.borderColor='var(--primary)'; this.style.boxShadow='var(--shadow)';"
                       onmouseout="this.style.borderColor='var(--gray-200)'; this.style.boxShadow='none';">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div>
                                <div style="font-weight: 600; color: var(--gray-800);">${s.name}</div>
                                <div style="font-size: 0.75rem; color: var(--gray-500);">SOC: ${s.socCode}</div>
                            </div>
                            <span class="tag ${o}">${r}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--gray-600);">
                            <span>${(s.employment/1e3).toFixed(0)}K employed</span>
                            <span>$${(s.medianWage/1e3).toFixed(0)}K median</span>
                        </div>
                        <div style="margin-top: 8px;">
                            <div style="height: 6px; background: var(--gray-200); border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; width: ${s.automationExposure*100}%; background: ${s.automationExposure>=.7?"var(--danger)":s.automationExposure>=.4?"var(--warning)":"var(--secondary)"}"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--gray-400); margin-top: 4px;">
                                <span>AI Exposure: ${(s.automationExposure*100).toFixed(0)}%</span>
                                <span>Augmentation: ${(s.aiAugmentationPotential*100).toFixed(0)}%</span>
                            </div>
                        </div>
                    </div>
                `}),e+="</div></div>"}),e+="</div>",e}generateDetailedViewHTML(t,e=70,i=2029){const n=this.getOccupation(t);if(!n)return"<p>Occupation not found.</p>";const s=this.calculateTaskImpact(t,e),o=this.projectEmploymentChange(t,i,e),r=this.getTransitionRecommendations(t),l=n.automationExposure>=.7?"tag-high":n.automationExposure>=.4?"tag-medium":"tag-low";return`
            <div class="occupation-detail">
                <button class="btn btn-outline btn-sm" onclick="hideOccupationDetails()" style="margin-bottom: 16px;">
                    &larr; Back to List
                </button>

                <div class="card" style="margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 16px;">
                        <div>
                            <h2 style="font-size: 1.5rem; color: var(--gray-900); margin-bottom: 4px;">${n.name}</h2>
                            <p style="color: var(--gray-500);">SOC Code: ${n.socCode} | ${n.category}</p>
                        </div>
                        <span class="tag ${l}" style="font-size: 1rem; padding: 8px 16px;">
                            ${n.automationExposure>=.7?"High Risk":n.automationExposure>=.4?"Medium Risk":"Low Risk"}
                        </span>
                    </div>

                    <div class="stats-grid" style="margin-top: 24px;">
                        <div class="stat-card">
                            <div class="label">Current Employment</div>
                            <div class="value">${(n.employment/1e6).toFixed(2)}M</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Median Wage</div>
                            <div class="value">$${n.medianWage.toLocaleString()}</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">AI Exposure</div>
                            <div class="value" style="color: ${n.automationExposure>=.7?"var(--danger)":"var(--warning)"}">
                                ${(n.automationExposure*100).toFixed(0)}%
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Augmentation Potential</div>
                            <div class="value" style="color: var(--secondary);">
                                ${(n.aiAugmentationPotential*100).toFixed(0)}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Employment Projection -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>Employment Projection to ${i}</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; text-align: center;">
                        <div>
                            <div style="font-size: 0.875rem; color: var(--gray-500);">Projected Change</div>
                            <div style="font-size: 1.75rem; font-weight: 700; color: ${o.percentChange<0?"var(--danger)":"var(--secondary)"};">
                                ${o.percentChange>0?"+":""}${o.percentChange.toFixed(1)}%
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--gray-500);">Jobs Impact</div>
                            <div style="font-size: 1.75rem; font-weight: 700; color: ${o.absoluteChange<0?"var(--danger)":"var(--secondary)"};">
                                ${o.absoluteChange>0?"+":""}${(o.absoluteChange/1e3).toFixed(0)}K
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 0.875rem; color: var(--gray-500);">Projected Employment</div>
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--gray-900);">
                                ${(o.projectedEmployment/1e6).toFixed(2)}M
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task-Level Analysis -->
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>Task-Level AI Exposure Analysis</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Task</th>
                                <th>Type</th>
                                <th>AI Exposure</th>
                                <th>Automation Likelihood</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${s.map(c=>`
                                <tr>
                                    <td><strong>${c.name}</strong></td>
                                    <td style="font-size: 0.75rem; color: var(--gray-500);">
                                        ${c.type.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase())}
                                    </td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="width: 60px; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                                <div style="height: 100%; width: ${c.adjustedExposure*100}%; background: ${c.impact.color};"></div>
                                            </div>
                                            <span>${(c.adjustedExposure*100).toFixed(0)}%</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="tag ${c.impact.level==="high"?"tag-high":c.impact.level==="medium"?"tag-medium":"tag-low"}">
                                            ${c.automationLikelihood}
                                        </span>
                                    </td>
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>

                <!-- Skill Recommendations -->
                <div class="card">
                    <div class="card-header">
                        <h3>Recommended Skills for AI Era</h3>
                    </div>
                    <p style="color: var(--gray-600); margin-bottom: 16px;">
                        Workers in this occupation should consider developing these skills to adapt to AI-driven changes:
                    </p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${r.map(c=>`
                            <span style="
                                background: var(--primary);
                                color: white;
                                padding: 8px 16px;
                                border-radius: 9999px;
                                font-size: 0.875rem;
                            ">${c}</span>
                        `).join("")}
                    </div>
                </div>
            </div>
        `}}const nu=new uo;typeof window<"u"&&(window.OccupationDrilldown=uo,window.occupationDrilldown=nu);class mo{constructor(){this.reportStyles=`
            @media print {
                body {
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                    color: #111827;
                    line-height: 1.6;
                }
                .no-print { display: none !important; }
                .page-break { page-break-before: always; }
                .report-section { margin-bottom: 24px; }
                table { width: 100%; border-collapse: collapse; }
                th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
                th { background: #f9fafb; font-weight: 600; }
            }
        `}generateReport(t,e={}){if(!t){alert("No simulation results to export. Please run a simulation first.");return}const i=this.buildReportHTML(t,e);this.openPrintWindow(i)}buildReportHTML(t,e){const i=t.summary,n=t.scenario,s=new Date().toLocaleString();return e.includeCharts,e.includeRawData,`
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Labor Market Simulation Report - ${n.name}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: #111827;
            line-height: 1.6;
            padding: 40px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .report-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3b82f6;
        }
        .report-header h1 { font-size: 24px; margin-bottom: 8px; }
        .report-header p { color: #6b7280; }
        .section { margin-bottom: 32px; }
        .section h2 {
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-box {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }
        .stat-box .label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
        .stat-box .value { font-size: 24px; font-weight: 700; }
        .stat-box .value.positive { color: #10b981; }
        .stat-box .value.negative { color: #ef4444; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
        th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f9fafb; font-weight: 600; font-size: 12px; text-transform: uppercase; color: #6b7280; }
        .highlight { background: #fef3c7; }
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 500;
        }
        .tag-high { background: #fee2e2; color: #ef4444; }
        .tag-medium { background: #fef3c7; color: #f59e0b; }
        .tag-low { background: #d1fae5; color: #10b981; }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
            font-size: 12px;
            color: #9ca3af;
        }
        .page-break { page-break-before: always; }
        @media print {
            body { padding: 20px; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="report-header">
        <h1>AI Labor Market Impact Simulation Report</h1>
        <p><strong>${n.name}</strong> | Generated: ${s}</p>
    </div>

    <!-- Executive Summary -->
    <div class="section">
        <h2>Executive Summary</h2>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="label">Final Unemployment Rate</div>
                <div class="value ${parseFloat(i.labor_market_changes.unemployment_rate.final)>6?"negative":""}">
                    ${i.labor_market_changes.unemployment_rate.final}%
                </div>
            </div>
            <div class="stat-box">
                <div class="label">Net Job Impact</div>
                <div class="value ${i.ai_impact.net_impact<0?"negative":"positive"}">
                    ${i.ai_impact.net_impact>0?"+":""}${(i.ai_impact.net_impact/1e6).toFixed(2)}M
                </div>
            </div>
            <div class="stat-box">
                <div class="label">Jobs Displaced</div>
                <div class="value negative">
                    ${(i.ai_impact.cumulative_displacement/1e6).toFixed(2)}M
                </div>
            </div>
            <div class="stat-box">
                <div class="label">Jobs Created</div>
                <div class="value positive">
                    ${(i.ai_impact.cumulative_new_jobs/1e6).toFixed(2)}M
                </div>
            </div>
        </div>
    </div>

    <!-- Scenario Configuration -->
    <div class="section">
        <h2>Scenario Configuration</h2>
        <table>
            <tbody>
                <tr>
                    <td><strong>Timeframe</strong></td>
                    <td>${n.timeframe.start_year} - ${n.timeframe.end_year} (${n.timeframe.end_year-n.timeframe.start_year} years)</td>
                </tr>
                <tr>
                    <td><strong>Target Unemployment Rate</strong></td>
                    <td>${n.targets.unemployment_rate}%</td>
                </tr>
                <tr>
                    <td><strong>Target AI Adoption Rate</strong></td>
                    <td>${n.targets.ai_adoption_rate}%</td>
                </tr>
                <tr>
                    <td><strong>Automation Pace</strong></td>
                    <td>${n.targets.automation_pace.charAt(0).toUpperCase()+n.targets.automation_pace.slice(1)}</td>
                </tr>
                <tr>
                    <td><strong>Adoption Curve</strong></td>
                    <td>${n.ai_parameters.adoption_curve.replace("_","-").replace(/\b\w/g,o=>o.toUpperCase())}</td>
                </tr>
                <tr>
                    <td><strong>New Job Multiplier</strong></td>
                    <td>${n.ai_parameters.new_job_multiplier}</td>
                </tr>
                <tr>
                    <td><strong>Active Interventions</strong></td>
                    <td>${n.interventions.length>0?n.interventions.map(o=>o.name).join(", "):"None"}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Labor Market Outcomes -->
    <div class="section">
        <h2>Labor Market Outcomes</h2>
        <table>
            <thead>
                <tr>
                    <th>Indicator</th>
                    <th>Initial</th>
                    <th>Final</th>
                    <th>Change</th>
                </tr>
            </thead>
            <tbody>
                <tr class="highlight">
                    <td><strong>Unemployment Rate</strong></td>
                    <td>${i.labor_market_changes.unemployment_rate.initial}%</td>
                    <td>${i.labor_market_changes.unemployment_rate.final}%</td>
                    <td>${parseFloat(i.labor_market_changes.unemployment_rate.change)>0?"+":""}${i.labor_market_changes.unemployment_rate.change}%</td>
                </tr>
                <tr>
                    <td><strong>Total Employment</strong></td>
                    <td>${(i.labor_market_changes.total_employment.initial/1e6).toFixed(2)}M</td>
                    <td>${(i.labor_market_changes.total_employment.final/1e6).toFixed(2)}M</td>
                    <td>${i.labor_market_changes.total_employment.change>0?"+":""}${(i.labor_market_changes.total_employment.change/1e6).toFixed(2)}M</td>
                </tr>
                <tr>
                    <td><strong>Job Openings</strong></td>
                    <td>${(i.labor_market_changes.job_openings.initial/1e6).toFixed(2)}M</td>
                    <td>${(i.labor_market_changes.job_openings.final/1e6).toFixed(2)}M</td>
                    <td>${i.labor_market_changes.job_openings.change>0?"+":""}${(i.labor_market_changes.job_openings.change/1e6).toFixed(2)}M</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Economic Indicators -->
    <div class="section">
        <h2>Economic Indicators</h2>
        <table>
            <thead>
                <tr>
                    <th>Indicator</th>
                    <th>Initial</th>
                    <th>Final</th>
                    <th>Change</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Productivity Growth</strong></td>
                    <td>${i.productivity.growth_rate.initial}%</td>
                    <td>${i.productivity.growth_rate.final}%</td>
                    <td>${parseFloat(i.productivity.growth_rate.final)-parseFloat(i.productivity.growth_rate.initial)>0?"+":""}${(parseFloat(i.productivity.growth_rate.final)-parseFloat(i.productivity.growth_rate.initial)).toFixed(1)}%</td>
                </tr>
                <tr>
                    <td><strong>Average Hourly Wage</strong></td>
                    <td>$${i.wages.average_hourly.initial}</td>
                    <td>$${i.wages.average_hourly.final}</td>
                    <td>${parseFloat(i.wages.average_hourly.change_percent)>0?"+":""}${i.wages.average_hourly.change_percent}%</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- AI Impact -->
    <div class="section">
        <h2>AI Impact Analysis</h2>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="label">AI Adoption (Initial)</div>
                <div class="value">${i.ai_impact.ai_adoption.initial}%</div>
            </div>
            <div class="stat-box">
                <div class="label">AI Adoption (Final)</div>
                <div class="value">${i.ai_impact.ai_adoption.final}%</div>
            </div>
            <div class="stat-box">
                <div class="label">Total Jobs Displaced</div>
                <div class="value negative">${(i.ai_impact.cumulative_displacement/1e6).toFixed(2)}M</div>
            </div>
            <div class="stat-box">
                <div class="label">Total Jobs Created</div>
                <div class="value positive">${(i.ai_impact.cumulative_new_jobs/1e6).toFixed(2)}M</div>
            </div>
        </div>
    </div>

    ${n.interventions.length>0?`
    <!-- Policy Interventions -->
    <div class="section page-break">
        <h2>Policy Interventions</h2>
        <table>
            <thead>
                <tr>
                    <th>Intervention</th>
                    <th>Category</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                ${n.interventions.map(o=>`
                    <tr>
                        <td><strong>${o.name}</strong></td>
                        <td>${o.category.replace("_"," ").replace(/\b\w/g,r=>r.toUpperCase())}</td>
                        <td><span class="tag tag-low">Active</span></td>
                    </tr>
                `).join("")}
            </tbody>
        </table>
    </div>
    `:""}

    <!-- Year-by-Year Projections -->
    <div class="section ${n.interventions.length>0?"":"page-break"}">
        <h2>Year-by-Year Projections</h2>
        <table>
            <thead>
                <tr>
                    <th>Year</th>
                    <th>UR (%)</th>
                    <th>Employment (M)</th>
                    <th>AI Adoption (%)</th>
                    <th>Jobs Displaced (K)</th>
                    <th>Jobs Created (K)</th>
                    <th>Productivity (%)</th>
                </tr>
            </thead>
            <tbody>
                ${t.results.map(o=>`
                    <tr>
                        <td><strong>${o.year}</strong></td>
                        <td>${o.unemployment_rate.toFixed(1)}</td>
                        <td>${(o.employment/1e6).toFixed(2)}</td>
                        <td>${o.ai_adoption.toFixed(1)}</td>
                        <td>${(o.jobs_displaced/1e3).toFixed(0)}</td>
                        <td>${(o.jobs_created/1e3).toFixed(0)}</td>
                        <td>${o.productivity_growth.toFixed(1)}</td>
                    </tr>
                `).join("")}
            </tbody>
        </table>
    </div>

    <!-- Methodology Notes -->
    <div class="section">
        <h2>Methodology Notes</h2>
        <p style="font-size: 13px; color: #6b7280;">
            This simulation uses economic modeling based on historical labor market data from the Bureau of Labor Statistics,
            combined with AI adoption projections from research institutions including the Anthropic Economic Index,
            MIT Iceberg Index, and IMF working papers. Job displacement and creation estimates are derived from
            sector-level automation exposure analysis using O*NET task frameworks. All projections are hypothetical
            and intended for educational and research purposes only. Actual labor market outcomes will depend on
            numerous factors not captured in this model.
        </p>
    </div>

    <div class="footer">
        <p>AI Labor Market Impact Simulator | Report generated automatically</p>
        <p style="margin-top: 4px;">This report is for informational purposes only and should not be considered financial or policy advice.</p>
    </div>

    <div class="no-print" style="text-align: center; margin-top: 40px;">
        <button onclick="window.print()" style="
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        ">Print / Save as PDF</button>
        <button onclick="window.close()" style="
            background: #e5e7eb;
            color: #374151;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 8px;
        ">Close</button>
    </div>
</body>
</html>
        `}openPrintWindow(t){const e=window.open("","_blank","width=1000,height=800");if(!e){alert("Please allow pop-ups to generate the PDF report.");return}e.document.write(t),e.document.close()}generateQuickSummary(t){const e=t.summary,i=t.scenario;return`
AI Labor Market Simulation Summary
==================================
Scenario: ${i.name}
Timeframe: ${i.timeframe.start_year}-${i.timeframe.end_year}

Key Results:
- Final Unemployment: ${e.labor_market_changes.unemployment_rate.final}% (${parseFloat(e.labor_market_changes.unemployment_rate.change)>0?"+":""}${e.labor_market_changes.unemployment_rate.change}%)
- Jobs Displaced: ${(e.ai_impact.cumulative_displacement/1e6).toFixed(2)}M
- Jobs Created: ${(e.ai_impact.cumulative_new_jobs/1e6).toFixed(2)}M
- Net Impact: ${e.ai_impact.net_impact>0?"+":""}${(e.ai_impact.net_impact/1e6).toFixed(2)}M jobs
- Final AI Adoption: ${e.ai_impact.ai_adoption.final}%

Configuration:
- Target Unemployment: ${i.targets.unemployment_rate}%
- AI Adoption Rate: ${i.targets.ai_adoption_rate}%
- Automation Pace: ${i.targets.automation_pace}
- Interventions: ${i.interventions.length>0?i.interventions.map(n=>n.name).join(", "):"None"}
        `.trim()}}const au=new mo;typeof window<"u"&&(window.PDFExporter=mo,window.pdfExporter=au);class po{constructor(){this.pageWidth=595.28,this.pageHeight=841.89,this.margin=40,this.lineHeight=14,this.currentY=this.margin}async generateReport(t,e={}){typeof jspdf>"u"&&typeof i>"u"&&await this.loadJsPDF();const{jsPDF:i}=window.jspdf||window,n=new i("p","pt","a4");this.doc=n,this.currentY=this.margin;const s=t.summary,o=t.scenario;this.addTitlePage(o,s),this.addNewPage(),this.addExecutiveSummary(s,o),this.addNewPage(),this.addLaborMarketSection(s),this.addNewPage(),this.addAIImpactSection(s),this.addNewPage(),this.addSectorAnalysis(s),o.interventions&&o.interventions.length>0&&(this.addNewPage(),this.addInterventionSection(s,o.interventions)),s.demographics&&(this.addNewPage(),this.addDemographicsSection(s.demographics)),s.skills_gap&&(this.addNewPage(),this.addSkillsGapSection(s.skills_gap)),this.addNewPage(),this.addMethodologySection(o);const r=`labor-market-simulation-${new Date().toISOString().split("T")[0]}.pdf`;return n.save(r),r}async loadJsPDF(){return new Promise((t,e)=>{const i=document.createElement("script");i.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",i.onload=t,i.onerror=e,document.head.appendChild(i)})}addTitlePage(t,e){const i=this.doc,n=this.pageWidth/2;i.setFontSize(28),i.setFont("helvetica","bold"),i.text("AI Labor Market",n,200,{align:"center"}),i.text("Impact Simulation",n,235,{align:"center"}),i.setFontSize(16),i.setFont("helvetica","normal"),i.text("Comprehensive Analysis Report",n,280,{align:"center"}),i.setFontSize(12);const s=t.name||"Custom Scenario";i.text(`Scenario: ${s}`,n,340,{align:"center"});const o=`${e.timeframe.start_year} - ${e.timeframe.end_year}`;i.text(`Timeframe: ${o}`,n,360,{align:"center"}),i.setFontSize(11),i.setFont("helvetica","bold"),i.text("Key Projections",n,420,{align:"center"}),i.setFont("helvetica","normal"),[`Unemployment: ${e.labor_market_changes.unemployment_rate.initial}%  ${e.labor_market_changes.unemployment_rate.final}%`,`Jobs Displaced: ${this.formatNumber(e.ai_impact.cumulative_displacement)}`,`Jobs Created: ${this.formatNumber(e.ai_impact.cumulative_new_jobs)}`,`Net Impact: ${this.formatNumber(e.ai_impact.net_impact)}`].forEach((c,d)=>{i.text(c,n,450+d*20,{align:"center"})}),i.setFontSize(10),i.setTextColor(128);const l=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});i.text(`Generated: ${l}`,n,this.pageHeight-60,{align:"center"}),i.text("AI Labor Market Impact Simulator",n,this.pageHeight-45,{align:"center"}),i.setTextColor(0)}addExecutiveSummary(t,e){this.addSectionHeader("Executive Summary");const i=t.labor_market_changes.unemployment_rate,n=t.ai_impact,s=`This simulation projects labor market outcomes from ${t.timeframe.start_year} to ${t.timeframe.end_year} under a scenario with ${e.targets.ai_adoption_rate}% AI adoption and ${e.targets.automation_pace} automation pace. The analysis indicates ${i.change>0?"an increase":"a decrease"} in unemployment from ${i.initial}% to ${i.final}%.`;this.addParagraph(s),this.currentY+=10,this.addSubHeader("Key Findings"),[` Unemployment Rate Change: ${i.change>0?"+":""}${i.change} percentage points`,` Total Jobs Displaced by AI: ${this.formatNumber(n.cumulative_displacement)}`,` New Jobs Created: ${this.formatNumber(n.cumulative_new_jobs)}`,` Net Job Impact: ${this.formatNumber(n.net_impact)} ${n.net_impact>=0?"(net positive)":"(net negative)"}`,` Average Wage Change: ${t.wages.average_hourly.change_percent}%`].forEach(d=>{this.addText(d)}),this.currentY+=15,this.addSubHeader("Risk Assessment");let r="Moderate",l=[255,165,0];parseFloat(i.final)>10?(r="High",l=[255,0,0]):parseFloat(i.final)<5&&(r="Low",l=[0,128,0]),this.doc.setTextColor(...l),this.addText(`Overall Risk Level: ${r}`),this.doc.setTextColor(0);const c=[];n.net_impact<-1e6&&c.push(" Significant net job losses projected"),parseFloat(i.final)>8&&c.push(" Elevated unemployment exceeding historical norms"),parseFloat(t.wages.average_hourly.change_percent)<0&&c.push(" Wage pressure from automation"),c.length>0?c.forEach(d=>this.addText(d)):this.addText(" No major risk factors identified")}addLaborMarketSection(t){this.addSectionHeader("Labor Market Projections");const e=t.labor_market_changes;this.addSubHeader("Unemployment Rate"),this.addText(`Initial: ${e.unemployment_rate.initial}%`),this.addText(`Final: ${e.unemployment_rate.final}%`),this.addText(`Change: ${e.unemployment_rate.change>0?"+":""}${e.unemployment_rate.change} percentage points`),this.currentY+=10,this.addSubHeader("Total Employment"),this.addText(`Initial: ${this.formatNumber(e.total_employment.initial)} workers`),this.addText(`Final: ${this.formatNumber(e.total_employment.final)} workers`),this.addText(`Change: ${this.formatNumber(e.total_employment.change)} workers`),this.currentY+=10,this.addSubHeader("Job Openings"),this.addText(`Initial: ${this.formatNumber(e.job_openings.initial)}`),this.addText(`Final: ${this.formatNumber(e.job_openings.final)}`),this.addText(`Change: ${this.formatNumber(e.job_openings.change)}`),this.currentY+=10,this.addSubHeader("Wage Trends"),this.addText(`Initial Average Hourly Wage: $${t.wages.average_hourly.initial}`),this.addText(`Final Average Hourly Wage: $${t.wages.average_hourly.final}`),this.addText(`Wage Growth: ${t.wages.average_hourly.change_percent}%`)}addAIImpactSection(t){this.addSectionHeader("AI & Automation Impact");const e=t.ai_impact;this.addSubHeader("AI Adoption"),this.addText(`Initial Adoption Rate: ${e.ai_adoption.initial}%`),this.addText(`Final Adoption Rate: ${e.ai_adoption.final}%`),this.currentY+=10,this.addSubHeader("Job Displacement"),this.addText(`Cumulative Jobs Displaced: ${this.formatNumber(e.cumulative_displacement)}`),this.addParagraph("Job displacement represents positions eliminated or significantly transformed by AI and automation technologies."),this.currentY+=10,this.addSubHeader("Job Creation"),this.addText(`Cumulative New Jobs Created: ${this.formatNumber(e.cumulative_new_jobs)}`),this.addParagraph("New jobs include AI-adjacent roles, technology implementation positions, and emerging occupations enabled by automation."),this.currentY+=10,this.addSubHeader("Net Impact Analysis");const i=e.net_impact,n=i>=0?"positive":"negative";this.addText(`Net Job Impact: ${this.formatNumber(i)} (${n})`),i<0?this.addParagraph(`The simulation projects a net loss of ${this.formatNumber(Math.abs(i))} jobs. Policy interventions may help mitigate this impact.`):this.addParagraph(`The simulation projects a net gain of ${this.formatNumber(i)} jobs, suggesting job creation outpaces displacement in this scenario.`)}addSectorAnalysis(t){this.addSectionHeader("Sector-Level Analysis");const e=t.sector_summary;this.addSubHeader("Most Affected Sectors"),e.most_affected&&e.most_affected.forEach((i,n)=>{const s=i.name.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase());this.addText(`${n+1}. ${s}`),this.addText(`   Employment Change: ${this.formatNumber(i.employment_change)} (${i.employment_change_percent}%)`),this.addText(`   Automation Exposure: ${(i.automation_exposure*100).toFixed(0)}%`),this.currentY+=5}),this.currentY+=10,this.addSubHeader("Most Resilient Sectors"),e.least_affected&&e.least_affected.forEach((i,n)=>{const s=i.name.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase());this.addText(`${n+1}. ${s}`),this.addText(`   Employment Change: ${this.formatNumber(i.employment_change)} (${i.employment_change_percent}%)`),this.addText(`   Automation Exposure: ${(i.automation_exposure*100).toFixed(0)}%`),this.currentY+=5})}addInterventionSection(t,e){if(this.addSectionHeader("Policy Intervention Analysis"),this.addParagraph(`This simulation includes ${e.length} active policy intervention(s) designed to mitigate negative labor market impacts.`),this.currentY+=10,this.addSubHeader("Active Interventions"),e.forEach((i,n)=>{this.addText(`${n+1}. ${i.name}`),i.description&&(this.doc.setFontSize(10),this.addText(`   ${i.description.substring(0,80)}...`),this.doc.setFontSize(11)),this.currentY+=5}),t.interventions){this.currentY+=10,this.addSubHeader("Combined Intervention Effects");const i=t.interventions;this.addText(`Total Job Effect: ${this.formatNumber(i.total_job_effect||0)}`),this.addText(`Total Economic Impact: $${this.formatNumber(i.total_economic_impact||0)}`),this.addText(`Total Fiscal Cost: $${this.formatNumber(Math.abs(i.total_fiscal_cost||0))}${i.total_fiscal_cost<0?" (revenue)":""}`)}}addDemographicsSection(t){this.addSectionHeader("Demographic Impact Analysis"),t.by_age&&(this.addSubHeader("Impact by Age Group"),Object.entries(t.by_age).forEach(([e,i])=>{this.addText(`${e}: ${i.impact_level} impact (${i.displacement_rate}% displacement risk)`)}),this.currentY+=10),t.by_education&&(this.addSubHeader("Impact by Education Level"),Object.entries(t.by_education).forEach(([e,i])=>{this.addText(`${e}: ${i.impact_level} impact (${i.displacement_rate}% displacement risk)`)}),this.currentY+=10),t.recommendations&&(this.addSubHeader("Targeted Recommendations"),t.recommendations.forEach((e,i)=>{this.addText(`${i+1}. ${e}`)}))}addSkillsGapSection(t){this.addSectionHeader("Skills Gap Analysis"),t.declining_skills&&(this.addSubHeader("Declining Skills"),t.declining_skills.forEach(e=>{this.addText(` ${e.name} (-${e.decline_rate}% demand)`)}),this.currentY+=10),t.growing_skills&&(this.addSubHeader("In-Demand Skills"),t.growing_skills.forEach(e=>{this.addText(` ${e.name} (+${e.growth_rate}% demand)`)}),this.currentY+=10),t.training_recommendations&&(this.addSubHeader("Training Recommendations"),t.training_recommendations.forEach((e,i)=>{this.addText(`${i+1}. ${e.program}: ${e.duration} months, ${e.cost}`)}))}addMethodologySection(t){this.addSectionHeader("Methodology"),this.addSubHeader("Simulation Parameters"),this.addText(`Target Unemployment Rate: ${t.targets.unemployment_rate}%`),this.addText(`Target AI Adoption: ${t.targets.ai_adoption_rate}%`),this.addText(`Automation Pace: ${t.targets.automation_pace}`),this.addText(`Adoption Curve: ${t.ai_parameters.adoption_curve.replace("_","-")}`),this.currentY+=15,this.addSubHeader("Model Description"),this.addParagraph("This simulation uses a multi-factor economic model that projects labor market outcomes based on AI adoption trajectories, sector-specific automation exposure rates, historical employment patterns, and policy intervention effects."),this.currentY+=10,this.addParagraph("Key model components include:"),[" Sector-specific automation exposure coefficients derived from occupational task analysis"," AI adoption curves (linear, exponential, or S-curve) based on technology diffusion research"," Labor market dynamics including job displacement, creation, and wage effects"," Policy intervention models with fiscal cost and effectiveness estimates"].forEach(i=>this.addText(i)),this.currentY+=15,this.addSubHeader("Limitations"),this.addParagraph("This simulation provides projections based on model assumptions and historical patterns. Actual outcomes may vary due to unforeseen technological developments, policy changes, economic shocks, or other factors not captured in the model.")}addSectionHeader(t){this.checkPageBreak(40),this.doc.setFontSize(18),this.doc.setFont("helvetica","bold"),this.doc.text(t,this.margin,this.currentY),this.currentY+=25,this.doc.setFontSize(11),this.doc.setFont("helvetica","normal")}addSubHeader(t){this.checkPageBreak(25),this.doc.setFontSize(13),this.doc.setFont("helvetica","bold"),this.doc.text(t,this.margin,this.currentY),this.currentY+=18,this.doc.setFontSize(11),this.doc.setFont("helvetica","normal")}addText(t){this.checkPageBreak(this.lineHeight),this.doc.text(t,this.margin,this.currentY),this.currentY+=this.lineHeight}addParagraph(t){const e=this.pageWidth-this.margin*2;this.doc.splitTextToSize(t,e).forEach(n=>{this.checkPageBreak(this.lineHeight),this.doc.text(n,this.margin,this.currentY),this.currentY+=this.lineHeight}),this.currentY+=5}checkPageBreak(t){this.currentY+t>this.pageHeight-this.margin&&this.addNewPage()}addNewPage(){this.doc.addPage(),this.currentY=this.margin;const t=this.doc.internal.getNumberOfPages();this.doc.setFontSize(9),this.doc.setTextColor(128),this.doc.text(`Page ${t}`,this.pageWidth-this.margin,this.pageHeight-20,{align:"right"}),this.doc.setTextColor(0),this.doc.setFontSize(11)}formatNumber(t){if(t==null)return"N/A";const e=parseFloat(t);return isNaN(e)?"N/A":Math.abs(e)>=1e9?(e/1e9).toFixed(1)+"B":Math.abs(e)>=1e6?(e/1e6).toFixed(1)+"M":Math.abs(e)>=1e3?(e/1e3).toFixed(1)+"K":e.toLocaleString()}}const su=new po;typeof window<"u"&&(window.PDFReportGenerator=po,window.pdfReportGenerator=su);class go{constructor(){this.parameters={unemployment_rate:{name:"Target Unemployment Rate",unit:"%",baseValue:10,range:{min:4,max:20,step:2},inputId:"targetUR"},ai_adoption:{name:"AI Adoption Rate",unit:"%",baseValue:70,range:{min:30,max:100,step:10},inputId:"aiAdoption"},target_year:{name:"Target Year",unit:"",baseValue:2029,range:{min:2026,max:2034,step:1},inputId:"targetYear"}},this.outcomes={final_unemployment:{name:"Final Unemployment Rate",unit:"%",extractor:t=>t.summary.labor_market_changes.unemployment_rate.final},net_job_impact:{name:"Net Job Impact",unit:"millions",extractor:t=>t.summary.ai_impact.net_impact/1e6},jobs_displaced:{name:"Jobs Displaced",unit:"millions",extractor:t=>t.summary.ai_impact.jobs_displaced/1e6},jobs_created:{name:"Jobs Created",unit:"millions",extractor:t=>t.summary.ai_impact.jobs_created/1e6},productivity_growth:{name:"Final Productivity Growth",unit:"%",extractor:t=>t.summary.economic_indicators.productivity_growth.final}},this.analysisResults=null}async runAnalysis(t,e,i,n=null){const s=this.parameters[t];if(!s)return null;const o=n||Object.keys(this.outcomes),r=[],l=[];for(let c=s.range.min;c<=s.range.max;c+=s.range.step)l.push(c);for(const c of l){const d={...i};switch(t){case"unemployment_rate":d.target_unemployment=c;break;case"ai_adoption":d.ai_adoption_rate=c;break;case"target_year":d.end_year=c;break}try{e.createScenario(d);const h=await e.runSimulation(),u={};o.forEach(m=>{const p=this.outcomes[m];p&&(u[m]=p.extractor(h))}),r.push({paramValue:c,outcomes:u})}catch(h){console.error(`Sensitivity analysis error at ${t}=${c}:`,h)}}return{parameter:s,parameterId:t,results:r,baseValue:s.baseValue}}calculateSensitivity(t){if(!t||t.results.length<2)return null;const e={};return Object.keys(this.outcomes).forEach(i=>{const n=t.results.map(u=>u.outcomes[i]).filter(u=>u!==void 0);if(n.length<2)return;const s=Math.min(...n),o=Math.max(...n),r=o-s,l=n.reduce((u,m)=>u+m,0)/n.length,c=t.results.map(u=>u.paramValue),d=Math.max(...c)-Math.min(...c),h=d>0?r/l/(d/t.parameter.baseValue):0;e[i]={name:this.outcomes[i].name,unit:this.outcomes[i].unit,min:s,max:o,range:r,mean:l,elasticity:Math.abs(h),sensitivity:this.getSensitivityLevel(Math.abs(h))}}),e}getSensitivityLevel(t){return t>=1.5?{level:"high",color:"var(--danger)",label:"High"}:t>=.5?{level:"medium",color:"var(--warning)",label:"Medium"}:{level:"low",color:"var(--secondary)",label:"Low"}}generateTornadoData(t){const e=[];return Object.entries(t).forEach(([i,n])=>{if(!n||!n.results.length)return;const s=this.parameters[i],o=n.results.map(c=>c.outcomes.final_unemployment),r=Math.min(...o),l=Math.max(...o);e.push({parameter:s.name,low:r,high:l,range:l-r})}),e.sort((i,n)=>n.range-i.range),e}generateAnalysisHTML(t){if(!t||!t.results.length)return'<p style="color: var(--gray-500);">No analysis results available.</p>';const e=this.calculateSensitivity(t),i=t.parameter;return`
            <div class="sensitivity-analysis">
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>Sensitivity to ${i.name}</h3>
                    </div>
                    <p style="color: var(--gray-600); margin-bottom: 16px;">
                        Analysis of how changes in ${i.name} (${i.range.min}${i.unit} to ${i.range.max}${i.unit})
                        affect simulation outcomes.
                    </p>

                    <!-- Sensitivity Metrics Table -->
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Outcome</th>
                                <th>Min</th>
                                <th>Max</th>
                                <th>Range</th>
                                <th>Sensitivity</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(e).map(([n,s])=>`
                                <tr>
                                    <td><strong>${s.name}</strong></td>
                                    <td>${s.min.toFixed(2)}${s.unit==="%"?"%":s.unit==="millions"?"M":""}</td>
                                    <td>${s.max.toFixed(2)}${s.unit==="%"?"%":s.unit==="millions"?"M":""}</td>
                                    <td>${s.range.toFixed(2)}${s.unit==="%"?"%":s.unit==="millions"?"M":""}</td>
                                    <td>
                                        <span class="tag" style="background: ${s.sensitivity.color}20; color: ${s.sensitivity.color};">
                                            ${s.sensitivity.label}
                                        </span>
                                    </td>
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>

                <!-- Parameter Values vs Outcomes -->
                <div class="card">
                    <div class="card-header">
                        <h3>${i.name} Impact Table</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>${i.name}</th>
                                ${Object.keys(this.outcomes).map(n=>`<th>${this.outcomes[n].name}</th>`).join("")}
                            </tr>
                        </thead>
                        <tbody>
                            ${t.results.map(n=>`
                                <tr ${n.paramValue===i.baseValue?'style="background: var(--primary); color: white;"':""}>
                                    <td><strong>${n.paramValue}${i.unit}</strong></td>
                                    ${Object.keys(this.outcomes).map(s=>{const o=n.outcomes[s],r=this.outcomes[s].unit;return`<td>${o!==void 0?o.toFixed(2):"N/A"}${r==="%"?"%":r==="millions"?"M":""}</td>`}).join("")}
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>
            </div>
        `}generateOverviewHTML(){return`
            <div class="sensitivity-overview">
                <div class="card" style="margin-bottom: 24px;">
                    <div class="card-header">
                        <h3>Sensitivity Analysis</h3>
                    </div>
                    <p style="color: var(--gray-600); margin-bottom: 24px;">
                        Analyze how changes in key input parameters affect simulation outcomes.
                        Select a parameter to see how sensitive the results are to changes in that variable.
                    </p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                        ${Object.entries(this.parameters).map(([t,e])=>`
                            <div class="sensitivity-param-card" style="
                                background: var(--gray-50);
                                border: 1px solid var(--gray-200);
                                border-radius: 8px;
                                padding: 16px;
                                cursor: pointer;
                                transition: all 0.2s;
                            " onclick="runParameterSensitivity('${t}')"
                               onmouseover="this.style.borderColor='var(--primary)'; this.style.boxShadow='var(--shadow)';"
                               onmouseout="this.style.borderColor='var(--gray-200)'; this.style.boxShadow='none';">
                                <h4 style="margin-bottom: 8px; color: var(--gray-800);">${e.name}</h4>
                                <p style="font-size: 0.875rem; color: var(--gray-500); margin-bottom: 12px;">
                                    Test range: ${e.range.min}${e.unit} to ${e.range.max}${e.unit}
                                </p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.75rem; color: var(--gray-400);">
                                        Base: ${e.baseValue}${e.unit}
                                    </span>
                                    <span class="tag tag-medium">Analyze</span>
                                </div>
                            </div>
                        `).join("")}
                    </div>
                </div>

                <div id="sensitivity-results">
                    <div class="card" style="text-align: center; padding: 40px; color: var(--gray-500);">
                        <p>Select a parameter above to run sensitivity analysis.</p>
                        <p style="font-size: 0.875rem; margin-top: 8px;">
                            Analysis will show how outcomes change as the parameter varies.
                        </p>
                    </div>
                </div>
            </div>
        `}}const ou=new go;typeof window<"u"&&(window.SensitivityAnalysis=go,window.sensitivityAnalysis=ou);class ru{constructor(t){this.engine=t,this.iterations=1e3,this.results=null,this.isRunning=!1,this.progress=0}configure(t={}){this.iterations=t.iterations||1e3,this.parameterRanges={ai_adoption_variance:t.ai_adoption_variance||15,productivity_variance:t.productivity_variance||1.5,job_multiplier_variance:t.job_multiplier_variance||.15,displacement_lag_variance:t.displacement_lag_variance||3,gdp_variance:t.gdp_variance||1,elasticity_variance:t.elasticity_variance||.2}}async run(t,e=null){this.isRunning=!0,this.progress=0;const i=[],n={...this.engine.currentScenario};try{for(let s=0;s<this.iterations;s++){const o=this.randomizeScenario(t);this.engine.createScenario(o);const r=await this.engine.runSimulation();i.push(this.extractKeyMetrics(r)),this.progress=(s+1)/this.iterations*100,e&&s%50===0&&e(this.progress)}return this.engine.currentScenario=n,this.results=this.analyzeDistributions(i),this.isRunning=!1,this.results}catch(s){throw this.isRunning=!1,this.engine.currentScenario=n,s}}randomizeScenario(t){const e=JSON.parse(JSON.stringify(t)),i=this.parameterRanges;return e.ai_adoption_rate=this.randomize(e.ai_adoption_rate||50,i.ai_adoption_variance),e.productivity_growth=this.randomize(e.productivity_growth||3,i.productivity_variance),e.new_job_multiplier=Math.max(.1,this.randomize(e.new_job_multiplier||.3,i.job_multiplier_variance)),e.displacement_lag=Math.max(1,Math.round(this.randomize(e.displacement_lag||6,i.displacement_lag_variance))),e.gdp_growth=this.randomize(e.gdp_growth||2,i.gdp_variance),e.labor_elasticity=this.randomize(e.labor_elasticity||-.5,i.elasticity_variance),e}randomize(t,e){const i=Math.random(),n=Math.random(),s=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*n);return t+s*(e/2)}extractKeyMetrics(t){const e=t.summary,i=t.results[t.results.length-1],n=this.getYearlySnapshots(t.results);return{final_unemployment:parseFloat(e.labor_market_changes.unemployment_rate.final),final_employment:i.labor_market.total_employment,cumulative_displacement:e.ai_impact.cumulative_displacement,cumulative_new_jobs:e.ai_impact.cumulative_new_jobs,net_job_change:e.ai_impact.net_impact,final_ai_adoption:i.ai_adoption,final_productivity:i.productivity.growth_rate,final_wage_growth:parseFloat(e.wages.average_hourly.change_percent),yearly:n}}getYearlySnapshots(t){const e={};return t.forEach(i=>{const n=Math.floor(i.year);(!e[n]||i.year===n)&&(e[n]={unemployment:i.labor_market.unemployment_rate,employment:i.labor_market.total_employment,ai_adoption:i.ai_adoption,productivity:i.productivity.growth_rate})}),e}analyzeDistributions(t){const e=["final_unemployment","final_employment","cumulative_displacement","cumulative_new_jobs","net_job_change","final_ai_adoption","final_productivity","final_wage_growth"],i={};e.forEach(o=>{const r=t.map(l=>l[o]).filter(l=>!isNaN(l)).sort((l,c)=>l-c);i[o]=this.calculateDistributionStats(r)});const n=Object.keys(t[0].yearly).map(Number).sort((o,r)=>o-r),s={};return n.forEach(o=>{const r=["unemployment","employment","ai_adoption","productivity"];s[o]={},r.forEach(l=>{const c=t.map(d=>{var h;return(h=d.yearly[o])==null?void 0:h[l]}).filter(d=>d!==void 0&&!isNaN(d)).sort((d,h)=>d-h);s[o][l]=this.calculateDistributionStats(c)})}),{iterations:this.iterations,distributions:i,yearlyDistributions:s,rawResults:t}}calculateDistributionStats(t){if(t.length===0)return null;const e=t.length,i=t.reduce((o,r)=>o+r,0)/e,n=t.reduce((o,r)=>o+Math.pow(r-i,2),0)/e,s=Math.sqrt(n);return{min:t[0],max:t[e-1],mean:i,median:this.percentile(t,50),stdDev:s,p5:this.percentile(t,5),p10:this.percentile(t,10),p25:this.percentile(t,25),p75:this.percentile(t,75),p90:this.percentile(t,90),p95:this.percentile(t,95),histogram:this.createHistogram(t,20)}}percentile(t,e){const i=e/100*(t.length-1),n=Math.floor(i),s=Math.ceil(i),o=i-n;return n===s?t[n]:t[n]*(1-o)+t[s]*o}createHistogram(t,e){const i=t[0],s=(t[t.length-1]-i)/e,o=[];for(let r=0;r<e;r++){const l=i+r*s,c=i+(r+1)*s,d=t.filter(h=>h>=l&&(r===e-1?h<=c:h<c)).length;o.push({binStart:l,binEnd:c,binMid:(l+c)/2,count:d,frequency:d/t.length})}return o}getProbability(t,e,i="less"){if(!this.results||!this.results.distributions[t])return null;const s=this.results.rawResults.map(r=>r[t]).filter(r=>!isNaN(r));let o;return i==="less"?o=s.filter(r=>r<e).length:i==="greater"?o=s.filter(r=>r>e).length:o=s.filter(r=>r===e).length,o/s.length}generateReport(){if(!this.results)return null;const t=this.results.distributions;return{iterations:this.iterations,unemployment:{mostLikely:t.final_unemployment.median,range:`${t.final_unemployment.p10.toFixed(1)}% - ${t.final_unemployment.p90.toFixed(1)}%`,confidence90:{low:t.final_unemployment.p5,high:t.final_unemployment.p95},probability_above_10:this.getProbability("final_unemployment",10,"greater")},displacement:{mostLikely:t.cumulative_displacement.median,range:`${(t.cumulative_displacement.p10/1e6).toFixed(1)}M - ${(t.cumulative_displacement.p90/1e6).toFixed(1)}M`,confidence90:{low:t.cumulative_displacement.p5,high:t.cumulative_displacement.p95}},netJobChange:{mostLikely:t.net_job_change.median,range:`${(t.net_job_change.p10/1e6).toFixed(1)}M - ${(t.net_job_change.p90/1e6).toFixed(1)}M`,probability_positive:this.getProbability("net_job_change",0,"greater")}}}}typeof window<"u"&&(window.MonteCarloSimulation=ru);class fo{constructor(){this.assumptions={adultPopulation:258e6,averageWage:59428,workingPopulation:16e7,avgHoursPerWeek:38.6,taxRevenueMultiplier:.25,gdp:255e11}}calculateAllCosts(t,e){var r;const i={interventions:[],totalCost:0,totalRevenue:0,netCost:0,totalJobsSaved:0,costPerJobSaved:0};if(!t||t.length===0)return i;const s=((r=((e==null?void 0:e.summary)||{}).ai_impact)==null?void 0:r.cumulative_displacement)||0,o=this.getYearsSimulated(e);return t.forEach(l=>{const c=this.calculateInterventionCost(l,s,o);i.interventions.push(c),i.totalCost+=c.annualCost*o,i.totalRevenue+=c.annualRevenue*o,i.totalJobsSaved+=c.estimatedJobsSaved}),i.netCost=i.totalCost-i.totalRevenue,i.costPerJobSaved=i.totalJobsSaved>0?i.netCost/i.totalJobsSaved:0,i}calculateInterventionCost(t,e,i){const n=t.type,s=t.parameters||{};let o=0,r=0,l=0,c="";switch(n){case"ubi":const h=this.calculateUBICost(s,e);o=h.cost,l=h.jobsSaved,c=h.description;break;case"job_retraining":const u=this.calculateRetrainingCost(s,e,i);o=u.cost,l=u.jobsSaved,c=u.description;break;case"wage_subsidy":const m=this.calculateWageSubsidyCost(s,e);o=m.cost,l=m.jobsSaved,c=m.description;break;case"reduced_workweek":const p=this.calculateReducedWorkweekCost(s);o=p.cost,l=p.jobsSaved,c=p.description;break;case"robot_tax":const g=this.calculateRobotTaxRevenue(s,e);r=g.revenue,l=g.jobsSaved,c=g.description;break;case"education_subsidy":const f=this.calculateEducationSubsidyCost(s);o=f.cost,l=f.jobsSaved,c=f.description;break;default:c="Cost model not available for this intervention"}const d=o>0&&l>0?l*this.assumptions.averageWage/o:r>0?"Revenue generating":0;return{name:t.name,type:n,annualCost:o,annualRevenue:r,netAnnualCost:o-r,estimatedJobsSaved:l,costPerJob:l>0?(o-r)/l:0,roi:d,description:c}}calculateUBICost(t,e){const i=t.monthly_amount||1e3,n=i*12,o=(t.phase_out_threshold||0)===0?this.assumptions.adultPopulation:this.assumptions.adultPopulation*.7,r=o*n,l=r*.15,c=e*15e3,d=r-l-c,h=Math.floor(r*.7/this.assumptions.averageWage*.1);return{cost:d,jobsSaved:h,description:`$${i}/month to ${this.formatNumber(o)} adults. Gross: $${this.formatNumber(r)}/yr`}}calculateRetrainingCost(t,e,i){const n=t.funding_per_worker||1e4,s=(t.success_rate||60)/100,o=Math.ceil(e/i),r=o*n,l=Math.floor(o*s);return{cost:r,jobsSaved:l,description:`$${this.formatNumber(n)} per worker, ${o.toLocaleString()} annual participants, ${Math.round(s*100)}% success rate`}}calculateWageSubsidyCost(t,e){const i=(t.subsidy_rate||25)/100,n=t.max_wage_covered||5e4,s=Math.floor(e*.8),o=Math.min(this.assumptions.averageWage,n)*i,r=s*o,l=Math.floor(s*.7);return{cost:r,jobsSaved:l,description:`${Math.round(i*100)}% subsidy on wages up to $${this.formatNumber(n)}, covering ${s.toLocaleString()} jobs`}}calculateReducedWorkweekCost(t){const e=t.target_hours||32,i=this.assumptions.avgHoursPerWeek,n=(i-e)/i,s=t.wage_adjustment||"partial_subsidy";let o=0;switch(s){case"full_wage":o=n*.5;break;case"partial_subsidy":o=n*.25;break;case"proportional":o=0;break}const r=this.assumptions.workingPopulation*this.assumptions.averageWage*o,l=Math.floor(this.assumptions.workingPopulation*n*.6);return{cost:r,jobsSaved:l,description:`${e}hr week (from ${i}hrs), ${s.replace("_"," ")} approach`}}calculateRobotTaxRevenue(t,e){const i=(t.tax_rate||5)/100,n=this.assumptions.averageWage*1.3,o=e*n*i,r=i*.1,l=Math.floor(e*r);return{revenue:o,jobsSaved:l,description:`${Math.round(i*100)}% tax on automation savings, generating $${this.formatNumber(o)}/yr in revenue`}}calculateEducationSubsidyCost(t){const e=t.funding_increase||20,n=8e11*(e/100),o=4e6*.05;return{cost:n,jobsSaved:Math.floor(o),description:`${e}% increase in education funding, improving outcomes for ${this.formatNumber(o)} graduates annually`}}getYearsSimulated(t){var n;if(!((n=t==null?void 0:t.scenario)!=null&&n.timeframe))return 5;const{start_year:e,end_year:i}=t.scenario.timeframe;return i-e}formatNumber(t){return t>=1e12?"$"+(t/1e12).toFixed(1)+"T":t>=1e9?"$"+(t/1e9).toFixed(1)+"B":t>=1e6?"$"+(t/1e6).toFixed(1)+"M":t>=1e3?"$"+(t/1e3).toFixed(1)+"K":"$"+t.toFixed(0)}generateSummaryHTML(t){if(!t||t.interventions.length===0)return`
                <div style="text-align: center; padding: 24px; color: var(--gray-500);">
                    <p>No interventions active. Add interventions to see cost analysis.</p>
                </div>
            `;const e=t.interventions.map(i=>`
            <tr>
                <td><strong>${i.name}</strong></td>
                <td style="text-align: right;">${i.annualCost>0?this.formatNumber(i.annualCost):"-"}</td>
                <td style="text-align: right; color: var(--secondary);">${i.annualRevenue>0?this.formatNumber(i.annualRevenue):"-"}</td>
                <td style="text-align: right;">${i.estimatedJobsSaved.toLocaleString()}</td>
                <td style="text-align: right;">${i.costPerJob>0?this.formatNumber(i.costPerJob):"N/A"}</td>
                <td style="text-align: right;">${typeof i.roi=="number"?i.roi.toFixed(2)+"x":i.roi}</td>
            </tr>
        `).join("");return`
            <div style="margin-bottom: 24px;">
                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Total Cost</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--danger);">${this.formatNumber(t.totalCost)}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Tax Revenue</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--secondary);">${this.formatNumber(t.totalRevenue)}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Net Cost</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--gray-900);">${this.formatNumber(t.netCost)}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Jobs Saved</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">${t.totalJobsSaved.toLocaleString()}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Cost Per Job</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--warning);">${this.formatNumber(t.costPerJobSaved)}</div>
                    </div>
                </div>

                <!-- Detailed Table -->
                <table class="data-table" style="font-size: 0.875rem;">
                    <thead>
                        <tr>
                            <th>Intervention</th>
                            <th style="text-align: right;">Annual Cost</th>
                            <th style="text-align: right;">Revenue</th>
                            <th style="text-align: right;">Jobs Saved</th>
                            <th style="text-align: right;">Cost/Job</th>
                            <th style="text-align: right;">ROI</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${e}
                    </tbody>
                </table>

                <p style="font-size: 0.75rem; color: var(--gray-400); margin-top: 12px;">
                    * Costs are estimates based on economic models. Actual costs depend on implementation details.
                    ROI = (Jobs Saved  Avg Wage) / Net Cost. Values >1 indicate positive economic return.
                </p>
            </div>
        `}}const lu=new fo;typeof window<"u"&&(window.InterventionCostCalculator=fo,window.interventionCostCalculator=lu);class yo{constructor(){this.isPlaying=!1,this.currentYearIndex=0,this.playbackSpeed=1e3,this.playbackInterval=null,this.simulationData=null,this.years=[],this.onYearChange=null,this.onPlayStateChange=null}initialize(t){const e=(t==null?void 0:t.results)||(t==null?void 0:t.timeline);return!e||e.length===0?(console.warn("No timeline data available"),!1):(this.simulationData={...t,timeline:e},this.years=e.map(i=>i.year),this.currentYearIndex=0,this.isPlaying=!1,!0)}getCurrentYearData(){return!this.simulationData||!this.simulationData.timeline?null:this.simulationData.timeline[this.currentYearIndex]}getYearData(t){return!this.simulationData||!this.simulationData.timeline?null:this.simulationData.timeline[Math.min(t,this.simulationData.timeline.length-1)]}getAllData(){var t;return((t=this.simulationData)==null?void 0:t.timeline)||[]}play(){this.isPlaying||(this.isPlaying=!0,this.onPlayStateChange&&this.onPlayStateChange(!0),this.playbackInterval=setInterval(()=>{this.currentYearIndex<this.years.length-1?(this.currentYearIndex++,this.emitYearChange()):(this.pause(),this.currentYearIndex=0,this.emitYearChange())},this.playbackSpeed))}pause(){this.isPlaying=!1,this.playbackInterval&&(clearInterval(this.playbackInterval),this.playbackInterval=null),this.onPlayStateChange&&this.onPlayStateChange(!1)}toggle(){this.isPlaying?this.pause():this.play()}seekTo(t){this.pause(),this.currentYearIndex=Math.max(0,Math.min(t,this.years.length-1)),this.emitYearChange()}seekToYear(t){const e=this.years.indexOf(t);e!==-1&&this.seekTo(e)}stepForward(){this.pause(),this.currentYearIndex<this.years.length-1&&(this.currentYearIndex++,this.emitYearChange())}stepBackward(){this.pause(),this.currentYearIndex>0&&(this.currentYearIndex--,this.emitYearChange())}goToStart(){this.pause(),this.currentYearIndex=0,this.emitYearChange()}goToEnd(){this.pause(),this.currentYearIndex=this.years.length-1,this.emitYearChange()}setSpeed(t){this.playbackSpeed=t,this.isPlaying&&(this.pause(),this.play())}emitYearChange(){this.onYearChange&&this.onYearChange(this.currentYearIndex,this.getCurrentYearData())}getProgress(){return this.years.length<=1?100:this.currentYearIndex/(this.years.length-1)*100}destroy(){this.pause(),this.simulationData=null,this.years=[],this.onYearChange=null,this.onPlayStateChange=null}}class _o{constructor(t,e){this.container=document.getElementById(t),this.player=e,this.animatedMetrics={},this.charts={},this.metricConfigs=[{key:"unemployment_rate",label:"Unemployment Rate",unit:"%",color:"#ef4444",colorLight:"rgba(239, 68, 68, 0.2)",decimals:1,extract:i=>{var n;return this.getNumber(((n=i.labor_market)==null?void 0:n.unemployment_rate)??i.unemployment_rate??0)}},{key:"ai_adoption",label:"AI Adoption",unit:"%",color:"#10b981",colorLight:"rgba(16, 185, 129, 0.2)",decimals:0,extract:i=>{const n=i.ai_adoption;return(typeof n=="object"?this.getNumber(n==null?void 0:n.rate):this.getNumber(n))*100}},{key:"productivity",label:"Productivity Growth",unit:"%",color:"#6366f1",colorLight:"rgba(99, 102, 241, 0.2)",decimals:1,extract:i=>{const n=i.productivity;return typeof n=="object"?this.getNumber(n==null?void 0:n.growth_rate):this.getNumber(n)}},{key:"employment",label:"Total Employment",unit:"M",color:"#3b82f6",colorLight:"rgba(59, 130, 246, 0.2)",decimals:1,extract:i=>{var n,s;return this.getNumber(((n=i.labor_market)==null?void 0:n.total_employment)??((s=i.labor_market)==null?void 0:s.employment)??i.employment??0)/1e6},formatValue:i=>i.toFixed(1)+"M"}],this.player.onYearChange=(i,n)=>this.handleYearChange(i,n),this.player.onPlayStateChange=i=>this.handlePlayStateChange(i)}getNumber(t){return typeof t=="number"?t:typeof t=="object"&&t!==null?0:parseFloat(t)||0}formatYearAsDate(t){const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=Math.floor(t),n=(t-i)*12,s=Math.min(11,Math.floor(n));return`${e[s]} ${i}`}formatYearShort(t){const e=Math.floor(t),i=(t-e)*12,n=Math.min(11,Math.floor(i));return n===0?`${e}`:`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n]} '${String(e).slice(-2)}`}extractMetricSeries(){const t=this.player.getAllData(),e={};for(const i of this.metricConfigs)e[i.key]=t.map(n=>i.extract(n));return e}render(){if(!this.container){console.error("Timeline container not found");return}const t=this.player.years;if(console.log("Rendering timeline with years:",t.length>0?`${t[0]} to ${t[t.length-1]}`:"empty"),t.length===0){this.container.innerHTML='<p style="text-align: center; color: var(--gray-500);">Run a simulation to see the timeline player.</p>';return}const e=this.extractMetricSeries(),i=this.formatYearAsDate(t[0]),n=this.formatYearAsDate(t[t.length-1]);Math.max(1,Math.ceil(t.length/6)),this.container.innerHTML=`
            <div class="timeline-player">
                <!-- Playback Controls at Top -->
                <div class="timeline-controls-bar">
                    <div class="timeline-controls">
                        <button class="timeline-btn" onclick="timelinePlayer.goToStart()" title="Go to start"></button>
                        <button class="timeline-btn" onclick="timelinePlayer.stepBackward()" title="Previous"></button>
                        <button class="timeline-btn timeline-btn-play" id="timeline-play-btn" onclick="timelinePlayer.toggle()" title="Play/Pause">
                            <span id="timeline-play-icon"></span>
                        </button>
                        <button class="timeline-btn" onclick="timelinePlayer.stepForward()" title="Next"></button>
                        <button class="timeline-btn" onclick="timelinePlayer.goToEnd()" title="Go to end"></button>
                    </div>

                    <div class="timeline-speed-control">
                        <label>Speed:</label>
                        <select class="timeline-speed-select" id="timeline-speed" onchange="timelineUI.handleSpeedChange(this.value)" title="Playback speed">
                            <option value="2000">0.5x</option>
                            <option value="1000" selected>1x</option>
                            <option value="500">2x</option>
                            <option value="250">4x</option>
                        </select>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="timeline-charts-grid">
                    ${this.metricConfigs.map(s=>this.renderChartCard(s,e[s.key])).join("")}
                </div>

                <!-- Visual Timeline Scrubber -->
                <div class="timeline-scrubber">
                    <div class="timeline-track">
                        ${t.map((s,o)=>`
                            <div class="timeline-tick ${o===0?"active":""}"
                                 data-index="${o}"
                                 onclick="timelineUI.handleTickClick(${o})"
                                 title="${this.formatYearAsDate(s)}">
                                <div class="timeline-tick-dot"></div>
                            </div>
                        `).join("")}
                        <div class="timeline-track-line"></div>
                        <div class="timeline-track-progress" id="timeline-track-progress"></div>
                    </div>
                    <div class="timeline-labels">
                        <span>${i}</span>
                        <span>${n}</span>
                    </div>
                </div>

                <!-- Current Date Display at Bottom -->
                <div class="timeline-date-display">
                    <span class="timeline-date-value" id="timeline-current-year">${i}</span>
                </div>
            </div>
        `,requestAnimationFrame(()=>this.initializeCharts(e))}renderChartCard(t,e){const i=e[0],n=t.formatValue||(s=>s.toFixed(t.decimals)+t.unit);return`
            <div class="timeline-chart-card" data-metric="${t.key}">
                <div class="timeline-chart-header">
                    <span class="timeline-chart-label">${t.label}</span>
                    <span class="timeline-chart-value" id="chart-value-${t.key}" style="color: ${t.color}">
                        ${n(i)}
                    </span>
                </div>
                <div class="timeline-chart-container">
                    <canvas id="chart-${t.key}" class="timeline-chart-canvas"></canvas>
                </div>
            </div>
        `}initializeCharts(t){for(const e of this.metricConfigs){const i=document.getElementById(`chart-${e.key}`);if(!i)continue;const n=i.getContext("2d"),s=t[e.key],o=i.parentElement.getBoundingClientRect();i.width=o.width*window.devicePixelRatio,i.height=o.height*window.devicePixelRatio,i.style.width=o.width+"px",i.style.height=o.height+"px",n.scale(window.devicePixelRatio,window.devicePixelRatio),this.charts[e.key]={canvas:i,ctx:n,data:s,config:e,width:o.width,height:o.height},this.drawChart(e.key,0)}}drawChart(t,e){const i=this.charts[t];if(!i)return;const{ctx:n,data:s,config:o,width:r,height:l}=i,c={top:10,right:10,bottom:10,left:10},d=r-c.left-c.right,h=l-c.top-c.bottom;if(n.clearRect(0,0,r,l),s.length<2)return;const u=Math.min(...s),m=Math.max(...s),p=m-u||1,g=u-p*.1,f=m+p*.1,y=b=>c.left+b/(s.length-1)*d,_=b=>c.top+h-(b-g)/(f-g)*h;n.beginPath(),n.moveTo(y(0),_(s[0]));for(let b=1;b<=e;b++)n.lineTo(y(b),_(s[b]));n.lineTo(y(e),l-c.bottom),n.lineTo(y(0),l-c.bottom),n.closePath(),n.fillStyle=o.colorLight,n.fill(),n.beginPath(),n.moveTo(y(0),_(s[0]));for(let b=1;b<s.length;b++)n.lineTo(y(b),_(s[b]));n.strokeStyle="rgba(150, 150, 150, 0.3)",n.lineWidth=1,n.stroke(),n.beginPath(),n.moveTo(y(0),_(s[0]));for(let b=1;b<=e;b++)n.lineTo(y(b),_(s[b]));n.strokeStyle=o.color,n.lineWidth=2,n.stroke(),n.beginPath(),n.arc(y(e),_(s[e]),5,0,Math.PI*2),n.fillStyle=o.color,n.fill(),n.strokeStyle="#fff",n.lineWidth=2,n.stroke(),n.beginPath(),n.moveTo(y(e),c.top),n.lineTo(y(e),l-c.bottom),n.strokeStyle="rgba(150, 150, 150, 0.2)",n.lineWidth=1,n.setLineDash([4,4]),n.stroke(),n.setLineDash([])}handleYearChange(t,e){const i=document.getElementById("timeline-current-year");i&&(i.textContent=this.formatYearAsDate(this.player.years[t]),i.classList.add("timeline-year-animate"),setTimeout(()=>i.classList.remove("timeline-year-animate"),300)),document.querySelectorAll(".timeline-tick").forEach((o,r)=>{o.classList.toggle("active",r<=t),o.classList.toggle("current",r===t)});const s=document.getElementById("timeline-track-progress");if(s){const o=this.player.years.length>1?t/(this.player.years.length-1)*100:0;s.style.width=o+"%"}for(const o of this.metricConfigs){this.drawChart(o.key,t);const r=document.getElementById(`chart-value-${o.key}`);if(r&&e){const l=o.extract(e),c=o.formatValue||(d=>d.toFixed(o.decimals)+o.unit);this.animateValue(r,l,c)}}}animateValue(t,e,i){const n=t.id,s=this.animatedMetrics[n]??e;this.animatedMetrics[n]=e;const o=300,r=performance.now(),l=c=>{const d=c-r,h=Math.min(d/o,1),u=1-Math.pow(1-h,3),m=s+(e-s)*u;t.textContent=i(m),h<1&&requestAnimationFrame(l)};requestAnimationFrame(l)}handlePlayStateChange(t){const e=document.getElementById("timeline-play-icon"),i=document.getElementById("timeline-play-btn");e&&(e.textContent=t?"":""),i&&i.classList.toggle("playing",t)}handleTickClick(t){this.player.seekTo(t)}handleSliderChange(t){this.player.seekTo(parseInt(t))}handleSpeedChange(t){this.player.setSpeed(parseInt(t))}}const Ni=new yo;let Va=null;function bo(a){console.log("Initializing timeline player...");const t=document.getElementById("timeline-player-container");return t?Ni.initialize(a)?(console.log("Timeline player initialized with",Ni.years.length,"data points"),Va=new _o("timeline-player-container",Ni),Va.render(),console.log("Timeline UI rendered"),!0):(console.warn("Failed to initialize timeline player - no data"),t.innerHTML='<p style="text-align: center; color: var(--gray-500); padding: 20px;">No timeline data available.</p>',!1):(console.warn("Timeline container not found, retrying..."),setTimeout(()=>bo(a),100),!1)}typeof window<"u"&&(window.TimelinePlayer=yo,window.TimelineUI=_o,window.initializeTimeline=bo);class vo{constructor(){this.statePositions={WA:{x:6,y:2,w:3,h:2},OR:{x:6,y:4,w:3,h:2},CA:{x:5,y:6,w:2,h:4},NV:{x:7,y:6,w:2,h:2},ID:{x:9,y:3,w:2,h:3},MT:{x:11,y:2,w:4,h:2},WY:{x:12,y:4,w:3,h:2},UT:{x:9,y:6,w:2,h:2},CO:{x:12,y:6,w:3,h:2},AZ:{x:9,y:8,w:2,h:2},NM:{x:11,y:8,w:2,h:2},ND:{x:15,y:2,w:3,h:1.5},SD:{x:15,y:3.5,w:3,h:1.5},NE:{x:15,y:5,w:3,h:1.5},KS:{x:15,y:6.5,w:3,h:1.5},OK:{x:15,y:8,w:3,h:1.5},TX:{x:14,y:9.5,w:4,h:3},MN:{x:18,y:2,w:2,h:2},IA:{x:18,y:4,w:2,h:1.5},MO:{x:18,y:5.5,w:2,h:2},AR:{x:18,y:7.5,w:2,h:1.5},LA:{x:18,y:9,w:2,h:1.5},WI:{x:20,y:2,w:2,h:2},IL:{x:20,y:4,w:2,h:2.5},IN:{x:22,y:4,w:1.5,h:2},MI:{x:22,y:2,w:2,h:2},OH:{x:23.5,y:4,w:2,h:2},KY:{x:22,y:6,w:3,h:1.5},TN:{x:21,y:7.5,w:4,h:1.5},MS:{x:20,y:9,w:1.5,h:2},AL:{x:21.5,y:9,w:1.5,h:2},GA:{x:23,y:9,w:2,h:2},FL:{x:24,y:11,w:2,h:2},SC:{x:25,y:8,w:2,h:1.5},NC:{x:25,y:6.5,w:3,h:1.5},VA:{x:26,y:5,w:2.5,h:1.5},WV:{x:25,y:5,w:1,h:1.5},PA:{x:26,y:3.5,w:2.5,h:1.5},NY:{x:27,y:2,w:2,h:1.5},VT:{x:29,y:1,w:1,h:1},NH:{x:30,y:1.5,w:.8,h:1},ME:{x:30.8,y:.5,w:1.2,h:2},MA:{x:29.5,y:2.5,w:1.5,h:.8},RI:{x:30,y:3.3,w:.8,h:.5},CT:{x:29,y:3.3,w:1,h:.7},NJ:{x:28.5,y:4,w:.8,h:1},DE:{x:28.5,y:5,w:.5,h:.7},MD:{x:27.5,y:5,w:1,h:.8},AK:{x:1,y:10,w:3,h:2},HI:{x:4,y:12,w:2,h:1}},this.colorScales={unemployment:{stops:[{value:3,color:"#10b981"},{value:5,color:"#84cc16"},{value:7,color:"#fbbf24"},{value:9,color:"#f97316"},{value:12,color:"#ef4444"}]},displacement:{stops:[{value:0,color:"#10b981"},{value:.02,color:"#84cc16"},{value:.05,color:"#fbbf24"},{value:.08,color:"#f97316"},{value:.12,color:"#ef4444"}]},aiAdoption:{stops:[{value:.2,color:"#94a3b8"},{value:.4,color:"#60a5fa"},{value:.6,color:"#3b82f6"},{value:.8,color:"#2563eb"},{value:1,color:"#1d4ed8"}]},wageChange:{stops:[{value:-5,color:"#ef4444"},{value:-2,color:"#f97316"},{value:0,color:"#fbbf24"},{value:2,color:"#84cc16"},{value:5,color:"#10b981"}]}},this.selectedMetric="unemployment",this.regionalData=null}initialize(t){this.regionalData=this.extractRegionalData(t)}extractRegionalData(t){var i;const e={};if(t.regionalData)return t.regionalData;if(typeof US_REGIONS<"u"){const n=t.summary,s=((i=n.final)==null?void 0:i.unemploymentRate)||.05,o=(n.totalLayoffs||0)/15e7;US_REGIONS.forEach(r=>{let l=1,c=1,d=.3,h=0;r.techHub&&(l=.8,c=.7,d=.6,h=2),r.costOfLiving>1.2&&(l*=.9,h+=1),["MI","OH","IN","WI","PA"].includes(r.abbrev)&&(c=1.3,l=1.2,h-=1),r.population<2&&(l*=1.1,d*=.7);const m=()=>.9+Math.random()*.2;e[r.abbrev]={name:r.name,unemployment:(s*100*l*m()).toFixed(1),displacement:(o*c*m()).toFixed(3),aiAdoption:(d*m()).toFixed(2),wageChange:(h*m()).toFixed(1),population:r.population,techHub:r.techHub,costOfLiving:r.costOfLiving}})}return e}getColor(t,e){const i=this.colorScales[e];if(!i)return"#94a3b8";const n=i.stops;if(t<=n[0].value)return n[0].color;if(t>=n[n.length-1].value)return n[n.length-1].color;for(let s=0;s<n.length-1;s++)if(t>=n[s].value&&t<=n[s+1].value){const o=(t-n[s].value)/(n[s+1].value-n[s].value);return this.interpolateColor(n[s].color,n[s+1].color,o)}return"#94a3b8"}interpolateColor(t,e,i){const n=parseInt(t.slice(1,3),16),s=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16),r=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),c=parseInt(e.slice(5,7),16),d=Math.round(n+(r-n)*i),h=Math.round(s+(l-s)*i),u=Math.round(o+(c-o)*i);return`#${d.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}${u.toString(16).padStart(2,"0")}`}render(t,e="unemployment"){this.selectedMetric=e;const i=document.getElementById(t);if(!i||!this.regionalData)return;const n=20,s=35*n,o=15*n;let r=`
            <div style="margin-bottom: 16px;">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button class="heatmap-btn ${e==="unemployment"?"active":""}" onclick="regionalHeatMap.render('${t}', 'unemployment')">Unemployment</button>
                    <button class="heatmap-btn ${e==="displacement"?"active":""}" onclick="regionalHeatMap.render('${t}', 'displacement')">Displacement</button>
                    <button class="heatmap-btn ${e==="aiAdoption"?"active":""}" onclick="regionalHeatMap.render('${t}', 'aiAdoption')">AI Adoption</button>
                    <button class="heatmap-btn ${e==="wageChange"?"active":""}" onclick="regionalHeatMap.render('${t}', 'wageChange')">Wage Change</button>
                </div>
            </div>
            <style>
                .heatmap-btn {
                    padding: 8px 16px;
                    border: 1px solid var(--gray-300);
                    background: var(--gray-50);
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 0.875rem;
                    transition: all 0.2s;
                }
                .heatmap-btn:hover {
                    background: var(--gray-100);
                }
                .heatmap-btn.active {
                    background: var(--primary);
                    color: white;
                    border-color: var(--primary);
                }
                .state-rect {
                    cursor: pointer;
                    transition: all 0.2s;
                }
                .state-rect:hover {
                    filter: brightness(1.1);
                    stroke-width: 2;
                }
            </style>
            <div style="position: relative; overflow-x: auto;">
                <svg viewBox="0 0 ${s} ${o}" style="width: 100%; max-width: ${s}px; height: auto;">
        `;Object.entries(this.statePositions).forEach(([l,c])=>{const d=this.regionalData[l];if(!d)return;let h;switch(e){case"unemployment":h=parseFloat(d.unemployment);break;case"displacement":h=parseFloat(d.displacement);break;case"aiAdoption":h=parseFloat(d.aiAdoption);break;case"wageChange":h=parseFloat(d.wageChange);break}const u=this.getColor(h,e);r+=`
                <g class="state-group" data-state="${l}">
                    <rect
                        class="state-rect"
                        x="${c.x*n}"
                        y="${c.y*n}"
                        width="${c.w*n}"
                        height="${c.h*n}"
                        fill="${u}"
                        stroke="white"
                        stroke-width="1"
                        rx="3"
                        onclick="regionalHeatMap.showStateDetails('${l}')"
                    />
                    <text
                        x="${(c.x+c.w/2)*n}"
                        y="${(c.y+c.h/2+.15)*n}"
                        text-anchor="middle"
                        dominant-baseline="middle"
                        font-size="${Math.min(c.w,c.h)*n*.35}"
                        fill="white"
                        font-weight="600"
                        style="text-shadow: 0 1px 2px rgba(0,0,0,0.3); pointer-events: none;"
                    >${l}</text>
                </g>
            `}),r+="</svg></div>",r+=this.renderLegend(e),r+='<div id="stateDetailsPanel" style="display: none; margin-top: 16px;"></div>',i.innerHTML=r}renderLegend(t){const e=this.colorScales[t];if(!e)return"";const i={unemployment:"Unemployment Rate (%)",displacement:"Job Displacement Rate",aiAdoption:"AI Adoption Rate",wageChange:"Wage Change (%)"},n=o=>t==="displacement"||t==="aiAdoption"?(o*100).toFixed(0)+"%":o+"%";let s=`
            <div style="margin-top: 16px; padding: 12px; background: var(--gray-50); border-radius: 8px;">
                <div style="font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">${i[t]}</div>
                <div style="display: flex; align-items: center; gap: 4px;">
        `;return s+='<div style="flex: 1; height: 12px; border-radius: 6px; background: linear-gradient(to right',e.stops.forEach((o,r)=>{const l=r/(e.stops.length-1)*100;s+=`, ${o.color} ${l}%`}),s+=');"></div>',s+='</div><div style="display: flex; justify-content: space-between; margin-top: 4px; font-size: 0.75rem; color: var(--gray-500);">',e.stops.forEach(o=>{s+=`<span>${n(o.value)}</span>`}),s+="</div></div>",s}showStateDetails(t){const e=document.getElementById("stateDetailsPanel"),i=this.regionalData[t];!e||!i||(e.style.display="block",e.innerHTML=`
            <div style="padding: 16px; background: var(--gray-50); border-radius: 8px; border-left: 4px solid var(--primary);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                    <div>
                        <h4 style="margin: 0; color: var(--gray-800);">${i.name} (${t})</h4>
                        <div style="font-size: 0.875rem; color: var(--gray-500);">
                            Pop: ${i.population}M ${i.techHub?" Tech Hub":""}  COL: ${(i.costOfLiving*100).toFixed(0)}%
                        </div>
                    </div>
                    <button onclick="document.getElementById('stateDetailsPanel').style.display='none'" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; color: var(--gray-400);"></button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: ${parseFloat(i.unemployment)>7?"var(--danger)":"var(--gray-700)"};">${i.unemployment}%</div>
                        <div style="font-size: 0.75rem; color: var(--gray-500);">Unemployment</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--gray-700);">${(parseFloat(i.displacement)*100).toFixed(1)}%</div>
                        <div style="font-size: 0.75rem; color: var(--gray-500);">Displacement</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">${(parseFloat(i.aiAdoption)*100).toFixed(0)}%</div>
                        <div style="font-size: 0.75rem; color: var(--gray-500);">AI Adoption</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: white; border-radius: 8px;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: ${parseFloat(i.wageChange)>=0?"var(--secondary)":"var(--danger)"};">${i.wageChange>0?"+":""}${i.wageChange}%</div>
                        <div style="font-size: 0.75rem; color: var(--gray-500);">Wage Change</div>
                    </div>
                </div>
            </div>
        `)}getSummaryStats(){if(!this.regionalData)return null;const t=Object.values(this.regionalData),e=o=>t.reduce((r,l)=>r+parseFloat(l[o]),0)/t.length,i=o=>Math.max(...t.map(r=>parseFloat(r[o]))),n=o=>Math.min(...t.map(r=>parseFloat(r[o]))),s=(o,r)=>{var c;return(c=[...t].sort((d,h)=>r?parseFloat(h[o])-parseFloat(d[o]):parseFloat(d[o])-parseFloat(h[o]))[0])==null?void 0:c.name};return{unemployment:{avg:e("unemployment").toFixed(1),max:i("unemployment").toFixed(1),min:n("unemployment").toFixed(1),highest:s("unemployment",!0),lowest:s("unemployment",!1)},displacement:{avg:(e("displacement")*100).toFixed(1),max:(i("displacement")*100).toFixed(1),min:(n("displacement")*100).toFixed(1),highest:s("displacement",!0),lowest:s("displacement",!1)},aiAdoption:{avg:(e("aiAdoption")*100).toFixed(0),max:(i("aiAdoption")*100).toFixed(0),min:(n("aiAdoption")*100).toFixed(0),highest:s("aiAdoption",!0),lowest:s("aiAdoption",!1)},techHubCount:t.filter(o=>o.techHub).length,statesAboveNationalUR:t.filter(o=>parseFloat(o.unemployment)>e("unemployment")).length}}renderSummaryPanel(t){const e=document.getElementById(t),i=this.getSummaryStats();!e||!i||(e.innerHTML=`
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                <div style="padding: 16px; background: var(--gray-50); border-radius: 8px;">
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 12px;">Unemployment</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center;">
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--secondary);">${i.unemployment.min}%</div>
                            <div style="font-size: 0.65rem; color: var(--gray-500);">Lowest</div>
                        </div>
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--gray-600);">${i.unemployment.avg}%</div>
                            <div style="font-size: 0.65rem; color: var(--gray-500);">Average</div>
                        </div>
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--danger);">${i.unemployment.max}%</div>
                            <div style="font-size: 0.65rem; color: var(--gray-500);">Highest</div>
                        </div>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 8px;">
                        Best: ${i.unemployment.lowest}  Worst: ${i.unemployment.highest}
                    </div>
                </div>
                <div style="padding: 16px; background: var(--gray-50); border-radius: 8px;">
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 12px;">AI Adoption</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center;">
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--gray-400);">${i.aiAdoption.min}%</div>
                            <div style="font-size: 0.65rem; color: var(--gray-500);">Lowest</div>
                        </div>
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">${i.aiAdoption.avg}%</div>
                            <div style="font-size: 0.65rem; color: var(--gray-500);">Average</div>
                        </div>
                        <div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">${i.aiAdoption.max}%</div>
                            <div style="font-size: 0.65rem; color: var(--gray-500);">Highest</div>
                        </div>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 8px;">
                        ${i.techHubCount} tech hub states driving adoption
                    </div>
                </div>
                <div style="padding: 16px; background: var(--gray-50); border-radius: 8px;">
                    <div style="font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 12px;">Regional Disparity</div>
                    <div style="text-align: center; padding: 8px 0;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--warning);">${i.statesAboveNationalUR}</div>
                        <div style="font-size: 0.75rem; color: var(--gray-500);">states above national average</div>
                    </div>
                    <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 8px;">
                        UR range: ${i.unemployment.min}% - ${i.unemployment.max}%
                    </div>
                </div>
            </div>
        `)}}const cu=new vo;typeof window<"u"&&(window.RegionalHeatMap=vo,window.regionalHeatMap=cu);class xo{constructor(){this.demographicData={age_groups:{"16-24":{labor_force:195e5,avg_wage:16.5,sectors:{retail:.22,food_services:.18,healthcare:.08,technology:.05},education_distribution:{no_degree:.45,high_school:.35,bachelors:.15,advanced:.05},automation_vulnerability:.45},"25-34":{labor_force:358e5,avg_wage:28.5,sectors:{technology:.12,healthcare:.14,finance:.1,professional_services:.15},education_distribution:{no_degree:.12,high_school:.28,bachelors:.4,advanced:.2},automation_vulnerability:.32},"35-44":{labor_force:332e5,avg_wage:32.8,sectors:{technology:.1,healthcare:.15,finance:.12,manufacturing:.1},education_distribution:{no_degree:.1,high_school:.3,bachelors:.38,advanced:.22},automation_vulnerability:.3},"45-54":{labor_force:325e5,avg_wage:33.2,sectors:{healthcare:.16,manufacturing:.12,government:.1,education:.1},education_distribution:{no_degree:.12,high_school:.35,bachelors:.33,advanced:.2},automation_vulnerability:.35},"55-64":{labor_force:268e5,avg_wage:32.5,sectors:{healthcare:.18,government:.12,manufacturing:.1,retail:.08},education_distribution:{no_degree:.14,high_school:.38,bachelors:.3,advanced:.18},automation_vulnerability:.38},"65+":{labor_force:108e5,avg_wage:28,sectors:{healthcare:.15,retail:.12,professional_services:.1,education:.08},education_distribution:{no_degree:.18,high_school:.4,bachelors:.28,advanced:.14},automation_vulnerability:.3}},education_levels:{"No High School":{labor_force:82e5,avg_wage:14.5,unemployment_rate:8.5,automation_vulnerability:.65,primary_sectors:["agriculture","construction","food_services"]},"High School":{labor_force:355e5,avg_wage:20.5,unemployment_rate:5.8,automation_vulnerability:.52,primary_sectors:["retail","manufacturing","transportation"]},"Some College":{labor_force:328e5,avg_wage:24.8,unemployment_rate:4.5,automation_vulnerability:.42,primary_sectors:["healthcare","retail","administrative"]},"Bachelor's":{labor_force:485e5,avg_wage:35.5,unemployment_rate:3.2,automation_vulnerability:.28,primary_sectors:["technology","finance","professional_services"]},"Advanced Degree":{labor_force:265e5,avg_wage:48,unemployment_rate:2.1,automation_vulnerability:.18,primary_sectors:["healthcare","education","technology","legal"]}},gender:{Male:{labor_force:825e5,participation_rate:68.2,avg_wage:31.5,sector_concentration:{construction:.96,transportation:.78,manufacturing:.72,technology:.74,mining:.88},automation_vulnerability:.38},Female:{labor_force:75e6,participation_rate:57.4,avg_wage:27.8,sector_concentration:{healthcare:.77,education:.73,administrative:.65,retail:.52,food_services:.54},automation_vulnerability:.35}}},this.retrainingFactors={"16-24":{difficulty:.2,duration_multiplier:.8,success_rate:.85},"25-34":{difficulty:.3,duration_multiplier:1,success_rate:.8},"35-44":{difficulty:.4,duration_multiplier:1.2,success_rate:.7},"45-54":{difficulty:.5,duration_multiplier:1.4,success_rate:.55},"55-64":{difficulty:.6,duration_multiplier:1.6,success_rate:.4},"65+":{difficulty:.7,duration_multiplier:2,success_rate:.25}}}analyzeImpacts(t){const e=t.summary,i=e.ai_impact,n=e.sector_summary,s={by_age:this.analyzeByAge(i,n),by_education:this.analyzeByEducation(i,n),by_gender:this.analyzeByGender(i,n),most_vulnerable:[],recommendations:[],summary_stats:{}};return s.most_vulnerable=this.identifyMostVulnerable(s),s.recommendations=this.generateRecommendations(s),s.summary_stats=this.calculateSummaryStats(s),s}analyzeByAge(t,e){const i={},n=t.cumulative_displacement;for(const[s,o]of Object.entries(this.demographicData.age_groups)){const r=this.calculateSectorExposure(o.sectors,e),l=o.labor_force/158e6*o.automation_vulnerability*r,c=Math.round(n*l),d=(c/o.labor_force*100).toFixed(1);let h="Low";d>8?h="Critical":d>5?h="High":d>3&&(h="Moderate");const u=this.retrainingFactors[s];i[s]={labor_force:o.labor_force,estimated_displacement:c,displacement_rate:parseFloat(d),impact_level:h,avg_wage:o.avg_wage,wage_impact:this.estimateWageImpact(o.automation_vulnerability,h),retraining_success_rate:(u.success_rate*100).toFixed(0)+"%",retraining_difficulty:u.difficulty<.4?"Low":u.difficulty<.6?"Moderate":"High",key_risks:this.identifyAgeRisks(s,o)}}return i}analyzeByEducation(t,e){const i={},n=t.cumulative_displacement;for(const[s,o]of Object.entries(this.demographicData.education_levels)){const r=o.labor_force/1515e5*o.automation_vulnerability,l=Math.round(n*r*1.2),c=(l/o.labor_force*100).toFixed(1);let d="Low";c>10?d="Critical":c>6?d="High":c>3&&(d="Moderate"),i[s]={labor_force:o.labor_force,estimated_displacement:l,displacement_rate:parseFloat(c),impact_level:d,current_unemployment:o.unemployment_rate+"%",projected_unemployment:(o.unemployment_rate+parseFloat(c)*.4).toFixed(1)+"%",avg_wage:"$"+o.avg_wage.toFixed(2),primary_sectors:o.primary_sectors.join(", "),upskilling_priority:o.automation_vulnerability>.4?"High":o.automation_vulnerability>.25?"Medium":"Low"}}return i}analyzeByGender(t,e){var s,o;const i={},n=t.cumulative_displacement;for(const[r,l]of Object.entries(this.demographicData.gender)){let c=0,d=0;for(const[f,y]of Object.entries(l.sector_concentration)){const _=((s=e.most_affected)==null?void 0:s.find(b=>b.name===f))||((o=e.least_affected)==null?void 0:o.find(b=>b.name===f));_&&(c+=y*Math.abs(parseFloat(_.employment_change_percent)/100),d+=y)}const h=d>0?l.automation_vulnerability*(1+c/d):l.automation_vulnerability,u=l.labor_force/1575e5*h,m=Math.round(n*u),p=(m/l.labor_force*100).toFixed(1);let g="Low";p>7?g="High":p>4&&(g="Moderate"),i[r]={labor_force:l.labor_force,participation_rate:l.participation_rate+"%",estimated_displacement:m,displacement_rate:parseFloat(p),impact_level:g,avg_wage:"$"+l.avg_wage.toFixed(2),high_exposure_sectors:Object.entries(l.sector_concentration).filter(([f,y])=>y>.6).map(([f,y])=>f.replace(/_/g," ")).join(", ")}}return i}calculateSectorExposure(t,e){let i=1;const n=[...e.most_affected||[]];for(const[s,o]of Object.entries(t)){const r=n.find(l=>l.name===s);r&&(i+=o*Math.abs(parseFloat(r.employment_change_percent)/100))}return Math.min(2,i)}estimateWageImpact(t,e){return(t*-3*(e==="Critical"?1.5:e==="High"?1.2:e==="Moderate"?1:.8)).toFixed(1)+"%"}identifyAgeRisks(t,e){const i=[];return t==="16-24"?(i.push("Limited work experience"),i.push("High concentration in retail/food service")):(t==="55-64"||t==="65+")&&(i.push("Retraining challenges"),i.push("Potential early workforce exit")),e.automation_vulnerability>.4&&i.push("High automation exposure"),i}identifyMostVulnerable(t){const e=[];for(const[i,n]of Object.entries(t.by_age))(n.impact_level==="Critical"||n.impact_level==="High")&&e.push({type:"Age Group",group:i,impact_level:n.impact_level,displacement_rate:n.displacement_rate,estimated_affected:n.estimated_displacement});for(const[i,n]of Object.entries(t.by_education))(n.impact_level==="Critical"||n.impact_level==="High")&&e.push({type:"Education",group:i,impact_level:n.impact_level,displacement_rate:n.displacement_rate,estimated_affected:n.estimated_displacement});return e.sort((i,n)=>n.displacement_rate-i.displacement_rate)}generateRecommendations(t){const e=[],i=t.by_age["16-24"],n=t.by_age["55-64"];((i==null?void 0:i.impact_level)==="High"||(i==null?void 0:i.impact_level)==="Critical")&&e.push({target:"Young Workers (16-24)",priority:"High",actions:["Expand apprenticeship programs in growing sectors","Provide tech skills training in high schools","Create entry-level positions in AI-adjacent roles"]}),((n==null?void 0:n.impact_level)==="High"||(n==null?void 0:n.impact_level)==="Critical")&&e.push({target:"Older Workers (55-64)",priority:"High",actions:["Phased retirement programs with knowledge transfer","Age-appropriate retraining with extended timelines","Bridge employment in supervisory/consulting roles"]});const s=t.by_education["No High School"],o=t.by_education["High School"];return((s==null?void 0:s.impact_level)==="Critical"||(o==null?void 0:o.impact_level)==="High")&&e.push({target:"Workers without College Degree",priority:"Critical",actions:["Free community college for high-demand fields","Stackable credentials and micro-certifications","On-the-job training subsidies for employers","Basic digital literacy programs"]}),e.push({target:"All Workers",priority:"Medium",actions:["Portable benefits for gig and transitioning workers","Career counseling and job matching services","Income support during retraining periods"]}),e}calculateSummaryStats(t){var s;let e=0,i=0,n=0;for(const o of Object.values(t.by_age))e+=o.estimated_displacement,o.impact_level==="High"&&i++,o.impact_level==="Critical"&&n++;return{total_estimated_displacement:e,high_impact_demographic_groups:i,critical_impact_groups:n,most_vulnerable_segment:((s=t.most_vulnerable[0])==null?void 0:s.group)||"None identified",policy_recommendations_count:t.recommendations.length}}generateHTML(t){return t?`
            <div class="demographics-analysis">
                <!-- Summary Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">High Impact Groups</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--warning);">${t.summary_stats.high_impact_demographic_groups}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Critical Groups</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--danger);">${t.summary_stats.critical_impact_groups}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Most Vulnerable</div>
                        <div style="font-size: 1rem; font-weight: 700; color: var(--primary);">${t.summary_stats.most_vulnerable_segment}</div>
                    </div>
                </div>

                <!-- Age Group Impact -->
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">Impact by Age Group</h4>
                <div style="overflow-x: auto; margin-bottom: 24px;">
                    <table style="width: 100%; font-size: 0.875rem; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--gray-200);">
                                <th style="text-align: left; padding: 8px;">Age</th>
                                <th style="text-align: right; padding: 8px;">Displacement</th>
                                <th style="text-align: right; padding: 8px;">Rate</th>
                                <th style="text-align: center; padding: 8px;">Impact</th>
                                <th style="text-align: center; padding: 8px;">Retraining</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(t.by_age).map(([e,i])=>`
                                <tr style="border-bottom: 1px solid var(--gray-100);">
                                    <td style="padding: 8px; font-weight: 500;">${e}</td>
                                    <td style="padding: 8px; text-align: right;">${this.formatNumber(i.estimated_displacement)}</td>
                                    <td style="padding: 8px; text-align: right;">${i.displacement_rate}%</td>
                                    <td style="padding: 8px; text-align: center;">
                                        <span style="padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; background: ${this.getImpactColor(i.impact_level)}; color: white;">
                                            ${i.impact_level}
                                        </span>
                                    </td>
                                    <td style="padding: 8px; text-align: center; color: var(--gray-500);">${i.retraining_success_rate}</td>
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>

                <!-- Education Impact -->
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">Impact by Education Level</h4>
                <div style="overflow-x: auto; margin-bottom: 24px;">
                    <table style="width: 100%; font-size: 0.875rem; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--gray-200);">
                                <th style="text-align: left; padding: 8px;">Education</th>
                                <th style="text-align: right; padding: 8px;">Displacement</th>
                                <th style="text-align: right; padding: 8px;">Rate</th>
                                <th style="text-align: center; padding: 8px;">Impact</th>
                                <th style="text-align: center; padding: 8px;">Priority</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(t.by_education).map(([e,i])=>`
                                <tr style="border-bottom: 1px solid var(--gray-100);">
                                    <td style="padding: 8px; font-weight: 500;">${e}</td>
                                    <td style="padding: 8px; text-align: right;">${this.formatNumber(i.estimated_displacement)}</td>
                                    <td style="padding: 8px; text-align: right;">${i.displacement_rate}%</td>
                                    <td style="padding: 8px; text-align: center;">
                                        <span style="padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; background: ${this.getImpactColor(i.impact_level)}; color: white;">
                                            ${i.impact_level}
                                        </span>
                                    </td>
                                    <td style="padding: 8px; text-align: center;">
                                        <span style="color: ${i.upskilling_priority==="High"?"var(--danger)":i.upskilling_priority==="Medium"?"var(--warning)":"var(--secondary)"};">
                                            ${i.upskilling_priority}
                                        </span>
                                    </td>
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>

                <!-- Recommendations -->
                ${t.recommendations.length>0?`
                    <h4 style="margin-bottom: 12px; color: var(--text-primary);">Policy Recommendations</h4>
                    <div style="display: grid; gap: 12px;">
                        ${t.recommendations.slice(0,3).map(e=>`
                            <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; border-left: 4px solid ${e.priority==="Critical"?"var(--danger)":e.priority==="High"?"var(--warning)":"var(--primary)"};">
                                <div style="font-weight: 600; margin-bottom: 8px;">${e.target}</div>
                                <ul style="margin: 0; padding-left: 20px; font-size: 0.875rem; color: var(--text-secondary);">
                                    ${e.actions.slice(0,2).map(i=>`<li>${i}</li>`).join("")}
                                </ul>
                            </div>
                        `).join("")}
                    </div>
                `:""}
            </div>
        `:"<p>Demographics analysis not available.</p>"}getImpactColor(t){switch(t){case"Critical":return"var(--danger)";case"High":return"#f97316";case"Moderate":return"var(--warning)";default:return"var(--secondary)"}}formatNumber(t){return Math.abs(t)>=1e6?(t/1e6).toFixed(1)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(1)+"K":t.toLocaleString()}}const du=new xo;typeof window<"u"&&(window.DemographicsAnalyzer=xo,window.demographicsAnalyzer=du);class wo{constructor(){this.parameters={numWorkers:{name:"Number of Workers",baseValue:1e3,range:{min:500,max:2e3,step:250},description:"Total worker agents in simulation"},numFirms:{name:"Number of Firms",baseValue:100,range:{min:50,max:200,step:25},description:"Total firm agents in simulation"},initialAIAdoption:{name:"Initial AI Adoption",baseValue:.2,range:{min:.05,max:.4,step:.05},format:"percent",description:"Starting AI adoption rate among firms"},aiAdoptionSpeed:{name:"AI Adoption Speed",baseValue:1,range:{min:.5,max:2,step:.25},description:"Multiplier for AI adoption rate"},laborMarketFriction:{name:"Labor Market Friction",baseValue:.1,range:{min:.02,max:.25,step:.03},format:"percent",description:"Difficulty of job matching"},retrainingEffectiveness:{name:"Retraining Effectiveness",baseValue:.3,range:{min:.1,max:.6,step:.1},format:"percent",description:"Success rate of retraining programs"},wageFlexibility:{name:"Wage Flexibility",baseValue:.05,range:{min:.01,max:.15,step:.02},format:"percent",description:"How quickly wages adjust to market conditions"},informationSpread:{name:"Information Spread Rate",baseValue:.1,range:{min:.02,max:.2,step:.03},format:"percent",description:"Rate at which workers learn about opportunities"}},this.outcomes={finalUnemployment:{name:"Final Unemployment Rate",format:"percent",extractor:t=>t.summary.final.unemploymentRate},peakUnemployment:{name:"Peak Unemployment",format:"percent",extractor:t=>t.summary.peakUnemployment},netJobChange:{name:"Net Job Change",format:"number",extractor:t=>t.summary.totalHires-t.summary.totalLayoffs},totalDisplacement:{name:"Total Displaced",format:"number",extractor:t=>t.summary.totalLayoffs},aiAdoptionFinal:{name:"Final AI Adoption",format:"percent",extractor:t=>t.summary.final.aiAdoptionRate},avgPolicySupport:{name:"Avg Policy Support",format:"percent",extractor:t=>{const e=t.summary.finalPolicySupport;if(!e)return 0;const i=Object.values(e).map(n=>n.mean||0);return i.reduce((n,s)=>n+s,0)/i.length}}},this.analysisCache=new Map,this.isRunning=!1}async runSingleParameterAnalysis(t,e,i,n){const s=this.parameters[t];if(!s)return null;const o=[],r=this.generateTestValues(s);for(let l=0;l<r.length;l++){const c=r[l];n&&n({parameter:s.name,current:l+1,total:r.length,value:c});const d=this.applyParameterValue(i,t,c);try{const h=await this.runABMSimulation(e,d),u={};Object.entries(this.outcomes).forEach(([m,p])=>{try{u[m]=p.extractor(h)}catch{u[m]=null}}),o.push({paramValue:c,outcomes:u})}catch(h){console.error(`ABM sensitivity error at ${t}=${c}:`,h)}}return{parameter:s,parameterId:t,results:o,baseValue:s.baseValue}}generateTestValues(t){const e=[];for(let i=t.range.min;i<=t.range.max;i+=t.range.step)e.push(Math.round(i*1e3)/1e3);return e}applyParameterValue(t,e,i){const n=JSON.parse(JSON.stringify(t));switch(e){case"numWorkers":n.numWorkers=i;break;case"numFirms":n.numFirms=i;break;case"initialAIAdoption":n.initialAIAdoption=i;break;case"aiAdoptionSpeed":n.aiAdoptionSpeed=i;break;case"laborMarketFriction":n.laborMarketFriction=i;break;case"retrainingEffectiveness":n.retrainingEffectiveness=i;break;case"wageFlexibility":n.wageFlexibility=i;break;case"informationSpread":n.informationSpread=i;break}return n}async runABMSimulation(t,e){return typeof t.runSimulation=="function"?await t.runSimulation(e):this.generateMockResults(e)}generateMockResults(t){const e=.05+Math.random()*.03,i=t.initialAIAdoption||.2,n=t.laborMarketFriction||.1;return{summary:{initial:{unemploymentRate:.05,aiAdoptionRate:i},final:{unemploymentRate:e+n*.5-i*.2,aiAdoptionRate:Math.min(.9,i+.4)},peakUnemployment:e+n*.8,totalHires:Math.floor(1e5*(1-n)),totalLayoffs:Math.floor(8e4*i),finalPolicySupport:{ubi:{mean:.4+i*.3},retraining:{mean:.5+n*.2}}}}}calculateMetrics(t){if(!t||t.results.length<2)return null;const e={};return Object.entries(this.outcomes).forEach(([i,n])=>{const s=t.results.map(f=>f.outcomes[i]).filter(f=>f!=null&&!isNaN(f));if(s.length<2)return;const o=Math.min(...s),r=Math.max(...s),l=r-o,c=s.reduce((f,y)=>f+y,0)/s.length,d=Math.sqrt(s.reduce((f,y)=>f+Math.pow(y-c,2),0)/s.length),h=c!==0?d/Math.abs(c)*100:0,u=t.results.map(f=>f.paramValue),m=Math.max(...u)-Math.min(...u),p=t.parameter.baseValue,g=m>0&&p>0?l/c/(m/p):0;e[i]={name:n.name,format:n.format,min:o,max:r,range:l,mean:c,stdDev:d,cv:h,elasticity:Math.abs(g),sensitivity:this.getSensitivityLevel(Math.abs(g),h)}}),e}getSensitivityLevel(t,e){const i=t*.6+e/100*.4;return i>=.8?{level:"critical",color:"#ef4444",label:"Critical"}:i>=.5?{level:"high",color:"#f97316",label:"High"}:i>=.25?{level:"medium",color:"#fbbf24",label:"Medium"}:{level:"low",color:"#10b981",label:"Low"}}async runMultiParameterAnalysis(t,e,i,n){var o;const s={};for(let r=0;r<t.length;r++){const l=t[r];n&&n({phase:"parameter",current:r+1,total:t.length,paramName:(o=this.parameters[l])==null?void 0:o.name}),s[l]=await this.runSingleParameterAnalysis(l,e,i,c=>{n&&n({phase:"simulation",parameter:c.parameter,current:c.current,total:c.total,paramIndex:r+1,paramTotal:t.length})})}return s}generateTornadoData(t,e="finalUnemployment"){const i=[];return Object.entries(t).forEach(([n,s])=>{if(!s||!s.results.length)return;const o=s.results.map(h=>h.outcomes[e]).filter(h=>h!==null&&!isNaN(h));if(o.length<2)return;const r=this.parameters[n],l=this.getBaseOutcome(s,e),c=Math.min(...o),d=Math.max(...o);i.push({parameterId:n,parameter:r.name,low:c,high:d,range:d-c,baseValue:l,lowDiff:c-l,highDiff:d-l})}),i.sort((n,s)=>s.range-n.range),i}getBaseOutcome(t,e){if(!t||!t.results.length)return 0;const i=t.results.find(n=>Math.abs(n.paramValue-t.baseValue)<.001);return(i==null?void 0:i.outcomes[e])||t.results[0].outcomes[e]||0}renderDashboard(t,e){const i=document.getElementById(t);if(!i)return;let n="";n+=this.renderSummaryCards(e),n+=this.renderTornadoChart(e),n+=this.renderParameterTables(e),i.innerHTML=n}renderSummaryCards(t){const e=Object.keys(t).length,i={};Object.entries(t).forEach(([l,c])=>{const d=this.calculateMetrics(c);d&&(i[l]=d)});const n=[];Object.entries(i).forEach(([l,c])=>{const d=Object.values(c).reduce((h,u)=>h+u.elasticity,0)/Object.keys(c).length;n.push({paramId:l,name:this.parameters[l].name,avgElasticity:d,level:this.getSensitivityLevel(d,50)})}),n.sort((l,c)=>c.avgElasticity-l.avgElasticity);const s=n[0],o=n[n.length-1],r=n.filter(l=>l.level.level==="critical"||l.level.level==="high").length;return`
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                <div style="background: var(--gray-50); padding: 16px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">${e}</div>
                    <div style="font-size: 0.875rem; color: var(--gray-500);">Parameters Analyzed</div>
                </div>
                <div style="background: var(--gray-50); padding: 16px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--danger);">${r}</div>
                    <div style="font-size: 0.875rem; color: var(--gray-500);">High Sensitivity</div>
                </div>
                <div style="background: var(--gray-50); padding: 16px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 1rem; font-weight: 600; color: ${(s==null?void 0:s.level.color)||"var(--gray-600)"}; margin-bottom: 4px;">
                        ${(s==null?void 0:s.name)||"N/A"}
                    </div>
                    <div style="font-size: 0.875rem; color: var(--gray-500);">Most Sensitive</div>
                </div>
                <div style="background: var(--gray-50); padding: 16px; border-radius: 12px; text-align: center;">
                    <div style="font-size: 1rem; font-weight: 600; color: ${(o==null?void 0:o.level.color)||"var(--gray-600)"}; margin-bottom: 4px;">
                        ${(o==null?void 0:o.name)||"N/A"}
                    </div>
                    <div style="font-size: 0.875rem; color: var(--gray-500);">Least Sensitive</div>
                </div>
            </div>
        `}renderTornadoChart(t){const e=this.generateTornadoData(t,"finalUnemployment");if(e.length===0)return'<p style="color: var(--gray-500);">No data for tornado chart</p>';const n=100/(Math.max(...e.map(o=>Math.max(Math.abs(o.lowDiff),Math.abs(o.highDiff))))*2);return`
            <div style="background: var(--gray-50); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
                <h4 style="margin-bottom: 16px; color: var(--gray-700);"> Impact on Final Unemployment Rate</h4>
                <div style="position: relative;">
                    <!-- Center line -->
                    <div style="position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: var(--gray-300);"></div>

                    ${e.map((o,r)=>{const l=Math.abs(o.lowDiff)*n,c=Math.abs(o.highDiff)*n;return`
                            <div style="display: flex; align-items: center; margin-bottom: 12px; position: relative;">
                                <div style="width: 180px; text-align: right; padding-right: 12px; font-size: 0.875rem; color: var(--gray-600);">
                                    ${o.parameter}
                                </div>
                                <div style="flex: 1; display: flex; position: relative;">
                                    <!-- Low bar (left side) -->
                                    <div style="width: 50%; display: flex; justify-content: flex-end;">
                                        <div style="background: #3b82f6; height: 24px; width: ${l}%; border-radius: 4px 0 0 4px; display: flex; align-items: center; justify-content: flex-start; padding-left: 4px;">
                                            <span style="font-size: 0.7rem; color: white;">${(o.low*100).toFixed(1)}%</span>
                                        </div>
                                    </div>
                                    <!-- High bar (right side) -->
                                    <div style="width: 50%; display: flex; justify-content: flex-start;">
                                        <div style="background: #ef4444; height: 24px; width: ${c}%; border-radius: 0 4px 4px 0; display: flex; align-items: center; justify-content: flex-end; padding-right: 4px;">
                                            <span style="font-size: 0.7rem; color: white;">${(o.high*100).toFixed(1)}%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `}).join("")}
                </div>
                <div style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; font-size: 0.75rem; color: var(--gray-500);">
                    <span> Lower Values</span>
                    <span> Higher Values</span>
                </div>
            </div>
        `}renderParameterTables(t){let e='<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">';return Object.entries(t).forEach(([i,n])=>{if(!n)return;const s=this.parameters[i],o=this.calculateMetrics(n);e+=`
                <div style="background: var(--gray-50); padding: 16px; border-radius: 12px;">
                    <h5 style="margin-bottom: 12px; color: var(--gray-700);">${s.name}</h5>
                    <p style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 12px;">${s.description}</p>

                    ${o?`
                        <div style="display: grid; gap: 8px;">
                            ${Object.entries(o).slice(0,4).map(([r,l])=>`
                                <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                    <span style="font-size: 0.875rem; color: var(--gray-600);">${l.name}</span>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 0.75rem; color: var(--gray-400);">
                                            ${this.formatValue(l.min,l.format)} - ${this.formatValue(l.max,l.format)}
                                        </span>
                                        <span style="background: ${l.sensitivity.color}20; color: ${l.sensitivity.color}; padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: 600;">
                                            ${l.sensitivity.label}
                                        </span>
                                    </div>
                                </div>
                            `).join("")}
                        </div>
                    `:'<p style="color: var(--gray-400); font-size: 0.875rem;">No metrics available</p>'}
                </div>
            `}),e+="</div>",e}formatValue(t,e){if(t==null||isNaN(t))return"N/A";switch(e){case"percent":return(t*100).toFixed(1)+"%";case"number":return t.toLocaleString();default:return t.toFixed(2)}}}const hu=new wo;typeof window<"u"&&(window.ABMSensitivityAnalysis=wo,window.abmSensitivity=hu);class So{constructor(){this.skillsData={declining:{"Data Entry":{current_demand:12e5,automation_risk:.95,decline_rate:15,sector:"administrative"},"Basic Bookkeeping":{current_demand:8e5,automation_risk:.9,decline_rate:12,sector:"finance"},"Assembly Line Work":{current_demand:25e5,automation_risk:.85,decline_rate:10,sector:"manufacturing"},Telemarketing:{current_demand:4e5,automation_risk:.9,decline_rate:18,sector:"retail"},"Cashier Operations":{current_demand:32e5,automation_risk:.8,decline_rate:8,sector:"retail"},"Basic Customer Service":{current_demand:28e5,automation_risk:.75,decline_rate:7,sector:"retail"},"Filing/Records Management":{current_demand:6e5,automation_risk:.88,decline_rate:14,sector:"administrative"},"Routine Analysis":{current_demand:9e5,automation_risk:.7,decline_rate:6,sector:"finance"},"Manual QA Testing":{current_demand:45e4,automation_risk:.72,decline_rate:9,sector:"technology"},"Basic Translation":{current_demand:35e4,automation_risk:.78,decline_rate:11,sector:"professional_services"}},growing:{"AI/ML Engineering":{current_demand:28e4,growth_rate:35,avg_salary:145e3,training_months:18,sector:"technology"},"Data Science":{current_demand:45e4,growth_rate:28,avg_salary:125e3,training_months:12,sector:"technology"},Cybersecurity:{current_demand:52e4,growth_rate:25,avg_salary:115e3,training_months:12,sector:"technology"},"Cloud Architecture":{current_demand:38e4,growth_rate:22,avg_salary:135e3,training_months:9,sector:"technology"},"Healthcare Tech":{current_demand:62e4,growth_rate:20,avg_salary:85e3,training_months:12,sector:"healthcare"},"Robotics Maintenance":{current_demand:18e4,growth_rate:30,avg_salary:72e3,training_months:9,sector:"manufacturing"},"UX/UI Design":{current_demand:34e4,growth_rate:18,avg_salary:95e3,training_months:6,sector:"technology"},"Digital Marketing":{current_demand:58e4,growth_rate:15,avg_salary:72e3,training_months:6,sector:"professional_services"},"Project Management":{current_demand:72e4,growth_rate:12,avg_salary:95e3,training_months:6,sector:"professional_services"},"Human-AI Collaboration":{current_demand:15e4,growth_rate:45,avg_salary:11e4,training_months:9,sector:"technology"},"AI Ethics/Governance":{current_demand:45e3,growth_rate:55,avg_salary:12e4,training_months:12,sector:"professional_services"},"Prompt Engineering":{current_demand:85e3,growth_rate:80,avg_salary:1e5,training_months:3,sector:"technology"},"Renewable Energy Tech":{current_demand:32e4,growth_rate:24,avg_salary:78e3,training_months:12,sector:"construction"},"Elder Care":{current_demand:18e5,growth_rate:18,avg_salary:35e3,training_months:6,sector:"healthcare"},"Mental Health Services":{current_demand:42e4,growth_rate:22,avg_salary:55e3,training_months:24,sector:"healthcare"}},transitions:{"Data Entry":["Data Science","Digital Marketing","Project Management"],"Basic Bookkeeping":["Data Science","Cloud Architecture","AI Ethics/Governance"],"Assembly Line Work":["Robotics Maintenance","Renewable Energy Tech","Healthcare Tech"],Telemarketing:["Digital Marketing","UX/UI Design","Project Management"],"Cashier Operations":["Digital Marketing","Healthcare Tech","Elder Care"],"Basic Customer Service":["UX/UI Design","Project Management","Mental Health Services"],"Filing/Records Management":["Cybersecurity","Cloud Architecture","Project Management"],"Routine Analysis":["Data Science","AI/ML Engineering","Prompt Engineering"],"Manual QA Testing":["Cybersecurity","AI/ML Engineering","Human-AI Collaboration"],"Basic Translation":["AI Ethics/Governance","Prompt Engineering","Digital Marketing"]}},this.trainingPrograms={"AI/ML Engineering":{programs:[{name:"Google ML Engineer Certificate",duration:6,cost:"$300/month",provider:"Coursera",format:"Online"},{name:"AWS Machine Learning Specialty",duration:3,cost:"$500 exam",provider:"AWS",format:"Self-paced"},{name:"University ML Bootcamp",duration:12,cost:"$15,000",provider:"Various",format:"Hybrid"}],prerequisites:["Python programming","Statistics basics","Linear algebra"],career_paths:["ML Engineer","AI Developer","Research Scientist"]},"Data Science":{programs:[{name:"IBM Data Science Professional",duration:5,cost:"$39/month",provider:"Coursera",format:"Online"},{name:"Data Science Bootcamp",duration:6,cost:"$12,000",provider:"Various",format:"Intensive"},{name:"Google Data Analytics",duration:4,cost:"$39/month",provider:"Coursera",format:"Online"}],prerequisites:["Excel proficiency","Basic statistics","SQL basics"],career_paths:["Data Analyst","Data Scientist","Business Intelligence"]},Cybersecurity:{programs:[{name:"CompTIA Security+",duration:3,cost:"$392 exam",provider:"CompTIA",format:"Self-paced"},{name:"Google Cybersecurity Certificate",duration:6,cost:"$39/month",provider:"Coursera",format:"Online"},{name:"CISSP Certification",duration:6,cost:"$749 exam",provider:"ISC2",format:"Self-paced"}],prerequisites:["Networking basics","Operating systems","IT fundamentals"],career_paths:["Security Analyst","Penetration Tester","Security Engineer"]},"Cloud Architecture":{programs:[{name:"AWS Solutions Architect",duration:3,cost:"$300 exam",provider:"AWS",format:"Self-paced"},{name:"Google Cloud Professional",duration:4,cost:"$200 exam",provider:"Google",format:"Self-paced"},{name:"Azure Administrator",duration:3,cost:"$165 exam",provider:"Microsoft",format:"Self-paced"}],prerequisites:["IT fundamentals","Networking","Linux basics"],career_paths:["Cloud Architect","DevOps Engineer","Platform Engineer"]},"Prompt Engineering":{programs:[{name:"DeepLearning.AI Prompt Engineering",duration:1,cost:"Free",provider:"DeepLearning.AI",format:"Online"},{name:"Anthropic Prompt Design",duration:1,cost:"Free",provider:"Anthropic",format:"Online"},{name:"Enterprise AI Implementation",duration:2,cost:"$500",provider:"Various",format:"Online"}],prerequisites:["Basic AI understanding","Writing skills","Domain expertise"],career_paths:["Prompt Engineer","AI Product Manager","AI Consultant"]},"Healthcare Tech":{programs:[{name:"Health Informatics Certificate",duration:6,cost:"$5,000",provider:"University",format:"Online"},{name:"Epic Systems Certification",duration:2,cost:"$3,000",provider:"Epic",format:"In-person"},{name:"Healthcare Data Analytics",duration:4,cost:"$2,500",provider:"Various",format:"Online"}],prerequisites:["Healthcare experience","Basic IT skills","Data literacy"],career_paths:["Health IT Specialist","Clinical Informatics","Medical Data Analyst"]}}}analyzeSkillsGap(t){const e=t.summary,i=e.sector_summary,n=e.ai_impact,s=this.analyzeDecliningSkills(i,n),o=this.analyzeGrowingSkills(i,n),r=this.analyzeTransitionPaths(s,o),l=this.generateTrainingRecommendations(r,n),c=this.calculateGapMetrics(s,o);return{declining_skills:s,growing_skills:o,transition_paths:r,training_recommendations:l,gap_metrics:c,sector_skill_needs:this.analyzeSectorSkillNeeds(i)}}analyzeDecliningSkills(t,e){const i=[],n=e.cumulative_displacement/1e7;for(const[s,o]of Object.entries(this.skillsData.declining)){const r=this.getSectorImpact(o.sector,t),l=o.decline_rate*(1+n)*(1+Math.abs(r)/100),c=Math.round(o.current_demand*(l/100));i.push({name:s,current_workers:o.current_demand,decline_rate:Math.round(l),workers_affected:c,automation_risk:Math.round(o.automation_risk*100)+"%",sector:o.sector,urgency:l>12?"Critical":l>8?"High":"Moderate",transition_options:this.skillsData.transitions[s]||[]})}return i.sort((s,o)=>o.decline_rate-s.decline_rate)}analyzeGrowingSkills(t,e){const i=[],n=parseFloat(e.ai_adoption.final)/100;for(const[s,o]of Object.entries(this.skillsData.growing)){let r=o.growth_rate;["AI/ML Engineering","Data Science","Prompt Engineering","Human-AI Collaboration","AI Ethics/Governance"].includes(s)&&(r*=1+n*.5);const l=Math.round(o.current_demand*(1+r/100)),c=l-o.current_demand;i.push({name:s,current_demand:o.current_demand,growth_rate:Math.round(r),projected_demand:l,new_positions:c,avg_salary:"$"+o.avg_salary.toLocaleString(),training_months:o.training_months,sector:o.sector,opportunity_score:this.calculateOpportunityScore(r,o.avg_salary,o.training_months)})}return i.sort((s,o)=>o.opportunity_score-s.opportunity_score)}analyzeTransitionPaths(t,e){var n;const i=[];for(const s of t.slice(0,5)){const o=s.transition_options;for(const r of o){const l=e.find(c=>c.name===r);if(l){const c=this.trainingPrograms[r];i.push({from_skill:s.name,to_skill:r,workers_needing_transition:s.workers_affected,salary_change:l.avg_salary,training_duration:l.training_months+" months",difficulty:this.assessTransitionDifficulty(s,l),recommended_programs:((n=c==null?void 0:c.programs)==null?void 0:n.slice(0,2))||[],success_likelihood:this.estimateSuccessLikelihood(s,l)})}}}return i.sort((s,o)=>o.success_likelihood-s.success_likelihood)}generateTrainingRecommendations(t,e){const i=[],n=new Set;for(const o of t.slice(0,10))if(!n.has(o.to_skill)){n.add(o.to_skill);const r=this.trainingPrograms[o.to_skill];r&&i.push({skill:o.to_skill,priority:o.difficulty==="Low"?"High":o.difficulty==="Medium"?"Medium":"Low",workers_to_train:o.workers_needing_transition,programs:r.programs,prerequisites:r.prerequisites,career_outcomes:r.career_paths,estimated_cost:this.estimateTrainingCost(r.programs,o.workers_needing_transition),roi_estimate:this.estimateTrainingROI(o)})}return parseFloat(e.ai_adoption.final)>50&&i.unshift({skill:"AI Literacy (All Workers)",priority:"Critical",workers_to_train:Math.round(e.cumulative_displacement*.8),programs:[{name:"AI Fundamentals for Everyone",duration:1,cost:"Free",provider:"Various",format:"Online"},{name:"Working with AI Tools",duration:2,cost:"$200",provider:"LinkedIn Learning",format:"Online"}],prerequisites:["Basic computer skills"],career_outcomes:["Enhanced productivity in any role"],estimated_cost:"Low",roi_estimate:"High"}),i}calculateGapMetrics(t,e){const i=t.reduce((o,r)=>o+r.workers_affected,0),n=e.reduce((o,r)=>o+r.new_positions,0),s=i-n;return{workers_needing_reskilling:i,new_positions_available:n,net_skill_gap:s,gap_status:s>0?"Deficit":"Surplus",critical_skills_declining:t.filter(o=>o.urgency==="Critical").length,high_opportunity_skills:e.filter(o=>o.opportunity_score>70).length,avg_retraining_time:Math.round(e.slice(0,5).reduce((o,r)=>o+r.training_months,0)/5)+" months",market_readiness:s>1e6?"Low":s>5e5?"Moderate":"Good"}}analyzeSectorSkillNeeds(t){const e={},i={technology:["AI/ML Engineering","Cybersecurity","Cloud Architecture","Data Science"],healthcare:["Healthcare Tech","Data Science","Elder Care","Mental Health Services"],manufacturing:["Robotics Maintenance","AI/ML Engineering","Project Management"],retail:["Digital Marketing","UX/UI Design","Data Science"],finance:["Data Science","Cybersecurity","AI Ethics/Governance"],professional_services:["Prompt Engineering","Project Management","AI Ethics/Governance"]};for(const[n,s]of Object.entries(i)){const o=this.getSectorImpact(n,t);e[n]={impact_level:Math.abs(o)>10?"High":Math.abs(o)>5?"Moderate":"Low",priority_skills:s,hiring_outlook:o>0?"Growing":o<-5?"Declining":"Stable"}}return e}getSectorImpact(t,e){const i=[...e.most_affected||[],...e.least_affected||[]].find(n=>n.name===t);return i?parseFloat(i.employment_change_percent):0}calculateOpportunityScore(t,e,i){const n=Math.min(100,e/1500),s=Math.min(100,t*2),o=Math.max(0,100-i*4);return Math.round(n*.4+s*.4+o*.2)}assessTransitionDifficulty(t,e){const i=e.training_months;return i<=6?"Low":i<=12?"Medium":"High"}estimateSuccessLikelihood(t,e){let i=70;return e.training_months<=6?i+=15:e.training_months>12&&(i-=15),i+=e.growth_rate>20?10:0,Math.min(95,Math.max(30,i))}estimateTrainingCost(t,e){if(!t||t.length===0)return"Unknown";const n=t.reduce((s,o)=>{const r=o.cost.includes("Free")?0:parseInt(o.cost.replace(/[^0-9]/g,""))||500;return s+r},0)/t.length*e;return n>1e9?"$"+(n/1e9).toFixed(1)+"B":n>1e6?"$"+(n/1e6).toFixed(1)+"M":"$"+n.toLocaleString()}estimateTrainingROI(t){const e=parseInt(t.salary_change.replace(/[^0-9]/g,""));return e>1e5?"Very High":e>7e4?"High":e>5e4?"Moderate":"Standard"}generateHTML(t){return t?`
            <div class="skills-gap-analysis">
                <!-- Gap Metrics Summary -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Need Reskilling</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--danger);">${this.formatNumber(t.gap_metrics.workers_needing_reskilling)}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">New Positions</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--secondary);">${this.formatNumber(t.gap_metrics.new_positions_available)}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Net Gap</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: ${t.gap_metrics.net_skill_gap>0?"var(--danger)":"var(--secondary)"};">${this.formatNumber(Math.abs(t.gap_metrics.net_skill_gap))}</div>
                        <div style="font-size: 0.7rem; color: var(--gray-400);">${t.gap_metrics.gap_status}</div>
                    </div>
                    <div style="background: var(--gray-50); padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Avg Training</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">${t.gap_metrics.avg_retraining_time}</div>
                    </div>
                </div>

                <!-- Declining Skills -->
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">
                    <span style="color: var(--danger);"></span> Declining Skills
                </h4>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px;">
                    ${t.declining_skills.slice(0,6).map(e=>`
                        <span style="padding: 6px 12px; background: #fef2f2; color: #991b1b; border-radius: 16px; font-size: 0.8rem;">
                            ${e.name} <span style="opacity: 0.7;">-${e.decline_rate}%</span>
                        </span>
                    `).join("")}
                </div>

                <!-- Growing Skills -->
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">
                    <span style="color: var(--secondary);"></span> In-Demand Skills
                </h4>
                <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px;">
                    ${t.growing_skills.slice(0,6).map(e=>`
                        <span style="padding: 6px 12px; background: #ecfdf5; color: #065f46; border-radius: 16px; font-size: 0.8rem;">
                            ${e.name} <span style="opacity: 0.7;">+${e.growth_rate}%</span>
                        </span>
                    `).join("")}
                </div>

                <!-- Top Transition Paths -->
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">Recommended Transitions</h4>
                <div style="display: grid; gap: 12px; margin-bottom: 20px;">
                    ${t.transition_paths.slice(0,3).map(e=>`
                        <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; display: flex; align-items: center; gap: 12px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span style="color: var(--danger); font-weight: 500;">${e.from_skill}</span>
                                    <span style="color: var(--gray-400);"></span>
                                    <span style="color: var(--secondary); font-weight: 500;">${e.to_skill}</span>
                                </div>
                                <div style="font-size: 0.8rem; color: var(--gray-500);">
                                    ${e.training_duration} training  ${e.salary_change} avg salary  ${e.success_likelihood}% success rate
                                </div>
                            </div>
                            <div style="padding: 4px 10px; background: ${e.difficulty==="Low"?"var(--secondary)":e.difficulty==="Medium"?"var(--warning)":"var(--danger)"}; color: white; border-radius: 12px; font-size: 0.7rem;">
                                ${e.difficulty}
                            </div>
                        </div>
                    `).join("")}
                </div>

                <!-- Training Recommendations -->
                <h4 style="margin-bottom: 12px; color: var(--text-primary);">Training Programs</h4>
                ${t.training_recommendations.slice(0,3).map(e=>{var i;return`
                    <div style="padding: 12px; background: var(--gray-50); border-radius: 8px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 600;">${e.skill}</span>
                            <span style="padding: 2px 8px; background: ${e.priority==="Critical"?"var(--danger)":e.priority==="High"?"var(--warning)":"var(--primary)"}; color: white; border-radius: 10px; font-size: 0.7rem;">
                                ${e.priority} Priority
                            </span>
                        </div>
                        <div style="font-size: 0.85rem; color: var(--gray-600);">
                            ${((i=e.programs)==null?void 0:i.slice(0,2).map(n=>`${n.name} (${n.duration}mo, ${n.cost})`).join("  "))||"Various programs available"}
                        </div>
                    </div>
                `}).join("")}
            </div>
        `:"<p>Skills gap analysis not available.</p>"}formatNumber(t){return Math.abs(t)>=1e6?(t/1e6).toFixed(1)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(0)+"K":t.toLocaleString()}}const uu=new So;typeof window<"u"&&(window.SkillsGapAnalyzer=So,window.skillsGapAnalyzer=uu);class ko{constructor(){this.paramMap={n:"name",sy:"start_year",ey:"end_year",ur:"unemployment_rate",ai:"ai_adoption_rate",ap:"automation_pace",ac:"adoption_curve",pd:"productivity_dispersion",njm:"new_job_multiplier",td:"transition_delay",iv:"interventions"},this.reverseMap={};for(const[t,e]of Object.entries(this.paramMap))this.reverseMap[e]=t}encodeScenario(t){if(!t)return"";const e=new URLSearchParams;if(t.name&&e.set("n",this.compressString(t.name)),t.timeframe&&(e.set("sy",t.timeframe.start_year),e.set("ey",t.timeframe.end_year)),t.targets&&(e.set("ur",t.targets.unemployment_rate),e.set("ai",t.targets.ai_adoption_rate),e.set("ap",t.targets.automation_pace)),t.ai_parameters&&(e.set("ac",this.encodeAdoptionCurve(t.ai_parameters.adoption_curve)),e.set("pd",t.ai_parameters.productivity_dispersion),e.set("njm",t.ai_parameters.new_job_multiplier),e.set("td",t.ai_parameters.transition_delay)),t.interventions&&t.interventions.length>0){const i=this.encodeInterventions(t.interventions);e.set("iv",i)}return e.toString()}decodeScenario(t){if(!t)return null;const e=new URLSearchParams(t),i={},n=e.get("n");n&&(i.name=this.decompressString(n));const s=e.get("sy"),o=e.get("ey");(s||o)&&(i.timeframe={start_year:s?parseInt(s):2024,end_year:o?parseInt(o):2034});const r=e.get("ur"),l=e.get("ai"),c=e.get("ap");(r||l||c)&&(i.targets={unemployment_rate:r?parseFloat(r):6,ai_adoption_rate:l?parseFloat(l):50,automation_pace:c||"moderate"});const d=e.get("ac"),h=e.get("pd"),u=e.get("njm"),m=e.get("td");(d||h||u||m)&&(i.ai_parameters={adoption_curve:d?this.decodeAdoptionCurve(d):"s_curve",productivity_dispersion:h?parseFloat(h):.3,new_job_multiplier:u?parseFloat(u):.4,transition_delay:m?parseFloat(m):2});const p=e.get("iv");return p&&(i.interventions=this.decodeInterventions(p)),Object.keys(i).length>0?i:null}encodeAdoptionCurve(t){return{linear:"L",exponential:"E",s_curve:"S",step:"T"}[t]||"S"}decodeAdoptionCurve(t){return{L:"linear",E:"exponential",S:"s_curve",T:"step"}[t]||"s_curve"}encodeInterventions(t){if(!t||t.length===0)return"";const e={ubi:"U",job_retraining:"R",wage_subsidy:"W",reduced_workweek:"H",robot_tax:"T",education_subsidy:"E"};return t.map(i=>{const n=e[i.type]||i.type.charAt(0).toUpperCase(),s=this.encodeInterventionParams(i.type,i.parameters);return n+(s?":"+s:"")}).join(",")}encodeInterventionParams(t,e){if(!e)return"";const i=[];switch(t){case"ubi":e.monthly_amount&&i.push("m"+e.monthly_amount),e.phase_out_threshold&&i.push("p"+e.phase_out_threshold);break;case"job_retraining":e.funding_per_worker&&i.push("f"+e.funding_per_worker),e.success_rate&&i.push("s"+e.success_rate);break;case"wage_subsidy":e.subsidy_rate&&i.push("r"+e.subsidy_rate),e.max_wage_covered&&i.push("w"+e.max_wage_covered);break;case"reduced_workweek":e.target_hours&&i.push("h"+e.target_hours);break;case"robot_tax":e.tax_rate&&i.push("t"+e.tax_rate);break;case"education_subsidy":e.funding_increase&&i.push("i"+e.funding_increase);break}return i.join("-")}decodeInterventions(t){if(!t)return[];const e={U:"ubi",R:"job_retraining",W:"wage_subsidy",H:"reduced_workweek",T:"robot_tax",E:"education_subsidy"},i={ubi:"Universal Basic Income",job_retraining:"Job Retraining",wage_subsidy:"Wage Subsidy",reduced_workweek:"Reduced Work Week",robot_tax:"Robot Tax",education_subsidy:"Education Subsidy"};return t.split(",").map(n=>{const s=n.charAt(0),o=e[s];if(!o)return null;const r=n.includes(":")?n.split(":")[1]:"",l=this.decodeInterventionParams(o,r);return{type:o,name:i[o],parameters:l}}).filter(n=>n!==null)}decodeInterventionParams(t,e){const i={};if(!e)return i;const n=e.split("-");for(const s of n){if(s.length<2)continue;const o=s.charAt(0),r=parseFloat(s.substring(1));switch(t){case"ubi":o==="m"&&(i.monthly_amount=r),o==="p"&&(i.phase_out_threshold=r);break;case"job_retraining":o==="f"&&(i.funding_per_worker=r),o==="s"&&(i.success_rate=r);break;case"wage_subsidy":o==="r"&&(i.subsidy_rate=r),o==="w"&&(i.max_wage_covered=r);break;case"reduced_workweek":o==="h"&&(i.target_hours=r);break;case"robot_tax":o==="t"&&(i.tax_rate=r);break;case"education_subsidy":o==="i"&&(i.funding_increase=r);break}}return i}compressString(t){return encodeURIComponent(t.replace(/ /g,"_"))}decompressString(t){return decodeURIComponent(t).replace(/_/g," ")}generateShareableURL(t){const e=this.encodeScenario(t),i=window.location.origin+window.location.pathname;return e?`${i}?${e}`:i}hasScenarioInURL(){return window.location.search.length>1}loadFromURL(){return this.hasScenarioInURL()?this.decodeScenario(window.location.search.substring(1)):null}updateURL(t){const e=this.encodeScenario(t),i=e?`${window.location.pathname}?${e}`:window.location.pathname;window.history.replaceState({scenario:t},"",i)}async copyToClipboard(t){const e=this.generateShareableURL(t);try{return await navigator.clipboard.writeText(e),!0}catch{const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select();try{return document.execCommand("copy"),document.body.removeChild(n),!0}catch{return document.body.removeChild(n),!1}}}}const gi=new ko;async function xn(){const a=getCurrentScenario();if(!a){showNotification("No scenario configured yet","warning");return}if(await gi.copyToClipboard(a))showNotification("Shareable URL copied to clipboard!","success");else{const e=gi.generateShareableURL(a);Mo(e)}}function Mo(a){const t=document.createElement("div");t.className="modal-overlay",t.style.display="flex",t.innerHTML=`
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Share This Scenario</h3>
                <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px;">Copy this URL to share your scenario configuration:</p>
                <div style="display: flex; gap: 8px;">
                    <input type="text" id="shareUrlInput" value="${a}" readonly
                        style="flex: 1; padding: 12px; font-size: 0.875rem; border: 1px solid var(--gray-300);
                               border-radius: var(--radius); background: var(--gray-50);">
                    <button class="btn btn-primary" onclick="copyShareInput()">Copy</button>
                </div>
                <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 12px;">
                    This URL contains your scenario parameters. Anyone with this link can load your exact configuration.
                </p>
            </div>
        </div>
    `,document.body.appendChild(t),setTimeout(()=>{document.getElementById("shareUrlInput").select()},100)}function mu(){const a=document.getElementById("shareUrlInput");a.select(),document.execCommand("copy"),showNotification("URL copied!","success"),a.closest(".modal-overlay").remove()}function pu(){const a=gi.loadFromURL();if(!a)return!1;if(a.name){const t=document.getElementById("scenarioName");t&&(t.value=a.name)}if(a.timeframe){const t=document.getElementById("targetYear");t&&(t.value=a.timeframe.end_year)}if(a.targets){const t=document.getElementById("targetUR"),e=document.getElementById("aiAdoption"),i=document.getElementById("automationPace");if(t){t.value=a.targets.unemployment_rate;const n=document.getElementById("urValue");n&&(n.textContent=a.targets.unemployment_rate)}if(e){e.value=a.targets.ai_adoption_rate;const n=document.getElementById("aiValue");n&&(n.textContent=a.targets.ai_adoption_rate)}i&&(i.value=a.targets.automation_pace)}if(a.ai_parameters){const t=document.getElementById("adoptionCurve");t&&(t.value=a.ai_parameters.adoption_curve)}return a.interventions&&a.interventions.length>0&&typeof interventionSystem<"u"&&(a.interventions.forEach(t=>{interventionSystem.addIntervention(t.type,t.parameters)}),typeof updateInterventionsList<"u"&&updateInterventionsList()),setTimeout(()=>{showNotification("Scenario loaded from shared URL","success")},500),!0}function gu(){[["targetUnemployment","targetUnemploymentSlider"],["targetAIAdoption","targetAIAdoptionSlider"],["productivityDispersion","productivityDispersionSlider"],["newJobMultiplier","newJobMultiplierSlider"],["transitionDelay","transitionDelaySlider"]].forEach(([t,e])=>{const i=document.getElementById(t),n=document.getElementById(e);i&&n&&(n.value=i.value)})}const fu=xn,yu=()=>{const a=document.querySelector(".modal-overlay");a&&a.remove()},_u=xn;typeof window<"u"&&(window.URLSharingService=ko,window.urlSharing=gi,window.copyScenarioURL=xn,window.showShareURLModal=Mo,window.copyShareInput=mu,window.applyScenarioFromURL=pu,window.updateSlidersFromInputs=gu,window.showShareModal=fu,window.hideShareModal=yu,window.copyShareUrl=_u);const q={EMPLOYED:"employed",UNEMPLOYED:"unemployed",RETRAINING:"retraining",OUT_OF_LABOR_FORCE:"out_of_labor_force"},Y={NO_DEGREE:"no_degree",HIGH_SCHOOL:"high_school",SOME_COLLEGE:"some_college",BACHELORS:"bachelors",ADVANCED:"advanced"},oi={POSITIVE:"positive",NEGATIVE:"negative",NEUTRAL:"neutral",NONE:"none"};let bu=class{constructor(t={}){this.id=t.id||`worker_${Math.random().toString(36).substr(2,9)}`,this.age=t.age||this._randomAge(),this.education=t.education||this._randomEducation(),this.region=t.region||1,this.status=t.status||q.EMPLOYED,this.occupation=t.occupation||this._randomOccupation(),this.industry=t.industry||this._randomIndustry(),this.employer=t.employer||null,this.tenure=t.tenure||Math.floor(Math.random()*120),this.unemploymentDuration=0,this.skills=t.skills||this._initializeSkills(),this.aiAugmentationSkill=t.aiAugmentationSkill||Math.random()*.5+.1,this.adaptability=t.adaptability||Math.random()*.6+.2,this.wage=t.wage||this._calculateInitialWage(),this.savings=t.savings||Math.random()*12,this.reservationWage=this.wage*.7,this.riskTolerance=t.riskTolerance||Math.random(),this.mobilityWillingness=t.mobilityWillingness||Math.random()*.5,this.networkSize=t.networkSize||Math.floor(Math.random()*50)+5,this.informationLevel=t.informationLevel||Math.random(),this.network=[],this.unemploymentSpells=0,this.retrainingHistory=[],this.jobHistory=[],this.politicalEngagement=t.politicalEngagement||Math.random()*.6+.2,this.ideologicalPrior=t.ideologicalPrior||Math.random()*2-1,this.economicAnxiety=t.economicAnxiety||.2,this.trustInGovernment=t.trustInGovernment||Math.random()*.5+.25,this.networkPoliticalInfluence=t.networkPoliticalInfluence||Math.random()*.5,this.policySupport={ubi:this._initializePolicySupport("ubi"),retraining:this._initializePolicySupport("retraining"),wageSubsidy:this._initializePolicySupport("wageSubsidy"),reducedWorkWeek:this._initializePolicySupport("reducedWorkWeek"),publicWorks:this._initializePolicySupport("publicWorks"),eitcExpansion:this._initializePolicySupport("eitcExpansion"),aiRegulation:this._initializePolicySupport("aiRegulation"),tradeProtection:this._initializePolicySupport("tradeProtection"),educationInvestment:this._initializePolicySupport("educationInvestment")},this.personalAIExperience=oi.NONE,this.benefitedFromIntervention=null,this.harmedByLackOfIntervention=!1,this.retrainingProgram=null,this.retrainingProgress=0,this.activelySearching=!1,this.jobApplications=[],this.jobOffers=[]}_randomAge(){const t=Math.random();return t<.15?Math.floor(Math.random()*7)+18:t<.35?Math.floor(Math.random()*10)+25:t<.55?Math.floor(Math.random()*10)+35:t<.75?Math.floor(Math.random()*10)+45:t<.92?Math.floor(Math.random()*10)+55:Math.floor(Math.random()*6)+65}_randomEducation(){const t=Math.random();return t<.1?Y.NO_DEGREE:t<.38?Y.HIGH_SCHOOL:t<.58?Y.SOME_COLLEGE:t<.85?Y.BACHELORS:Y.ADVANCED}_randomOccupation(){return Math.floor(Math.random()*100)+1}_randomIndustry(){return Math.floor(Math.random()*20)+1}_initializeSkills(){const t={};return["technical","analytical","communication","leadership","creativity","problemSolving","dataAnalysis","programming","customerService","sales","projectManagement","writing","research","financial","healthcare","manufacturing","logistics","marketing","legal","teaching"].forEach(i=>{const n=this._getEducationBonus();t[i]=Math.min(1,Math.random()*.6+n)}),t}_getEducationBonus(){switch(this.education){case Y.ADVANCED:return .3;case Y.BACHELORS:return .2;case Y.SOME_COLLEGE:return .1;case Y.HIGH_SCHOOL:return .05;default:return 0}}_calculateInitialWage(){let t=3e3;const e={[Y.NO_DEGREE]:.7,[Y.HIGH_SCHOOL]:.85,[Y.SOME_COLLEGE]:1,[Y.BACHELORS]:1.4,[Y.ADVANCED]:1.8};t*=e[this.education]||1;const i=1+Math.min(.5,(this.age-22)*.015);return t*=i,t*=.8+Math.random()*.4,Math.round(t)}_initializePolicySupport(t){let e=.5;return this.ideologicalPrior<0?["ubi","retraining","publicWorks","aiRegulation"].includes(t)&&(e+=Math.abs(this.ideologicalPrior)*.2):(["ubi","aiRegulation","publicWorks"].includes(t)&&(e-=this.ideologicalPrior*.15),t==="educationInvestment"&&(e+=.1)),e+=(Math.random()-.5)*.2,Math.max(0,Math.min(1,e))}makeMonthlyDecisions(t,e,i){const n=this._calculateDisplacementRisk(e);switch(this.status){case q.EMPLOYED:this._employedDecisions(n,t);break;case q.UNEMPLOYED:this._unemployedDecisions(t);break;case q.RETRAINING:this._retrainingDecisions();break;case q.OUT_OF_LABOR_FORCE:this._outOfLaborForceDecisions(t);break}this._updatePolicySupport(),this._ageOneMonth()}_calculateDisplacementRisk(t){const e=t.getOccupationExposure(this.occupation),i=this.aiAugmentationSkill*.3,n=this.employer?this.employer.automationLevel*.2:0,s=this.tenure>60?.05:0;return Math.max(0,Math.min(1,e-i+n+s))}_employedDecisions(t,e){const i=.5-this.riskTolerance*.2;if(t>i){const n=t*(.5+this.savings/24);Math.random()<n&&(this.activelySearching=!0)}t>.7&&this.savings>3&&this.age<55&&this._calculateRetrainingROI()>1.2&&Math.random()<.1&&this._considerRetraining(),this.savings=Math.min(24,this.savings+.2)}_unemployedDecisions(t){this.unemploymentDuration++,this.activelySearching=!0,this.savings=Math.max(0,this.savings-1),this.economicAnxiety=Math.min(1,this.economicAnxiety+.03),this.unemploymentDuration>3&&(this.reservationWage*=.98),this.unemploymentDuration>6&&this.savings>2&&this.age<55&&Math.random()<.15&&this._considerRetraining(),this.unemploymentDuration>18&&this.age>55&&Math.random()<.05&&(this.status=q.OUT_OF_LABOR_FORCE,this.activelySearching=!1),this.unemploymentDuration>6&&(this.mobilityWillingness=Math.min(1,this.mobilityWillingness+.02))}_retrainingDecisions(){if(!this.retrainingProgram){this.status=q.UNEMPLOYED;return}this.retrainingProgress++,this.retrainingProgress>=this.retrainingProgram.duration&&this._completeRetraining(),this.savings<=0&&Math.random()<.1&&this._dropoutRetraining(),this.savings=Math.max(0,this.savings-.8)}_outOfLaborForceDecisions(t){Math.random()<.02&&(this.status=q.UNEMPLOYED,this.unemploymentDuration=0,this.activelySearching=!0)}_considerRetraining(){this.wantsRetraining=!0}_calculateRetrainingROI(){const t=this.wage*.3,e=Math.max(1,65-this.age);return t*12*e/1e4}_completeRetraining(){this.retrainingProgram.skillsProvided&&Object.entries(this.retrainingProgram.skillsProvided).forEach(([t,e])=>{this.skills[t]=Math.min(1,(this.skills[t]||0)+e)}),this.aiAugmentationSkill=Math.min(1,this.aiAugmentationSkill+.2),this.retrainingHistory.push({program:this.retrainingProgram.id,completedMonth:Date.now(),success:!0}),this.status=q.UNEMPLOYED,this.unemploymentDuration=0,this.retrainingProgram=null,this.retrainingProgress=0,this.activelySearching=!0,this.policySupport.retraining=Math.min(1,this.policySupport.retraining+.2),this.policySupport.educationInvestment=Math.min(1,this.policySupport.educationInvestment+.15),this.trustInGovernment=Math.min(1,this.trustInGovernment+.1),this.benefitedFromIntervention="retraining"}_dropoutRetraining(){this.retrainingHistory.push({program:this.retrainingProgram.id,completedMonth:Date.now(),success:!1}),this.status=q.UNEMPLOYED,this.retrainingProgram=null,this.retrainingProgress=0,this.activelySearching=!0,this.policySupport.retraining=Math.max(0,this.policySupport.retraining-.15),this.trustInGovernment=Math.max(0,this.trustInGovernment-.15),this.policySupport.ubi=Math.min(1,this.policySupport.ubi+.1)}_ageOneMonth(){}searchForJobs(t){if(!this.activelySearching)return[];const i=t.getVisibleJobs(this).filter(o=>this._isQualifiedFor(o)),n=this.unemploymentDuration>6?10:5,s=i.slice(0,n);return this.jobApplications=s.map(o=>o.id),s}_isQualifiedFor(t){const e={[Y.NO_DEGREE]:0,[Y.HIGH_SCHOOL]:1,[Y.SOME_COLLEGE]:2,[Y.BACHELORS]:3,[Y.ADVANCED]:4};return!(e[this.education]<e[t.requiredEducation||Y.NO_DEGREE]||t.requiredSkills&&!Object.entries(t.requiredSkills).every(([n,s])=>(this.skills[n]||0)>=s*.7)||this.unemploymentDuration<6&&t.wage<this.reservationWage||t.region!==this.region&&this.mobilityWillingness<.5)}evaluateOffers(){if(this.jobOffers.length===0)return null;const t=this.jobOffers.map(i=>({offer:i,score:this._scoreJobOffer(i)}));t.sort((i,n)=>n.score-i.score);const e=t[0];return e.offer.wage>=this.reservationWage||this.unemploymentDuration>9?e.offer:null}_scoreJobOffer(t){let e=0;return e+=t.wage/this.wage*40,t.region===this.region?e+=20:e+=this.mobilityWillingness*10,e+=(1-(t.automationExposure||.5))*20,e+=(t.growthPotential||.5)*10,e+=(t.aiAugmentation||0)*10,e}acceptJob(t,e){this.status===q.EMPLOYED&&this.employer&&this.jobHistory.push({employer:this.employer.id,occupation:this.occupation,wage:this.wage,tenure:this.tenure,endReason:"voluntary_quit"}),this.status=q.EMPLOYED,this.employer=e,this.occupation=t.occupation,this.industry=e.industry,this.wage=t.wage,this.tenure=0,this.unemploymentDuration=0,this.activelySearching=!1,this.jobOffers=[],this.jobApplications=[],this.reservationWage=this.wage*.7,this.economicAnxiety=Math.max(0,this.economicAnxiety-.2)}layOff(t="automation"){this.jobHistory.push({employer:this.employer?this.employer.id:null,occupation:this.occupation,wage:this.wage,tenure:this.tenure,endReason:t}),this.status=q.UNEMPLOYED,this.employer=null,this.tenure=0,this.unemploymentDuration=0,this.unemploymentSpells++,this.activelySearching=!0,this.economicAnxiety=Math.min(1,this.economicAnxiety+.3),this.policySupport.ubi=Math.min(1,this.policySupport.ubi+.15),this.policySupport.retraining=Math.min(1,this.policySupport.retraining+.12),t==="automation"&&(this.policySupport.aiRegulation=Math.min(1,this.policySupport.aiRegulation+.2),this.personalAIExperience=oi.NEGATIVE,this.harmedByLackOfIntervention=!0),this.network.forEach(e=>{e.economicAnxiety!==void 0&&(e.economicAnxiety=Math.min(1,e.economicAnxiety+.05),e.policySupport.aiRegulation=Math.min(1,e.policySupport.aiRegulation+.03))})}_updatePolicySupport(){this._applyNetworkInfluence(),this._applyIdeologyBounds(),this._applyTrustModifier(),Object.keys(this.policySupport).forEach(t=>{this.policySupport[t]=Math.max(0,Math.min(1,this.policySupport[t]))})}_applyNetworkInfluence(){this.network.length!==0&&this.network.forEach(t=>{if(!t.policySupport)return;const e=(t.closeness||.5)*this.networkPoliticalInfluence;Object.keys(this.policySupport).forEach(i=>{if(t.policySupport[i]!==void 0){const n=t.policySupport[i]-this.policySupport[i];this.policySupport[i]+=n*.02*e}}),t.status===q.UNEMPLOYED&&t.unemploymentDuration<3&&(this.policySupport.ubi+=.03*e,this.economicAnxiety+=.05*e)})}_applyIdeologyBounds(){const t=this.economicAnxiety>.7?.5:1;this.ideologicalPrior<0?(this.policySupport.ubi=Math.max(this.policySupport.ubi,.3*t),this.policySupport.retraining=Math.max(this.policySupport.retraining,.4*t),this.policySupport.aiRegulation=Math.max(this.policySupport.aiRegulation,.3*t)):this.economicAnxiety<.7&&(this.policySupport.ubi=Math.min(this.policySupport.ubi,.6),this.policySupport.aiRegulation=Math.min(this.policySupport.aiRegulation,.5))}_applyTrustModifier(){this.trustInGovernment<.3?["retraining","publicWorks","wageSubsidy"].forEach(t=>{this.policySupport[t]*=.7}):this.trustInGovernment>.7&&Object.keys(this.policySupport).forEach(t=>{this.policySupport[t]=Math.min(1,this.policySupport[t]*1.1)})}receiveUBI(t){this.savings+=t/this.wage,this.policySupport.ubi=Math.min(1,this.policySupport.ubi+.25),this.economicAnxiety=Math.max(0,this.economicAnxiety-.15),this.benefitedFromIntervention="ubi",this.network.forEach(e=>{e.policySupport&&(e.policySupport.ubi=Math.min(1,e.policySupport.ubi+.08))})}enrollInRetraining(t){this.status=q.RETRAINING,this.retrainingProgram=t,this.retrainingProgress=0,this.activelySearching=!1}experienceAISuccess(t){this.wage+=t,this.personalAIExperience=oi.POSITIVE,this.policySupport.aiRegulation=Math.max(0,this.policySupport.aiRegulation-.15),this.policySupport.educationInvestment=Math.min(1,this.policySupport.educationInvestment+.1),this.economicAnxiety=Math.max(0,this.economicAnxiety-.1),this.network.forEach(e=>{e.policySupport&&(e.policySupport.aiRegulation=Math.max(0,e.policySupport.aiRegulation-.02))})}getAgeGroup(){return this.age<25?"18-24":this.age<35?"25-34":this.age<45?"35-44":this.age<55?"45-54":this.age<65?"55-64":"65+"}isEmployed(){return this.status===q.EMPLOYED}isUnemployed(){return this.status===q.UNEMPLOYED}isInLaborForce(){return this.status!==q.OUT_OF_LABOR_FORCE}getSummary(){return{id:this.id,age:this.age,ageGroup:this.getAgeGroup(),education:this.education,region:this.region,status:this.status,occupation:this.occupation,industry:this.industry,wage:this.wage,unemploymentDuration:this.unemploymentDuration,economicAnxiety:this.economicAnxiety,policySupport:{...this.policySupport}}}};typeof window<"u"&&(window.WorkerAgent=bu,window.EmploymentStatus=q,window.EducationLevel=Y,window.AIExperience=oi);const z={NONE:"none",EXPLORING:"exploring",PILOTING:"piloting",SCALING:"scaling",MATURE:"mature"},Z={SMALL:"small",MEDIUM:"medium",LARGE:"large",ENTERPRISE:"enterprise"},yt={COST_MINIMIZER:"cost_minimizer",TALENT_INVESTOR:"talent_investor",BALANCED:"balanced"};let vu=class{constructor(t={}){this.id=t.id||`firm_${Math.random().toString(36).substr(2,9)}`,this.industry=t.industry||this._randomIndustry(),this.region=t.region||1,this.size=t.size||this._randomSize(),this.employees=t.employees||[],this.targetHeadcount=t.targetHeadcount||this._getTargetHeadcount(),this.openPositions=[],this.aiAdoptionStatus=t.aiAdoptionStatus||z.NONE,this.aiCapabilities=t.aiCapabilities||{},this.automationLevel=t.automationLevel||0,this.aiInvestment=0,this.aiROI=0,this.monthsInCurrentStatus=0,this.revenue=t.revenue||this._calculateInitialRevenue(),this.laborCosts=0,this.profitMargin=t.profitMargin||.05+Math.random()*.15,this.innovativeness=t.innovativeness||Math.random(),this.laborStrategy=t.laborStrategy||this._randomLaborStrategy(),this.marketShare=t.marketShare||Math.random()*.1,this.competitors=[],this.competitorAIAdoption=0,this.industryAutomationPotential=this._getIndustryAutomationPotential(),this.baseWage=this._calculateBaseWage(),this.wageAdjustmentRate=.02}_randomIndustry(){return Math.floor(Math.random()*20)+1}_randomSize(){const t=Math.random();return t<.7?Z.SMALL:t<.9?Z.MEDIUM:t<.98?Z.LARGE:Z.ENTERPRISE}_getTargetHeadcount(){switch(this.size){case Z.SMALL:return Math.floor(Math.random()*45)+5;case Z.MEDIUM:return Math.floor(Math.random()*450)+50;case Z.LARGE:return Math.floor(Math.random()*4500)+500;case Z.ENTERPRISE:return Math.floor(Math.random()*1e4)+5e3;default:return 25}}_randomLaborStrategy(){const t=Math.random();return t<.4?yt.COST_MINIMIZER:t<.7?yt.BALANCED:yt.TALENT_INVESTOR}_calculateInitialRevenue(){const t={[Z.SMALL]:1,[Z.MEDIUM]:10,[Z.LARGE]:100,[Z.ENTERPRISE]:1e3};return(5e5+Math.random()*5e5)*(t[this.size]||1)}_calculateBaseWage(){const t={1:1.3,2:1.2,3:1.1,4:.9,5:.85,6:1,7:1.15,8:.95,9:1.05,10:.9},e=4e3,i=t[this.industry]||1;return e*i}_getIndustryAutomationPotential(){return{1:.6,2:.7,3:.4,4:.8,5:.75,6:.85,7:.5,8:.65,9:.3,10:.4}[this.industry]||.5}makeMonthlyDecisions(t,e,i){this._observeCompetitors(i),this._makeAIAdoptionDecision(t),this._makeWorkforceDecisions(t,e),this._makeWageDecisions(e),this._updateFinancials(),this.monthsInCurrentStatus++}_observeCompetitors(t){if(!t||t.length===0)return;const e={[z.NONE]:0,[z.EXPLORING]:.2,[z.PILOTING]:.4,[z.SCALING]:.7,[z.MATURE]:1},i=t.reduce((n,s)=>n+(e[s.aiAdoptionStatus]||0),0);this.competitorAIAdoption=i/t.length}_makeAIAdoptionDecision(t){this._calculateAIROI(t);const e=1+(1-this.innovativeness)*.5,i=this.competitorAIAdoption>.3?.2:0,n=e-i;switch(this.aiAdoptionStatus){case z.NONE:(this.aiROI>n||this.competitorAIAdoption>.5)&&(this.aiAdoptionStatus=z.EXPLORING,this.monthsInCurrentStatus=0);break;case z.EXPLORING:this.monthsInCurrentStatus>=3+Math.floor(Math.random()*3)&&this.aiROI>n*.9&&(this.aiAdoptionStatus=z.PILOTING,this.monthsInCurrentStatus=0,this.automationLevel=.1);break;case z.PILOTING:this.monthsInCurrentStatus>=6+Math.floor(Math.random()*6)&&(Math.random()<.8?(this.aiAdoptionStatus=z.SCALING,this.monthsInCurrentStatus=0,this.automationLevel=.3):(this.aiAdoptionStatus=z.EXPLORING,this.monthsInCurrentStatus=0));break;case z.SCALING:this.monthsInCurrentStatus>=12+Math.floor(Math.random()*12)&&(this.aiAdoptionStatus=z.MATURE,this.monthsInCurrentStatus=0,this.automationLevel=.6+Math.random()*.3),this.automationLevel=Math.min(.6,this.automationLevel+.02);break;case z.MATURE:this.automationLevel=Math.min(.9,this.automationLevel+.005);break}}_calculateAIROI(t){const e=this.laborCosts*this.industryAutomationPotential*.3,n=1e5*({[Z.SMALL]:.5,[Z.MEDIUM]:1,[Z.LARGE]:2,[Z.ENTERPRISE]:5}[this.size]||1),s=t?t.getCurrentLevel():.5;this.aiROI=e*12*s/n}_makeWorkforceDecisions(t,e){const i=this.automationLevel*this.industryAutomationPotential,n=this.targetHeadcount*(1-i*.5),s=this.employees.length,o=n-s;o>5?this._createJobPostings(Math.ceil(o*.3)):o<-5&&this._planLayoffs(Math.ceil(Math.abs(o)*.2)),this.openPositions=this.openPositions.filter(r=>!r.filled)}_createJobPostings(t){for(let e=0;e<t;e++){const i={id:`job_${this.id}_${Date.now()}_${e}`,firm:this,firmId:this.id,industry:this.industry,region:this.region,occupation:this._getTypicalOccupation(),wage:this._calculateOfferWage(),requiredEducation:this._getRequiredEducation(),requiredSkills:this._getRequiredSkills(),automationExposure:this.industryAutomationPotential*(1-this.automationLevel),aiAugmentation:this.automationLevel>.3?.3:0,growthPotential:this.aiAdoptionStatus===z.SCALING?.7:.5,posted:Date.now(),filled:!1};this.openPositions.push(i)}}_getTypicalOccupation(){return this.industry*5+Math.floor(Math.random()*5)}_calculateOfferWage(){let t=this.baseWage;return this.laborStrategy===yt.TALENT_INVESTOR?t*=1.1:this.laborStrategy===yt.COST_MINIMIZER&&(t*=.9),t*=.95+Math.random()*.1,this.automationLevel>.3&&(t*=1.05),Math.round(t)}_getRequiredEducation(){return[1,2,7].includes(this.industry)?Math.random()<.7?"bachelors":"some_college":Math.random()<.5?"high_school":"some_college"}_getRequiredSkills(){const t={};return({1:["technical","programming","problemSolving"],2:["financial","analytical","dataAnalysis"],3:["healthcare","communication","problemSolving"],4:["customerService","sales","communication"],5:["customerService","communication"],6:["manufacturing","technical","problemSolving"],7:["analytical","communication","projectManagement"],8:["logistics","technical"],9:["teaching","communication","research"],10:["technical","manufacturing"]}[this.industry]||["communication"]).forEach(n=>{t[n]=.3+Math.random()*.3}),this.automationLevel>.3&&(t.dataAnalysis=.4),t}_planLayoffs(t){if(this.employees.length===0)return;const e=[...this.employees].sort((n,s)=>{let o=0,r=0;return this.laborStrategy===yt.COST_MINIMIZER&&(o+=(n.wage||0)/1e4,r+=(s.wage||0)/1e4),o+=n.automationExposure||.5,r+=s.automationExposure||.5,o+=Math.max(0,1-(n.tenure||0)/120),r+=Math.max(0,1-(s.tenure||0)/120),r-o});e.slice(0,Math.min(t,e.length)).forEach(n=>{n.markedForLayoff=!0,n.layoffReason=this.automationLevel>.3?"automation":"downsizing"})}_makeWageDecisions(t){const e=t?t.getMarketWage(this.industry,this.region):this.baseWage;this.baseWage<e*.9?this.baseWage*=1+this.wageAdjustmentRate:this.baseWage>e*1.1&&this.laborStrategy!==yt.TALENT_INVESTOR&&(this.baseWage*=1-this.wageAdjustmentRate*.5),this.automationLevel>.5&&(this.baseWage*=.998)}_updateFinancials(){if(this.laborCosts=this.employees.reduce((e,i)=>e+(i.wage||0),0),this.aiAdoptionStatus!==z.NONE){const e={[z.EXPLORING]:.001,[z.PILOTING]:.005,[z.SCALING]:.01,[z.MATURE]:.003};this.aiInvestment=this.revenue*(e[this.aiAdoptionStatus]||0)}const t=this.laborCosts*this.automationLevel*.2;this.profitMargin=Math.min(.3,this.profitMargin+t/this.revenue*.1)}getOpenPositions(){return this.openPositions.filter(t=>!t.filled)}rankApplicants(t,e){return t.map(i=>({applicant:i,score:this._scoreApplicant(i,e)})).sort((i,n)=>n.score-i.score)}_scoreApplicant(t,e){let i=0;if(e.requiredSkills&&t.skills){const r=Object.entries(e.requiredSkills).map(([l,c])=>{const d=t.skills[l]||0;return Math.min(1,d/c)});i+=r.reduce((l,c)=>l+c,0)/r.length*40}const n={no_degree:0,high_school:1,some_college:2,bachelors:3,advanced:4},s=n[e.requiredEducation]||0,o=n[t.education]||0;if(o>=s&&(i+=20+Math.min(10,(o-s)*5)),this.automationLevel>.3&&(i+=(t.aiAugmentationSkill||0)*20),this.laborStrategy===yt.COST_MINIMIZER){const r=(t.reservationWage||e.wage)/e.wage;i+=(2-r)*10}return t.region===this.region&&(i+=10),i}makeOffers(t,e){const i=[],n=Math.min(3,t.length);for(let s=0;s<n;s++){const{applicant:o,score:r}=t[s];let l=e.wage;r>80&&this.laborStrategy===yt.TALENT_INVESTOR&&(l*=1.1),i.push({firm:this,position:e,applicant:o,wage:Math.round(l),score:r})}return i}hire(t,e){this.employees.push(t),e.filled=!0,t.employer=this}executeLayoffs(){const t=[];return this.employees=this.employees.filter(e=>e.markedForLayoff?(t.push({worker:e,reason:e.layoffReason||"downsizing"}),!1):!0),t}getHeadcount(){return this.employees.length}getAverageWage(){return this.employees.length===0?this.baseWage:this.employees.reduce((t,e)=>t+(e.wage||0),0)/this.employees.length}isAdoptingAI(){return this.aiAdoptionStatus!==z.NONE}getSummary(){return{id:this.id,industry:this.industry,region:this.region,size:this.size,headcount:this.employees.length,targetHeadcount:this.targetHeadcount,openPositions:this.openPositions.filter(t=>!t.filled).length,aiAdoptionStatus:this.aiAdoptionStatus,automationLevel:this.automationLevel,averageWage:this.getAverageWage(),laborCosts:this.laborCosts,profitMargin:this.profitMargin}}};typeof window<"u"&&(window.FirmAgent=vu,window.AIAdoptionStatus=z,window.FirmSize=Z,window.LaborStrategy=yt);const A={BOOTCAMP:"bootcamp",COMMUNITY_COLLEGE:"community_college",UNIVERSITY:"university",EMPLOYER_SPONSORED:"employer_sponsored",ONLINE:"online"},Vt={ACTIVE:"active",FULL:"full",SUSPENDED:"suspended",CLOSED:"closed"};let xu=class{constructor(t={}){this.id=t.id||`prog_${Math.random().toString(36).substr(2,9)}`,this.type=t.type||this._randomType(),this.region=t.region||1,this.name=t.name||this._generateName(),this.maxEnrollment=t.maxEnrollment||this._getDefaultCapacity(),this.currentEnrollment=0,this.waitlist=[],this.enrolledWorkers=[],this.targetOccupations=t.targetOccupations||this._getDefaultTargetOccupations(),this.skillsProvided=t.skillsProvided||this._getDefaultSkills(),this.duration=t.duration||this._getDefaultDuration(),this.cost=t.cost||this._getDefaultCost(),this.subsidyAvailable=t.subsidyAvailable||0,this.qualityScore=t.qualityScore||.5+Math.random()*.4,this.completionRate=t.completionRate||this._calculateInitialCompletionRate(),this.jobPlacementRate=t.jobPlacementRate||this._calculateInitialPlacementRate(),this.reputation=t.reputation||this.qualityScore*.8+Math.random()*.2,this.totalGraduates=0,this.totalDropouts=0,this.placementsThisYear=0,this.graduatesThisYear=0,this.studentProgress=new Map,this.status=Vt.ACTIVE,this.revenue=0,this.operatingCosts=this._calculateOperatingCosts()}_randomType(){const t=Math.random();return t<.25?A.BOOTCAMP:t<.45?A.COMMUNITY_COLLEGE:t<.6?A.UNIVERSITY:t<.8?A.EMPLOYER_SPONSORED:A.ONLINE}_generateName(){const t={[A.BOOTCAMP]:["Tech","Code","Data","Digital","Cyber"],[A.COMMUNITY_COLLEGE]:["Central","Metro","Valley","Regional","State"],[A.UNIVERSITY]:["State","National","Metro","Technical","Applied"],[A.EMPLOYER_SPONSORED]:["Corporate","Industry","Professional","Enterprise","Business"],[A.ONLINE]:["Virtual","Online","Digital","Remote","eLearning"]},e={[A.BOOTCAMP]:["Bootcamp","Academy","Institute","School","Lab"],[A.COMMUNITY_COLLEGE]:["Community College","Technical College","College"],[A.UNIVERSITY]:["University","Institute of Technology","Polytechnic"],[A.EMPLOYER_SPONSORED]:["Training Center","Skills Program","Development Program"],[A.ONLINE]:["Academy","Learning Platform","Skills Center"]},i=t[this.type][Math.floor(Math.random()*t[this.type].length)],n=e[this.type][Math.floor(Math.random()*e[this.type].length)];return`${i} ${n}`}_getDefaultCapacity(){return{[A.BOOTCAMP]:Math.floor(Math.random()*30)+20,[A.COMMUNITY_COLLEGE]:Math.floor(Math.random()*200)+100,[A.UNIVERSITY]:Math.floor(Math.random()*500)+200,[A.EMPLOYER_SPONSORED]:Math.floor(Math.random()*50)+10,[A.ONLINE]:Math.floor(Math.random()*1e3)+500}[this.type]}_getDefaultDuration(){return{[A.BOOTCAMP]:Math.floor(Math.random()*3)+3,[A.COMMUNITY_COLLEGE]:Math.floor(Math.random()*12)+12,[A.UNIVERSITY]:Math.floor(Math.random()*24)+24,[A.EMPLOYER_SPONSORED]:Math.floor(Math.random()*4)+2,[A.ONLINE]:Math.floor(Math.random()*6)+3}[this.type]}_getDefaultCost(){return{[A.BOOTCAMP]:Math.floor(Math.random()*2e3)+2e3,[A.COMMUNITY_COLLEGE]:Math.floor(Math.random()*500)+300,[A.UNIVERSITY]:Math.floor(Math.random()*1500)+1e3,[A.EMPLOYER_SPONSORED]:0,[A.ONLINE]:Math.floor(Math.random()*200)+50}[this.type]}_getDefaultTargetOccupations(){const t=[],e=Math.floor(Math.random()*5)+3;for(let i=0;i<e;i++)t.push(Math.floor(Math.random()*100)+1);return t}_getDefaultSkills(){return{[A.BOOTCAMP]:{programming:.4+Math.random()*.2,dataAnalysis:.3+Math.random()*.2,technical:.3+Math.random()*.2,problemSolving:.2+Math.random()*.1},[A.COMMUNITY_COLLEGE]:{technical:.3+Math.random()*.2,communication:.2+Math.random()*.1,customerService:.2+Math.random()*.1,manufacturing:.2+Math.random()*.2,healthcare:.15+Math.random()*.15},[A.UNIVERSITY]:{analytical:.3+Math.random()*.2,research:.3+Math.random()*.2,writing:.25+Math.random()*.15,leadership:.2+Math.random()*.1,problemSolving:.25+Math.random()*.15},[A.EMPLOYER_SPONSORED]:{technical:.35+Math.random()*.2,projectManagement:.2+Math.random()*.15,communication:.15+Math.random()*.1},[A.ONLINE]:{programming:.3+Math.random()*.2,dataAnalysis:.25+Math.random()*.15,marketing:.2+Math.random()*.1,technical:.2+Math.random()*.15}}[this.type]}_calculateInitialCompletionRate(){return({[A.BOOTCAMP]:.7,[A.COMMUNITY_COLLEGE]:.55,[A.UNIVERSITY]:.6,[A.EMPLOYER_SPONSORED]:.85,[A.ONLINE]:.35}[this.type]||.6)+(Math.random()*.2-.1)}_calculateInitialPlacementRate(){return({[A.BOOTCAMP]:.75,[A.COMMUNITY_COLLEGE]:.7,[A.UNIVERSITY]:.8,[A.EMPLOYER_SPONSORED]:.95,[A.ONLINE]:.5}[this.type]||.65)+(Math.random()*.15-.05)}_calculateOperatingCosts(){return{[A.BOOTCAMP]:5e4,[A.COMMUNITY_COLLEGE]:2e5,[A.UNIVERSITY]:5e5,[A.EMPLOYER_SPONSORED]:3e4,[A.ONLINE]:2e4}[this.type]||5e4}canEnroll(t){if(this.status!==Vt.ACTIVE)return{eligible:!1,reason:"Program not accepting students"};if(this.currentEnrollment>=this.maxEnrollment)return{eligible:!1,reason:"Program at capacity",canWaitlist:!0};if(t.retrainingProgram)return{eligible:!1,reason:"Already enrolled in a program"};if(this.type===A.UNIVERSITY&&t.age>55)return{eligible:!1,reason:"Age restriction"};const e=this.cost*(1-this.subsidyAvailable);return e>0&&t.savings<e/t.wage*this.duration*.5?{eligible:!1,reason:"Insufficient funds"}:this.type===A.UNIVERSITY&&!["high_school","some_college","bachelors","advanced"].includes(t.education)?{eligible:!1,reason:"Education requirements not met"}:{eligible:!0}}enrollWorker(t,e){const i=this.canEnroll(t);if(!i.eligible)return i.canWaitlist&&this.addToWaitlist(t),{success:!1,reason:i.reason};this.enrolledWorkers.push(t),this.currentEnrollment++,this.studentProgress.set(t.id,{enrolledMonth:e,currentProgress:0,expectedGraduation:e+this.duration,monthlyProgress:1/this.duration});const n=this.cost*(1-this.subsidyAvailable);return t.enrollInRetraining({id:this.id,name:this.name,type:this.type,duration:this.duration,skillsProvided:this.skillsProvided,monthlyCost:n,qualityScore:this.qualityScore}),this.revenue+=n,this.currentEnrollment>=this.maxEnrollment&&(this.status=Vt.FULL),{success:!0,program:this}}addToWaitlist(t){this.waitlist.find(e=>e.id===t.id)||(this.waitlist.push({worker:t,addedMonth:t.unemploymentDuration||0,priority:this._calculateWaitlistPriority(t)}),this.waitlist.sort((e,i)=>i.priority-e.priority))}_calculateWaitlistPriority(t){let e=0;return t.status==="unemployed"&&(e+=30,e+=Math.min(20,t.unemploymentDuration*2)),e+=Math.max(0,(60-t.age)/2),e+=Math.max(0,10-t.savings),e}processMonth(t,e={}){const i={graduates:[],dropouts:[],newEnrollments:[],waitlistProcessed:0};return[...this.enrolledWorkers].forEach(s=>{const o=this.studentProgress.get(s.id);o&&(o.currentProgress+=o.monthlyProgress,o.currentProgress>=1?this._graduateStudent(s,t)&&i.graduates.push(s):this._shouldDropout(s,o)&&(this._handleDropout(s,t),i.dropouts.push(s)))}),this.currentEnrollment<this.maxEnrollment&&this.waitlist.length>0&&(i.waitlistProcessed=this._processWaitlist(t)),this._updateQualityMetrics(),this.currentEnrollment<this.maxEnrollment&&this.status===Vt.FULL&&(this.status=Vt.ACTIVE),i}_graduateStudent(t,e){return this.enrolledWorkers=this.enrolledWorkers.filter(i=>i.id!==t.id),this.studentProgress.delete(t.id),this.currentEnrollment--,this.totalGraduates++,this.graduatesThisYear++,t.skills&&this.skillsProvided&&Object.entries(this.skillsProvided).forEach(([i,n])=>{const s=t.skills[i]||0,o=n*this.qualityScore;t.skills[i]=Math.min(1,s+o)}),t.aiAugmentationSkill!==void 0&&(t.aiAugmentationSkill=Math.min(1,t.aiAugmentationSkill+.15*this.qualityScore)),typeof t._completeRetraining=="function"?t._completeRetraining():(t.status="unemployed",t.retrainingProgram=null,t.retrainingProgress=0,t.activelySearching=!0),Math.random()<this.jobPlacementRate&&this.placementsThisYear++,!0}_shouldDropout(t,e){let i=(1-this.completionRate)/this.duration;return t.savings<=0?i*=3:t.savings<2&&(i*=1.5),this.type===A.ONLINE&&(i*=1.5),i*=1.5-this.qualityScore,t.unemploymentSpells>0&&(i*=.8),Math.random()<i}_handleDropout(t,e){this.enrolledWorkers=this.enrolledWorkers.filter(i=>i.id!==t.id),this.studentProgress.delete(t.id),this.currentEnrollment--,this.totalDropouts++,typeof t._dropoutRetraining=="function"?t._dropoutRetraining():(t.status="unemployed",t.retrainingProgram=null,t.retrainingProgress=0,t.activelySearching=!0)}_processWaitlist(t){let e=0;const i=this.maxEnrollment-this.currentEnrollment;for(;this.waitlist.length>0&&e<i;){const s=this.waitlist.shift().worker;(s.status==="unemployed"||s.wantsRetraining)&&this.enrollWorker(s,t).success&&e++}return e}_updateQualityMetrics(){if(this.totalGraduates+this.totalDropouts>10){const e=this.totalGraduates/(this.totalGraduates+this.totalDropouts);this.completionRate=this.completionRate*.9+e*.1}const t=(this.completionRate+this.jobPlacementRate)/2;this.reputation=this.reputation*.95+t*.05}respondToMarket(t){const{demandedSkills:e,unemploymentRate:i,aiAdoptionRate:n}=t;i>.08&&this.currentEnrollment>this.maxEnrollment*.8&&(this.maxEnrollment=Math.floor(this.maxEnrollment*1.1)),e&&n>.3&&(this.skillsProvided.programming&&(this.skillsProvided.programming=Math.min(1,this.skillsProvided.programming*1.05)),this.skillsProvided.dataAnalysis&&(this.skillsProvided.dataAnalysis=Math.min(1,this.skillsProvided.dataAnalysis*1.05)))}receiveSubsidy(t){this.subsidyAvailable=Math.min(1,t),t>.5&&(this.maxEnrollment=Math.floor(this.maxEnrollment*1.2))}getSummary(){return{id:this.id,name:this.name,type:this.type,region:this.region,status:this.status,enrollment:{current:this.currentEnrollment,max:this.maxEnrollment,waitlist:this.waitlist.length},metrics:{completionRate:this.completionRate,jobPlacementRate:this.jobPlacementRate,qualityScore:this.qualityScore,reputation:this.reputation},program:{duration:this.duration,cost:this.cost,subsidyAvailable:this.subsidyAvailable,effectiveCost:this.cost*(1-this.subsidyAvailable)},outcomes:{totalGraduates:this.totalGraduates,totalDropouts:this.totalDropouts,graduatesThisYear:this.graduatesThisYear,placementsThisYear:this.placementsThisYear},skillsProvided:this.skillsProvided}}getAvailableCapacity(){return Math.max(0,this.maxEnrollment-this.currentEnrollment)}isAcceptingApplications(){return this.status===Vt.ACTIVE&&this.currentEnrollment<this.maxEnrollment}getEffectiveCost(){return this.cost*(1-this.subsidyAvailable)}calculateROIForWorker(t){const e=this.getEffectiveCost()*this.duration,i=t.wage*.25*this.qualityScore,n=Math.max(1,65-t.age-this.duration/12),s=this.completionRate*this.jobPlacementRate,o=i*12*n*s;return{cost:e,expectedBenefit:o,roi:e>0?o/e:1/0,paybackYears:i>0?e/(i*12):1/0,successProbability:s}}};typeof window<"u"&&(window.TrainingProgramAgent=xu,window.ProgramType=A,window.ProgramStatus=Vt);let wu=class{constructor(t={}){this.workers=t.workers||[],this.firms=t.firms||[],this.jobPostings=[],this.applications=[],this.hires=[],this.layoffs=[],this.marketWages={},this.unemploymentRates={},this.searchRadius=t.searchRadius||1,this.networkBonus=t.networkBonus||.2}setPopulations(t,e){this.workers=t,this.firms=e,this._updateMarketStatistics()}runMonthlyMatching(){return this.applications=[],this.hires=[],this.layoffs=[],this._collectJobPostings(),this._workerApplicationPhase(),this._firmSelectionPhase(),this._workerAcceptancePhase(),this._executeLayoffs(),this._updateMarketStatistics(),{hires:this.hires.length,layoffs:this.layoffs.length,openPositions:this.jobPostings.filter(t=>!t.filled).length,applications:this.applications.length}}_collectJobPostings(){this.jobPostings=[],this.firms.forEach(t=>{const e=t.getOpenPositions();this.jobPostings.push(...e)})}_workerApplicationPhase(){this.workers.filter(e=>e.activelySearching||e.status==="unemployed").forEach(e=>{const i=this.getVisibleJobs(e);e.searchForJobs({getVisibleJobs:()=>i}).forEach(s=>{this.applications.push({worker:e,job:s,timestamp:Date.now()})})})}_firmSelectionPhase(){const t={};this.applications.forEach(e=>{t[e.job.id]||(t[e.job.id]=[]),t[e.job.id].push(e.worker)}),this.firms.forEach(e=>{e.getOpenPositions().forEach(i=>{const n=t[i.id]||[];if(n.length===0)return;const s=e.rankApplicants(n,i);e.makeOffers(s,i).forEach(r=>{r.applicant.jobOffers||(r.applicant.jobOffers=[]),r.applicant.jobOffers.push(r)})})})}_workerAcceptancePhase(){this.workers.filter(e=>e.jobOffers&&e.jobOffers.length>0).forEach(e=>{const i=e.evaluateOffers();i&&(e.acceptJob(i,i.firm),i.firm.hire(e,i.position),this.hires.push({worker:e,firm:i.firm,position:i.position,wage:i.wage})),e.jobOffers=[]})}_executeLayoffs(){this.firms.forEach(t=>{t.executeLayoffs().forEach(({worker:i,reason:n})=>{i.layOff(n),this.layoffs.push({worker:i,firm:t,reason:n})})})}_updateMarketStatistics(){const t={};this.workers.forEach(e=>{t[e.region]||(t[e.region]={employed:0,unemployed:0,laborForce:0,totalWages:0,wageCount:0}),e.isInLaborForce()&&(t[e.region].laborForce++,e.isEmployed()?(t[e.region].employed++,t[e.region].totalWages+=e.wage,t[e.region].wageCount++):e.isUnemployed()&&t[e.region].unemployed++)}),Object.entries(t).forEach(([e,i])=>{this.unemploymentRates[e]=i.laborForce>0?i.unemployed/i.laborForce:0}),this.marketWages={},this.firms.forEach(e=>{this.marketWages[e.region]||(this.marketWages[e.region]={}),this.marketWages[e.region][e.industry]||(this.marketWages[e.region][e.industry]={total:0,count:0});const i=e.getAverageWage();this.marketWages[e.region][e.industry].total+=i,this.marketWages[e.region][e.industry].count++})}getVisibleJobs(t){const e=[];return this.jobPostings.forEach(i=>{if(i.filled)return;let n=0;i.region===t.region?n=1:Math.abs(i.region-t.region)<=this.searchRadius&&(n=.5*t.mobilityWillingness),t.network&&t.network.length>0&&t.network.some(o=>o.employer&&o.employer.id===i.firmId)&&(n+=this.networkBonus),n*=.5+t.informationLevel*.5,Math.random()<n&&e.push(i)}),e.sort((i,n)=>{const s=i.region===t.region?1:0,o=n.region===t.region?1:0;return s!==o?o-s:(n.wage||0)-(i.wage||0)})}getMarketWage(t,e){if(this.marketWages[e]&&this.marketWages[e][t]){const i=this.marketWages[e][t];return i.count>0?i.total/i.count:4e3}return 4e3}getUnemploymentRate(t){return this.unemploymentRates[t]||0}getMarketStatistics(){const t=this.workers.length,e=this.workers.filter(u=>u.isInLaborForce()).length,i=this.workers.filter(u=>u.isEmployed()).length,n=this.workers.filter(u=>u.isUnemployed()).length,s=this.workers.filter(u=>u.status==="retraining").length,o=this.firms.length,r=this.firms.filter(u=>u.isAdoptingAI()).length,l=this.jobPostings.filter(u=>!u.filled).length,c=this.workers.filter(u=>u.isEmployed()&&u.wage>0).map(u=>u.wage).sort((u,m)=>u-m),d=c.length>0?c[Math.floor(c.length/2)]:0,h=c.length>0?c.reduce((u,m)=>u+m,0)/c.length:0;return{totalWorkers:t,inLaborForce:e,employed:i,unemployed:n,retraining:s,outOfLaborForce:t-e,unemploymentRate:e>0?n/e:0,laborForceParticipation:t>0?e/t:0,totalFirms:o,firmsAdoptingAI:r,aiAdoptionRate:o>0?r/o:0,openPositions:l,medianWage:d,avgWage:h,monthlyHires:this.hires.length,monthlyLayoffs:this.layoffs.length,netJobChange:this.hires.length-this.layoffs.length,regionalUnemployment:{...this.unemploymentRates}}}getPolicySupportStatistics(){const t=["ubi","retraining","wageSubsidy","reducedWorkWeek","publicWorks","eitcExpansion","aiRegulation","tradeProtection","educationInvestment"],e={};return t.forEach(i=>{const n=this.workers.filter(d=>d.policySupport&&d.policySupport[i]!==void 0).map(d=>d.policySupport[i]);if(n.length===0){e[i]={mean:.5,median:.5,strongSupport:0,strongOppose:0};return}const s=[...n].sort((d,h)=>d-h),o=n.reduce((d,h)=>d+h,0)/n.length,r=s[Math.floor(s.length/2)],l=n.filter(d=>d>.7).length/n.length,c=n.filter(d=>d<.3).length/n.length;e[i]={mean:Math.round(o*100)/100,median:Math.round(r*100)/100,strongSupport:Math.round(l*100)/100,strongOppose:Math.round(c*100)/100,feasibilityScore:Math.round((o*.5+(1-c)*.3+l*.2)*100)}}),e}getPolicySupportByDemographic(t){const e={},i={},n={};this.workers.forEach(o=>{if(!o.policySupport||o.policySupport[t]===void 0)return;const r=o.policySupport[t],l=o.getAgeGroup();e[l]||(e[l]={total:0,count:0}),e[l].total+=r,e[l].count++,i[o.education]||(i[o.education]={total:0,count:0}),i[o.education].total+=r,i[o.education].count++,n[o.status]||(n[o.status]={total:0,count:0}),n[o.status].total+=r,n[o.status].count++});const s=o=>{const r={};return Object.entries(o).forEach(([l,c])=>{r[l]=c.count>0?Math.round(c.total/c.count*100)/100:0}),r};return{byAge:s(e),byEducation:s(i),byStatus:s(n)}}};typeof window<"u"&&(window.LaborMarket=wu);let Su=class{constructor(t={}){this.nationalMedianWage=t.nationalMedianWage||4500,this.nationalMeanWage=t.nationalMeanWage||5200,this.minimumWage=t.minimumWage||1260,this.upwardStickiness=t.upwardStickiness||.02,this.downwardStickiness=t.downwardStickiness||.01,this.supplyElasticity=t.supplyElasticity||.3,this.demandElasticity=t.demandElasticity||.4,this.aiWagePremium=t.aiWagePremium||.15,this.automationWageDiscount=t.automationWageDiscount||.1,this.wageHistory=[],this.industryWages={},this.regionWages={},this.skillPremiums={}}calculateJobWage(t,e,i){let n=this.nationalMedianWage;const s=this._getIndustryMultiplier(t.industry);if(n*=s,i!=null&&i.costOfLiving&&(n*=i.costOfLiving),t.requiredSkills){const l=this._calculateSkillPremium(t.requiredSkills);n*=1+l}const o=this._getEducationMultiplier(t.requiredEducation);n*=o,t.aiAugmentation&&(n*=1+this.aiWagePremium*t.aiAugmentation),t.automationExposure&&(n*=1-this.automationWageDiscount*t.automationExposure);const r=this._calculateMarketTightness(e,t);return n*=1+r*.1,n=Math.max(n,this.minimumWage),Math.round(n)}adjustMarketWages(t,e,i){const n={byIndustry:{},byRegion:{},bySkill:{},overall:0},s=t.filter(c=>c.status==="unemployed"||c.activelySearching).length,o=e.reduce((c,d)=>{var h;return c+(((h=d.openPositions)==null?void 0:h.length)||0)},0),r=o>0?s/o:2;let l=0;return r<1?l=(1-r)*this.upwardStickiness:r>1.5&&(l=-(r-1.5)*this.downwardStickiness),n.overall=l,this._calculateIndustryWageAdjustments(t,e,n),this._calculateRegionWageAdjustments(t,e,n),this._calculateSkillPremiumAdjustments(t,e,n),this._applyWageAdjustments(t,n),this.wageHistory.push({month:this.wageHistory.length,medianWage:this._calculateMedianWage(t),meanWage:this._calculateMeanWage(t),adjustments:{...n}}),n}_calculateIndustryWageAdjustments(t,e,i){const n={};t.filter(s=>s.status==="employed").forEach(s=>{const o=s.industry;n[o]||(n[o]={employed:0,totalWage:0}),n[o].employed++,n[o].totalWage+=s.wage}),e.forEach(s=>{var r;const o=s.industry;n[o]||(n[o]={employed:0,totalWage:0,openings:0}),n[o].openings=(n[o].openings||0)+(((r=s.openPositions)==null?void 0:r.length)||0)}),Object.keys(n).forEach(s=>{const o=n[s],r=o.employed>0?o.totalWage/o.employed:this.nationalMedianWage,l=o.openings/Math.max(1,o.employed);let c=0;l>.1?c=Math.min(.05,(l-.1)*this.upwardStickiness):l<.02&&(c=Math.max(-.02,(l-.02)*this.downwardStickiness)),i.byIndustry[s]=c,this.industryWages[s]=r*(1+c)})}_calculateRegionWageAdjustments(t,e,i){const n={};t.forEach(s=>{const o=s.region;n[o]||(n[o]={employed:0,unemployed:0,totalWage:0}),s.status==="employed"?(n[o].employed++,n[o].totalWage+=s.wage):s.status==="unemployed"&&n[o].unemployed++}),Object.keys(n).forEach(s=>{const o=n[s],r=o.employed+o.unemployed>0?o.unemployed/(o.employed+o.unemployed):.05;let l=0;r<.04?l=(.04-r)*this.upwardStickiness*2:r>.08&&(l=-(r-.08)*this.downwardStickiness*2),i.byRegion[s]=l,this.regionWages[s]=o.employed>0?o.totalWage/o.employed*(1+l):this.nationalMedianWage})}_calculateSkillPremiumAdjustments(t,e,i){["programming","dataAnalysis","aiAugmentationSkill","technical","leadership","healthcare"].forEach(s=>{const o=t.filter(d=>{var h;return s==="aiAugmentationSkill"?d.aiAugmentationSkill>.6:((h=d.skills)==null?void 0:h[s])>.6}),r=t.length,l=o.length/Math.max(1,r);let c=0;l<.1?c=.2:l<.2?c=.1:l<.3&&(c=.05),["programming","dataAnalysis","aiAugmentationSkill"].includes(s)&&(c*=1.2),i.bySkill[s]=c,this.skillPremiums[s]=c})}_applyWageAdjustments(t,e){t.filter(i=>i.status==="employed").forEach(i=>{let n=e.overall;e.byIndustry[i.industry]&&(n+=e.byIndustry[i.industry]),e.byRegion[i.region]&&(n+=e.byRegion[i.region]),n=Math.max(-.02,Math.min(.05,n)),n!==0&&(i.wage=Math.round(i.wage*(1+n)),i.wage=Math.max(this.minimumWage,i.wage))})}_getIndustryMultiplier(t){return{1:1.4,2:1.2,3:1.35,4:.75,5:1,6:.9,7:.95,8:1.05,9:1,10:1.25,11:.7,12:.8,13:1.15,14:1.1,15:1.05,16:1.1,17:1.15,18:1.3,19:.95,20:.85}[t]||1}_getEducationMultiplier(t){return{no_degree:.7,high_school:.85,some_college:1,bachelors:1.35,advanced:1.7}[t]||1}_calculateSkillPremium(t){if(!t)return 0;let e=0,i=0;return Object.entries(t).forEach(([n,s])=>{const o=this.skillPremiums[n]||0;e+=o*s,i++}),i>0?e/i:0}_calculateMarketTightness(t,e){var s;return t?.05-((((s=t.getMarketStatistics)==null?void 0:s.call(t))||{}).unemploymentRate||.05):0}_calculateMedianWage(t){const e=t.filter(n=>n.status==="employed"&&n.wage>0).map(n=>n.wage).sort((n,s)=>n-s);if(e.length===0)return this.nationalMedianWage;const i=Math.floor(e.length/2);return e.length%2!==0?e[i]:(e[i-1]+e[i])/2}_calculateMeanWage(t){const e=t.filter(i=>i.status==="employed"&&i.wage>0);return e.length===0?this.nationalMeanWage:e.reduce((i,n)=>i+n.wage,0)/e.length}getWageDistribution(t){const e=t.filter(o=>o.status==="employed"&&o.wage>0).map(o=>o.wage).sort((o,r)=>o-r);if(e.length===0)return{min:0,p10:0,p25:0,median:0,p75:0,p90:0,max:0,mean:0,stdDev:0,gini:0};const i=e.length,n=e.reduce((o,r)=>o+r,0)/i,s=e.reduce((o,r)=>o+Math.pow(r-n,2),0)/i;return{min:e[0],p10:e[Math.floor(i*.1)],p25:e[Math.floor(i*.25)],median:e[Math.floor(i*.5)],p75:e[Math.floor(i*.75)],p90:e[Math.floor(i*.9)],max:e[i-1],mean:Math.round(n),stdDev:Math.round(Math.sqrt(s)),gini:this._calculateGini(e)}}_calculateGini(t){if(t.length===0)return 0;const e=t.length;let i=0;const n=t.reduce((s,o)=>s+o,0);for(let s=0;s<e;s++)for(let o=0;o<e;o++)i+=Math.abs(t[s]-t[o]);return i/(2*e*n)}getWagePolarization(t){const e=this.getWageDistribution(t),i=e.p25,n=e.p75,s=t.filter(d=>d.status==="employed"&&d.wage>0).map(d=>d.wage),o=s.filter(d=>d<i).length/s.length,r=s.filter(d=>d>=i&&d<=n).length/s.length,l=s.filter(d=>d>n).length/s.length,c=r>0?(o+l)/r:0;return{lowShare:o,midShare:r,highShare:l,polarizationRatio:c,isPolarizing:c>1.5}}getAIWageImpact(t){const e=t.filter(l=>l.status==="employed"&&l.wage>0),i=e.filter(l=>l.aiAugmentationSkill>.6),n=e.filter(l=>l.aiAugmentationSkill<=.6),s=i.length>0?i.reduce((l,c)=>l+c.wage,0)/i.length:0,o=n.length>0?n.reduce((l,c)=>l+c.wage,0)/n.length:0,r=o>0?(s-o)/o:0;return{highAISkillCount:i.length,lowAISkillCount:n.length,highAIAvgWage:Math.round(s),lowAIAvgWage:Math.round(o),aiSkillPremium:r,premiumPercent:(r*100).toFixed(1)+"%"}}getSummary(t){return{distribution:this.getWageDistribution(t),polarization:this.getWagePolarization(t),aiImpact:this.getAIWageImpact(t),industryWages:{...this.industryWages},skillPremiums:{...this.skillPremiums},historyLength:this.wageHistory.length}}};typeof window<"u"&&(window.WageDynamics=Su);const ht={AI_AWARENESS:"ai_awareness",JOB_OPPORTUNITIES:"job_opportunities",RETRAINING_OPTIONS:"retraining_options",POLICY_NEWS:"policy_news",LAYOFF_NEWS:"layoff_news",SUCCESS_STORIES:"success_stories",FAILURE_STORIES:"failure_stories"},ut={MASS_LAYOFF:"mass_layoff",BREAKTHROUGH:"ai_breakthrough",POLICY_ANNOUNCEMENT:"policy_announcement",STUDY_RELEASE:"study_release",COMPANY_NEWS:"company_news"};let ku=class{constructor(t={}){this.baseSpreadRate=t.baseSpreadRate||.05,this.networkWeight=t.networkWeight||.3,this.mediaWeight=t.mediaWeight||.2,this.decayRate=t.decayRate||.02,this.globalAwareness={[ht.AI_AWARENESS]:.3,[ht.JOB_OPPORTUNITIES]:.5,[ht.RETRAINING_OPTIONS]:.2,[ht.POLICY_NEWS]:.3,[ht.LAYOFF_NEWS]:.2,[ht.SUCCESS_STORIES]:.2,[ht.FAILURE_STORIES]:.1},this.mediaEvents=[],this.mediaEventHistory=[],this.diffusionHistory=[]}processMonth(t,e,i,n={}){const s={month:i,networkDiffusion:0,mediaEvents:[],awarenessChanges:{}};return this._generateMediaEvents(n,i),s.mediaEvents=this._processMediaEvents(t,i),s.networkDiffusion=this._processNetworkDiffusion(t),this._applyDecay(t),this._updateGlobalAwareness(t),Object.keys(this.globalAwareness).forEach(o=>{s.awarenessChanges[o]=this.globalAwareness[o]}),this.diffusionHistory.push(s),s}_generateMediaEvents(t,e){const{unemploymentRate:i,layoffCount:n,aiAdoptionRate:s,policyChanges:o}=t;n&&n>5e3&&this.queueMediaEvent({type:ut.MASS_LAYOFF,month:e,magnitude:Math.min(1,n/5e4),affectedIndustry:t.mostAffectedIndustry,description:`Major layoffs: ${n.toLocaleString()} jobs lost`}),Math.random()<.02*(1+s)&&this.queueMediaEvent({type:ut.BREAKTHROUGH,month:e,magnitude:.3+Math.random()*.4,description:"Major AI capability breakthrough announced"}),o&&o.length>0&&o.forEach(r=>{this.queueMediaEvent({type:ut.POLICY_ANNOUNCEMENT,month:e,magnitude:.4,policy:r.type,description:`New ${r.type} policy announced`})}),e%6===0&&this.queueMediaEvent({type:ut.STUDY_RELEASE,month:e,magnitude:.2,description:"New study on AI employment impact released"})}queueMediaEvent(t){this.mediaEvents.push(t)}_processMediaEvents(t,e){const i=[];for(;this.mediaEvents.length>0;){const n=this.mediaEvents.shift(),s=this._applyMediaEvent(t,n);i.push({...n,workersAffected:s}),this.mediaEventHistory.push(n)}return i}_applyMediaEvent(t,e){let i=0;return t.forEach(n=>{const s=this._calculateMediaExposure(n,e);Math.random()<s&&(this._updateWorkerFromMedia(n,e),i++)}),i}_calculateMediaExposure(t,e){let i=.3;return i+=t.informationLevel*.3,i*=e.magnitude,e.affectedIndustry&&t.industry===e.affectedIndustry&&(i*=1.5),t.status==="unemployed"&&[ut.MASS_LAYOFF,ut.POLICY_ANNOUNCEMENT].includes(e.type)&&(i*=1.3),Math.min(.9,i)}_updateWorkerFromMedia(t,e){switch(e.type){case ut.MASS_LAYOFF:t.informationLevel=Math.min(1,t.informationLevel+.1*e.magnitude),t.economicAnxiety=Math.min(1,t.economicAnxiety+.08*e.magnitude),t.policySupport&&(t.policySupport.ubi=Math.min(1,t.policySupport.ubi+.05*e.magnitude),t.policySupport.aiRegulation=Math.min(1,t.policySupport.aiRegulation+.04*e.magnitude));break;case ut.BREAKTHROUGH:t.informationLevel=Math.min(1,t.informationLevel+.15*e.magnitude),t.status==="employed"&&t.aiAugmentationSkill>.5?t.economicAnxiety=Math.max(0,t.economicAnxiety-.03):t.economicAnxiety=Math.min(1,t.economicAnxiety+.05*e.magnitude);break;case ut.POLICY_ANNOUNCEMENT:t.informationLevel=Math.min(1,t.informationLevel+.08),t.economicAnxiety>.3&&(t.economicAnxiety=Math.max(0,t.economicAnxiety-.02)),t.trustInGovernment=Math.min(1,t.trustInGovernment+.03);break;case ut.STUDY_RELEASE:t.informationLevel=Math.min(1,t.informationLevel+.05);break}}_processNetworkDiffusion(t){let e=0;return t.forEach(i=>{if(!i.network||i.network.length===0)return;const n=this._calculateNetworkInformation(i),o=(n.averageInfoLevel-i.informationLevel)*this.baseSpreadRate*this.networkWeight;i.informationLevel=Math.max(0,Math.min(1,i.informationLevel+o)),n.hasJobInfo&&i.status==="unemployed"&&(i.jobSearchEffectiveness=Math.min(1,(i.jobSearchEffectiveness||.5)+.05));const l=(n.averageAnxiety-i.economicAnxiety)*this.baseSpreadRate*this.networkWeight*.5;i.economicAnxiety=Math.max(0,Math.min(1,i.economicAnxiety+l)),n.retrainingSuccess&&(i.informationLevel=Math.min(1,i.informationLevel+.02),i.policySupport&&(i.policySupport.retraining=Math.min(1,i.policySupport.retraining+.02))),e+=Math.abs(o)}),e}_calculateNetworkInformation(t){const e=t.network;let i=0,n=0,s=!1,o=!1;e.forEach(l=>{const c=l.closeness||.5;i+=(l.informationLevel||.5)*c,n+=(l.economicAnxiety||.2)*c,l.status==="employed"&&l.tenure<3&&(s=!0),l.benefitedFromIntervention==="retraining"&&(o=!0)});const r=e.reduce((l,c)=>l+(c.closeness||.5),0);return{averageInfoLevel:r>0?i/r:.5,averageAnxiety:r>0?n/r:.2,hasJobInfo:s,retrainingSuccess:o}}_applyDecay(t){t.forEach(e=>{e.informationLevel>.3&&(e.informationLevel=Math.max(.3,e.informationLevel-this.decayRate*.1)),e.status==="employed"&&e.tenure>6&&(e.economicAnxiety=Math.max(.1,e.economicAnxiety-this.decayRate*.5))})}_updateGlobalAwareness(t){const e=t.length;if(e===0)return;this.globalAwareness[ht.AI_AWARENESS]=t.reduce((s,o)=>s+(o.informationLevel||.3),0)/e;const i=t.filter(s=>s.activelySearching);this.globalAwareness[ht.JOB_OPPORTUNITIES]=i.length>0?i.reduce((s,o)=>s+(o.jobSearchEffectiveness||.5),0)/i.length:.5;const n=t.filter(s=>s.status==="retraining"||s.benefitedFromIntervention==="retraining");this.globalAwareness[ht.RETRAINING_OPTIONS]=Math.min(.8,.2+n.length/e*2)}detectEchoChambers(t){const e=[],i=Math.min(100,t.length);return t.filter(s=>s.network&&s.network.length>=5).sort(()=>Math.random()-.5).slice(0,i).forEach(s=>{const o=s.network.map(l=>{if(!l.policySupport||!s.policySupport)return .5;let c=0,d=0;return Object.keys(s.policySupport).forEach(h=>{if(l.policySupport[h]!==void 0){const u=Math.abs(s.policySupport[h]-l.policySupport[h]);c+=1-u,d++}}),d>0?c/d:.5}),r=o.reduce((l,c)=>l+c,0)/o.length;r>.8&&e.push({worker:s.id,similarity:r,networkSize:s.network.length,dominantView:this._getDominantView(s)})}),{echoChamberCount:e.length,percentage:(e.length/i*100).toFixed(1),chambers:e.slice(0,10)}}_getDominantView(t){if(!t.policySupport)return"neutral";const e=Object.entries(t.policySupport),i=e.filter(([s,o])=>o>.7),n=e.filter(([s,o])=>o<.3);return i.length>n.length?`pro-intervention (${i.map(s=>s[0]).join(", ")})`:n.length>i.length?"anti-intervention":"mixed"}detectCascades(){if(this.diffusionHistory.length<2)return[];const t=[],e=this.diffusionHistory[this.diffusionHistory.length-1],i=this.diffusionHistory[this.diffusionHistory.length-2];return Object.keys(e.awarenessChanges).forEach(n=>{const s=e.awarenessChanges[n]-i.awarenessChanges[n];Math.abs(s)>.05&&t.push({type:n,change:s,direction:s>0?"increasing":"decreasing",magnitude:Math.abs(s),month:e.month})}),t}getGlobalAwareness(){return{...this.globalAwareness}}getMediaEventHistory(){return[...this.mediaEventHistory]}getSummary(){return{globalAwareness:this.getGlobalAwareness(),mediaEventsTotal:this.mediaEventHistory.length,recentMediaEvents:this.mediaEventHistory.slice(-5),monthsProcessed:this.diffusionHistory.length,cascadesDetected:this.detectCascades()}}};typeof window<"u"&&(window.InformationDiffusion=ku,window.InformationType=ht,window.MediaEventType=ut);const I={ROUTINE_COGNITIVE:"routine_cognitive",ROUTINE_MANUAL:"routine_manual",NON_ROUTINE_COGNITIVE:"non_routine_cognitive",NON_ROUTINE_MANUAL:"non_routine_manual",INTERPERSONAL:"interpersonal",CREATIVE:"creative"},tn={1:{name:"Data Entry Clerk",exposure:.95,category:I.ROUTINE_COGNITIVE},2:{name:"Bookkeeper",exposure:.9,category:I.ROUTINE_COGNITIVE},3:{name:"Cashier",exposure:.85,category:I.ROUTINE_MANUAL},4:{name:"Telemarketer",exposure:.9,category:I.ROUTINE_COGNITIVE},5:{name:"Assembly Worker",exposure:.8,category:I.ROUTINE_MANUAL},6:{name:"Truck Driver",exposure:.75,category:I.ROUTINE_MANUAL},7:{name:"Warehouse Worker",exposure:.78,category:I.ROUTINE_MANUAL},8:{name:"Fast Food Worker",exposure:.72,category:I.ROUTINE_MANUAL},20:{name:"Accountant",exposure:.65,category:I.ROUTINE_COGNITIVE},21:{name:"Paralegal",exposure:.6,category:I.ROUTINE_COGNITIVE},22:{name:"Insurance Underwriter",exposure:.65,category:I.ROUTINE_COGNITIVE},23:{name:"Loan Officer",exposure:.55,category:I.ROUTINE_COGNITIVE},24:{name:"Customer Service Rep",exposure:.5,category:I.INTERPERSONAL},25:{name:"Radiologist",exposure:.55,category:I.NON_ROUTINE_COGNITIVE},26:{name:"Financial Analyst",exposure:.5,category:I.NON_ROUTINE_COGNITIVE},27:{name:"Journalist",exposure:.45,category:I.CREATIVE},28:{name:"Translator",exposure:.55,category:I.NON_ROUTINE_COGNITIVE},40:{name:"Software Developer",exposure:.35,category:I.NON_ROUTINE_COGNITIVE},41:{name:"Nurse",exposure:.25,category:I.INTERPERSONAL},42:{name:"Teacher",exposure:.2,category:I.INTERPERSONAL},43:{name:"Therapist",exposure:.15,category:I.INTERPERSONAL},44:{name:"Surgeon",exposure:.2,category:I.NON_ROUTINE_MANUAL},45:{name:"CEO",exposure:.15,category:I.NON_ROUTINE_COGNITIVE},46:{name:"Sales Manager",exposure:.25,category:I.INTERPERSONAL},47:{name:"HR Manager",exposure:.3,category:I.INTERPERSONAL},48:{name:"Plumber",exposure:.2,category:I.NON_ROUTINE_MANUAL},49:{name:"Electrician",exposure:.22,category:I.NON_ROUTINE_MANUAL},50:{name:"Artist",exposure:.4,category:I.CREATIVE}},en={1:{name:"Technology",potential:.35,aiAdoptionSpeed:"fast"},2:{name:"Healthcare",potential:.4,aiAdoptionSpeed:"moderate"},3:{name:"Finance",potential:.55,aiAdoptionSpeed:"fast"},4:{name:"Retail",potential:.7,aiAdoptionSpeed:"moderate"},5:{name:"Manufacturing",potential:.75,aiAdoptionSpeed:"moderate"},6:{name:"Transportation",potential:.7,aiAdoptionSpeed:"slow"},7:{name:"Education",potential:.3,aiAdoptionSpeed:"slow"},8:{name:"Government",potential:.4,aiAdoptionSpeed:"slow"},9:{name:"Construction",potential:.45,aiAdoptionSpeed:"slow"},10:{name:"Professional Services",potential:.5,aiAdoptionSpeed:"fast"},11:{name:"Hospitality",potential:.6,aiAdoptionSpeed:"moderate"},12:{name:"Agriculture",potential:.65,aiAdoptionSpeed:"slow"},13:{name:"Energy",potential:.5,aiAdoptionSpeed:"moderate"},14:{name:"Media",potential:.55,aiAdoptionSpeed:"fast"},15:{name:"Real Estate",potential:.4,aiAdoptionSpeed:"moderate"},16:{name:"Utilities",potential:.5,aiAdoptionSpeed:"slow"},17:{name:"Telecom",potential:.55,aiAdoptionSpeed:"fast"},18:{name:"Pharma",potential:.45,aiAdoptionSpeed:"moderate"},19:{name:"Logistics",potential:.7,aiAdoptionSpeed:"fast"},20:{name:"Administrative",potential:.8,aiAdoptionSpeed:"fast"}};let Mu=class{constructor(t={}){this.scenario=t,this.currentLevel=t.initialAILevel||.3,this.adoptionCurve=t.adoptionCurve||"s_curve",this.automationPace=t.automationPace||"moderate",this.taskCapabilities=this._initializeTaskCapabilities(),this.occupationExposure={},this.industryAdoption={},this.history=[],this.breakthroughs=[],this.costThreshold=t.costThreshold||.6}_initializeTaskCapabilities(){return{[I.ROUTINE_COGNITIVE]:.7,[I.ROUTINE_MANUAL]:.5,[I.NON_ROUTINE_COGNITIVE]:.4,[I.NON_ROUTINE_MANUAL]:.2,[I.INTERPERSONAL]:.2,[I.CREATIVE]:.35}}advance(t,e={}){const n={slow:.5,moderate:1,fast:1.5,accelerating:2}[this.automationPace]||1;let s=0;switch(this.adoptionCurve){case"linear":s=.005*n;break;case"exponential":s=this.currentLevel*.01*n;break;case"s_curve":default:s=.015*n/(1+Math.exp(-.05*(t-60)));break;case"step":t%24===0?(s=.15*n,this._recordBreakthrough(t,s)):s=.002*n;break}return this.currentLevel=Math.min(.95,this.currentLevel+s),this._updateTaskCapabilities(t,n),Math.random()<.01*n&&this._generateBreakthrough(t),this.history.push({month:t,level:this.currentLevel,taskCapabilities:{...this.taskCapabilities},breakthrough:this.breakthroughs.length>0&&this.breakthroughs[this.breakthroughs.length-1].month===t}),this.currentLevel}_updateTaskCapabilities(t,e){const i={[I.ROUTINE_COGNITIVE]:.008*e,[I.ROUTINE_MANUAL]:.005*e,[I.NON_ROUTINE_COGNITIVE]:.007*e,[I.NON_ROUTINE_MANUAL]:.003*e,[I.INTERPERSONAL]:.002*e,[I.CREATIVE]:.006*e};Object.keys(this.taskCapabilities).forEach(n=>{const s=i[n]||.004;this.taskCapabilities[n]=Math.min(.95,this.taskCapabilities[n]+s)})}_recordBreakthrough(t,e){this.breakthroughs.push({month:t,impact:e,type:"scheduled"})}_generateBreakthrough(t){const e=Object.keys(this.taskCapabilities),i=e[Math.floor(Math.random()*e.length)],n=.05+Math.random()*.1;return this.taskCapabilities[i]=Math.min(.95,this.taskCapabilities[i]+n),this.breakthroughs.push({month:t,impact:n,category:i,type:"random",description:`Breakthrough in ${i.replace("_"," ")} automation`}),this.breakthroughs[this.breakthroughs.length-1]}getOccupationExposure(t){if(this.occupationExposure[t]!==void 0)return this.occupationExposure[t]*this.currentLevel;const e=tn[t];let i;return e?i=e.exposure:(i=.3+Math.random()*.4,t>80&&(i*=.7)),this.occupationExposure[t]=i,i*this.currentLevel}getIndustryAutomation(t){const e=en[t];if(!e)return{potential:.5,currentExposure:.5*this.currentLevel,adoptionSpeed:"moderate"};const n={slow:.7,moderate:1,fast:1.3}[e.aiAdoptionSpeed]||1;return{name:e.name,potential:e.potential,currentExposure:e.potential*this.currentLevel*n,adoptionSpeed:e.aiAdoptionSpeed}}getWorkerExposure(t){let e=this.getOccupationExposure(t.occupation);const i=(t.aiAugmentationSkill||0)*.3;e=e*(1-i);const n=this._getEducationMitigation(t.education);return e=e*(1-n),t.age>50&&(e*=1.1),Math.min(1,Math.max(0,e))}_getEducationMitigation(t){return{no_degree:0,high_school:.05,some_college:.1,bachelors:.15,advanced:.2}[t]||.05}canAutomate(t,e){const i=this.taskCapabilities[t]||.3,n=3e3/(i+.1);return i>=this.costThreshold&&n<e}getAugmentationPotential(t){const e=this.getOccupationExposure(t);return e>.7?.3:e<.2?.4:.7}getHighRiskOccupations(t=.5){const e=[];return Object.entries(tn).forEach(([i,n])=>{const s=n.exposure*this.currentLevel;s>=t&&e.push({id:parseInt(i),name:n.name,exposure:s,category:n.category})}),e.sort((i,n)=>n.exposure-i.exposure)}getIndustryRiskRanking(){const t=[];return Object.entries(en).forEach(([e,i])=>{const n=this.getIndustryAutomation(parseInt(e));t.push({id:parseInt(e),...i,currentExposure:n.currentExposure})}),t.sort((e,i)=>i.currentExposure-e.currentExposure)}estimateJobsAtRisk(t,e=.5){let i=0,n=0;return t.forEach(s=>{if(s.status!=="employed")return;const o=this.getWorkerExposure(s);o>=e&&i++,o>=.7&&n++}),{atRisk:i,highRisk:n,atRiskPercent:t.length>0?(i/t.length*100).toFixed(1):0,highRiskPercent:t.length>0?(n/t.length*100).toFixed(1):0}}projectCapabilities(t){const e=[];let i=this.currentLevel;for(let n=1;n<=t;n++){switch(this.adoptionCurve){case"linear":i+=.005;break;case"exponential":i*=1.01;break;case"s_curve":default:const s=this.history.length+n,o=.015/(1+Math.exp(-.05*(s-60)));i+=o;break}i=Math.min(.95,i),n%12===0&&e.push({month:n,year:Math.floor(n/12),level:i})}return e}getCurrentLevel(){return this.currentLevel}getTaskCapabilities(){return{...this.taskCapabilities}}getBreakthroughs(){return[...this.breakthroughs]}getSummary(){return{currentLevel:this.currentLevel,adoptionCurve:this.adoptionCurve,automationPace:this.automationPace,taskCapabilities:this.getTaskCapabilities(),breakthroughCount:this.breakthroughs.length,monthsSimulated:this.history.length,highRiskOccupations:this.getHighRiskOccupations(.5).length}}};typeof window<"u"&&(window.AICapabilityFrontier=Mu,window.TaskCategories=I,window.OCCUPATION_AUTOMATION_DATA=tn,window.INDUSTRY_AUTOMATION=en);const nn=[{id:1,name:"California",abbrev:"CA",population:39.5,costOfLiving:1.5,techHub:!0},{id:2,name:"Texas",abbrev:"TX",population:29.1,costOfLiving:.92,techHub:!0},{id:3,name:"Florida",abbrev:"FL",population:21.5,costOfLiving:1,techHub:!1},{id:4,name:"New York",abbrev:"NY",population:20.2,costOfLiving:1.4,techHub:!0},{id:5,name:"Pennsylvania",abbrev:"PA",population:13,costOfLiving:.98,techHub:!1},{id:6,name:"Illinois",abbrev:"IL",population:12.8,costOfLiving:1.02,techHub:!1},{id:7,name:"Ohio",abbrev:"OH",population:11.8,costOfLiving:.88,techHub:!1},{id:8,name:"Georgia",abbrev:"GA",population:10.7,costOfLiving:.95,techHub:!0},{id:9,name:"North Carolina",abbrev:"NC",population:10.4,costOfLiving:.92,techHub:!0},{id:10,name:"Michigan",abbrev:"MI",population:10,costOfLiving:.9,techHub:!1},{id:11,name:"New Jersey",abbrev:"NJ",population:9.3,costOfLiving:1.25,techHub:!1},{id:12,name:"Virginia",abbrev:"VA",population:8.6,costOfLiving:1.05,techHub:!0},{id:13,name:"Washington",abbrev:"WA",population:7.6,costOfLiving:1.2,techHub:!0},{id:14,name:"Arizona",abbrev:"AZ",population:7.3,costOfLiving:.98,techHub:!0},{id:15,name:"Massachusetts",abbrev:"MA",population:7,costOfLiving:1.35,techHub:!0},{id:16,name:"Tennessee",abbrev:"TN",population:6.9,costOfLiving:.88,techHub:!1},{id:17,name:"Indiana",abbrev:"IN",population:6.8,costOfLiving:.85,techHub:!1},{id:18,name:"Maryland",abbrev:"MD",population:6.2,costOfLiving:1.12,techHub:!0},{id:19,name:"Missouri",abbrev:"MO",population:6.2,costOfLiving:.85,techHub:!1},{id:20,name:"Wisconsin",abbrev:"WI",population:5.9,costOfLiving:.9,techHub:!1},{id:21,name:"Colorado",abbrev:"CO",population:5.8,costOfLiving:1.1,techHub:!0},{id:22,name:"Minnesota",abbrev:"MN",population:5.7,costOfLiving:.98,techHub:!1},{id:23,name:"South Carolina",abbrev:"SC",population:5.1,costOfLiving:.88,techHub:!1},{id:24,name:"Alabama",abbrev:"AL",population:5,costOfLiving:.85,techHub:!1},{id:25,name:"Louisiana",abbrev:"LA",population:4.7,costOfLiving:.9,techHub:!1},{id:26,name:"Kentucky",abbrev:"KY",population:4.5,costOfLiving:.85,techHub:!1},{id:27,name:"Oregon",abbrev:"OR",population:4.2,costOfLiving:1.12,techHub:!0},{id:28,name:"Oklahoma",abbrev:"OK",population:4,costOfLiving:.85,techHub:!1},{id:29,name:"Connecticut",abbrev:"CT",population:3.6,costOfLiving:1.2,techHub:!1},{id:30,name:"Utah",abbrev:"UT",population:3.3,costOfLiving:.98,techHub:!0},{id:31,name:"Iowa",abbrev:"IA",population:3.2,costOfLiving:.85,techHub:!1},{id:32,name:"Nevada",abbrev:"NV",population:3.1,costOfLiving:1.02,techHub:!1},{id:33,name:"Arkansas",abbrev:"AR",population:3,costOfLiving:.82,techHub:!1},{id:34,name:"Mississippi",abbrev:"MS",population:3,costOfLiving:.8,techHub:!1},{id:35,name:"Kansas",abbrev:"KS",population:2.9,costOfLiving:.85,techHub:!1},{id:36,name:"New Mexico",abbrev:"NM",population:2.1,costOfLiving:.9,techHub:!1},{id:37,name:"Nebraska",abbrev:"NE",population:2,costOfLiving:.88,techHub:!1},{id:38,name:"Idaho",abbrev:"ID",population:1.9,costOfLiving:.95,techHub:!1},{id:39,name:"West Virginia",abbrev:"WV",population:1.8,costOfLiving:.82,techHub:!1},{id:40,name:"Hawaii",abbrev:"HI",population:1.5,costOfLiving:1.85,techHub:!1},{id:41,name:"New Hampshire",abbrev:"NH",population:1.4,costOfLiving:1.1,techHub:!1},{id:42,name:"Maine",abbrev:"ME",population:1.4,costOfLiving:1,techHub:!1},{id:43,name:"Montana",abbrev:"MT",population:1.1,costOfLiving:.95,techHub:!1},{id:44,name:"Rhode Island",abbrev:"RI",population:1.1,costOfLiving:1.08,techHub:!1},{id:45,name:"Delaware",abbrev:"DE",population:1,costOfLiving:1.02,techHub:!1},{id:46,name:"South Dakota",abbrev:"SD",population:.9,costOfLiving:.88,techHub:!1},{id:47,name:"North Dakota",abbrev:"ND",population:.8,costOfLiving:.9,techHub:!1},{id:48,name:"Alaska",abbrev:"AK",population:.7,costOfLiving:1.25,techHub:!1},{id:49,name:"Vermont",abbrev:"VT",population:.6,costOfLiving:1.05,techHub:!1},{id:50,name:"Wyoming",abbrev:"WY",population:.6,costOfLiving:.92,techHub:!1}],Yt={1:{name:"Technology",automationExposure:.3,aiAdoptionRate:.7,growthRate:.05},2:{name:"Healthcare",automationExposure:.4,aiAdoptionRate:.4,growthRate:.04},3:{name:"Finance",automationExposure:.5,aiAdoptionRate:.6,growthRate:.02},4:{name:"Retail",automationExposure:.7,aiAdoptionRate:.5,growthRate:-.01},5:{name:"Manufacturing",automationExposure:.8,aiAdoptionRate:.5,growthRate:-.02},6:{name:"Transportation",automationExposure:.75,aiAdoptionRate:.4,growthRate:.01},7:{name:"Education",automationExposure:.35,aiAdoptionRate:.3,growthRate:.02},8:{name:"Government",automationExposure:.4,aiAdoptionRate:.2,growthRate:.01},9:{name:"Construction",automationExposure:.5,aiAdoptionRate:.2,growthRate:.02},10:{name:"Professional Services",automationExposure:.45,aiAdoptionRate:.55,growthRate:.03},11:{name:"Hospitality",automationExposure:.6,aiAdoptionRate:.3,growthRate:.02},12:{name:"Agriculture",automationExposure:.65,aiAdoptionRate:.3,growthRate:-.01},13:{name:"Energy",automationExposure:.55,aiAdoptionRate:.4,growthRate:.01},14:{name:"Media & Entertainment",automationExposure:.5,aiAdoptionRate:.5,growthRate:.02},15:{name:"Real Estate",automationExposure:.4,aiAdoptionRate:.35,growthRate:.01},16:{name:"Utilities",automationExposure:.5,aiAdoptionRate:.35,growthRate:0},17:{name:"Telecommunications",automationExposure:.55,aiAdoptionRate:.5,growthRate:.01},18:{name:"Pharmaceuticals",automationExposure:.45,aiAdoptionRate:.5,growthRate:.04},19:{name:"Logistics",automationExposure:.7,aiAdoptionRate:.45,growthRate:.03},20:{name:"Administrative",automationExposure:.8,aiAdoptionRate:.5,growthRate:-.02}},Au={CA:{1:.2,2:.1,3:.08,10:.15,14:.12},WA:{1:.25,2:.08,10:.12,19:.1},TX:{1:.12,3:.08,5:.1,13:.15,2:.12},NY:{3:.2,10:.15,14:.1,2:.1},MA:{1:.15,2:.18,7:.12,18:.1},MI:{5:.25,6:.12,2:.1},OH:{5:.2,2:.12,3:.08},IN:{5:.22,19:.12,2:.1},WI:{5:.18,12:.1,2:.12},FL:{11:.15,2:.12,15:.1,4:.12},NV:{11:.25,15:.1,9:.08},LA:{13:.2,5:.1,6:.08},OK:{13:.18,12:.1},WY:{13:.25,12:.15},ND:{13:.2,12:.25},IA:{12:.25,5:.12},NE:{12:.22,5:.1},KS:{12:.2,13:.08}};class Ao{constructor(t){this.id=t.id,this.name=t.name,this.abbrev=t.abbrev||t.name.substring(0,2).toUpperCase(),this.population=t.population||5,this.costOfLiving=t.costOfLiving||1,this.techHub=t.techHub||!1,this.industryMix=this._initializeIndustryMix(),this.unemploymentRate=t.initialUnemploymentRate||.04+(Math.random()*.02-.01),this.averageWage=this._calculateAverageWage(),this.laborForceParticipation=.6+Math.random()*.08,this.localWorkers=[],this.localFirms=[],this.localTrainingPrograms=[],this.jobPostings=[],this.inMigration=0,this.outMigration=0,this.attractiveness=this._calculateAttractiveness(),this.regionalAIAdoption=this.techHub?.25+Math.random()*.15:.1+Math.random()*.1,this.policySupport={ubi:.5,retraining:.5,aiRegulation:.5}}_initializeIndustryMix(){const t={},e=Au[this.abbrev]||{};Object.entries(e).forEach(([n,s])=>{t[n]=s});let i=Object.values(t).reduce((n,s)=>n+s,0);return Object.keys(Yt).forEach(n=>{if(!t[n]){const s=Math.max(.02,(1-i)/15);t[n]=s*(.5+Math.random())}}),i=Object.values(t).reduce((n,s)=>n+s,0),Object.keys(t).forEach(n=>{t[n]=t[n]/i}),t}_calculateAverageWage(){let e=4500*this.costOfLiving;return this.techHub&&(e*=1.15),e*=.95+Math.random()*.1,Math.round(e)}_calculateAttractiveness(){let t=50;t+=(1-this.unemploymentRate)*20;const e=this.averageWage/(4500*this.costOfLiving);return t+=e*10,this.techHub&&(t+=10),this.costOfLiving>1.2?t-=(this.costOfLiving-1.2)*20:this.costOfLiving<.9&&(t+=(.9-this.costOfLiving)*10),Math.max(0,Math.min(100,t))}updateMonth(t,e,i={}){this.localWorkers=t.filter(l=>l.region===this.id),this.localFirms=e.filter(l=>l.region===this.id);const n=this.localWorkers.filter(l=>l.status!=="out_of_labor_force"),s=n.filter(l=>l.status==="unemployed");this.unemploymentRate=n.length>0?s.length/n.length:0;const o=this.localWorkers.filter(l=>l.status==="employed"&&l.wage>0);o.length>0&&(this.averageWage=Math.round(o.reduce((l,c)=>l+c.wage,0)/o.length));const r=this.localFirms.filter(l=>["piloting","scaling","mature"].includes(l.aiAdoptionStatus));return this.regionalAIAdoption=this.localFirms.length>0?r.length/this.localFirms.length:0,this._updatePolicySupport(),this.attractiveness=this._calculateAttractiveness(),this.getSnapshot()}_updatePolicySupport(){if(this.localWorkers.length===0)return;["ubi","retraining","aiRegulation"].forEach(e=>{const i=this.localWorkers.reduce((n,s)=>{var o;return n+(((o=s.policySupport)==null?void 0:o[e])||.5)},0);this.policySupport[e]=i/this.localWorkers.length})}calculateMigrationPressure(t){const e=t.reduce((s,o)=>s+o.attractiveness,0)/t.length;let i=0;this.unemploymentRate>.06&&(i+=(this.unemploymentRate-.06)*50),this.attractiveness<e&&(i+=(e-this.attractiveness)*.5);let n=0;return this.attractiveness>e&&(n+=(this.attractiveness-e)*.5),this.unemploymentRate<.04&&(n+=(.04-this.unemploymentRate)*30),{outPressure:Math.max(0,i),inPressure:Math.max(0,n)}}processMigration(t,e){this.outMigration++}receiveMigrant(t){this.inMigration++}getIndustryEmployment(){const t={};return Object.keys(Yt).forEach(e=>{const i=this.localWorkers.filter(n=>n.industry===parseInt(e)&&n.status==="employed");t[e]={name:Yt[e].name,employed:i.length,share:this.localWorkers.length>0?i.length/this.localWorkers.length:0}}),t}getAutomationExposure(){let t=0,e=0;return Object.entries(this.industryMix).forEach(([i,n])=>{const s=Yt[i];s&&(t+=s.automationExposure*n,e+=n)}),e>0?t/e:.5}getSnapshot(){return{id:this.id,name:this.name,abbrev:this.abbrev,population:this.population,laborForce:this.localWorkers.filter(t=>t.status!=="out_of_labor_force").length,employed:this.localWorkers.filter(t=>t.status==="employed").length,unemployed:this.localWorkers.filter(t=>t.status==="unemployed").length,unemploymentRate:this.unemploymentRate,averageWage:this.averageWage,costOfLiving:this.costOfLiving,techHub:this.techHub,aiAdoptionRate:this.regionalAIAdoption,attractiveness:this.attractiveness,automationExposure:this.getAutomationExposure(),policySupport:{...this.policySupport},migration:{in:this.inMigration,out:this.outMigration,net:this.inMigration-this.outMigration}}}getTopIndustries(t=5){return Object.entries(this.industryMix).map(([i,n])=>{var s,o;return{id:parseInt(i),name:((s=Yt[i])==null?void 0:s.name)||"Unknown",share:n,automationExposure:((o=Yt[i])==null?void 0:o.automationExposure)||.5}}).sort((i,n)=>n.share-i.share).slice(0,t)}}let Cu=class{constructor(t=50){this.regions=[],this.numRegions=Math.min(t,nn.length),this._initializeRegions()}_initializeRegions(){for(let t=0;t<this.numRegions;t++){const e=nn[t];this.regions.push(new Ao(e))}}getRegion(t){return this.regions.find(e=>e.id===t)}getRegionByAbbrev(t){return this.regions.find(e=>e.abbrev===t)}updateAllRegions(t,e){const i=[];return this.regions.forEach(n=>{const s=n.updateMonth(t,e);i.push(s)}),i}getPopulationDistribution(){const t=this.regions.reduce((e,i)=>e+i.population,0);return this.regions.map(e=>({id:e.id,weight:e.population/t}))}selectRegionByPopulation(){const t=this.getPopulationDistribution(),e=Math.random();let i=0;for(const{id:n,weight:s}of t)if(i+=s,e<=i)return n;return this.regions[0].id}getNationalStats(){const t=this.regions.reduce((s,o)=>s+o.localWorkers.length,0),e=this.regions.reduce((s,o)=>s+o.localWorkers.filter(r=>r.status==="unemployed").length,0),i=this.regions.reduce((s,o)=>s+o.localWorkers.filter(r=>r.status==="employed").length,0),n=i+e;return{totalWorkers:t,laborForce:n,employed:i,unemployed:e,unemploymentRate:n>0?e/n:0,averageWage:this.regions.reduce((s,o)=>s+o.averageWage,0)/this.regions.length,regionalVariation:this._calculateRegionalVariation()}}_calculateRegionalVariation(){const t=this.regions.map(n=>n.unemploymentRate),e=t.reduce((n,s)=>n+s,0)/t.length,i=t.reduce((n,s)=>n+Math.pow(s-e,2),0)/t.length;return{min:Math.min(...t),max:Math.max(...t),mean:e,stdDev:Math.sqrt(i)}}getRankedRegions(t="unemploymentRate",e=!0){return[...this.regions].sort((n,s)=>{const o=n[t]||0,r=s[t]||0;return e?o-r:r-o}).map(n=>({id:n.id,name:n.name,abbrev:n.abbrev,value:n[t]}))}getAllRegionSnapshots(){return this.regions.map(t=>t.getSnapshot())}};typeof window<"u"&&(window.Region=Ao,window.RegionalMarketSystem=Cu,window.US_REGIONS=nn,window.INDUSTRY_SECTORS=Yt);if(typeof module<"u"&&module.exports)try{const{WorkerAgent:a}=require("./agents/worker.js"),{FirmAgent:t}=require("./agents/firm.js"),{TrainingProgramAgent:e}=require("./agents/training-program.js"),{LaborMarket:i}=require("./market/labor-market.js"),{WageDynamics:n}=require("./market/wage-dynamics.js"),{InformationDiffusion:s}=require("./market/information.js"),{AICapabilityFrontier:o}=require("./environment/ai-frontier.js"),{RegionalMarketSystem:r}=require("./environment/regions.js");global.WorkerAgent=a,global.FirmAgent=t,global.TrainingProgramAgent=e,global.LaborMarket=i,global.WageDynamics=n,global.InformationDiffusion=s,global.AICapabilityFrontier=o,global.RegionalMarketSystem=r}catch(a){console.warn("Some ABM classes not available:",a.message)}let Eu=class{constructor(t={}){this.config={numWorkers:t.numWorkers||1e4,numFirms:t.numFirms||500,numRegions:t.numRegions||10,numTrainingPrograms:t.numTrainingPrograms||50,durationMonths:t.durationMonths||60,...t},this.workers=[],this.firms=[],this.trainingPrograms=[],this.laborMarket=null,this.wageDynamics=null,this.informationDiffusion=null,this.aiCapability=null,this.regionalSystem=null,this.results={monthly:[],monthlyData:[],summary:null,policySupport:[],emergentPatterns:[],regionalSnapshots:[],wageDistribution:[]},this.currentMonth=0,this.isRunning=!1,this.isPaused=!1,this.onProgress=t.onProgress||null,this.onComplete=t.onComplete||null}async initialize(t={}){return console.log("Initializing ABM simulation..."),typeof AICapabilityFrontier<"u"?this.aiCapability=new AICapabilityFrontier(t):this.aiCapability=new Co(t),typeof RegionalMarketSystem<"u"&&(this.regionalSystem=new RegionalMarketSystem(this.config.numRegions)),this.workers=this._generateWorkers(this.config.numWorkers,t),console.log(`Created ${this.workers.length} worker agents`),this.firms=this._generateFirms(this.config.numFirms,t),console.log(`Created ${this.firms.length} firm agents`),this.trainingPrograms=this._generateTrainingPrograms(this.config.numTrainingPrograms,t),console.log(`Created ${this.trainingPrograms.length} training program agents`),this._assignInitialEmployment(),this._buildWorkerNetworks(),this._setFirmCompetitors(),this.laborMarket=new LaborMarket({workers:this.workers,firms:this.firms,searchRadius:2}),typeof WageDynamics<"u"&&(this.wageDynamics=new WageDynamics),typeof InformationDiffusion<"u"&&(this.informationDiffusion=new InformationDiffusion),this.currentMonth=0,this.results={monthly:[],monthlyData:[],summary:null,policySupport:[],emergentPatterns:[],regionalSnapshots:[],wageDistribution:[]},console.log("ABM initialization complete"),this}async runSimulation(t={}){this.workers.length===0&&await this.initialize(t),this.isRunning=!0,this.isPaused=!1;const e=Date.now();try{for(let n=0;n<this.config.durationMonths&&!(!this.isRunning||this.isPaused);n++)await this._runMonth(n,t),this._collectMonthlyResults(n),this.onProgress&&this.onProgress({month:n,totalMonths:this.config.durationMonths,progress:(n+1)/this.config.durationMonths,currentStats:this.results.monthly[this.results.monthly.length-1]}),n%12===0&&await new Promise(s=>setTimeout(s,0));this._finalizeResults(),this.isRunning=!1;const i=(Date.now()-e)/1e3;return console.log(`Simulation complete in ${i.toFixed(2)}s`),this.onComplete&&this.onComplete(this.results),this.results}catch(i){throw this.isRunning=!1,console.error("Simulation error:",i),i}}async _runMonth(t,e){this.currentMonth=t,this.aiCapability.advance(t,e),this.firms.forEach(n=>{const s=this._getCompetitors(n);n.makeMonthlyDecisions(this.aiCapability,this.laborMarket,s)}),this.workers.forEach(n=>{n.makeMonthlyDecisions(this.laborMarket,this.aiCapability,e.interventions)}),this._processTrainingPrograms(t);const i=this.laborMarket.runMonthlyMatching();return this.wageDynamics&&this.wageDynamics.adjustMarketWages(this.workers,this.firms,this.laborMarket),e.interventions&&this._applyInterventions(e.interventions,t),this._diffuseInformation(t,i),this.regionalSystem&&this.regionalSystem.updateAllRegions(this.workers,this.firms),t>0&&t%6===0&&this._detectPatterns(t),i}_generateWorkers(t,e){const i=[];this.regionalSystem;const n=this._getRegionPopulations(this.config.numRegions);for(let s=0;s<t;s++){const o=this.regionalSystem?this.regionalSystem.selectRegionByPopulation():this._selectRegion(n),r=new WorkerAgent({id:`w_${s}`,region:o,status:Math.random()<(e.initialUnemploymentRate||.04)?"unemployed":"employed"});i.push(r)}return i}_generateFirms(t,e){const i=[];for(let n=0;n<t;n++){const s=this.regionalSystem?this.regionalSystem.selectRegionByPopulation():Math.floor(Math.random()*this.config.numRegions)+1,o=new FirmAgent({id:`f_${n}`,region:s});e.initialAIAdoption&&Math.random()<e.initialAIAdoption&&(o.aiAdoptionStatus="exploring"),i.push(o)}return i}_generateTrainingPrograms(t,e){const i=[];if(typeof TrainingProgramAgent>"u")return i;for(let n=0;n<t;n++){const s=this.regionalSystem?this.regionalSystem.selectRegionByPopulation():Math.floor(Math.random()*this.config.numRegions)+1,o=new TrainingProgramAgent({id:`prog_${n}`,region:s,subsidyAvailable:e.trainingSubsidy||.3});i.push(o)}return i}_processTrainingPrograms(t){if(this.trainingPrograms.length===0)return;this.trainingPrograms.forEach(i=>{i.processMonth(t)}),this.workers.filter(i=>i.wantsRetraining&&!i.retrainingProgram&&i.age<60).forEach(i=>{const n=this.trainingPrograms.filter(s=>s.isAcceptingApplications()&&(s.region===i.region||Math.random()<.2));n.length>0&&(n.sort((o,r)=>{const l=o.calculateROIForWorker(i);return r.calculateROIForWorker(i).roi-l.roi}),n[0].enrollWorker(i,t).success&&(i.wantsRetraining=!1))})}_assignInitialEmployment(){const e=this.workers.filter(n=>n.status==="employed").sort(()=>Math.random()-.5);let i=0;this.firms.forEach(n=>{const s=n.targetHeadcount;for(let o=0;o<s&&i<e.length;o++){const r=e[i++];r.employer=n,r.industry=n.industry,n.employees.push(r)}})}_buildWorkerNetworks(){this.workers.forEach(t=>{const e=t.networkSize,n=this.workers.filter(s=>s.id!==t.id&&(s.region===t.region||Math.random()<.1)).sort(()=>Math.random()-.5);t.network=n.slice(0,Math.min(e,n.length)),t.network.forEach(s=>{s.closeness=Math.random()*.5+.3})})}_setFirmCompetitors(){const t={};this.firms.forEach(e=>{t[e.industry]||(t[e.industry]=[]),t[e.industry].push(e)}),this.firms.forEach(e=>{const i=t[e.industry]||[];e.competitors=i.filter(n=>n.id!==e.id).slice(0,10)})}_getCompetitors(t){return t.competitors||[]}_getRegionPopulations(t){const e=[];let i=0;for(let n=0;n<t;n++){const s=.5+Math.random()*1.5;e.push(s),i+=s}return e.map(n=>n/i)}_selectRegion(t){const e=Math.random();let i=0;for(let n=0;n<t.length;n++)if(i+=t[n],e<=i)return n+1;return t.length}_applyInterventions(t,e){!t||!Array.isArray(t)||t.forEach(i=>{if(i.active)switch(i.type){case"ubi":this._applyUBI(i,e);break;case"retraining":this._applyRetraining(i,e);break;case"wage_subsidy":this._applyWageSubsidy(i,e);break}})}_applyUBI(t,e){const i=t.amount||1e3;this.workers.filter(s=>s.status==="unemployed"||t.universal).forEach(s=>{s.receiveUBI(i)})}_applyRetraining(t,e){if(this.trainingPrograms.length>0){this.trainingPrograms.forEach(o=>{o.receiveSubsidy(t.subsidyLevel||.5)});return}const i=this.workers.filter(o=>(o.status==="unemployed"||o.wantsRetraining)&&o.age<60&&!o.retrainingProgram),n=t.capacity||1e3;i.slice(0,n).forEach(o=>{o.enrollInRetraining({id:`retrain_${e}_${o.id}`,duration:t.duration||6,skillsProvided:t.skills||{dataAnalysis:.3,programming:.2,technical:.2}}),o.wantsRetraining=!1})}_applyWageSubsidy(t,e){this.firms.forEach(i=>{i.employees.length>0&&(t.amountPerWorker,i.employees.forEach(n=>{n.markedForLayoff&&(n.markedForLayoff=!1,n.policySupport.wageSubsidy=Math.min(1,n.policySupport.wageSubsidy+.15),n.benefitedFromIntervention="wageSubsidy")}))})}_diffuseInformation(t,e={}){var i;if(this.informationDiffusion){const n={unemploymentRate:((i=this.laborMarket.getMarketStatistics())==null?void 0:i.unemploymentRate)||.05,layoffCount:e.layoffs||0,aiAdoptionRate:this.aiCapability.getCurrentLevel(),policyChanges:[]};this.informationDiffusion.processMonth(this.workers,this.firms,t,n);return}this.workers.forEach(n=>{if(n.network.length===0)return;const o=n.network.reduce((r,l)=>r+(l.informationLevel||.5),0)/n.network.length-n.informationLevel;n.informationLevel+=o*.05})}_detectPatterns(t){const e=this.laborMarket.getMarketStatistics(),i=this.results.monthly[this.results.monthly.length-6];if(!i)return;const n=e.unemploymentRate-i.unemploymentRate;Math.abs(n)>.02&&this.results.emergentPatterns.push({type:"tipping_point",month:t,description:n>0?`Unemployment spiked ${(n*100).toFixed(1)}% in 6 months`:`Rapid recovery: unemployment dropped ${(Math.abs(n)*100).toFixed(1)}%`,metrics:{unemploymentChange:n}});const s=e.aiAdoptionRate-i.aiAdoptionRate;if(s>.1&&this.results.emergentPatterns.push({type:"feedback_loop",month:t,description:`AI adoption accelerated - ${(s*100).toFixed(0)}% more firms adopting`,effect:"Competitive pressure cascade"}),this.informationDiffusion&&this.informationDiffusion.detectCascades().forEach(r=>{this.results.emergentPatterns.push({type:"information_cascade",month:t,description:`${r.type} ${r.direction} by ${(r.magnitude*100).toFixed(1)}%`,metrics:r})}),this.regionalSystem){const o=this.regionalSystem.getNationalStats();o.regionalVariation.stdDev>.03&&this.results.emergentPatterns.push({type:"regional_divergence",month:t,description:`Regional unemployment diverging (std dev: ${(o.regionalVariation.stdDev*100).toFixed(1)}%)`,metrics:o.regionalVariation})}}_collectMonthlyResults(t){const e=this.laborMarket.getMarketStatistics(),i=this.laborMarket.getPolicySupportStatistics(),n={};["none","exploring","piloting","scaling","mature"].forEach(r=>{n[r]=this.firms.filter(l=>l.aiAdoptionStatus===r).length});let s=null;this.wageDynamics&&(s=this.wageDynamics.getWageDistribution(this.workers));const o={totalPrograms:this.trainingPrograms.length,totalEnrolled:this.trainingPrograms.reduce((r,l)=>r+l.currentEnrollment,0),totalGraduates:this.trainingPrograms.reduce((r,l)=>r+l.totalGraduates,0),avgCompletionRate:this.trainingPrograms.length>0?this.trainingPrograms.reduce((r,l)=>r+l.completionRate,0)/this.trainingPrograms.length:0};this.results.monthly.push({month:t,year:Math.floor(t/12)+2025,...e,aiAdoptionByStatus:n,policySupport:i,wageDistribution:s,trainingStats:o,aiCapabilityLevel:this.aiCapability.getCurrentLevel()}),this.results.policySupport.push({month:t,...i}),this.regionalSystem&&t%6===0&&this.results.regionalSnapshots.push({month:t,regions:this.regionalSystem.getAllRegionSnapshots()}),s&&this.results.wageDistribution.push({month:t,...s})}_finalizeResults(){var i;const t=this.results.monthly[0],e=this.results.monthly[this.results.monthly.length-1];this.results.monthlyData=this.results.monthly,this.results.summary={durationMonths:this.config.durationMonths,totalWorkers:this.config.numWorkers,totalFirms:this.config.numFirms,totalTrainingPrograms:this.trainingPrograms.length,initial:{unemploymentRate:(t==null?void 0:t.unemploymentRate)||0,aiAdoptionRate:(t==null?void 0:t.aiAdoptionRate)||0,medianWage:(t==null?void 0:t.medianWage)||0,aiCapabilityLevel:(t==null?void 0:t.aiCapabilityLevel)||0},final:{unemploymentRate:(e==null?void 0:e.unemploymentRate)||0,aiAdoptionRate:(e==null?void 0:e.aiAdoptionRate)||0,medianWage:(e==null?void 0:e.medianWage)||0,employed:(e==null?void 0:e.employed)||0,unemployed:(e==null?void 0:e.unemployed)||0,outOfLaborForce:(e==null?void 0:e.outOfLaborForce)||0,aiCapabilityLevel:(e==null?void 0:e.aiCapabilityLevel)||0},changes:{unemploymentChange:((e==null?void 0:e.unemploymentRate)||0)-((t==null?void 0:t.unemploymentRate)||0),wageChange:(((e==null?void 0:e.medianWage)||0)-((t==null?void 0:t.medianWage)||0))/((t==null?void 0:t.medianWage)||1),aiAdoptionChange:((e==null?void 0:e.aiAdoptionRate)||0)-((t==null?void 0:t.aiAdoptionRate)||0)},peakUnemployment:Math.max(...this.results.monthly.map(n=>n.unemploymentRate)),peakUnemploymentMonth:this.results.monthly.findIndex(n=>n.unemploymentRate===Math.max(...this.results.monthly.map(s=>s.unemploymentRate))),totalHires:this.results.monthly.reduce((n,s)=>n+(s.monthlyHires||0),0),totalLayoffs:this.results.monthly.reduce((n,s)=>n+(s.monthlyLayoffs||0),0),trainingOutcomes:{totalGraduates:this.trainingPrograms.reduce((n,s)=>n+s.totalGraduates,0),totalDropouts:this.trainingPrograms.reduce((n,s)=>n+s.totalDropouts,0),avgCompletionRate:this.trainingPrograms.length>0?this.trainingPrograms.reduce((n,s)=>n+s.completionRate,0)/this.trainingPrograms.length:0},wageInequality:e!=null&&e.wageDistribution?{gini:e.wageDistribution.gini,p90p10Ratio:e.wageDistribution.p90/(e.wageDistribution.p10||1)}:null,finalPolicySupport:(e==null?void 0:e.policySupport)||{},emergentPatterns:this.results.emergentPatterns,aiCapabilitySummary:this.aiCapability.getSummary?this.aiCapability.getSummary():null,informationSummary:((i=this.informationDiffusion)==null?void 0:i.getSummary())||null}}stop(){this.isRunning=!1}pause(){this.isPaused=!0}resume(){this.isPaused=!1}getCurrentState(){var t,e;return{month:this.currentMonth,isRunning:this.isRunning,isPaused:this.isPaused,workerCount:this.workers.length,firmCount:this.firms.length,trainingProgramCount:this.trainingPrograms.length,currentStats:((t=this.laborMarket)==null?void 0:t.getMarketStatistics())||null,aiCapabilityLevel:((e=this.aiCapability)==null?void 0:e.getCurrentLevel())||0}}getRegionalBreakdown(){return this.regionalSystem?this.regionalSystem.getAllRegionSnapshots():null}getTrainingStats(){return this.trainingPrograms.map(t=>t.getSummary())}getWageAnalysis(){return this.wageDynamics?this.wageDynamics.getSummary(this.workers):null}};class Co{constructor(t={}){this.scenario=t,this.currentLevel=t.initialAILevel||.3,this.adoptionCurve=t.adoptionCurve||"s_curve",this.automationPace=t.automationPace||"moderate",this.occupationExposure={}}advance(t,e){const n={slow:.5,moderate:1,fast:1.5,accelerating:2}[this.automationPace]||1;switch(this.adoptionCurve){case"linear":this.currentLevel+=.005*n;break;case"exponential":this.currentLevel*=1+.01*n;break;case"s_curve":default:const o=.01*n/(1+Math.exp(-.05*(t-60)));this.currentLevel+=o;break}this.currentLevel=Math.min(.95,this.currentLevel)}getCurrentLevel(){return this.currentLevel}getOccupationExposure(t){return this.occupationExposure[t]?this.occupationExposure[t]*this.currentLevel:(this.occupationExposure[t]=.3+Math.random()*.5,this.occupationExposure[t]*this.currentLevel)}getSummary(){return{currentLevel:this.currentLevel,adoptionCurve:this.adoptionCurve,automationPace:this.automationPace}}}typeof window<"u"&&(window.ABMSimulationEngine=Eu,window.AICapabilityFrontierInline=Co);function Iu(){return console.log("ABM Module Initialized"),console.log("Available classes:"),console.log("  - WorkerAgent"),console.log("  - FirmAgent"),console.log("  - LaborMarket"),console.log("  - ABMSimulationEngine"),{WorkerAgent:typeof WorkerAgent<"u"?WorkerAgent:null,FirmAgent:typeof FirmAgent<"u"?FirmAgent:null,LaborMarket:typeof LaborMarket<"u"?LaborMarket:null,ABMSimulationEngine:typeof ABMSimulationEngine<"u"?ABMSimulationEngine:null}}async function Pu(){console.log("Running ABM test simulation...");const a=new ABMSimulationEngine({numWorkers:1e3,numFirms:50,numRegions:5,durationMonths:12,onProgress:e=>{console.log(`Month ${e.month+1}/${e.totalMonths}`)}}),t={initialUnemploymentRate:.05,initialAIAdoption:.1,adoptionCurve:"s_curve",automationPace:"moderate"};try{const e=await a.runSimulation(t);return console.log(`
=== ABM Test Results ===`),console.log(`Initial unemployment: ${(e.summary.initial.unemploymentRate*100).toFixed(1)}%`),console.log(`Final unemployment: ${(e.summary.final.unemploymentRate*100).toFixed(1)}%`),console.log(`Peak unemployment: ${(e.summary.peakUnemployment*100).toFixed(1)}%`),console.log(`Initial AI adoption: ${(e.summary.initial.aiAdoptionRate*100).toFixed(1)}%`),console.log(`Final AI adoption: ${(e.summary.final.aiAdoptionRate*100).toFixed(1)}%`),console.log(`Total hires: ${e.summary.totalHires}`),console.log(`Total layoffs: ${e.summary.totalLayoffs}`),console.log(`Emergent patterns detected: ${e.summary.emergentPatterns.length}`),console.log(`
=== Policy Support (Final) ===`),Object.entries(e.summary.finalPolicySupport).forEach(([i,n])=>{console.log(`  ${i}: ${(n.mean*100).toFixed(0)}% support (feasibility: ${n.feasibilityScore})`)}),e}catch(e){throw console.error("ABM test failed:",e),e}}typeof window<"u"&&(window.initializeABM=Iu,window.testABM=Pu);class Te{constructor(){this.worker=null,this.isInitialized=!1,this.pendingRequests=new Map,this.requestId=0,this.onProgress=null,this.onComplete=null}static isSupported(){return typeof Worker<"u"}async initialize(t={},e={}){if(!Te.isSupported())throw new Error("Web Workers are not supported in this browser");return this.worker&&this.terminate(),new Promise((i,n)=>{try{this.worker=new Worker("src/workers/simulation-worker.js"),this.worker.onmessage=o=>this._handleMessage(o),this.worker.onerror=o=>{console.error("Worker error:",o),n(new Error(o.message))};const s=this._getRequestId();this.pendingRequests.set(s,{resolve:i,reject:n}),this.worker.postMessage({type:"init",requestId:s,payload:{config:t,scenario:e}})}catch(s){n(s)}})}async runMonth(t,e={}){if(!this.isInitialized)throw new Error("Worker not initialized");return new Promise((i,n)=>{const s=this._getRequestId();this.pendingRequests.set(s,{resolve:i,reject:n}),this.worker.postMessage({type:"runMonth",requestId:s,payload:{month:t,scenario:e}})})}async runSimulation(t={}){if(!this.isInitialized)throw new Error("Worker not initialized");return new Promise((e,i)=>{const n=this._getRequestId();this.pendingRequests.set(n,{resolve:e,reject:i,isSimulation:!0}),this.worker.postMessage({type:"runSimulation",requestId:n,payload:{scenario:t}})})}async getState(){return this.worker?new Promise((t,e)=>{const i=this._getRequestId();this.pendingRequests.set(i,{resolve:t,reject:e}),this.worker.postMessage({type:"getState",requestId:i})}):{isInitialized:!1}}setProgressCallback(t){this.onProgress=t}setCompletionCallback(t){this.onComplete=t}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.isInitialized=!1,this.pendingRequests.clear()}_handleMessage(t){const{type:e,requestId:i,payload:n,error:s}=t.data;switch(e){case"initComplete":this.isInitialized=!0,this._resolveRequest(i,n);break;case"monthComplete":this._resolveRequest(i,n);break;case"simulationComplete":this.onComplete&&this.onComplete(n),this._resolveRequest(i,n);break;case"progress":this.onProgress&&this.onProgress(n);break;case"state":this._resolveRequest(i,n);break;case"chunkComplete":this._resolveRequest(i,n);break;case"error":this._rejectRequest(i,new Error(s));break;default:console.warn("Unknown message type from worker:",e)}}_getRequestId(){return`req_${++this.requestId}`}_resolveRequest(t,e){const i=this.pendingRequests.get(t);i&&(this.pendingRequests.delete(t),i.resolve(e))}_rejectRequest(t,e){const i=this.pendingRequests.get(t);i&&(this.pendingRequests.delete(t),i.reject(e))}}class Ou{constructor(t=navigator.hardwareConcurrency||4){this.numWorkers=t,this.workers=[],this.isInitialized=!1}async initialize(t={},e={}){if(!Te.isSupported())throw new Error("Web Workers are not supported");const i=new Te;return await i.initialize(t,e),this.workers=[i],this.isInitialized=!0,{workerCount:this.workers.length,ready:!0}}async runSimulation(t={},e={}){if(!this.isInitialized||this.workers.length===0)throw new Error("Workers not initialized");const i=this.workers[0];return e.onProgress&&i.setProgressCallback(e.onProgress),e.onComplete&&i.setCompletionCallback(e.onComplete),i.runSimulation(t)}terminate(){for(const t of this.workers)t.terminate();this.workers=[],this.isInitialized=!1}}typeof window<"u"&&(window.WorkerManager=Te,window.ParallelSimulationManager=Ou);window.Chart=bn;window.DOMUtils=Jh;document.addEventListener("DOMContentLoaded",async()=>{await Ro(()=>import("./app-K7V0Ylxr.js"),[],import.meta.url),typeof window.initApp=="function"&&window.initApp()});
//# sourceMappingURL=main-CRf3ivLP.js.map
